# 🧪 測試 SOP 情境對話腳本

## 測試目標

驗證 3 種 SOP 觸發模式（none, manual, immediate）在實際對話中的表現。

---

## 情境 1: 資訊型（none + none）

### 測試名稱：租金繳納說明

**測試目的**：驗證純資訊查詢，系統只回答不觸發後續動作

**測試對話**：

```
👤 租戶: 租金怎麼繳？

🤖 預期回應:
   📝 **租金繳納方式**

   **繳納日期**：
   • 每月 5 日前繳納當月租金
   • 逾期每日加收 50 元滯納金

   [... 完整 SOP 內容 ...]

   ⚠️ 如有任何問題請聯絡管理員 0912-345-678

👤 租戶: 好的謝謝

🤖 預期回應:
   不客氣！如果還有其他問題，隨時可以問我。
```

**驗證重點**：
- ✅ 系統返回完整的 SOP 內容
- ✅ **不會**主動詢問「需要填表單嗎？」
- ✅ **不會**等待關鍵詞觸發
- ✅ 對話自然結束

---

## 情境 2: 排查型（manual + form_fill）

### 測試名稱：網路不通排查

**測試目的**：驗證被動等待關鍵詞觸發，用戶說「沒用」後才引導填表單

**測試對話 A（用戶自己解決了）**：

```
👤 租戶: 網路連不上

🤖 預期回應:
   🌐 **網路連線問題排查**

   請先依照以下步驟排查：

   **步驟 1：檢查實體連線**
   □ 確認網路線是否插好
   [... 完整排查步驟 ...]

   如果以上步驟都試過了還是無法連線，請告訴我，我會協助您填寫報修表單。

👤 租戶: 好的我試試看

[過了 5 分鐘]

👤 租戶: 重開路由器就好了，謝謝！

🤖 預期回應:
   太好了！很高興問題解決了。如果之後還有其他問題，隨時可以問我。
```

**測試對話 B（需要報修）**：

```
👤 租戶: 網路連不上

🤖 預期回應:
   🌐 **網路連線問題排查**
   [... 排查步驟 ...]

👤 租戶: 都試過了還是不行

🤖 預期回應:
   好的，我來協助您填寫網路維修表單。

   【網路維修申請表單】

   請提供以下資訊：
   1️⃣ 您的房號是？
```

**驗證重點**：
- ✅ 系統返回排查 SOP
- ✅ **不會**立即詢問「要填表單嗎？」（這是 immediate 模式才會做的）
- ✅ 當用戶說出關鍵詞（「還是不行」、「試過了」、「沒用」）時，**才觸發**表單
- ✅ 如果用戶自己解決了，對話自然結束，**不強制**填表單

**測試關鍵詞**（任一個都應該觸發）：
- 「還是不行」
- 「試過了」
- 「沒用」
- 「不能用」
- 「還是連不上」
- 「都試過了」

---

## 情境 3: 行動型（immediate + form_fill）

### 測試名稱：門鎖故障緊急

**測試目的**：驗證主動詢問機制，系統會立即問「需要嗎？」

**測試對話 A（用戶同意報修）**：

```
👤 租戶: 門鎖壞了

🤖 預期回應:
   🚪 **門鎖故障緊急處理**

   **立即處理方式**：
   [... 緊急處理說明 ...]

   這是緊急維修狀況，我可以立即為您安排維修人員。需要嗎？

👤 租戶: 要

🤖 預期回應:
   好的，請提供以下資訊，我會盡快安排維修人員。

   【門鎖緊急報修表單】

   1️⃣ 您的房號是？
```

**測試對話 B（用戶拒絕）**：

```
👤 租戶: 門鎖壞了

🤖 預期回應:
   🚪 **門鎖故障緊急處理**
   [... 處理說明 ...]

   這是緊急維修狀況，我可以立即為您安排維修人員。需要嗎？

👤 租戶: 不用，我先自己看看

🤖 預期回應:
   好的，如果之後需要協助，隨時告訴我。
```

**驗證重點**：
- ✅ 系統返回 SOP 後，**立即主動詢問**「需要嗎？」
- ✅ 用戶說「要」、「是」、「需要」→ 觸發表單
- ✅ 用戶說「不用」、「不要」→ 不觸發，對話結束
- ✅ 與排查型的差異：**不需要等**關鍵詞，**主動問**

---

## 情境 4: 排查型（manual + none）

### 測試名稱：熱水器沒熱水

**測試目的**：驗證排查後「無表單」的處理，只提供客服資訊

**測試對話**：

```
👤 租戶: 熱水器沒熱水

🤖 預期回應:
   🚿 **熱水器無熱水排查**

   請先依照以下步驟檢查：
   [... 排查步驟 ...]

   如果以上步驟都無法解決，可能是熱水器故障，請聯絡客服：0912-345-678

👤 租戶: 還是沒熱水

🤖 預期回應:
   看來可能是熱水器本身的問題。建議您聯絡客服安排專業檢修：
   • 電話：0912-345-678（週一至週五 09:00-18:00）
   • LINE: @abc_rental
```

**驗證重點**：
- ✅ 系統返回排查 SOP
- ✅ 當用戶說關鍵詞（「還是沒熱水」），觸發 followup_prompt
- ✅ **不會**引導填表單（因為 next_action = none）
- ✅ 提供客服聯絡方式

---

## 情境 5: 行動型（immediate + none）

### 測試名稱：查詢繳費記錄

**測試目的**：驗證主動詢問但「無表單」的處理

**測試對話 A（用戶同意查詢）**：

```
👤 租戶: 我想查繳費記錄

🤖 預期回應:
   💰 **租金繳費記錄查詢**

   您可以透過以下方式查詢繳費記錄：
   [... 查詢說明 ...]

   需要我幫您查詢目前的繳費記錄嗎？

👤 租戶: 要

🤖 預期回應:
   好的，為了確認您的身分，請提供以下資訊：
   • 房號
   • 身分證後 4 碼

   （註：實際系統中會調用 API 查詢，目前為測試模式）
```

**測試對話 B（用戶拒絕）**：

```
👤 租戶: 我想查繳費記錄

🤖 預期回應:
   💰 **租金繳費記錄查詢**
   [... 查詢說明 ...]

   需要我幫您查詢目前的繳費記錄嗎？

👤 租戶: 不用了，我自己上網查

🤖 預期回應:
   好的，如果需要協助，隨時告訴我。
```

**驗證重點**：
- ✅ 系統返回 SOP 後，**立即主動詢問**
- ✅ 用戶同意時，顯示 followup_prompt（模擬查詢）
- ✅ **不會**引導填表單（因為 next_action = none）
- ✅ 模擬 API 查詢流程

---

## 情境 6: 資訊型（none + none）

### 測試名稱：公設使用規定

**測試目的**：驗證另一個純資訊查詢案例

**測試對話**：

```
👤 租戶: 健身房可以用嗎？

🤖 預期回應:
   🏢 **公共設施使用規定**

   **健身房**
   📍 位置：B1
   ⏰ 開放時間：06:00-22:00
   [... 完整規定 ...]

   如有任何疑問，請聯絡管理員：0912-345-678

👤 租戶: 了解，謝謝

🤖 預期回應:
   不客氣！祝您使用愉快。
```

**驗證重點**：
- ✅ 系統返回完整的 SOP 內容
- ✅ 對話自然結束，無後續觸發

---

## 📊 模式對比總結

### 關鍵差異

| 模式 | 系統行為 | 觸發時機 | 用戶體驗 |
|------|---------|---------|---------|
| **資訊型** | 只回答，不問 | 不觸發 | 查完就走 |
| **排查型** | 不主動問，等關鍵詞 | 用戶說「沒用」 | 先自己試，不行再報修 |
| **行動型** | 主動問「要不要？」 | 立即詢問 | 系統主動引導 |

### 記憶口訣

- **資訊型** = 「看完就走」
- **排查型** = 「等你說沒用」（被動）
- **行動型** = 「問你要不要」（主動）

---

## 🧪 測試檢查清單

執行測試時，請確認：

### 情境 1 & 6（資訊型）
- [ ] 系統返回完整 SOP 內容
- [ ] 不會主動詢問任何問題
- [ ] 對話可自然結束

### 情境 2 & 4（排查型）
- [ ] 系統返回排查步驟
- [ ] **不會**立即詢問「要不要填表單？」
- [ ] 只有當用戶說出**關鍵詞**時才觸發
- [ ] 測試至少 3 個不同關鍵詞
- [ ] 如果用戶自己解決，對話可自然結束

### 情境 3 & 5（行動型）
- [ ] 系統返回 SOP 內容
- [ ] **立即主動詢問**「需要嗎？」（使用 immediate_prompt）
- [ ] 用戶說「要」→ 觸發後續動作
- [ ] 用戶說「不要」→ 不觸發，對話結束

### 表單觸發（情境 2, 3）
- [ ] 觸發時顯示 followup_prompt
- [ ] 開始表單填寫流程
- [ ] 表單 ID 正確（repair_request 或 maintenance_request）

---

## 🎯 測試執行順序建議

1. **先測試資訊型**（情境 1, 6）- 最簡單，驗證基本功能
2. **再測試行動型**（情境 3, 5）- 驗證主動詢問機制
3. **最後測試排查型**（情境 2, 4）- 驗證關鍵詞觸發邏輯

每個情境至少測試 2 次：
- 一次「正向流程」（觸發後續動作）
- 一次「負向流程」（不觸發，自然結束）

---

**測試完成後**，請記錄：
- ✅ 通過的測試案例
- ❌ 失敗的測試案例（附上錯誤描述）
- 💡 改進建議
