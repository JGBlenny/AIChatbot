"""
建立測試知識匯入用的 Excel 檔案
測試項目：
1. 意圖推薦
2. 文字去重
3. 語意去重
4. B2C 測試情境建議
5. 審核佇列匯入
"""
import pandas as pd
from pathlib import Path

# 建立測試數據
test_data = [
    # 租客問題（B2C）- 應該建立測試情境
    {
        "問題": "如何繳納租金？",
        "答案": "您可以透過以下方式繳納租金：\n1. 臨櫃繳費：攜帶繳費單至指定銀行繳費\n2. ATM轉帳：使用虛擬帳號轉帳\n3. 線上繳費：登入 JGB 系統使用信用卡或行動支付\n\n繳費期限為每月5日前，逾期會產生滯納金。",
        "分類": "帳務查詢",
        "對象": "租客",
        "關鍵字": "繳費, 租金, ATM, 信用卡"
    },
    {
        "問題": "租金要怎麼繳？",  # 語意相似，應該被去重
        "答案": "您可以透過以下方式繳納租金：\n1. 臨櫃繳費：攜帶繳費單至指定銀行繳費\n2. ATM轉帳：使用虛擬帳號轉帳\n3. 線上繳費：登入 JGB 系統使用信用卡或行動支付",
        "分類": "帳務查詢",
        "對象": "租客",
        "關鍵字": "繳費, 租金"
    },
    {
        "問題": "可以養寵物嗎？",
        "答案": "關於寵物飼養規定：\n1. 需事先向房東申請，並獲得書面同意\n2. 部分物件有寵物押金要求\n3. 飼主需負責寵物造成的損害\n4. 需定期清潔，不得影響環境衛生\n5. 不得飼養危險性寵物\n\n詳細規定請參考您的租賃合約。",
        "分類": "合約規定",
        "對象": "租客",
        "關鍵字": "寵物, 狗, 貓, 規定"
    },
    {
        "問題": "能不能養狗？",  # 語意相似，應該被去重
        "答案": "關於養狗的規定，需要事先向房東申請並獲得書面同意。部分物件可能需要額外的寵物押金。",
        "分類": "合約規定",
        "對象": "租客",
        "關鍵字": "寵物, 狗"
    },
    # 房東問題（B2C）
    {
        "問題": "如何申請退租？",
        "答案": "退租流程如下：\n1. 提前30天以書面通知房東\n2. 預約退租驗屋時間\n3. 清空個人物品並復原房屋\n4. 配合驗屋確認房屋狀況\n5. 結清水電費等帳單\n6. 歸還鑰匙及門禁卡\n7. 確認退租後，押金將於7個工作天內退還\n\n如有任何問題請聯繫客服。",
        "分類": "退租流程",
        "對象": "房東",
        "關鍵字": "退租, 驗屋, 押金"
    },
    # 管理師問題（B2B）- 不應建立測試情境
    {
        "問題": "如何使用系統報修功能？",
        "答案": "系統報修功能使用方式：\n1. 登入管理後台\n2. 進入「報修管理」頁面\n3. 點選「新增報修單」\n4. 填寫報修項目、位置、嚴重程度\n5. 上傳現場照片（選填）\n6. 指派維修人員\n7. 追蹤維修進度\n\n系統會自動通知相關人員。",
        "分類": "設備報修",
        "對象": "管理師",
        "關鍵字": "報修, 系統, 後台"
    },
    # IOT 設備問題
    {
        "問題": "智慧門鎖一直嗶嗶叫怎麼辦？",
        "答案": "智慧門鎖嗶嗶聲通常有以下原因：\n1. 電量不足警告：請更換電池（使用3號鹼性電池4顆）\n2. 門未關好警告：請確認門片是否完全關閉\n3. 異常開啟警告：可能有人嘗試非法開啟\n\n如果更換電池後仍持續響起，請聯繫客服安排檢修。緊急狀況可使用備用鑰匙開門。",
        "分類": "設備使用",
        "對象": "租客",
        "關鍵字": "IOT, 門鎖, 嗶嗶, 電池"
    },
    # 完全重複的項目（測試文字去重）
    {
        "問題": "如何繳納租金？",
        "答案": "您可以透過以下方式繳納租金：\n1. 臨櫃繳費：攜帶繳費單至指定銀行繳費\n2. ATM轉帳：使用虛擬帳號轉帳\n3. 線上繳費：登入 JGB 系統使用信用卡或行動支付\n\n繳費期限為每月5日前，逾期會產生滯納金。",
        "分類": "帳務查詢",
        "對象": "租客",
        "關鍵字": "繳費, 租金, ATM, 信用卡"
    },
    # 合約查詢
    {
        "問題": "如何查詢租約到期日？",
        "答案": "查詢租約到期日的方式：\n1. 登入 JGB 系統\n2. 進入「我的租約」頁面\n3. 查看「合約資訊」區塊\n4. 可下載電子合約查看完整內容\n\n系統會在合約到期前30天發送提醒通知。",
        "分類": "租約查詢",
        "對象": "租客",
        "關鍵字": "合約, 租約, 到期日"
    },
    # 看房預約
    {
        "問題": "如何預約看房？",
        "答案": "預約看房流程：\n1. 瀏覽物件頁面，選擇有興趣的房源\n2. 點選「預約看房」按鈕\n3. 選擇方便的時間（平日10:00-18:00）\n4. 填寫聯絡資訊\n5. 等待客服確認並通知\n6. 依約定時間至現場看房\n\n看房時請攜帶身分證件。",
        "分類": "預約看房",
        "對象": "租客",
        "關鍵字": "看房, 預約, 物件"
    }
]

# 建立 DataFrame
df = pd.DataFrame(test_data)

# 儲存為 Excel
output_path = Path(__file__).parent.parent / "fixtures" / "test_knowledge_data.xlsx"
df.to_excel(output_path, index=False, engine='openpyxl')

print(f"✅ 測試檔案已建立: {output_path}")
print(f"📊 包含 {len(df)} 條測試知識")
print(f"\n測試項目：")
print(f"  - B2C 知識（租客+房東）: {len(df[df['對象'].isin(['租客', '房東'])])} 條 → 應建立測試情境")
print(f"  - B2B 知識（管理師）: {len(df[df['對象'] == '管理師'])} 條 → 不建立測試情境")
print(f"  - 完全重複項目: 1 條 → 應在文字去重時過濾")
print(f"  - 語意相似項目: 2 對 → 應在語意去重時過濾")
print(f"\n預期結果：")
print(f"  - 文字去重後: {len(df) - 1} 條")
print(f"  - 語意去重後: ~{len(df) - 3} 條（視相似度閾值）")
print(f"  - 測試情境建議: ~7 條（B2C 且未重複）")
