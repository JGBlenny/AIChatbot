# AIChatbot å¾Œå°ç®¡ç†ç³»çµ± - å°ˆæ¡ˆæ¦‚è¦½

## ğŸ¯ å°ˆæ¡ˆç›®æ¨™

å»ºç«‹ä¸€å€‹å®Œæ•´çš„å¾Œå°ç³»çµ±ï¼Œç”¨æ–¼ï¼š
1. åŒ¯å…¥å’Œç®¡ç† LINE å°è©±è¨˜éŒ„
2. ä½¿ç”¨ AI è‡ªå‹•è™•ç†å’Œåˆ†é¡å°è©±
3. ç”Ÿæˆ Markdown çŸ¥è­˜åº«æª”æ¡ˆ
4. æ”¯æ´ RAGï¼ˆæª¢ç´¢å¢å¼·ç”Ÿæˆï¼‰ç³»çµ±

---

## ğŸ“ å°ˆæ¡ˆçµæ§‹

```
AIChatbot/
â”œâ”€â”€ README.md                    # å°ˆæ¡ˆèªªæ˜
â”œâ”€â”€ NEXT_STEPS.md               # ä¸‹ä¸€æ­¥è¡Œå‹•æŒ‡å—
â”œâ”€â”€ PROJECT_OVERVIEW.md         # æœ¬æª”æ¡ˆ
â”‚
â”œâ”€â”€ backend/                    # FastAPI å¾Œç«¯
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ api/               # API è·¯ç”±
â”‚   â”‚   â”‚   â”œâ”€â”€ conversations.py    # å°è©±ç®¡ç† API
â”‚   â”‚   â”‚   â””â”€â”€ processing.py       # AI è™•ç† API
â”‚   â”‚   â”œâ”€â”€ core/              # æ ¸å¿ƒé…ç½®
â”‚   â”‚   â”‚   â”œâ”€â”€ config.py          # ç’°å¢ƒé…ç½®
â”‚   â”‚   â”‚   â””â”€â”€ database.py        # è³‡æ–™åº«é€£æ¥
â”‚   â”‚   â”œâ”€â”€ models/            # SQLAlchemy æ¨¡å‹
â”‚   â”‚   â”‚   â””â”€â”€ conversation.py    # å°è©±è³‡æ–™æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ schemas/           # Pydantic Schemas
â”‚   â”‚   â”‚   â””â”€â”€ conversation.py    # è³‡æ–™é©—è­‰æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ services/          # æ¥­å‹™é‚è¼¯
â”‚   â”‚   â”‚   â”œâ”€â”€ line_parser.py     # LINE å°è©±è§£æ
â”‚   â”‚   â”‚   â””â”€â”€ openai_service.py  # OpenAI API æ•´åˆ
â”‚   â”‚   â”œâ”€â”€ utils/             # å·¥å…·å‡½æ•¸
â”‚   â”‚   â””â”€â”€ main.py            # FastAPI æ‡‰ç”¨å…¥å£
â”‚   â”œâ”€â”€ tests/                 # æ¸¬è©¦
â”‚   â”œâ”€â”€ requirements.txt       # Python ä¾è³´
â”‚   â”œâ”€â”€ .env.example          # ç’°å¢ƒè®Šæ•¸ç¯„ä¾‹
â”‚   â”œâ”€â”€ test_example.py       # æ¸¬è©¦è…³æœ¬
â”‚   â””â”€â”€ test_conversation.txt # æ¸¬è©¦è³‡æ–™
â”‚
â”œâ”€â”€ frontend/                  # React å‰ç«¯ (å¾…å»ºç«‹)
â”‚
â”œâ”€â”€ knowledge-base/            # Markdown çŸ¥è­˜åº«æª”æ¡ˆ
â”‚
â””â”€â”€ docs/                      # æ–‡ä»¶
    â”œâ”€â”€ QUICKSTART.md         # å¿«é€Ÿé–‹å§‹æŒ‡å—
    â””â”€â”€ API_USAGE.md          # API ä½¿ç”¨æ–‡ä»¶
```

---

## ğŸ› ï¸ æŠ€è¡“æ£§

### å¾Œç«¯
- **èªè¨€**: Python 3.11+
- **æ¡†æ¶**: FastAPI 0.109
- **è³‡æ–™åº«**: PostgreSQL 16 + SQLAlchemy (Async)
- **AI**: OpenAI API (GPT-4/GPT-3.5)
- **å‘é‡è³‡æ–™åº«**: pgvector (å…è²») æˆ– Pinecone
- **ä»»å‹™éšŠåˆ—**: Celery + Redis (é¸ç”¨)

### å‰ç«¯ (å¾…å»ºç«‹)
- **èªè¨€**: TypeScript
- **æ¡†æ¶**: React 18 + Vite
- **UI**: Ant Design æˆ– Material-UI
- **ç‹€æ…‹ç®¡ç†**: React Query + Zustand
- **HTTP**: Axios

---

## ğŸ”„ è³‡æ–™æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ LINE å°è©±æ–‡å­—   â”‚
â”‚ (ç´”æ–‡å­—æˆ–JSON)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. åŒ¯å…¥è§£æ    â”‚  â† line_parser.py
â”‚  - è§£æè¨Šæ¯æ ¼å¼  â”‚
â”‚  - è­˜åˆ¥åƒèˆ‡è€…    â”‚
â”‚  - æå–æ™‚é–“æˆ³è¨˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. å„²å­˜è³‡æ–™åº«   â”‚  â† conversations.py
â”‚  - åŸå§‹å°è©±     â”‚
â”‚  - ä¾†æºè³‡è¨Š     â”‚
â”‚  - ç‹€æ…‹: pending â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. AI è™•ç†      â”‚  â† openai_service.py
â”‚  - å“è³ªè©•ä¼° (1-10)â”‚
â”‚  - è‡ªå‹•åˆ†é¡     â”‚
â”‚  - å…§å®¹æ¸…ç†æ”¹å¯«  â”‚
â”‚  - å¯¦é«”æå–     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. äººå·¥å¯©æ ¸     â”‚  â† processing.py
â”‚  - æª¢è¦– AI çµæœ  â”‚
â”‚  - æ‰‹å‹•èª¿æ•´     â”‚
â”‚  - æ‰¹å‡†/æ‹’çµ•    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. ç”Ÿæˆ MD      â”‚  â† (å¾…å¯¦ä½œ)
â”‚  - æŒ‰åˆ†é¡çµ„ç¹”   â”‚
â”‚  - Q&A æ ¼å¼åŒ–   â”‚
â”‚  - åŠ å…¥å…ƒæ•¸æ“š   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. å‘é‡åŒ–       â”‚  â† (å¾…å¯¦ä½œ)
â”‚  - èªç¾©åˆ†å¡Š     â”‚
â”‚  - ç”ŸæˆåµŒå…¥     â”‚
â”‚  - å„²å­˜ pgvector â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 7. RAG æª¢ç´¢     â”‚  â† (å¾…å¯¦ä½œ)
â”‚  - ç”¨æˆ¶æŸ¥è©¢     â”‚
â”‚  - ç›¸ä¼¼åº¦æœå°‹   â”‚
â”‚  - ç”Ÿæˆå›ç­”     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š è³‡æ–™åº« Schema

### conversations è¡¨
| æ¬„ä½ | é¡å‹ | èªªæ˜ |
|------|------|------|
| id | UUID | ä¸»éµ |
| raw_content | JSONB | åŸå§‹å°è©±å…§å®¹ |
| processed_content | JSONB | AI è™•ç†çµæœ |
| source | String | ä¾†æº (line/manual) |
| status | Enum | ç‹€æ…‹ (pending/processing/reviewed/approved/rejected) |
| quality_score | Integer | å“è³ªåˆ†æ•¸ 1-10 |
| primary_category | String | ä¸»è¦åˆ†é¡ |
| tags | Array | æ¨™ç±¤ |
| created_at | DateTime | å»ºç«‹æ™‚é–“ |

### knowledge_files è¡¨
| æ¬„ä½ | é¡å‹ | èªªæ˜ |
|------|------|------|
| id | UUID | ä¸»éµ |
| file_path | String | MD æª”æ¡ˆè·¯å¾‘ |
| category | String | åˆ†é¡ |
| content | Text | MD å…§å®¹ |
| version | Integer | ç‰ˆæœ¬è™Ÿ |
| vectorized_at | DateTime | å‘é‡åŒ–æ™‚é–“ |

è©³ç´° Schema è«‹è¦‹ï¼š`backend/app/models/conversation.py`

---

## ğŸ”Œ API ç«¯é»

### å°è©±ç®¡ç†
```
POST   /api/conversations/import/line/text    # åŒ¯å…¥æ–‡å­—æª”
POST   /api/conversations/import/line         # åŒ¯å…¥ JSON
GET    /api/conversations/                    # åˆ—è¡¨æŸ¥è©¢
GET    /api/conversations/{id}                # æŸ¥è©¢è©³æƒ…
PUT    /api/conversations/{id}                # æ›´æ–°
DELETE /api/conversations/{id}                # åˆªé™¤
GET    /api/conversations/stats/summary       # çµ±è¨ˆ
```

### AI è™•ç†
```
POST /api/processing/{id}/process-all    # å®Œæ•´è™•ç†
POST /api/processing/{id}/evaluate       # å“è³ªè©•ä¼°
POST /api/processing/{id}/categorize     # åˆ†é¡
POST /api/processing/{id}/clean          # æ¸…ç†æ”¹å¯«
POST /api/processing/{id}/extract        # æå–å¯¦é«”
POST /api/processing/{id}/approve        # æ‰¹å‡†
POST /api/processing/{id}/reject         # æ‹’çµ•
POST /api/processing/batch/process       # æ‰¹æ¬¡è™•ç†
```

è©³ç´°æ–‡ä»¶ï¼š[docs/API_USAGE.md](docs/API_USAGE.md)

---

## ğŸ’¡ æ ¸å¿ƒåŠŸèƒ½èªªæ˜

### 1. LINE å°è©±è§£æå™¨ (`line_parser.py`)

**æ”¯æ´æ ¼å¼**:
```
# æ ¼å¼ 1: å®Œæ•´æ™‚é–“æˆ³è¨˜
2024/01/15 14:30 å¼µä¸‰: è¨Šæ¯å…§å®¹

# æ ¼å¼ 2: æ‹¬è™Ÿæ ¼å¼
[2024-01-15 14:30:00] å¼µä¸‰: è¨Šæ¯å…§å®¹

# æ ¼å¼ 3: åƒ…æ™‚é–“
14:30 å¼µä¸‰: è¨Šæ¯å…§å®¹
```

**åŠŸèƒ½**:
- è‡ªå‹•è­˜åˆ¥è¨Šæ¯æ ¼å¼
- æå–åƒèˆ‡è€…
- æ™‚é–“æˆ³è¨˜è§£æ
- è½‰æ›ç‚ºæ¨™æº– JSON
- æ ¼å¼åŒ–ç‚º Q&A

### 2. OpenAI æœå‹™ (`openai_service.py`)

**åŠŸèƒ½**:

#### å“è³ªè©•ä¼°
```python
{
  "score": 8,
  "reasoning": "å°è©±å®Œæ•´ä¸”å…§å®¹ç›¸é—œ...",
  "suggestions": ["å»ºè­°..."]
}
```

#### è‡ªå‹•åˆ†é¡
```python
{
  "primary": "æŠ€è¡“æ”¯æ´",
  "secondary": ["åŠŸèƒ½è©¢å•", "ä½¿ç”¨æ•™å­¸"],
  "confidence": 0.92
}
```

#### å…§å®¹æ¸…ç†
```python
{
  "question": "å¦‚ä½•ä½¿ç”¨é€™å€‹åŠŸèƒ½ï¼Ÿ",
  "answer": "ä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼š...",
  "context": "å°è©±æ™‚é–“ï¼š...",
  "tags": ["è¨­å®š", "æ•™å­¸"],
  "confidence": 0.95
}
```

#### å¯¦é«”æå–
```python
{
  "entities": {
    "products": ["ç”¢å“A"],
    "features": ["åŠŸèƒ½X"],
    "versions": ["v2.0"]
  },
  "intents": ["è©¢å•", "æ±‚åŠ©"],
  "sentiment": "positive",
  "keywords": ["è¨­å®š", "æ•™å­¸"]
}
```

---

## ğŸ“ˆ ä½¿ç”¨æƒ…å¢ƒ

### æƒ…å¢ƒ 1: å®¢æœå°è©±æ•´ç†
1. åŒ¯å‡º LINE å®¢æœå°è©±è¨˜éŒ„
2. ä¸Šå‚³åˆ°ç³»çµ±
3. AI è‡ªå‹•åˆ†é¡ç‚ºï¼šç”¢å“åŠŸèƒ½ã€æŠ€è¡“æ”¯æ´ã€è¨ˆè²»å•é¡Œç­‰
4. äººå·¥å¯©æ ¸ç¢ºèª
5. ç”Ÿæˆ FAQ çŸ¥è­˜åº«

### æƒ…å¢ƒ 2: ç”¢å“æ–‡ä»¶å»ºç«‹
1. æ”¶é›†ç”¨æˆ¶èˆ‡å®¢æœçš„å°è©±
2. AI æå–ç”¢å“åŠŸèƒ½ç›¸é—œå•ç­”
3. æ•´ç†ç‚ºä½¿ç”¨æ•™å­¸æ–‡ä»¶
4. å‘é‡åŒ–å¾Œæ”¯æ´ AI å•ç­”

### æƒ…å¢ƒ 3: å“è³ªåˆ†æ
1. å®šæœŸåŒ¯å…¥å°è©±
2. è©•ä¼°å®¢æœå›ç­”å“è³ª
3. è­˜åˆ¥å¸¸è¦‹å•é¡Œ
4. æ”¹é€²æœå‹™æµç¨‹

---

## ğŸ”’ å®‰å…¨æ€§è€ƒé‡

### ç’°å¢ƒè®Šæ•¸
- æ‰€æœ‰æ•æ„Ÿè³‡è¨Šå­˜æ”¾åœ¨ `.env`
- ä¸æäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶
- ä½¿ç”¨å¼·éš¨æ©Ÿ `SECRET_KEY`

### API å®‰å…¨
- CORS é™åˆ¶ä¾†æº
- æœªä¾†åŠ å…¥ JWT èªè­‰
- Rate Limiting

### è³‡æ–™éš±ç§
- å°è©±å…§å®¹åŠ å¯†å„²å­˜ï¼ˆå¯é¸ï¼‰
- å®šæœŸæ¸…ç†èˆŠè³‡æ–™
- éµå®ˆ GDPRï¼ˆå¦‚é©ç”¨ï¼‰

---

## ğŸ’° æˆæœ¬é ä¼°

### OpenAI API æˆæœ¬ï¼ˆæ¯æœˆï¼‰

| æ–¹æ¡ˆ | æ¨¡å‹ | è™•ç†é‡ | é ä¼°æˆæœ¬ |
|------|------|--------|---------|
| è¶…çœ | GPT-3.5-Turbo | 500 ç­† | $5-10 |
| ç¶“æ¿Ÿ | GPT-4o-mini | 2000 ç­† | $20-30 |
| æ¨™æº– | GPT-4-Turbo | 5000 ç­† | $100-150 |

**è¨ˆç®—æ–¹å¼**:
- æ¯ç­†å°è©±ç´„ 500 tokens
- è™•ç† 3 æ¬¡ï¼ˆè©•ä¼° + åˆ†é¡ + æ¸…ç†ï¼‰
- GPT-3.5: $0.001/1K tokens
- GPT-4: $0.01/1K tokens

### å‘é‡è³‡æ–™åº«æˆæœ¬

| æ–¹æ¡ˆ | æˆæœ¬ |
|------|------|
| pgvector | $0ï¼ˆä½¿ç”¨ç¾æœ‰ PostgreSQLï¼‰|
| Pinecone Starter | $70/æœˆ |
| Weaviate è‡ªæ¶ | $0ï¼ˆéœ€ä¼ºæœå™¨ï¼‰|

**å»ºè­°**: å°è³‡æ–™é‡ä½¿ç”¨ **pgvector**

---

## ğŸš€ æ•ˆèƒ½å„ªåŒ–

### è³‡æ–™åº«
- å»ºç«‹ç´¢å¼•ï¼ˆstatus, category, created_atï¼‰
- ä½¿ç”¨é€£æ¥æ± 
- åˆ†é æŸ¥è©¢

### API
- éåŒæ­¥è™•ç†ï¼ˆFastAPI + SQLAlchemy Asyncï¼‰
- èƒŒæ™¯ä»»å‹™ï¼ˆæ‰¹æ¬¡è™•ç†ï¼‰
- å¿«å–ï¼ˆRedisï¼Œé¸ç”¨ï¼‰

### AI è™•ç†
- æ‰¹æ¬¡å‘¼å«ï¼ˆæ¸›å°‘ API è«‹æ±‚ï¼‰
- å¹³è¡Œè™•ç†ï¼ˆasyncio.gatherï¼‰
- çµæœå¿«å–

---

## ğŸ§ª æ¸¬è©¦

### å–®å…ƒæ¸¬è©¦
```bash
cd backend
pytest tests/
```

### API æ¸¬è©¦
```bash
# ä½¿ç”¨æ¸¬è©¦è…³æœ¬
python test_example.py

# æˆ–ä½¿ç”¨ pytest
pytest tests/test_api.py
```

### è² è¼‰æ¸¬è©¦
```bash
# ä½¿ç”¨ locust
pip install locust
locust -f tests/locustfile.py
```

---

## ğŸ“¦ éƒ¨ç½²

### é–‹ç™¼ç’°å¢ƒ
- æœ¬åœ° PostgreSQL
- Uvicorn è‡ªå‹•é‡è¼‰
- DEBUG=True

### ç”Ÿç”¢ç’°å¢ƒå»ºè­°
- Docker Compose
- PostgreSQLï¼ˆé›²ç«¯æˆ–è‡ªæ¶ï¼‰
- Nginx åå‘ä»£ç†
- Gunicorn + Uvicorn Workers
- Supervisor æˆ– systemd

**Docker Compose ç¯„ä¾‹**:
```yaml
version: '3.8'
services:
  backend:
    build: ./backend
    environment:
      - DATABASE_URL=postgresql://...
      - OPENAI_API_KEY=...
    ports:
      - "8000:8000"

  db:
    image: postgres:16
    volumes:
      - postgres_data:/var/lib/postgresql/data

  redis:
    image: redis:7
```

---

## ğŸ“– å­¸ç¿’è³‡æº

### FastAPI
- [å®˜æ–¹æ•™å­¸](https://fastapi.tiangolo.com/tutorial/)
- [éåŒæ­¥è³‡æ–™åº«](https://fastapi.tiangolo.com/advanced/async-sql-databases/)

### LangChain
- [å¿«é€Ÿé–‹å§‹](https://python.langchain.com/docs/get_started/quickstart)
- [RAG æ•™å­¸](https://python.langchain.com/docs/use_cases/question_answering/)

### PostgreSQL
- [pgvector æ•™å­¸](https://github.com/pgvector/pgvector)
- [SQLAlchemy 2.0](https://docs.sqlalchemy.org/en/20/)

---

## ğŸ¤ è²¢ç»æŒ‡å—

### é–‹ç™¼æµç¨‹
1. Fork å°ˆæ¡ˆ
2. å»ºç«‹ feature branch
3. æäº¤è®Šæ›´
4. å»ºç«‹ Pull Request

### ç¨‹å¼è¦ç¯„
- ä½¿ç”¨ Black æ ¼å¼åŒ–
- éµå¾ª PEP 8
- æ’°å¯«å–®å…ƒæ¸¬è©¦
- æ›´æ–°æ–‡ä»¶

---

## ğŸ“„ æˆæ¬Š

MIT License

---

## ğŸ‘¨â€ğŸ’» ä½œè€…

å»ºç«‹æ–¼ 2024 å¹´ï¼Œä½¿ç”¨ Claude Code å”åŠ©é–‹ç™¼

---

**é–‹å§‹ä½¿ç”¨**: è«‹åƒè€ƒ [å¿«é€Ÿé–‹å§‹æŒ‡å—](docs/QUICKSTART.md)

**API æ–‡ä»¶**: è«‹åƒè€ƒ [API ä½¿ç”¨èªªæ˜](docs/API_USAGE.md)

**ä¸‹ä¸€æ­¥**: è«‹åƒè€ƒ [NEXT_STEPS.md](NEXT_STEPS.md)
