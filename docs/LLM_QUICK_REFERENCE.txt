╔════════════════════════════════════════════════════════════════════════════════╗
║          AIChatbot LLM 使用分析 - 快速參考卡 (Quick Reference)                  ║
║                              2026-02-14                                         ║
╚════════════════════════════════════════════════════════════════════════════════╝

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
1️⃣ 核心 LLM 使用點 (7 個)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

┌─ 聊天模型 (Chat Completions)
│
├─ 1. 意圖分類 (Intent Classification)
│   位置: intent_classifier.py:316-326
│   模型: gpt-3.5-turbo
│   頻率: 每個問題 1 次
│   用途: Function Calling 分類用戶意圖
│
├─ 2. 答案優化 (Answer Optimization)
│   位置: llm_answer_optimizer.py:1008
│   模型: gpt-3.5-turbo
│   頻率: 高信心度問題 1 次 (80% 命中)
│   用途: 優化 RAG 檢索結果
│
├─ 3. 答案合成 (Answer Synthesis)
│   位置: llm_answer_optimizer.py:799
│   模型: gpt-3.5-turbo
│   頻率: 多結果問題 1 次
│   用途: 合成多個答案為完整回應
│
├─ 4. 知識生成 (Knowledge Generation)
│   位置: knowledge_generator.py:99-100
│   模型: gpt-3.5-turbo
│   頻率: 按需 (非實時)
│   用途: 生成知識候選答案
│
├─ 5. 文件轉換 (Document Converter)
│   位置: document_converter_service.py:48
│   模型: gpt-4o (預設)
│   頻率: 按需 (文件上傳時)
│   用途: 解析 Word/PDF 規格書，提取 Q&A
│
└─ 6. 意圖建議 (Intent Suggestion)
    位置: intent_suggestion_engine.py:24
    模型: gpt-3.5-turbo
    頻率: 按需 (不在主路徑)
    用途: 分析 unclear 問題，建議新增意圖

┌─ Embedding 模型
│
└─ 7. 向量生成 (Embedding Generation)
    位置: embedding-service/app.py:100-105
    模型: text-embedding-3-small
    頻率: 每個知識條目 1 次 + 查詢時 1 次
    用途: 生成文本向量用於語義搜索


━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
2️⃣ 成本估算 (月度)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

日均查詢: 1,000 個

當前方案 (全 OpenAI)
  意圖分類:        $1.65  ░░░░░░░░░░ 30%
  答案優化/合成:   $3.17  ░░░░░░░░░░░░░░░░░░░░ 58%
  文件轉換:        $0.55  ░░░░░ 10%
  知識生成:        $0.08  ░ 1%
  Embedding:       $0.01  - 0.2%
  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  合計:            $5.46/月

成本範圍:
  低用量 (500 查詢/日):     $1.64/月
  中用量 (1,000 查詢/日):   $5.46/月  ← 假設
  高用量 (5,000 查詢/日):   $27.30/月
  超高用量 (10,000 查詢/日): $54.60/月


━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
3️⃣ 切換選項對比
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

                    難度   實施時間  成本節約  新月成本  主要優點
┌────────────────────────────────────────────────────────────────┐
│ OpenRouter        2/5   2-3 天   35-50%   $3-4    ✓ API 相容性高
│                                                    ✓ 模型選擇多
│                                                    ✓ 無需本地部署
├────────────────────────────────────────────────────────────────┤
│ Ollama            3/5   4-5 天   70-80%   $0.5-1  ✓ 完全自主控制
│                                                    ✓ 隱私保護
│                                                    ✓ 成本最低
├────────────────────────────────────────────────────────────────┤
│ 混合方案 (推薦)   3/5   6 周    65-80%   $1-2    ✓ 最佳平衡
│                                                    ✓ 分層優化
│ - Embedding→Ollama                                 ✓ 成本+性能
│ - 意圖分類→OpenRouter                              ✓ 風險最低
│ - 答案優化→OpenRouter
└────────────────────────────────────────────────────────────────┘


━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
4️⃣ 混合方案 - 分層策略 (推薦)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

層級  功能              Provider              成本      優點
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
1️⃣   Embedding        Ollama (本地)         $0.05/月  最快，成本最低
     (文本向量)

2️⃣   意圖分類         OpenRouter+Mistral    $0.50/月  速度快，成本低
     (低延遲)

3️⃣   答案優化         OpenRouter+Claude     $3-4/月   性能最佳，成本可控
     (高品質)

4️⃣   文件轉換         Ollama+OpenRouter     $0.5-1/月 高複雜度，按需


━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
5️⃣ 立即行動 (Week 1)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

[準備階段]
□ 設置 OpenRouter 帳戶
□ 建立 Ollama 本地測試環境
□ 創建 LLMProvider 抽象基類
□ 計畫 6 周實施時間表


━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
6️⃣ 需要修改的文件 (6 個核心服務)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

✏️  intent_classifier.py                  行 27, 316-326
✏️  llm_answer_optimizer.py               行 36, 704, 799, 1008
✏️  knowledge_generator.py                行 99-100
✏️  document_converter_service.py         行 48
✏️  intent_suggestion_engine.py           行 24
✏️  embedding-service/app.py              行 28, 100-105


━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
7️⃣ 關鍵指標總結
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

代碼耦合度:          0.13% (20,082 行代碼中僅 27 個 LLM 函數)
切換難度:           2-3/5 (相對容易)
預期成本節約:       65-80% (混合方案)
年度投資回報率:     73% (5 年周期)
實施風險:           低-中 (技術可控，完整測試覆蓋)

关键成功因素:
  ✓ 建立 LLMProvider 抽象層 (最重要!)
  ✓ 完整的 A/B 測試驗證
  ✓ 漸進式灰度部署
  ✓ 自動監控和告警


━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📋 完整報告位置
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

詳細分析報告:     docs/LLM_USAGE_ANALYSIS_2026-02-14.md
執行總結:         docs/LLM_ANALYSIS_EXECUTIVE_SUMMARY.md
快速參考卡:       docs/LLM_QUICK_REFERENCE.txt (本文件)

