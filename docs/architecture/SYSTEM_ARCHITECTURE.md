# ç³»çµ±æ¶æ§‹æ–‡ä»¶

## ğŸ“‹ ç›®éŒ„

- [æ¦‚è¿°](#æ¦‚è¿°)
- [ç³»çµ±æ¶æ§‹åœ–](#ç³»çµ±æ¶æ§‹åœ–)
- [æŠ€è¡“æ£§](#æŠ€è¡“æ£§)
- [æ ¸å¿ƒæœå‹™](#æ ¸å¿ƒæœå‹™)
- [è³‡æ–™åº«è¨­è¨ˆ](#è³‡æ–™åº«è¨­è¨ˆ)
- [API æ¶æ§‹](#api-æ¶æ§‹)
- [éƒ¨ç½²æ¶æ§‹](#éƒ¨ç½²æ¶æ§‹)
- [å®‰å…¨æ€§è¨­è¨ˆ](#å®‰å…¨æ€§è¨­è¨ˆ)
- [æ“´å±•æ€§è¨­è¨ˆ](#æ“´å±•æ€§è¨­è¨ˆ)

---

## æ¦‚è¿°

### ç³»çµ±å®šä½

**AI Chatbot for Rental Management** æ˜¯ä¸€å€‹å°ˆç‚ºåŒ…ç§Ÿä»£ç®¡æ¥­è€…è¨­è¨ˆçš„ **SaaS å¤šç§Ÿæˆ¶ AI å®¢æœå¹³å°**ã€‚

### æ ¸å¿ƒç‰¹é»

- **ğŸª SaaS å¤šç§Ÿæˆ¶æ¶æ§‹**ï¼šæ”¯æ´å¤šå€‹æ¥­è€…ï¼Œè³‡æ–™å®Œå…¨éš”é›¢
- **ğŸ¤– RAG æ™ºèƒ½å•ç­”**ï¼šçµåˆçŸ¥è­˜åº«æª¢ç´¢èˆ‡ LLM å„ªåŒ–
- **ğŸ”„ Reranker äºŒéšæ®µæª¢ç´¢**ï¼šCross-Encoder é‡æ’åºï¼Œæº–ç¢ºç‡æå‡ 3 å€
- **ğŸ“‹ SOP æµç¨‹è‡ªå‹•åŒ–**ï¼šæ™ºèƒ½ SOP è§¸ç™¼èˆ‡åŸ·è¡Œï¼ˆmanual/immediate/autoï¼‰
- **ğŸ“ è¡¨å–®ç®¡ç†ç³»çµ±**ï¼šå‹•æ…‹è¡¨å–®å‰µå»ºã€å¡«å¯«ã€æäº¤èˆ‡ API æ•´åˆ
- **ğŸ¨ LLM åƒæ•¸æ³¨å…¥**ï¼šæ™ºèƒ½èª¿æ•´æ¥­è€…å·®ç•°åŒ–åƒæ•¸
- **ğŸ” ç°¡åŒ–çŸ¥è­˜ç¯„åœ**ï¼švendor_id æ±ºå®šï¼ˆNULL=å…¨åŸŸ, éNULL=æ¥­è€…å°ˆå±¬ï¼‰
- **âš¡ Redis ä¸‰å±¤ç·©å­˜**ï¼šå•é¡Œ/å‘é‡/çµæœç·©å­˜ï¼Œç¯€çœ 70-90% API æˆæœ¬
- **ğŸ“¡ å¤–éƒ¨ API æ•´åˆ**ï¼ˆPhase 2ï¼‰ï¼šæ•´åˆæ¥­è€…æ—¢æœ‰ç³»çµ±

### æ¥­å‹™æ¨¡å‹

```
å¹³å°æä¾›å•†ï¼ˆæ‚¨ï¼‰
    â†“ æä¾› SaaS æœå‹™
åŒ…ç§Ÿä»£ç®¡æ¥­è€… Aã€Bã€C...ï¼ˆäº’ç‚ºç«¶çˆ­å°æ‰‹ï¼‰
    â†“ æœå‹™çµ‚ç«¯ä½¿ç”¨è€…
ç§Ÿå®¢ï¼ˆB2Cï¼‰/ æ¥­è€…å®¢æœï¼ˆB2Bï¼‰
```

---

## ç³»çµ±æ¶æ§‹åœ–

### é«˜éšæ¶æ§‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          ä½¿ç”¨è€…å±¤                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚  ç§Ÿå®¢ App    â”‚  â”‚  æ¥­è€…å®¢æœ    â”‚  â”‚  ç®¡ç†å¾Œå°    â”‚          â”‚
â”‚  â”‚  (LINE/Web)  â”‚  â”‚  ä»‹é¢        â”‚  â”‚  (Admin)     â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          API é–˜é“å±¤                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Nginx (Reverse Proxy)                                 â”‚    â”‚
â”‚  â”‚  - è·¯ç”±è½‰ç™¼                                             â”‚    â”‚
â”‚  â”‚  - è² è¼‰å¹³è¡¡                                             â”‚    â”‚
â”‚  â”‚  - SSL/TLS çµ‚æ­¢                                        â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          æ‡‰ç”¨æœå‹™å±¤                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚  RAG Orchestrator â”‚          â”‚  Knowledge Admin â”‚            â”‚
â”‚  â”‚  (FastAPI)        â”‚          â”‚  (Vue.js 3)      â”‚            â”‚
â”‚  â”‚  Port: 8100       â”‚          â”‚  Port: 8087(dev) â”‚            â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤          â”‚  Port: 8081(prod)â”‚            â”‚
â”‚  â”‚                  â”‚          â”‚                  â”‚            â”‚
â”‚  â”‚  æ ¸å¿ƒæœå‹™:       â”‚          â”‚  ç®¡ç†åŠŸèƒ½:       â”‚            â”‚
â”‚  â”‚  âœ“ æ„åœ–åˆ†é¡      â”‚          â”‚  âœ“ çŸ¥è­˜åº«ç®¡ç†    â”‚            â”‚
â”‚  â”‚  âœ“ RAG æª¢ç´¢      â”‚          â”‚  âœ“ SOP ç®¡ç†      â”‚            â”‚
â”‚  â”‚  âœ“ Reranker å„ªåŒ– â”‚          â”‚  âœ“ è¡¨å–®ç·¨è¼¯å™¨    â”‚            â”‚
â”‚  â”‚  âœ“ LLM å„ªåŒ–      â”‚          â”‚  âœ“ æ¥­è€…ç®¡ç†      â”‚            â”‚
â”‚  â”‚  âœ“ åƒæ•¸æ³¨å…¥      â”‚          â”‚  âœ“ å¯©æ ¸ä¸­å¿ƒ      â”‚            â”‚
â”‚  â”‚  âœ“ SOP å”èª¿å™¨    â”‚  ğŸ†•      â”‚  âœ“ Chat æ¸¬è©¦     â”‚            â”‚
â”‚  â”‚  âœ“ è¡¨å–®ç®¡ç†å™¨    â”‚  ğŸ†•      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚  â”‚  âœ“ Chat API      â”‚                                           â”‚
â”‚  â”‚  âœ“ æµå¼ API      â”‚                                           â”‚
â”‚  â”‚                  â”‚                                           â”‚
â”‚  â”‚  Phase 2:        â”‚                                           â”‚
â”‚  â”‚  â³ ç§Ÿå®¢è­˜åˆ¥     â”‚                                           â”‚
â”‚  â”‚  â³ å¤–éƒ¨ API     â”‚                                           â”‚
â”‚  â”‚                  â”‚                                           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                           â”‚
â”‚           â†“                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚  Embedding API   â”‚          â”‚  Knowledge Admin â”‚            â”‚
â”‚  â”‚  (FastAPI)       â”‚  ğŸ†•      â”‚  API (FastAPI)   â”‚            â”‚
â”‚  â”‚  Port: 5001      â”‚          â”‚  Port: 8000      â”‚            â”‚
â”‚  â”‚                  â”‚          â”‚                  â”‚            â”‚
â”‚  â”‚  âœ“ å‘é‡ç”Ÿæˆ      â”‚          â”‚  âœ“ CRUD API      â”‚            â”‚
â”‚  â”‚  âœ“ Redis ç·©å­˜    â”‚          â”‚  âœ“ æ¸¬è©¦æƒ…å¢ƒç®¡ç†  â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          è³‡æ–™èˆ‡ç·©å­˜å±¤                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  PostgreSQL 15 + pgvector                              â”‚    â”‚
â”‚  â”‚  Database: aichatbot                                   â”‚    â”‚
â”‚  â”‚  Port: 5432                                            â”‚    â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚  â”‚  æ ¸å¿ƒè³‡æ–™è¡¨:                                            â”‚    â”‚
â”‚  â”‚  âœ“ knowledge_base (çŸ¥è­˜åº« + å‘é‡)                       â”‚    â”‚
â”‚  â”‚  âœ“ intents (æ„åœ–)                                      â”‚    â”‚
â”‚  â”‚  âœ“ vendors (æ¥­è€…)                                      â”‚    â”‚
â”‚  â”‚  âœ“ vendor_configs (æ¥­è€…é…ç½®)                           â”‚    â”‚
â”‚  â”‚                                                        â”‚    â”‚
â”‚  â”‚  SOP ç³»çµ±è¡¨: ğŸ†•                                         â”‚    â”‚
â”‚  â”‚  âœ“ vendor_sop_categories (SOP åˆ†é¡)                    â”‚    â”‚
â”‚  â”‚  âœ“ vendor_sop_items (SOP é …ç›®)                         â”‚    â”‚
â”‚  â”‚  âœ“ vendor_sop_groups (SOP ç¾¤çµ„)                        â”‚    â”‚
â”‚  â”‚  âœ“ vendor_sop_intent_intents (SOP æ„åœ–é—œè¯)            â”‚    â”‚
â”‚  â”‚                                                        â”‚    â”‚
â”‚  â”‚  è¡¨å–®ç³»çµ±è¡¨: ğŸ†•                                         â”‚    â”‚
â”‚  â”‚  âœ“ form_schemas (è¡¨å–®å®šç¾©)                             â”‚    â”‚
â”‚  â”‚  âœ“ form_submissions (è¡¨å–®æäº¤è¨˜éŒ„)                      â”‚    â”‚
â”‚  â”‚  âœ“ form_field_values (è¡¨å–®æ¬„ä½å€¼)                       â”‚    â”‚
â”‚  â”‚                                                        â”‚    â”‚
â”‚  â”‚  å…¶ä»–ç³»çµ±è¡¨:                                            â”‚    â”‚
â”‚  â”‚  âœ“ chat_history (å°è©±æ­·å²)                             â”‚    â”‚
â”‚  â”‚  âœ“ unclear_questions (æœªçŸ¥å•é¡Œ)                         â”‚    â”‚
â”‚  â”‚  âœ“ suggested_intents (æ„åœ–å»ºè­°)                         â”‚    â”‚
â”‚  â”‚  âœ“ test_scenarios (æ¸¬è©¦æƒ…å¢ƒ)                           â”‚    â”‚
â”‚  â”‚                                                        â”‚    â”‚
â”‚  â”‚  Phase 2:                                              â”‚    â”‚
â”‚  â”‚  â³ tenants (ç§Ÿå®¢)                                     â”‚    â”‚
â”‚  â”‚  â³ vendor_apis (å¤–éƒ¨ API)                             â”‚    â”‚
â”‚  â”‚  â³ vendor_api_logs (API æ—¥èªŒ)                         â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Redis 7                                               â”‚ ğŸ†• â”‚
â”‚  â”‚  Port: 6381                                            â”‚    â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚  â”‚  ä¸‰å±¤ç·©å­˜:                                              â”‚    â”‚
â”‚  â”‚  âœ“ å•é¡Œç·©å­˜ (TTL: 1å°æ™‚)                               â”‚    â”‚
â”‚  â”‚  âœ“ å‘é‡ç·©å­˜ (TTL: 24å°æ™‚)                              â”‚    â”‚
â”‚  â”‚  âœ“ çµæœç·©å­˜ (TTL: 1å°æ™‚)                               â”‚    â”‚
â”‚  â”‚                                                        â”‚    â”‚
â”‚  â”‚  SOP ä¸Šä¸‹æ–‡ç·©å­˜:                                        â”‚    â”‚
â”‚  â”‚  âœ“ SOP ç‹€æ…‹ (TTL: 10åˆ†é˜ - 1å°æ™‚)                      â”‚    â”‚
â”‚  â”‚                                                        â”‚    â”‚
â”‚  â”‚  è¡¨å–®æœƒè©±ç·©å­˜:                                          â”‚    â”‚
â”‚  â”‚  âœ“ è¡¨å–®ç‹€æ…‹ (TTL: 30åˆ†é˜)                              â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          å¤–éƒ¨æœå‹™å±¤                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚  OpenAI API      â”‚          â”‚  æ¥­è€…å¤–éƒ¨ç³»çµ±    â”‚            â”‚
â”‚  â”‚  (GPT-4o-mini)   â”‚          â”‚  (Phase 2)       â”‚            â”‚
â”‚  â”‚                  â”‚          â”‚  - ERP           â”‚            â”‚
â”‚  â”‚  åŠŸèƒ½:           â”‚          â”‚  - CRM           â”‚            â”‚
â”‚  â”‚  âœ“ æ„åœ–åˆ†é¡      â”‚          â”‚  - ç‰©æ¥­ç®¡ç†ç³»çµ±  â”‚            â”‚
â”‚  â”‚  âœ“ å‘é‡åµŒå…¥      â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚  â”‚  âœ“ LLM å„ªåŒ–      â”‚                                           â”‚
â”‚  â”‚  âœ“ Reranker é‡æ’ â”‚                                           â”‚
â”‚  â”‚  âœ“ åƒæ•¸æ³¨å…¥      â”‚                                           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                           â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## æŠ€è¡“æ£§

### å¾Œç«¯

| æŠ€è¡“ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| **Python** | 3.11+ | ä¸»è¦é–‹ç™¼èªè¨€ |
| **FastAPI** | 0.104+ | Web æ¡†æ¶ |
| **SQLAlchemy** | 2.0+ | ORM |
| **Pydantic** | 2.0+ | è³‡æ–™é©—è­‰ |
| **OpenAI SDK** | 1.0+ | LLM æ•´åˆ |
| **pgvector** | 0.2+ | å‘é‡æœå°‹ |
| **asyncpg** | 0.28+ | ç•°æ­¥ PostgreSQL é©…å‹• |
| **Redis** | 7.0+ | ç·©å­˜ç³»çµ± ğŸ†• |

### å‰ç«¯

| æŠ€è¡“ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| **Vue.js** | 3.3+ | å‰ç«¯æ¡†æ¶ |
| **Vue Router** | 4.0+ | è·¯ç”±ç®¡ç† |
| **Axios** | 1.0+ | HTTP å®¢æˆ¶ç«¯ |
| **Vite** | 4.0+ | å»ºç½®å·¥å…· |
| **SimpleMDE** | 2.18+ | Markdown ç·¨è¼¯å™¨ |
| **vuedraggable** | 4.1+ | æ‹–æ‹½æ’åº ğŸ†• |

### è³‡æ–™åº«

| æŠ€è¡“ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| **PostgreSQL** | 15+ | é—œè¯å¼è³‡æ–™åº« |
| **pgvector** | 0.5+ | å‘é‡æœå°‹æ“´å±• |

### åŸºç¤è¨­æ–½

| æŠ€è¡“ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| **Docker** | 24.0+ | å®¹å™¨åŒ– |
| **Docker Compose** | 2.20+ | å®¹å™¨ç·¨æ’ |
| **Nginx** | 1.24+ | åå‘ä»£ç† |
| **Redis** | 7.0+ | ç·©å­˜èˆ‡æœƒè©±å­˜å„² ğŸ†• |

---

## æ ¸å¿ƒæœå‹™

### 1. RAG Orchestratorï¼ˆæ ¸å¿ƒå¼•æ“ï¼‰

**ä½ç½®ï¼š** `rag-orchestrator/`

**è·è²¬ï¼š**
- æ„åœ–åˆ†é¡èˆ‡è·¯ç”±
- RAG çŸ¥è­˜æª¢ç´¢
- Reranker äºŒéšæ®µå„ªåŒ–
- LLM ç­”æ¡ˆå„ªåŒ–
- æ¥­è€…åƒæ•¸ç®¡ç†
- SOP æµç¨‹å”èª¿ ğŸ†•
- è¡¨å–®ç®¡ç†èˆ‡å¡«å¯« ğŸ†•
- Chat API æä¾›

**æŠ€è¡“æ¶æ§‹ï¼š**

```
rag-orchestrator/
â”œâ”€â”€ main.py                          # FastAPI æ‡‰ç”¨å…¥å£
â”œâ”€â”€ routers/
â”‚   â”œâ”€â”€ chat.py                      # Chat API è·¯ç”±
â”‚   â”œâ”€â”€ vendors.py                   # æ¥­è€…ç®¡ç† API
â”‚   â”œâ”€â”€ knowledge.py                 # çŸ¥è­˜åº« API
â”‚   â”œâ”€â”€ intents.py                   # æ„åœ–ç®¡ç† API
â”‚   â”œâ”€â”€ forms.py                     # è¡¨å–®ç®¡ç† API ğŸ†•
â”‚   â””â”€â”€ cache.py                     # ç·©å­˜ç®¡ç† API ğŸ†•
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ intent_classifier.py         # æ„åœ–åˆ†é¡æœå‹™
â”‚   â”œâ”€â”€ rag_engine.py                # RAG æª¢ç´¢æœå‹™
â”‚   â”œâ”€â”€ reranker_service.py          # Reranker é‡æ’åº ğŸ†•
â”‚   â”œâ”€â”€ llm_answer_optimizer.py      # LLM å„ªåŒ–æœå‹™
â”‚   â”œâ”€â”€ cache_service.py             # ä¸‰å±¤ç·©å­˜æœå‹™ ğŸ†•
â”‚   â”œâ”€â”€ vendor_parameter_resolver.py # æ¥­è€…åƒæ•¸è§£æ
â”‚   â”œâ”€â”€ vendor_knowledge_retriever.py# æ¥­è€…çŸ¥è­˜æª¢ç´¢
â”‚   â”œâ”€â”€ vendor_sop_retriever.py      # SOP æª¢ç´¢æœå‹™ ğŸ†•
â”‚   â”œâ”€â”€ sop_orchestrator.py          # SOP å”èª¿å™¨ ğŸ†•
â”‚   â”œâ”€â”€ sop_trigger_handler.py       # SOP è§¸ç™¼è™•ç† ğŸ†•
â”‚   â”œâ”€â”€ form_manager.py              # è¡¨å–®ç®¡ç†å™¨ ğŸ†•
â”‚   â”œâ”€â”€ tenant_identifier.py         # [Phase 2] ç§Ÿå®¢è­˜åˆ¥
â”‚   â”œâ”€â”€ external_api_client.py       # [Phase 2] å¤–éƒ¨ API
â”‚   â””â”€â”€ customer_service_assistant.py# [Phase 2] å®¢æœåŠ©ç†
â”œâ”€â”€ models/
â”‚   â””â”€â”€ database.py                  # SQLAlchemy æ¨¡å‹
â””â”€â”€ utils/
    â”œâ”€â”€ vector_utils.py              # å‘é‡è™•ç†å·¥å…·
    â””â”€â”€ redis_client.py              # Redis å®¢æˆ¶ç«¯ ğŸ†•
```

**æ ¸å¿ƒæµç¨‹ï¼š**

```python
# Chat API è™•ç†æµç¨‹ï¼ˆ2026-02-03 æœ€æ–°ç‰ˆæœ¬ï¼‰
async def process_chat_message(message, vendor_id, user_role, session_id):
    # 0. æª¢æŸ¥ SOP ä¸Šä¸‹æ–‡ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
    sop_context = await sop_orchestrator.check_context(session_id)
    if sop_context:
        # è™•ç† SOP è§¸ç™¼é—œéµè©æˆ–è¡¨å–®å¡«å¯«
        result = await sop_orchestrator.handle_context(message, sop_context)
        if result:
            return result

    # 1. æ„åœ–åˆ†é¡
    intent = await intent_classifier.classify(message)

    # 2. RAG æª¢ç´¢ï¼ˆèªç¾©æœå°‹ï¼‰
    search_results = await rag_service.search(
        query=message,
        intent_id=intent.id,
        vendor_id=vendor_id,
        user_role=user_role
    )

    # 3. Reranker äºŒéšæ®µé‡æ’åº
    reranked_results = await reranker_service.rerank(
        query=message,
        documents=search_results
    )

    # 4. æª¢æŸ¥æ˜¯å¦æœ‰ SOP åŒ¹é…
    sop_result = await sop_orchestrator.process_query(
        user_message=message,
        vendor_id=vendor_id,
        user_role=user_role,
        session_id=session_id,
        user_id=user_id
    )

    # 5. ç²å–æ¥­è€…åƒæ•¸
    vendor_params = await parameter_resolver.get_vendor_parameters(vendor_id)
    vendor_name = await get_vendor_name(vendor_id)

    # 6. LLM å„ªåŒ– + åƒæ•¸æ³¨å…¥
    result = await llm_optimizer.optimize_answer(
        question=message,
        search_results=reranked_results,
        sop_result=sop_result,  # ğŸ†• SOP çµæœ
        confidence_level=intent.confidence_level,
        intent_info=intent,
        vendor_params=vendor_params,
        vendor_name=vendor_name
    )

    return result
```

---

### 2. SOP Orchestratorï¼ˆSOP å”èª¿å™¨ï¼‰ğŸ†•

**è·è²¬ï¼š**
- SOP åŒ¹é…èˆ‡æª¢ç´¢
- SOP è§¸ç™¼æ¨¡å¼è™•ç†ï¼ˆmanual/immediate/autoï¼‰
- SOP ä¸Šä¸‹æ–‡ç®¡ç†ï¼ˆRedisï¼‰
- è§¸ç™¼é—œéµè©åµæ¸¬
- è¡¨å–®è§¸ç™¼èˆ‡åŸ·è¡Œ

**è§¸ç™¼æ¨¡å¼ï¼š**

| æ¨¡å¼ | èªªæ˜ | æµç¨‹ |
|------|------|------|
| **manual** (æ’æŸ¥å‹) | é¡¯ç¤º SOP å…§å®¹å¾Œï¼Œç­‰å¾…ç”¨æˆ¶ä¸»å‹•èªªè§¸ç™¼é—œéµè© | SOP å…§å®¹ â†’ ç­‰å¾…é—œéµè© â†’ åŸ·è¡Œå‹•ä½œ |
| **immediate** (è¡Œå‹•å‹) | é¡¯ç¤º SOP å…§å®¹å¾Œï¼Œç«‹å³è©¢å•æ˜¯å¦åŸ·è¡Œ | SOP å…§å®¹ â†’ ç¢ºèªæç¤º â†’ åŸ·è¡Œå‹•ä½œ |
| **auto** (è‡ªå‹•å‹) | ç›´æ¥åŸ·è¡Œï¼Œä¸ç­‰å¾…ç¢ºèª | ç›´æ¥åŸ·è¡Œå‹•ä½œï¼ˆè¡¨å–®/APIï¼‰ |

**æ ¸å¿ƒæ–¹æ³•ï¼š**

```python
class SOPOrchestrator:
    async def process_query(self, user_message, vendor_id, session_id, **kwargs):
        """è™•ç†ç”¨æˆ¶æŸ¥è©¢ï¼Œæª¢æŸ¥ SOP åŒ¹é…"""

        # 1. æª¢æŸ¥ç¾æœ‰ä¸Šä¸‹æ–‡
        context = await self._check_context(session_id)

        # 2. å¦‚æœæœ‰ä¸Šä¸‹æ–‡ï¼Œè™•ç†è§¸ç™¼
        if context:
            return await self._handle_trigger(user_message, context)

        # 3. æœå°‹ SOP
        sop_results = await sop_retriever.search(
            query=user_message,
            vendor_id=vendor_id,
            user_role=kwargs.get('user_role')
        )

        # 4. æ ¹æ“šè§¸ç™¼æ¨¡å¼è™•ç†
        if best_match:
            trigger_mode = best_match.get('trigger_mode')

            if trigger_mode == 'manual':
                return await self._handle_manual_mode(best_match, session_id)
            elif trigger_mode == 'immediate':
                return await self._handle_immediate_mode(best_match, session_id)
            else:
                # trigger_mode ç‚º null æˆ–æœªå®šç¾©æ™‚ï¼Œä¸è§¸ç™¼ä»»ä½•å‹•ä½œ
                return None
```

---

### 3. Form Managerï¼ˆè¡¨å–®ç®¡ç†å™¨ï¼‰ğŸ†•

**è·è²¬ï¼š**
- å‹•æ…‹è¡¨å–®å‰µå»ºèˆ‡ç·¨è¼¯
- è¡¨å–®å¡«å¯«æµç¨‹ç®¡ç†
- è¡¨å–®é©—è­‰ï¼ˆå°ç£å§“åã€é›»è©±ã€åœ°å€ç­‰ï¼‰
- è¡¨å–®æäº¤èˆ‡å­˜å„²
- API æ•´åˆï¼ˆon_complete_actionï¼‰

**è¡¨å–®å®Œæˆå¾Œå‹•ä½œï¼š**

| å‹•ä½œé¡å‹ | èªªæ˜ | ç”¨é€” |
|----------|------|------|
| **show_knowledge** | é¡¯ç¤ºçŸ¥è­˜åº«ç­”æ¡ˆ | ä¸€èˆ¬è³‡æ–™æ”¶é›† |
| **call_api** | èª¿ç”¨å¤–éƒ¨ API | å°‡è¡¨å–®æ•¸æ“šå‚³é€åˆ°æ¥­è€…ç³»çµ± |
| **both** | å…©è€…éƒ½åŸ·è¡Œ | åŒæ™‚é¡¯ç¤ºè¨Šæ¯ä¸¦èª¿ç”¨ API |

**API é…ç½®çµæ§‹ï¼š**

```json
{
  "method": "POST",
  "endpoint": "https://api.example.com/submit",
  "headers": {
    "Content-Type": "application/json",
    "Authorization": "Bearer TOKEN"
  },
  "params": {
    "source": "chatbot",
    "notify": true
  }
}
```

---

### 4. Embedding APIï¼ˆå‘é‡æœå‹™ï¼‰ğŸ†•

**ä½ç½®ï¼š** `embedding-service/`

**è·è²¬ï¼š**
- çµ±ä¸€å‘é‡ç”Ÿæˆ
- Redis å‘é‡ç·©å­˜
- æ‰¹é‡å‘é‡è™•ç†

**ç·©å­˜ç­–ç•¥ï¼š**
- TTL: 24 å°æ™‚
- å‘½ä¸­ç‡ç›®æ¨™: 70-90%
- ç¯€çœæˆæœ¬: OpenAI API èª¿ç”¨æ¸›å°‘ 70-90%

---

### 5. Knowledge Adminï¼ˆç®¡ç†å¾Œå°ï¼‰

**ä½ç½®ï¼š** `knowledge-admin/frontend/`

**è·è²¬ï¼š**
- æ¥­è€…ç®¡ç†ï¼ˆCRUDï¼‰
- æ¥­è€…é…ç½®ç®¡ç†
- çŸ¥è­˜åº«ç®¡ç†
- SOP ç®¡ç† ğŸ†•
- è¡¨å–®ç·¨è¼¯å™¨ ğŸ†•
- æ„åœ–ç®¡ç†
- å¯©æ ¸ä¸­å¿ƒ ğŸ†•
- Chat æ¸¬è©¦ä»‹é¢

**é é¢æ¶æ§‹ï¼š**

```
frontend/src/
â”œâ”€â”€ views/
â”‚   â”œâ”€â”€ KnowledgeView.vue            # çŸ¥è­˜åº«ç®¡ç†
â”‚   â”œâ”€â”€ IntentsView.vue              # æ„åœ–ç®¡ç†
â”‚   â”œâ”€â”€ VendorManagementView.vue     # æ¥­è€…ç®¡ç†
â”‚   â”œâ”€â”€ VendorConfigView.vue         # æ¥­è€…é…ç½®
â”‚   â”œâ”€â”€ ChatTestView.vue             # Chat æ¸¬è©¦
â”‚   â”œâ”€â”€ ReviewCenterView.vue         # å¯©æ ¸ä¸­å¿ƒ ğŸ†•
â”‚   â”œâ”€â”€ FormEditorView.vue           # è¡¨å–®ç·¨è¼¯å™¨ ğŸ†•
â”‚   â”œâ”€â”€ FormListView.vue             # è¡¨å–®åˆ—è¡¨ ğŸ†•
â”‚   â”œâ”€â”€ TenantManagementView.vue     # [Phase 2] ç§Ÿå®¢ç®¡ç†
â”‚   â”œâ”€â”€ APIConfigView.vue            # [Phase 2] API é…ç½®
â”‚   â””â”€â”€ CustomerServiceView.vue      # [Phase 2] å®¢æœåŠ©ç†
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ VendorSOPManager.vue         # SOP ç®¡ç†çµ„ä»¶ ğŸ†•
â”‚   â””â”€â”€ review/                      # å¯©æ ¸çµ„ä»¶ ğŸ†•
â”‚       â”œâ”€â”€ ScenarioReviewTab.vue
â”‚       â”œâ”€â”€ UnclearQuestionReviewTab.vue
â”‚       â”œâ”€â”€ IntentReviewTab.vue
â”‚       â””â”€â”€ KnowledgeReviewTab.vue
â””â”€â”€ router/
    â””â”€â”€ index.js                      # Vue Router é…ç½®
```

---

## è³‡æ–™åº«è¨­è¨ˆ

### ER åœ–ï¼ˆEntity Relationship Diagramï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   vendors   â”‚â”€â”€â”€â”€1:Nâ”€â”€â”‚ vendor_configs   â”‚         â”‚ knowledge_base  â”‚
â”‚             â”‚         â”‚                  â”‚         â”‚                 â”‚
â”‚ - id        â”‚         â”‚ - id             â”‚         â”‚ - id            â”‚
â”‚ - code      â”‚         â”‚ - vendor_id (FK) â”‚         â”‚ - question      â”‚
â”‚ - name      â”‚         â”‚ - category       â”‚         â”‚ - answer        â”‚
â”‚ - is_active â”‚         â”‚ - param_key      â”‚         â”‚ - vendor_id (FK)â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚ - param_value    â”‚         â”‚ - intent_id (FK)â”‚
      â”‚                 â”‚ - data_type      â”‚         â”‚ - scope         â”‚
      â”‚                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚ - priority      â”‚
      â”‚                                              â”‚ - embedding     â”‚
      â”‚                                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚                                                      â”‚
      â”‚                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€1:Nâ”€â”€â”€â”€â”€â”€â”‚    intents       â”‚â”€â”€â”€â”€â”€â”€â”€â”€N:1â”€â”€â”€â”€â”€â”˜
                        â”‚                  â”‚
                        â”‚ - id             â”‚
                        â”‚ - name           â”‚
                        â”‚ - intent_type    â”‚
                        â”‚ - keywords       â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ†• SOP ç³»çµ±è¡¨:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ vendor_sop_       â”‚â”€â”€â”€â”€1:Nâ”€â”€â”‚ vendor_sop_items  â”‚
â”‚ categories        â”‚         â”‚                   â”‚
â”‚ - id              â”‚         â”‚ - id              â”‚
â”‚ - name            â”‚         â”‚ - category_id(FK) â”‚
â”‚ - vendor_id (FK)  â”‚         â”‚ - title           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚ - content         â”‚
                              â”‚ - trigger_mode    â”‚
                              â”‚ - next_action     â”‚
                              â”‚ - next_form_id    â”‚
                              â”‚ - trigger_keywordsâ”‚
                              â”‚ - immediate_promptâ”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ†• è¡¨å–®ç³»çµ±è¡¨:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ form_schemas  â”‚â”€â”€â”€â”€1:Nâ”€â”€â”‚ form_submissions  â”‚â”€â”€â”€â”€1:Nâ”€â”€â”‚ form_field_    â”‚
â”‚               â”‚         â”‚                   â”‚         â”‚ values         â”‚
â”‚ - form_id(PK) â”‚         â”‚ - id              â”‚         â”‚                â”‚
â”‚ - form_name   â”‚         â”‚ - form_id (FK)    â”‚         â”‚ - id           â”‚
â”‚ - vendor_id   â”‚         â”‚ - session_id      â”‚         â”‚ - submission_idâ”‚
â”‚ - fields      â”‚         â”‚ - submitted_at    â”‚         â”‚ - field_name   â”‚
â”‚ - on_complete â”‚ ğŸ†•      â”‚ - status          â”‚         â”‚ - field_value  â”‚
â”‚ - api_config  â”‚ ğŸ†•      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å…¶ä»–ç³»çµ±è¡¨:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ chat_history  â”‚    â”‚ unclear_questionsâ”‚    â”‚ suggested_intentsâ”‚
â”‚               â”‚    â”‚                  â”‚    â”‚                  â”‚
â”‚ - id          â”‚    â”‚ - id             â”‚    â”‚ - id             â”‚
â”‚ - session_id  â”‚    â”‚ - question       â”‚    â”‚ - question_id    â”‚
â”‚ - vendor_id   â”‚    â”‚ - frequency      â”‚    â”‚ - suggested_name â”‚
â”‚ - question    â”‚    â”‚ - status         â”‚    â”‚ - confidence     â”‚
â”‚ - answer      â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Phase 2 æ–°å¢è¡¨æ ¼:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  tenants    â”‚         â”‚  vendor_apis     â”‚
â”‚             â”‚         â”‚                  â”‚
â”‚ - id        â”‚         â”‚ - id             â”‚
â”‚ - vendor_id â”‚â—„â”€â”€â”€â”€1:Nâ”€â”‚ - vendor_id (FK) â”‚
â”‚ - name      â”‚         â”‚ - api_name       â”‚
â”‚ - phone     â”‚         â”‚ - base_url       â”‚
â”‚ - room_no   â”‚         â”‚ - auth_type      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒè³‡æ–™è¡¨

#### Phase 1ï¼ˆå·²å¯¦ä½œï¼‰

| è¡¨å | èªªæ˜ | ä¸»è¦æ¬„ä½ |
|------|------|---------|
| `knowledge_base` | çŸ¥è­˜åº« | question, answer, embedding, vendor_id, scope |
| `intents` | æ„åœ– | name, intent_type, keywords, example_questions |
| `vendors` | æ¥­è€… | code, name, subscription_plan, is_active |
| `vendor_configs` | æ¥­è€…é…ç½® | vendor_id, category, param_key, param_value |
| `vendor_sop_categories` ğŸ†• | SOP åˆ†é¡ | name, vendor_id, sort_order |
| `vendor_sop_items` ğŸ†• | SOP é …ç›® | title, content, trigger_mode, next_action |
| `vendor_sop_groups` ğŸ†• | SOP ç¾¤çµ„ | name, vendor_id |
| `form_schemas` ğŸ†• | è¡¨å–®å®šç¾© | form_id, form_name, fields, on_complete_action, api_config |
| `form_submissions` ğŸ†• | è¡¨å–®æäº¤ | form_id, session_id, status, submitted_at |
| `form_field_values` ğŸ†• | è¡¨å–®æ¬„ä½å€¼ | submission_id, field_name, field_value |
| `chat_history` | å°è©±æ­·å² | session_id, vendor_id, question, answer |
| `unclear_questions` | æœªçŸ¥å•é¡Œ | question, frequency, status, last_asked |
| `suggested_intents` | æ„åœ–å»ºè­° | question_id, suggested_name, confidence |
| `test_scenarios` | æ¸¬è©¦æƒ…å¢ƒ | question, expected_answer, difficulty, status |

#### Phase 2ï¼ˆå¾…å¯¦ä½œï¼‰

| è¡¨å | èªªæ˜ | ä¸»è¦æ¬„ä½ |
|------|------|---------|
| `tenants` | ç§Ÿå®¢ | vendor_id, name, phone, room_number, contract_code |
| `vendor_apis` | API é…ç½® | vendor_id, api_name, base_url, auth_type |
| `vendor_api_endpoints` | API ç«¯é» | api_id, endpoint_name, http_method, path |
| `vendor_api_logs` | API æ—¥èªŒ | vendor_id, endpoint_id, request, response, status |

### ç´¢å¼•ç­–ç•¥

```sql
-- å‘é‡æœå°‹ç´¢å¼•
CREATE INDEX idx_knowledge_embedding ON knowledge_base
USING ivfflat (embedding vector_cosine_ops)
WITH (lists = 100);

-- æ¥­è€…éš”é›¢ç´¢å¼•
CREATE INDEX idx_knowledge_vendor ON knowledge_base(vendor_id);
CREATE INDEX idx_configs_vendor ON vendor_configs(vendor_id);
CREATE INDEX idx_sop_vendor ON vendor_sop_items(vendor_id);
CREATE INDEX idx_form_vendor ON form_schemas(vendor_id);

-- æ„åœ–æŸ¥è©¢ç´¢å¼•
CREATE INDEX idx_knowledge_intent ON knowledge_base(intent_id);

-- è¤‡åˆç´¢å¼•ï¼ˆæ¥­è€… + æ„åœ–ï¼‰
CREATE INDEX idx_knowledge_vendor_intent ON knowledge_base(vendor_id, intent_id);

-- SOP æª¢ç´¢ç´¢å¼•
CREATE INDEX idx_sop_embedding ON vendor_sop_items
USING ivfflat (primary_embedding vector_cosine_ops)
WITH (lists = 50);

-- è¡¨å–®æœƒè©±ç´¢å¼•
CREATE INDEX idx_form_submissions_session ON form_submissions(session_id);
```

---

## API æ¶æ§‹

### RESTful API è¨­è¨ˆåŸå‰‡

1. **è³‡æºå°å‘**ï¼šä½¿ç”¨åè©è€Œéå‹•è©
2. **HTTP æ–¹æ³•**ï¼šGETï¼ˆæŸ¥è©¢ï¼‰ã€POSTï¼ˆå»ºç«‹ï¼‰ã€PUTï¼ˆæ›´æ–°ï¼‰ã€DELETEï¼ˆåˆªé™¤ï¼‰
3. **ç‰ˆæœ¬æ§åˆ¶**ï¼š`/api/v1/`
4. **å›æ‡‰æ ¼å¼**ï¼šçµ±ä¸€ JSON æ ¼å¼
5. **éŒ¯èª¤è™•ç†**ï¼šæ¨™æº– HTTP ç‹€æ…‹ç¢¼ + è©³ç´°éŒ¯èª¤è¨Šæ¯

### API åˆ†å±¤

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Public API (é¢å‘çµ‚ç«¯ä½¿ç”¨è€…)                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  POST /api/v1/message                           â”‚
â”‚  - B2C èŠå¤©ï¼ˆç§Ÿå®¢ï¼‰                              â”‚
â”‚  - vendor_id è­˜åˆ¥æ¥­è€…                            â”‚
â”‚  - æ”¯æ´ SOP è§¸ç™¼èˆ‡è¡¨å–®å¡«å¯« ğŸ†•                     â”‚
â”‚  - è¿”å›å®¢è£½åŒ–ç­”æ¡ˆ                                â”‚
â”‚                                                 â”‚
â”‚  POST /api/v1/chat/stream ğŸ†•                    â”‚
â”‚  - æµå¼èŠå¤©ï¼ˆServer-Sent Eventsï¼‰                â”‚
â”‚  - å³æ™‚åé¥‹                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Internal API (é¢å‘æ¥­è€…å®¢æœ) [Phase 2]          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  POST /api/v2/customer-service                  â”‚
â”‚  - B2B èŠå¤©ï¼ˆå®¢æœï¼‰                              â”‚
â”‚  - æ”¯æ´ç§Ÿå®¢è­˜åˆ¥ + å¤–éƒ¨ API æ•´åˆ                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Management API (é¢å‘ç®¡ç†å¾Œå°)                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  /api/v1/vendors/*        - æ¥­è€…ç®¡ç†             â”‚
â”‚  /api/v1/knowledge/*      - çŸ¥è­˜åº«ç®¡ç†           â”‚
â”‚  /api/v1/intents/*        - æ„åœ–ç®¡ç†             â”‚
â”‚  /api/v1/forms/*          - è¡¨å–®ç®¡ç† ğŸ†•          â”‚
â”‚  /api/v1/sop/*            - SOP ç®¡ç† ğŸ†•          â”‚
â”‚  /api/v1/cache/*          - ç·©å­˜ç®¡ç† ğŸ†•          â”‚
â”‚  /api/v1/tenants/*        - [Phase 2] ç§Ÿå®¢ç®¡ç†   â”‚
â”‚  /api/v1/apis/*           - [Phase 2] API é…ç½®   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ä¸»è¦ API ç«¯é»

#### Chat API

```bash
# æ¨™æº–èŠå¤©
POST /api/v1/message
{
  "message": "ç§Ÿé‡‘æ€éº¼ç¹³ï¼Ÿ",
  "vendor_id": 1,
  "user_role": "customer",
  "session_id": "abc123"
}

# æµå¼èŠå¤© ğŸ†•
POST /api/v1/chat/stream
Content-Type: application/json
Accept: text/event-stream

{
  "question": "ç§Ÿé‡‘æ€éº¼ç¹³ï¼Ÿ",
  "vendor_id": 1,
  "user_role": "customer",
  "session_id": "abc123"
}
```

#### è¡¨å–® API ğŸ†•

```bash
# ç²å–è¡¨å–®å®šç¾©
GET /api/v1/forms/{form_id}

# å‰µå»ºè¡¨å–®
POST /api/v1/forms
{
  "form_id": "rental_inquiry",
  "form_name": "ç§Ÿå±‹è©¢å•è¡¨",
  "fields": [...],
  "on_complete_action": "call_api",
  "api_config": {...}
}

# æ›´æ–°è¡¨å–®
PUT /api/v1/forms/{form_id}

# åˆªé™¤è¡¨å–®
DELETE /api/v1/forms/{form_id}
```

#### SOP API ğŸ†•

```bash
# ç²å– SOP åˆ†é¡
GET /api/v1/sop/categories?vendor_id=1

# å‰µå»º SOP
POST /api/v1/sop/items
{
  "title": "åƒåœ¾åˆ†é¡èªªæ˜",
  "content": "...",
  "trigger_mode": "immediate",
  "next_action": "form_fill",
  "next_form_id": "waste_sorting_form"
}

# æ›´æ–° SOP
PUT /api/v1/sop/items/{sop_id}
```

#### ç·©å­˜ API ğŸ†•

```bash
# æ¸…é™¤ç·©å­˜
DELETE /api/v1/cache/clear?cache_type=all

# æŸ¥çœ‹ç·©å­˜çµ±è¨ˆ
GET /api/v1/cache/stats
```

### API å®‰å…¨æ€§

| æ©Ÿåˆ¶ | å¯¦ä½œæ–¹å¼ | ç‹€æ…‹ |
|------|---------|------|
| **HTTPS** | Nginx SSL/TLS çµ‚æ­¢ | âœ… ç”Ÿç”¢ç’°å¢ƒ |
| **API Key** | Header: `X-API-Key` | â³ å¾…å¯¦ä½œ |
| **Rate Limiting** | åŸºæ–¼ IP æˆ– API Key | â³ å¾…å¯¦ä½œ |
| **CORS** | FastAPI CORS Middleware | âœ… å·²å¯¦ä½œ |
| **Input Validation** | Pydantic Models | âœ… å·²å¯¦ä½œ |
| **Redis Session** | Session å­˜å„²èˆ‡é©—è­‰ | âœ… å·²å¯¦ä½œ ğŸ†• |

---

## éƒ¨ç½²æ¶æ§‹

### Docker Compose æ¶æ§‹

```yaml
version: '3.8'

services:
  # åå‘ä»£ç†
  nginx:
    image: nginx:1.24-alpine
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf
    depends_on:
      - rag-orchestrator
      - knowledge-admin-web

  # æ ¸å¿ƒå¾Œç«¯æœå‹™
  rag-orchestrator:
    build: ./rag-orchestrator
    ports:
      - "8100:8100"
    environment:
      - DATABASE_URL=postgresql://user:pass@postgres:5432/aichatbot
      - REDIS_URL=redis://redis:6379/0
      - OPENAI_API_KEY=${OPENAI_API_KEY}
      - EMBEDDING_API_URL=http://embedding-api:5001
    depends_on:
      - postgres
      - redis

  # Embedding API ğŸ†•
  embedding-api:
    build: ./embedding-service
    ports:
      - "5001:5001"
    environment:
      - REDIS_URL=redis://redis:6379/0
      - OPENAI_API_KEY=${OPENAI_API_KEY}
    depends_on:
      - redis

  # çŸ¥è­˜ç®¡ç† API
  knowledge-admin-api:
    build: ./knowledge-admin/backend
    ports:
      - "8000:8000"
    environment:
      - DATABASE_URL=postgresql://user:pass@postgres:5432/aichatbot
    depends_on:
      - postgres

  # ç®¡ç†å¾Œå°å‰ç«¯ï¼ˆé–‹ç™¼æ¨¡å¼ï¼‰
  knowledge-admin-web:
    build: ./knowledge-admin/frontend
    ports:
      - "8087:5173"  # Vite dev server
    volumes:
      - ./knowledge-admin/frontend:/app
    profiles:
      - dev

  # PostgreSQL è³‡æ–™åº«
  postgres:
    image: pgvector/pgvector:pg15
    ports:
      - "5432:5432"
    environment:
      - POSTGRES_USER=aichatbot_user
      - POSTGRES_PASSWORD=password
      - POSTGRES_DB=aichatbot
    volumes:
      - postgres_data:/var/lib/postgresql/data
      - ./database/init:/docker-entrypoint-initdb.d

  # Redis ç·©å­˜ ğŸ†•
  redis:
    image: redis:7-alpine
    ports:
      - "6381:6379"
    volumes:
      - redis_data:/data
    command: redis-server --appendonly yes

volumes:
  postgres_data:
  redis_data:
```

### ç’°å¢ƒè®Šæ•¸ç®¡ç†

```bash
# .env æª”æ¡ˆ
OPENAI_API_KEY=sk-...
DATABASE_URL=postgresql://aichatbot_user:password@localhost:5432/aichatbot
REDIS_URL=redis://localhost:6381/0
EMBEDDING_API_URL=http://localhost:5001
ENVIRONMENT=development  # development, staging, production
LOG_LEVEL=INFO
```

---

## å®‰å…¨æ€§è¨­è¨ˆ

### è³‡æ–™å®‰å…¨

| é …ç›® | å¯¦ä½œæ–¹å¼ |
|------|---------|
| **æ¥­è€…è³‡æ–™éš”é›¢** | æ‰€æœ‰æŸ¥è©¢å¿…é ˆåŒ…å« `vendor_id` WHERE æ¢ä»¶ |
| **æ•æ„Ÿè³‡æ–™åŠ å¯†** | API æ†‘è­‰ã€ç§Ÿå®¢èº«ä»½è­‰å­—è™ŸåŠ å¯†å„²å­˜ |
| **è³‡æ–™åº«åŠ å¯†** | PostgreSQL SSL é€£ç·š |
| **æ—¥èªŒè„«æ•** | æ•æ„Ÿè³‡è¨Šï¼ˆé›»è©±ã€èº«ä»½è­‰ï¼‰æ‰“ç¢¼è¨˜éŒ„ |
| **Redis å®‰å…¨** ğŸ†• | å¯†ç¢¼ä¿è­·ã€ç¶²è·¯éš”é›¢ |

### æ‡‰ç”¨å®‰å…¨

| é …ç›® | å¯¦ä½œæ–¹å¼ |
|------|---------|
| **SQL æ³¨å…¥é˜²è­·** | SQLAlchemy ORMï¼Œåƒæ•¸åŒ–æŸ¥è©¢ |
| **XSS é˜²è­·** | Vue.js è‡ªå‹•è½‰ç¾©ï¼ŒContent Security Policy |
| **CSRF é˜²è­·** | Token é©—è­‰ï¼ˆAPI ç‚º statelessï¼Œæš«ä¸éœ€è¦ï¼‰ |
| **è¼¸å…¥é©—è­‰** | Pydantic å¼·åˆ¶é©—è­‰æ‰€æœ‰è¼¸å…¥ |
| **è¡¨å–®é©—è­‰** ğŸ†• | å°ç£å§“åã€é›»è©±ã€åœ°å€æ ¼å¼é©—è­‰ |

### å­˜å–æ§åˆ¶ï¼ˆPhase 2ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è§’è‰²æ¬Šé™è¨­è¨ˆï¼ˆå¾…å¯¦ä½œï¼‰                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  - Platform Admin: å…¨å¹³å°ç®¡ç†            â”‚
â”‚  - Vendor Admin: æ¥­è€…ç®¡ç†                â”‚
â”‚  - CS Staff: å®¢æœæŸ¥è©¢                    â”‚
â”‚  - Tenant: ç§Ÿå®¢æŸ¥è©¢ï¼ˆB2Cï¼‰               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## æ“´å±•æ€§è¨­è¨ˆ

### æ°´å¹³æ“´å±•

```
                    Load Balancer
                         â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â†“                â†“                â†“
  Orchestrator #1  Orchestrator #2  Orchestrator #3
        â†“                â†“                â†“
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â†“                         â†“
       PostgreSQL                  Redis
    (Read Replicas)              (Cluster)
```

**æ”¯æ´æ–¹å¼ï¼š**
- RAG Orchestrator ç‚ºç„¡ç‹€æ…‹æœå‹™ï¼Œå¯æ°´å¹³æ“´å±•
- PostgreSQL è®€å¯«åˆ†é›¢ï¼ˆä¸»å¾è¤‡è£½ï¼‰
- Redis Cluster æ¨¡å¼ï¼ˆåˆ†ç‰‡èˆ‡è¤‡è£½ï¼‰ğŸ†•

### æ•ˆèƒ½å„ªåŒ–

| å„ªåŒ–é …ç›® | å¯¦ä½œæ–¹å¼ | ç‹€æ…‹ |
|---------|---------|------|
| **åƒæ•¸å¿«å–** | è¨˜æ†¶é«”å¿«å–æ¥­è€…åƒæ•¸ | âœ… å·²å¯¦ä½œ |
| **å‘é‡ç´¢å¼•** | IVFFlat ç´¢å¼•åŠ é€Ÿæœå°‹ | âœ… å·²å¯¦ä½œ |
| **é€£ç·šæ± ** | SQLAlchemy é€£ç·šæ±  | âœ… å·²å¯¦ä½œ |
| **éåŒæ­¥è™•ç†** | FastAPI async/await | âœ… å·²å¯¦ä½œ |
| **Redis ä¸‰å±¤ç·©å­˜** ğŸ†• | å•é¡Œ/å‘é‡/çµæœç·©å­˜ | âœ… å·²å¯¦ä½œ |
| **Reranker å„ªåŒ–** ğŸ†• | Cross-Encoder é‡æ’åº | âœ… å·²å¯¦ä½œ |
| **SOP ä¸Šä¸‹æ–‡ç·©å­˜** ğŸ†• | Redis TTL ç®¡ç† | âœ… å·²å¯¦ä½œ |
| **CDN** | éœæ…‹è³‡æºåŠ é€Ÿ | â³ å¾…å¯¦ä½œ |

### ç›£æ§èˆ‡æ—¥èªŒ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç›£æ§ç³»çµ±ï¼ˆå¾…å¯¦ä½œï¼‰                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  - Prometheus: æŒ‡æ¨™æ”¶é›†                  â”‚
â”‚  - Grafana: å„€è¡¨æ¿                       â”‚
â”‚  - ELK Stack: æ—¥èªŒèšåˆ                   â”‚
â”‚  - Sentry: éŒ¯èª¤è¿½è¹¤                      â”‚
â”‚  - Redis Monitoring: ç·©å­˜æ•ˆèƒ½ ğŸ†•         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## è³‡æ–™æµåœ–

### B2C èŠå¤©æµç¨‹ï¼ˆ2026-02-03 æœ€æ–°ç‰ˆæœ¬ï¼‰

```
ç§Ÿå®¢è¼¸å…¥å•é¡Œ
    â†“
[POST /api/v1/message]
    vendor_id: 2
    session_id: "abc123"
    message: "åƒåœ¾åˆ†é¡é‚„æ˜¯ä¸è¡Œ"
    â†“
æª¢æŸ¥ SOP ä¸Šä¸‹æ–‡ï¼ˆRedisï¼‰
    â†“ æ‰¾åˆ° SOP ä¸Šä¸‹æ–‡ï¼ˆMANUAL_WAITING ç‹€æ…‹ï¼‰
    â†“
æª¢æ¸¬è§¸ç™¼é—œéµè©
    â†“ åŒ¹é…åˆ° "é‚„æ˜¯ä¸è¡Œ" â†’ è§¸ç™¼é—œéµè©
    â†“
åŸ·è¡Œ SOP å¾ŒçºŒå‹•ä½œï¼ˆnext_actionï¼‰
    â†“ next_action: "form_fill"
    â†“ next_form_id: "rental_inquiry"
    â†“
å•Ÿå‹•è¡¨å–®å¡«å¯«
    â†“
[Form Manager]
    â†“
è¿”å›ç¬¬ä¸€å€‹å•é¡Œ
    â†“
"è«‹å•æ‚¨çš„å§“åæ˜¯ï¼Ÿ"
    â†“
ç”¨æˆ¶å¡«å¯«è¡¨å–®
    â†“
æäº¤è¡¨å–®
    â†“
åŸ·è¡Œå®Œæˆå¾Œå‹•ä½œï¼ˆon_complete_actionï¼‰
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ show_knowledgeâ”‚   call_api   â”‚    both      â”‚
â”‚              â”‚              â”‚              â”‚
â”‚ é¡¯ç¤ºçŸ¥è­˜ç­”æ¡ˆ  â”‚ èª¿ç”¨å¤–éƒ¨API  â”‚  å…©è€…éƒ½åŸ·è¡Œ   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### SOP è§¸ç™¼æ¨¡å¼æµç¨‹åœ– ğŸ†•

```
ç”¨æˆ¶å•é¡Œ: "åƒåœ¾åˆ†é¡"
    â†“
æ„åœ–åˆ†é¡ + SOP æª¢ç´¢
    â†“
æ‰¾åˆ°åŒ¹é…çš„ SOP
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   manual    â”‚  immediate  â”‚    auto     â”‚
â”‚  (æ’æŸ¥å‹)   â”‚  (è¡Œå‹•å‹)   â”‚  (è‡ªå‹•å‹)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚              â”‚              â”‚
       â†“              â†“              â†“
  é¡¯ç¤º SOP å…§å®¹   é¡¯ç¤º SOP å…§å®¹   ç›´æ¥åŸ·è¡Œå‹•ä½œ
       â”‚              â”‚
       â†“              â†“
  ç­‰å¾…è§¸ç™¼é—œéµè©  é™„åŠ ç¢ºèªæç¤º
       â”‚         (immediate_prompt)
       â†“              â”‚
  ç”¨æˆ¶èªªé—œéµè©      â†“
  "é‚„æ˜¯ä¸è¡Œ"    ç”¨æˆ¶ç¢ºèª "è¦"
       â”‚              â”‚
       â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
        åŸ·è¡Œå¾ŒçºŒå‹•ä½œ
              â†“
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚                 â”‚
  form_fill        api_call
     â”‚                 â”‚
  å•Ÿå‹•è¡¨å–®         èª¿ç”¨API
```

### B2B å®¢æœæµç¨‹ï¼ˆPhase 2ï¼‰

```
å®¢æœè¼¸å…¥å•é¡Œ
    â†“
[POST /api/v2/customer-service]
    vendor_id: 1
    message: "æ—å°å§é€™å€‹æœˆç¹³è²»äº†å—ï¼Ÿ"
    â†“
æ„åœ–åˆ†é¡
    â†“ intent_type: data_query
ç§Ÿå®¢è­˜åˆ¥
    â†“ LLM æå– â†’ è³‡æ–™åº«æ¯”å°
    tenant_id: 12345 (æ—å°å§, A-2024-001)
    â†“
å‘¼å«å¤–éƒ¨ API
    â†“ GET /api/payments?tenant_id=12345
    {
      "paid_date": "2024-10-03",
      "amount": 15000
    }
    â†“
æ ¼å¼åŒ–å›æ‡‰
    â†“
"æ—å°å§ï¼ˆA-2024-001ï¼‰å·²æ–¼ 10 æœˆ 3 æ—¥ç¹³æ¸…..."
```

---

## æ–‡ä»¶ç‰ˆæœ¬

- **ç‰ˆæœ¬ï¼š** 3.0
- **å»ºç«‹æ—¥æœŸï¼š** 2025-10-09
- **æœ€å¾Œæ›´æ–°ï¼š** 2026-02-03
- **ä½œè€…ï¼š** Claude Code
- **é©ç”¨ç³»çµ±ç‰ˆæœ¬ï¼š** Phase 1 å®Œæˆ + SOP ç³»çµ± + è¡¨å–®ç®¡ç† + Phase 2 è¦åŠƒ
- **è®Šæ›´ç´€éŒ„ï¼š**
  - v3.0 (2026-02-03): ğŸ†• æ·»åŠ  SOP ç³»çµ±ã€è¡¨å–®ç®¡ç†ã€Redis ç·©å­˜ã€Rerankerã€API é…ç½®
  - v2.0 (2025-10-10): æ›´æ–°ç‚º Phase 1 å¤šæ¥­è€…æ¶æ§‹ + LLM æ™ºèƒ½åƒæ•¸æ³¨å…¥
  - v1.0 (2025-10-09): åˆå§‹ç‰ˆæœ¬

---

## ğŸ†• æœ€æ–°åŠŸèƒ½ï¼ˆ2026-02-03ï¼‰

### SOP ç³»çµ±
- âœ… ä¸‰ç¨®è§¸ç™¼æ¨¡å¼ï¼ˆmanual/immediate/autoï¼‰
- âœ… SOP ä¸Šä¸‹æ–‡ç®¡ç†ï¼ˆRedis TTLï¼‰
- âœ… è§¸ç™¼é—œéµè©åµæ¸¬
- âœ… è¡¨å–®/API å¾ŒçºŒå‹•ä½œåŸ·è¡Œ

### è¡¨å–®ç®¡ç†ç³»çµ±
- âœ… å‹•æ…‹è¡¨å–®å‰µå»ºèˆ‡ç·¨è¼¯
- âœ… è¡¨å–®å¡«å¯«æµç¨‹ç®¡ç†
- âœ… å°ç£æ ¼å¼é©—è­‰ï¼ˆå§“åã€é›»è©±ã€åœ°å€ï¼‰
- âœ… å®Œæˆå¾Œå‹•ä½œï¼ˆshow_knowledge/call_api/bothï¼‰
- âœ… API é…ç½®ï¼ˆmethod, endpoint, headers, paramsï¼‰

### Redis ç·©å­˜ç³»çµ±
- âœ… ä¸‰å±¤ç·©å­˜ï¼ˆå•é¡Œ/å‘é‡/çµæœï¼‰
- âœ… SOP ä¸Šä¸‹æ–‡ç·©å­˜
- âœ… è¡¨å–®æœƒè©±ç·©å­˜
- âœ… ç¯€çœ 70-90% OpenAI API æˆæœ¬

### Reranker å„ªåŒ–
- âœ… Cross-Encoder äºŒéšæ®µé‡æ’åº
- âœ… æº–ç¢ºç‡æå‡ 3 å€ï¼ˆ25%â†’75%ï¼‰
- âœ… æ™ºèƒ½æª¢ç´¢è·¯ç”±

### æµå¼èŠå¤©
- âœ… Server-Sent Events (SSE)
- âœ… å³æ™‚åé¥‹ç”¨æˆ¶é«”é©—
