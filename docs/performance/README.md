# 效能測試與評估

此目錄包含系統效能測試報告和分析。

---

## 📊 最新效能報告

### 2025-10-21 - RAG 對話流程完整效能評估

**報告**: [CHAT_PERFORMANCE_ANALYSIS.md](./CHAT_PERFORMANCE_ANALYSIS.md)

#### 快速總結

| 指標 | 數值 | 目標 | 達成 |
|------|------|------|------|
| 平均響應時間 | 2.95 秒 | < 2 秒 | ❌ |
| 成功率 | 88.9% | 100% | ❌ |
| P95 延遲 | 7.03 秒 | < 3 秒 | ❌ |
| 標準差 | 1.77 秒 | < 0.5 秒 | ❌ |

#### 主要發現

🔴 **主要瓶頸**: LLM API 延遲（佔總時間 60-80%）
- 有文檔的問題: 6-8 秒
- 無文檔的問題: 2-4 秒

⚠️ **穩定性問題**: 2個問題持續失敗（HTTP 500）
- 「停車位怎麼收費？」
- 「我的鄰居很吵怎麼辦？」

📉 **信心度偏低**: 0個高信心度回答（≥0.8）
- 表示知識庫覆蓋不足

#### 優化建議優先級

1. **高優先級** (預期改進 50-60%)
   - 使用更快的 LLM 模型（GPT-3.5-turbo）
   - 修復 500 錯誤
   - 實施問題緩存

2. **中優先級** (預期改進 20-30%)
   - 擴充知識庫
   - 優化 RAG 檢索
   - 實施流式響應

3. **長期優化** (預期改進 70-80%)
   - 本地 LLM 部署
   - 智能路由
   - GPU 加速

---

## 🧪 測試工具

### 1. 對話流程效能測試
**腳本**: `/tests/performance/test_chat_performance.py`

**功能**:
- 測試 18 種不同類型的問題
- 每個問題重複 3 次
- 測量端到端響應時間
- 分析各階段耗時

**執行**:
```bash
python3 tests/performance/test_chat_performance.py
```

**輸出**:
- 控制台實時報告
- JSON 詳細數據（保存至 `/tmp/chat_performance_report_*.json`）

---

## 📈 效能追蹤

### 歷史趨勢

| 日期 | 平均時間 | P95 | 成功率 | 備註 |
|------|---------|-----|--------|------|
| 2025-10-21 | 2,948 ms | 7,033 ms | 88.9% | 基線測試 |

### 目標里程碑

| 階段 | 目標時間 | 目標日期 |
|------|---------|---------|
| 短期優化 | < 1,500 ms | 2025-11-04 |
| 中期優化 | < 800 ms | 2025-12-21 |
| 長期目標 | < 500 ms | 2026-04-21 |

---

## 🔍 測試方法論

### 測試場景分類

1. **高信心度問題**: 知識庫中有明確答案
2. **中等信心度問題**: 部分相關知識
3. **低信心度問題**: 無相關知識
4. **複雜問題**: 需要 API 整合、參數注入

### 測量指標

- **響應時間**: 從請求發送到收到完整響應
- **處理時間**: 後端報告的處理時間
- **成功率**: 成功請求 / 總請求
- **信心度**: 系統對答案的信心評分

### 統計方法

- 平均值（Mean）
- 中位數（Median）
- 標準差（Standard Deviation）
- P95 延遲（95th Percentile）

---

## 📋 測試檢查清單

### 執行前
- [ ] 確認所有服務運行（docker-compose ps）
- [ ] 確認資料庫有測試數據
- [ ] 確認 LLM API 可用

### 執行中
- [ ] 監控系統資源使用（CPU, Memory）
- [ ] 觀察日誌輸出
- [ ] 記錄異常情況

### 執行後
- [ ] 檢查成功率（應 > 95%）
- [ ] 分析慢查詢
- [ ] 比較與上次測試結果
- [ ] 更新效能報告

---

## 💡 解讀建議

### 效能評級

- **< 1 秒**: ⭐⭐⭐⭐⭐ 優秀（實時對話級別）
- **1-2 秒**: ⭐⭐⭐⭐ 良好（一般查詢可接受）
- **2-3 秒**: ⭐⭐⭐ 尚可（複雜查詢勉強接受）
- **3-5 秒**: ⭐⭐ 較慢（用戶體驗下降）
- **> 5 秒**: ⭐ 太慢（需要改進）

### 關注重點

1. **平均時間 vs 中位數**: 差異大表示有異常慢的案例
2. **標準差**: 高標準差（> 1秒）表示不穩定
3. **P95 延遲**: 95% 用戶的最差體驗
4. **成功率**: 必須 > 99%

---

## 🔗 相關文檔

- [完整效能分析報告](./CHAT_PERFORMANCE_ANALYSIS.md)
- [測試腳本說明](/tests/performance/)
- [優化計劃](/docs/planning/)

---

**最後更新**: 2025-10-21
