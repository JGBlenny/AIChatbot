# 📋 租戶維修請求系統 - 完整使用指南

**適用對象**: 業者管理人員、客服人員、系統操作員
**文檔版本**: 2.0
**最後更新**: 2026-01-23

---

## 📚 目錄

1. [系統概述](#系統概述)
2. [四種 SOP 觸發模式](#四種-sop-觸發模式)
3. [完整對話範例（10 種維修類型）](#完整對話範例)
4. [工單管理流程](#工單管理流程)
5. [客服介入指南](#客服介入指南)
6. [特殊情況處理](#特殊情況處理)
7. [報表與數據分析](#報表與數據分析)
8. [常見問題解答](#常見問題解答)

---

## 🎯 系統概述

### 系統目的

本系統透過 AI 對話機器人，協助租戶：
1. **快速診斷問題**：提供標準化排查步驟
2. **自動收集資訊**：透過表單收集維修所需的完整資訊
3. **即時創建工單**：自動派發維修任務
4. **追蹤維修進度**：隨時查詢工單狀態

### 業務價值

- **租戶端**：24/7 隨時報修，無需等待客服上班，簡單對話即可完成
- **客服端**：減少 70% 重複性接聽，專注處理複雜問題
- **維修端**：收到的工單資訊完整，減少來回溝通
- **管理端**：所有報修記錄結構化，便於分析和優化

### 系統架構

```
租戶提問 → SOP 排查 → 表單收集 → API 派工 → 維修處理 → 完工回報
    ↓         ↓          ↓          ↓          ↓          ↓
 意圖識別  觸發判斷   多輪對話   創建工單   通知維修    更新狀態
```

---

## 🔄 四種 SOP 觸發模式

系統支援四種不同的 SOP 觸發模式，適應不同的業務場景。

> **📌 實作狀態**：
> - ✅ **已實作**：資訊型、排查型、行動型（可立即使用）
> - ⚠️ **暫不實作**：緊急型（現階段不開發，文件保留供未來參考）

### 模式對比表

| 模式 | 觸發時機 | 適用場景 | 用戶確認 | 範例 | 狀態 |
|------|---------|---------|---------|------|------|
| **資訊型** | 不觸發 | 純資訊查詢 | 不需要 | 垃圾收取時間、公設使用規定 | ✅ 可用 |
| **排查型** | 用戶說關鍵詞後 | 需要先排查的問題 | 需要 | 冷氣不冷、網路不通 | ✅ 可用 |
| **行動型** | 返回 SOP 時立即詢問 | 直接的行動請求 | 需要 | 繳租登記、訪客登記 | ✅ 可用 |
| **緊急型** | 返回 SOP 時自動執行 | 緊急危險情況 | 不需要 | 天花板漏水、瓦斯外洩 | ⚠️ **暫不實作** |

> **💡 重要提示**：**排查型**和**行動型**的流程完全相同（返回 SOP → 觸發表單），唯一差異是觸發方式：
> - **排查型**：系統**不主動問**，等用戶說「沒用」「試過了」等關鍵詞
> - **行動型**：系統**主動問**「要不要填表單？」
>
> 詳細對比請見下方「[模式 2 vs 模式 3 快速對比](#📊-模式-2-vs-模式-3-快速對比)」章節。

---

### 模式 1：資訊型（無後續動作）

**特徵**：租戶只是查詢資訊，看完就結束，不需要任何後續動作。

#### 範例：垃圾收取時間

```
👤 租戶: 垃圾什麼時候收？

🤖 系統: 【垃圾收取時間】

        🗑️ 一般垃圾
           週一、三、五 19:00-20:00
           請於時間內將垃圾放置於一樓垃圾區

        ♻️ 資源回收
           週二、四 19:00-20:00
           請做好分類（紙類、塑膠、金屬）

        📦 大型垃圾
           需提前 3 天預約
           請聯絡管理員 0912-345-678

        【注意事項】
        • 請使用專用垃圾袋
        • 逾時不收
        • 違規丟棄將罰款 500 元

👤 租戶: 好的，謝謝

（對話結束，無後續動作）
```

#### 業務人員須知

- **無需關注後續**：這類對話結束後不會產生任何工單或任務
- **常見問題**：垃圾收取、公設使用、繳租方式、停車規定
- **系統行為**：只返回 SOP 內容，不記錄任何 context

---

## 📊 模式 2 vs 模式 3 快速對比

**核心提示**：這兩個模式的流程完全相同（返回 SOP → 觸發表單），唯一差異是**觸發方式**。

| 對比項 | **模式 2：排查型** | **模式 3：行動型** |
|--------|------------------|------------------|
| **別名** | 被動等待觸發 | 主動邀請觸發 |
| **系統行為** | ❌ 不主動問 | ✅ 主動問「要不要？」 |
| **觸發方式** | 等用戶說關鍵詞<br/>（如「沒用」「試過了」） | 用戶回答「是」「要」 |
| **等待期** | 有（等用戶反饋） | 無（立即詢問） |
| **適用場景** | 問題導向<br/>（可能自行解決） | 行動導向<br/>（意圖明確） |
| **典型例子** | 冷氣不冷、馬桶堵塞 | 登記繳租、申請續約 |
| **配置欄位** | `trigger_keywords` | `immediate_prompt` |

**記憶口訣**：
- 排查型 = "等你說沒用"
- 行動型 = "問你要不要"

### 流程對比圖

```
【排查型流程】
用戶提問 → 返回 SOP 說明 → ⏳ 等待用戶反饋
                              ↓
                          用戶說「沒用」
                              ↓
                          開始收集表單 📝

【行動型流程】
用戶提問 → 返回 SOP 說明 → ❓ 系統主動問「要不要？」
                              ↓
                          用戶說「要」
                              ↓
                          開始收集表單 📝
```

**本質相同**：都是「SOP 說明 + 表單收集」，只是觸發時機不同。

---

### 模式 2：排查型（被動等待觸發）

**核心特徵**：系統給出 SOP 說明後，**不會主動問**要不要填表單，而是**等待用戶**說「沒用」「試過了」等關鍵詞，才開始收集表單。

**與行動型的唯一差異**：系統不主動問，被動等待關鍵詞。

**適用場景**：問題可能是小故障，先引導租戶自行排查，約 30% 問題能自行解決，節省維修資源。

#### 範例：冷氣不冷

```
👤 租戶: 冷氣不冷

🤖 系統: 【冷氣不冷 - 排查步驟】

        請先嘗試以下步驟：

        1️⃣ 檢查溫度設定
           • 建議設定 24-26°C
           • 確認模式為「冷氣」而非「送風」

        2️⃣ 檢查濾網
           • 打開室內機面板
           • 如果濾網堵滿灰塵，請清洗濾網
           • 等待 10 分鐘觀察

        3️⃣ 檢查室外機
           • 確認室外機運轉（有聲音、風扇轉動）
           • 確認室外機周圍沒有障礙物

        4️⃣ 等待時間
           • 剛開機需要 10-15 分鐘才能感覺到冷

        若排查後仍不冷，請提交維修請求。

（系統此時會記住這個對話，等待租戶回覆）

---

👤 租戶: 試過了，濾網很乾淨，室外機也在轉，但就是不冷

🤖 系統: 好的，我來協助您提交維修請求。請提供一些詳細資訊，以便我們安排最合適的維修人員。

        請說明問題發生的具體位置（例如：主臥室、客廳、次臥）

👤 租戶: 主臥室

🤖 系統: 問題大約什麼時候開始的？
        1. 剛剛發生
        2. 今天發生
        3. 昨天發生
        4. 這週內
        5. 已經很久了

👤 租戶: 2

🤖 系統: 您是否有嘗試過簡單的排查步驟？
        1. 有，但沒有改善
        2. 沒有，不知道怎麼做
        3. 試了一些，但不確定

👤 租戶: 1

🤖 系統: 請說明您做了什麼排查？

👤 租戶: 我清洗了濾網，確認室外機有運轉，也等了半小時，但溫度還是降不下來

（繼續收集剩餘資料...）
```

#### ⚙️ 關鍵詞觸發機制（排查型的核心）

**重點**：系統**不會主動問**，而是監聽用戶回覆，當包含以下關鍵詞時，才觸發表單：

| 關鍵詞類型 | 範例 |
|----------|------|
| 無效類 | 「還是不冷」「沒用」「還是一樣」 |
| 嘗試類 | 「試過了」「都試過了」 |
| 求助類 | 「需要維修」「請幫忙」 |

**與行動型的差異**：行動型不需要關鍵詞，系統直接問「要不要？」

#### 業務人員須知

- **排查步驟的價值**：約 30% 的問題在排查階段就能解決，節省維修資源
- **如果租戶跳過排查**：租戶直接說「需要維修」也會觸發表單
- **排查記錄的重要性**：表單會詢問租戶做了什麼排查，維修人員能避免重複檢查

---

### 模式 3：行動型（主動邀請觸發）

**核心特徵**：系統給出 SOP 說明後，**立即主動問**「要不要填表單？」，用戶回答「是」「要」就開始收集表單。

**與排查型的唯一差異**：系統主動問，不需要等待。

**適用場景**：用戶意圖明確（如「我想登記」），直接詢問可提升效率，減少來回對話。

#### 範例：租金繳納登記

```
👤 租戶: 我想登記繳租

🤖 系統: 【租金繳納流程】

        📅 繳納時間
           每月 5 日前繳納當月租金

        💰 繳納方式
           銀行轉帳（推薦）
           銀行：玉山銀行
           帳號：1234-5678-9012-3456
           戶名：XX物業管理股份有限公司

        📝 繳納後請務必：
           1. 保留轉帳明細
           2. 登記繳納記錄（系統會自動更新）
           3. 如有問題請聯絡管理員

        📋 是否要登記本月租金繳納記錄？
           （回覆「是」、「要」或「好」即可開始登記）

👤 租戶: 要

🤖 系統: 好的，我來協助您登記繳租記錄。

        請提供繳納日期？（例如：01/22 或 今天）

👤 租戶: 今天

🤖 系統: 請提供轉帳金額（元）

👤 租戶: 15000

🤖 系統: 請提供轉帳帳號後五碼（用於核對）

👤 租戶: 12345

🤖 系統: 是否有備註或說明？（選填，可直接回覆「沒有」）

👤 租戶: 沒有

🤖 系統: ✅ 繳租記錄已成功登記！

        📋 登記資訊
        ━━━━━━━━━━━━
        租戶：王小明（3F-A）
        繳納日期：2026/01/22
        金額：15,000 元
        帳號後五碼：12345
        登記編號：RP20260122001

        我們會在 1 個工作日內核對，核對完成後會通知您。
        如需查詢記錄，請提供登記編號。
```

#### ⚙️ 主動詢問機制（行動型的核心）

**重點**：系統在 SOP 說明後，**主動問一句話**：「是否要登記？」

| 用戶回答類型 | 系統行為 |
|------------|---------|
| 肯定詞（是、要、好、可以） | ✅ 觸發表單 |
| 否定詞（不用、先不要） | ❌ 結束對話 |

**與排查型的差異**：排查型不主動問，等用戶說「沒用」才觸發。

#### 業務人員須知

- **為何主動問**：用戶說「我想登記」，意圖明確，直接問可節省對話次數
- **效率提升**：相比排查型，行動型少了「等待期」，直接進入執行階段

---

### 模式 4：緊急型（自動觸發）⚠️ 暫不實作

> **⚠️ 重要通知**：此模式**現階段不會實作**，以下內容僅供未來參考。
>
> 目前可用的模式：
> - ✅ 模式 1：資訊型
> - ✅ 模式 2：排查型
> - ✅ 模式 3：行動型

**特徵**（未來規劃）：緊急危險情況，返回 SOP 的同時自動創建緊急工單，無需等待租戶確認。

#### 範例：天花板漏水

```
👤 租戶: 天花板漏水了！

🤖 系統: 🚨 這是緊急狀況！請立即採取以下措施：

        【緊急處理步驟】

        1️⃣ 收集漏水
           • 立即在漏水處放置水桶或臉盆
           • 移開漏水處下方的物品（電器、傢俱、貴重物品）

        2️⃣ 關閉電源
           • 如果漏水接近電燈或插座，請立即關閉該區域電源
           • 避免觸電風險

        3️⃣ 通知樓上住戶
           • 如果是公寓，請立即聯絡樓上住戶檢查
           • 可能是樓上的水管或浴室漏水

        4️⃣ 拍照記錄
           • 拍下漏水位置和範圍
           • 拍下受損物品
           • 用於後續賠償和修繕

        ━━━━━━━━━━━━━━━━━━━━━━

        ⚡ 我已自動為您提交緊急維修請求

        📋 緊急工單資訊
        ━━━━━━━━━━━━━━━━
        工單編號：MT20260122001
        優先級：P0（非常緊急）
        問題類型：天花板漏水
        預計到達時間：1小時內

        維修人員會立即聯絡您，請保持手機暢通。

        🆘 緊急聯絡電話：0912-345-678
           （如果情況惡化，請立即撥打）
```

#### 自動創建的工單內容

系統會自動填入以下資訊：
- **問題類型**：天花板漏水
- **優先級**：P0（非常緊急）
- **緊急程度**：critical
- **問題位置**：（會自動帶入租戶的房號）
- **聯絡電話**：（會自動帶入租戶的手機）

#### 業務人員須知

- **適用情境**：天花板漏水、水管破裂、瓦斯外洩、停電（整棟）、火災（小火）
- **為何自動觸發**：這些情況非常緊急，每一秒都很重要，不能等租戶確認
- **後續溝通**：維修人員會立即致電租戶，確認詳細情況
- **監控告警**：P0 工單會同時發送 SMS、Email、App 推送給值班人員

---

## 📱 完整對話範例（詳細版）

以下提供多種情境的超級詳細對話流程，展示系統內部邏輯、狀態變化、異常處理等。

---

## 🎬 場景 1：排查型 SOP - 冷氣無法啟動（標準流程）

**情境描述**：租戶王小明（房號 3F-A）的主臥室冷氣無法啟動，今天下午 14:30 透過對話機器人報修。

---

### 📍 第一輪對話：租戶提出問題

```
👤 租戶（14:30:15）: 冷氣無法啟動

💭 系統內部處理：
   [14:30:15] 收到訊息："冷氣無法啟動"
   [14:30:15] 意圖分類 → intent_id: 25（冷氣維修）, confidence: 0.95
   [14:30:16] 檢查是否有待處理的 SOP context → 無
   [14:30:16] 檢查是否有進行中的表單 → 無
   [14:30:16] SOP 檢索 → 找到 SOP: "冷氣無法啟動"（ID: 123）
   [14:30:16] SOP 配置：
              - trigger_mode: 'manual'（排查型）
              - next_action: 'form_then_api'
              - next_form_id: 'maintenance_troubleshooting'
              - trigger_keywords: ['還是不行', '試過了', '需要維修', '沒用', '都試過了']
   [14:30:17] 儲存 SOP context 到 Redis:
              Key: sop_context:session_abc:user_123
              Expire: 3600 秒（1小時）
   [14:30:17] 返回 SOP 內容給租戶

🤖 系統（14:30:17）:
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
【冷氣無法啟動 - 排查步驟】
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

請先嘗試以下步驟：

1️⃣ 檢查電源插座是否正常
   • 確認插頭是否鬆脫
   • 嘗試插入其他電器測試插座
   • 確認該插座迴路的斷路器沒有跳掉

2️⃣ 檢查控制面板
   • 確認顯示燈是否亮起
   • 檢查是否有錯誤代碼顯示
   • 如有錯誤代碼，請記錄下來

3️⃣ 檢查遙控器
   • 更換遙控器電池（建議使用新電池）
   • 確認遙控器對準室內機
   • 嘗試使用室內機面板上的手動開關

4️⃣ 檢查電箱
   • 確認冷氣專用的斷路器是否跳掉
   • 如果跳掉，嘗試重新推上
   • 如果推上後又立即跳掉，請勿再嘗試

若以上步驟都無法解決，請提交維修請求。

💭 系統狀態：等待租戶回覆（監聽觸發關鍵詞）
```

---

### 📍 第二輪對話：租戶嘗試排查後回覆

**情境 A：租戶使用觸發關鍵詞**

```
👤 租戶（14:35:20）: 我都試過了，插座、電池都檢查了，電箱也沒跳，但冷氣還是完全沒反應

💭 系統內部處理：
   [14:35:20] 收到訊息："我都試過了，插座、電池都檢查了..."
   [14:35:20] 檢查 SOP context → 找到 context（ID: 123, trigger_mode: 'manual'）
   [14:35:20] 關鍵詞匹配：
              用戶訊息包含："都試過了" ✓
              匹配到 trigger_keywords 中的 "都試過了"
   [14:35:21] 標記 SOP context 為已觸發（is_triggered: true）
   [14:35:21] 準備啟動表單：
              - form_id: 'maintenance_troubleshooting'
              - 預填資料（從 next_api_config.params）:
                {
                  "problem_category": "ac_maintenance",
                  "specific_problem": "ac_not_starting",
                  "urgency_level": "urgent"
                }
   [14:35:21] 創建表單會話：
              - form_session_id: form_session_xyz
              - state: 'COLLECTING'
              - current_field_index: 0（跳過已預填的欄位）
   [14:35:22] 儲存 API callback 到 form_sessions.collected_data['_callback']:
              {
                "type": "api_call",
                "config": {
                  "endpoint": "maintenance_request",
                  "params": {...}
                }
              }
   [14:35:22] 返回表單引導語 + 第一個問題

🤖 系統（14:35:22）:
好的，我來協助您提交維修請求。

根據您描述的情況，這確實需要專業維修人員處理。我需要收集一些詳細資訊，以便我們安排最合適的維修人員並攜帶正確的工具和零件。

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📋 維修資訊收集（共 10 個問題，約 2-3 分鐘）
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

【問題 1/10】位置資訊

請說明問題發生的具體位置？
（例如：主臥室、次臥、客廳、書房）

💡 提示：準確的位置能幫助維修人員快速找到設備

💭 系統狀態：表單收集中（field: problem_location）
```

---

**情境 B：租戶沒有使用觸發關鍵詞（繼續等待）**

```
👤 租戶（14:35:20）: 我檢查了電源和遙控器

💭 系統內部處理：
   [14:35:20] 收到訊息："我檢查了電源和遙控器"
   [14:35:20] 檢查 SOP context → 找到 context（ID: 123, trigger_mode: 'manual'）
   [14:35:20] 關鍵詞匹配：
              用戶訊息不包含任何 trigger_keywords ✗
   [14:35:21] 判定為：租戶正在排查中，尚未完成
   [14:35:21] 回應：鼓勵租戶繼續排查，或詢問結果

🤖 系統（14:35:21）:
好的，您已經檢查了電源和遙控器。

請問：
1. 電源插座正常嗎？（可以插入其他電器測試）
2. 更換遙控器電池後，冷氣有反應嗎？

如果這些步驟都試過了但問題仍未解決，請告訴我，我來協助您提交維修請求。

💭 系統狀態：繼續等待租戶回覆（SOP context 保持有效）
```

---

### 📍 第三輪對話：開始收集表單欄位

```
👤 租戶（14:35:45）: 主臥室

💭 系統內部處理：
   [14:35:45] 收到訊息："主臥室"
   [14:35:45] 檢查表單會話 → 找到 form_session_xyz（state: 'COLLECTING'）
   [14:35:45] 當前欄位：problem_location
   [14:35:46] 驗證輸入："主臥室" ✓（有效位置）
   [14:35:46] 儲存到 collected_data:
              collected_data = {
                "problem_category": "ac_maintenance",  ← 預填
                "specific_problem": "ac_not_starting",  ← 預填
                "urgency_level": "urgent",              ← 預填
                "problem_location": "主臥室"            ← 剛收集
              }
   [14:35:46] current_field_index: 0 → 1
   [14:35:46] 下一個欄位：when_started（問題發生時間）
   [14:35:47] 返回下一個問題

🤖 系統（14:35:47）:
✓ 已記錄：主臥室

【問題 2/10】發生時間

問題大約什麼時候開始的？

1️⃣ 剛剛發生（30分鐘內）
2️⃣ 今天發生（今天稍早）
3️⃣ 昨天發生
4️⃣ 這週內發生
5️⃣ 已經很久了（一週以上）

💡 提示：發生時間幫助我們判斷問題的緊急程度

請回覆數字（1-5）或直接說明時間

💭 系統狀態：表單收集中（field: when_started）
```

---

### 📍 第四輪對話：租戶選擇選項

```
👤 租戶（14:36:10）: 2

💭 系統內部處理：
   [14:36:10] 收到訊息："2"
   [14:36:10] 檢查表單會話 → form_session_xyz（current_field: when_started）
   [14:36:10] 解析選項："2" → "今天發生"
   [14:36:11] 儲存到 collected_data:
              collected_data = {
                ...
                "when_started": "today",
                "when_started_display": "今天發生"
              }
   [14:36:11] current_field_index: 1 → 2
   [14:36:11] 下一個欄位：tried_troubleshooting（是否嘗試排查）
   [14:36:12] 返回下一個問題

🤖 系統（14:36:12）:
✓ 已記錄：今天發生

【問題 3/10】排查情況

您是否有嘗試過簡單的排查步驟？

1️⃣ 有，但沒有改善
2️⃣ 沒有，不知道怎麼做
3️⃣ 試了一些，但不確定是否正確

💡 提示：您的排查經驗能幫助維修人員避免重複檢查，更快找到問題

請回覆數字（1-3）

💭 系統狀態：表單收集中（field: tried_troubleshooting）
```

---

### 📍 第五輪對話：租戶選擇「有排查」（觸發條件式問題）

```
👤 租戶（14:36:30）: 1

💭 系統內部處理：
   [14:36:30] 收到訊息："1"
   [14:36:30] 解析選項："1" → "有，但沒有改善"
   [14:36:31] 儲存到 collected_data:
              collected_data = {
                ...
                "tried_troubleshooting": "yes_no_improvement"
              }
   [14:36:31] 判定：用戶選擇「有排查」→ 需要詢問排查詳情
   [14:36:31] current_field_index: 2 → 3
   [14:36:31] 下一個欄位：troubleshooting_details（排查詳情，條件式欄位）
   [14:36:32] 返回下一個問題

🤖 系統（14:36:32）:
✓ 已記錄：有嘗試排查但沒有改善

【問題 4/10】排查詳情

請詳細說明您做了什麼排查？

💡 這些資訊很重要：
   • 維修人員能避免重複您已做過的檢查
   • 幫助判斷可能的故障原因
   • 決定需要攜帶的工具和零件

範例回答：
「檢查了電源插座（插其他電器可用）、更換了遙控器電池、確認電箱沒有跳電、嘗試用面板手動開關也沒反應」

請詳細描述您的排查過程：

💭 系統狀態：表單收集中（field: troubleshooting_details）
```

---

### 📍 第六輪對話：租戶輸入詳細排查內容

```
👤 租戶（14:37:15）: 我檢查了電源插座，插檯燈可以亮所以插座是好的。然後我換了新的遙控器電池，也試了面板上的按鈕，都完全沒反應。電箱我也看了，冷氣的斷路器沒有跳。

💭 系統內部處理：
   [14:37:15] 收到訊息："我檢查了電源插座，插檯燈可以亮..."
   [14:37:15] 輸入長度：83 字元 ✓（足夠詳細）
   [14:37:16] 關鍵詞檢測：
              包含「電源插座」✓
              包含「遙控器電池」✓
              包含「面板」✓
              包含「電箱」✓
              → 排查過程完整
   [14:37:16] 儲存到 collected_data:
              collected_data = {
                ...
                "troubleshooting_details": "我檢查了電源插座，插檯燈可以亮所以插座是好的。然後我換了新的遙控器電池，也試了面板上的按鈕，都完全沒反應。電箱我也看了，冷氣的斷路器沒有跳。"
              }
   [14:37:17] current_field_index: 3 → 4
   [14:37:17] 下一個欄位：detailed_description（詳細描述）
   [14:37:17] 返回下一個問題

🤖 系統（14:37:17）:
✓ 已記錄：您的排查過程

非常感謝您提供如此詳細的排查資訊！根據您的描述，問題可能出在冷氣主機板或電源供應模組。

【問題 5/10】問題詳細描述

請詳細描述問題的狀況：

請說明：
• 冷氣是否有任何聲音？（嗡嗡聲、滴答聲、風扇聲等）
• 面板或遙控器是否有任何燈號？
• 是否有任何異味？（燒焦味、塑膠味等）
• 最後一次正常使用是什麼時候？

範例回答：
「完全沒反應，面板不亮，也沒有任何聲音。昨天晚上還正常，今天下午想開就發現不能用了。沒有聞到異味。」

請詳細描述：

💭 系統狀態：表單收集中（field: detailed_description）
```

---

### 📍 第七輪對話：租戶描述問題細節

```
👤 租戶（14:38:00）: 完全沒反應，面板一點燈都沒有，按遙控器也沒有嗶嗶聲。完全沒有任何聲音。昨天晚上睡覺前還在吹，今天下午想開就發現不行了。沒有聞到燒焦味。

💭 系統內部處理：
   [14:38:00] 收到訊息："完全沒反應，面板一點燈都沒有..."
   [14:38:00] 輸入長度：75 字元 ✓
   [14:38:01] AI 分析問題描述：
              關鍵線索：
              - "完全沒反應" → 電源問題或主機板故障
              - "面板一點燈都沒有" → 無電源供應
              - "沒有任何聲音" → 壓縮機未啟動
              - "昨天還在吹" → 突發性故障
              - "沒有燒焦味" → 排除嚴重短路
              → AI 判定：可能是電源供應模組故障或主機板問題
              → 建議優先級：P1（緊急）
   [14:38:01] 儲存到 collected_data:
              collected_data = {
                ...
                "detailed_description": "完全沒反應，面板一點燈都沒有...",
                "ai_analysis": {
                  "likely_cause": "power_supply_or_motherboard",
                  "suggested_priority": "P1"
                }
              }
   [14:38:02] current_field_index: 4 → 5
   [14:38:02] 下一個欄位：preferred_time（偏好維修時間）
   [14:38:02] 返回下一個問題

🤖 系統（14:38:02）:
✓ 已記錄：問題詳細描述

根據您的描述，問題很可能是冷氣的電源供應模組或主機板故障，需要專業維修。

【問題 6/10】維修時間偏好

請選擇您方便的維修時間：

1️⃣ ⏰ 越快越好（我們會盡快安排，通常 4 小時內）
2️⃣ 🌅 今天上午（9:00-12:00）
3️⃣ ☀️ 今天下午（13:00-17:00）
4️⃣ 🌆 今天傍晚（17:00-20:00）
5️⃣ 📅 明天或之後（請說明具體日期時間）
6️⃣ 💬 需要討論（我們會致電與您協調）

💡 提示：
   • 選擇「越快越好」會優先派工
   • 夏季高溫期，冷氣維修需求較高，建議盡早安排

請回覆數字（1-6）：

💭 系統狀態：表單收集中（field: preferred_time）
```

---

### 📍 第八輪對話：租戶選擇維修時間

```
👤 租戶（14:38:25）: 1

💭 系統內部處理：
   [14:38:25] 收到訊息："1"
   [14:38:25] 解析選項："1" → "越快越好"
   [14:38:26] 儲存到 collected_data:
              collected_data = {
                ...
                "preferred_time": "asap",
                "preferred_time_display": "越快越好"
              }
   [14:38:26] 標記為優先處理（會影響最終優先級）
   [14:38:26] current_field_index: 5 → 6
   [14:38:26] 下一個欄位：access_method（進入方式）
   [14:38:27] 返回下一個問題

🤖 系統（14:38:27）:
✓ 已記錄：越快越好

我們會優先為您安排。根據目前維修人員的排程，預計可在 4 小時內到達（最快可能在 2 小時內）。

【問題 7/10】進入方式

維修人員如何進入您的房間？

1️⃣ 👤 我會在場（維修人員到達時我會開門）
2️⃣ 🏠 房東/管理員陪同（管理處安排）
3️⃣ 🔑 使用備用鑰匙（管理處提供備用鑰匙）
4️⃣ 🚪 管理處協助開門（需要時管理員會協助）

💡 提示：
   • 選擇「我會在場」：維修完成後您能立即確認
   • 選擇其他方式：請確保管理處知情

請回覆數字（1-4）：

💭 系統狀態：表單收集中（field: access_method）
```

---

### 📍 第九輪對話：租戶選擇進入方式

```
👤 租戶（14:38:50）: 1

💭 系統內部處理：
   [14:38:50] 收到訊息："1"
   [14:38:50] 解析選項："1" → "我會在場"
   [14:38:51] 儲存到 collected_data:
              collected_data = {
                ...
                "access_method": "tenant_present",
                "access_method_display": "我會在場"
              }
   [14:38:51] current_field_index: 6 → 7
   [14:38:51] 下一個欄位：contact_requirement（事前聯絡需求）
   [14:38:52] 返回下一個問題

🤖 系統（14:38:52）:
✓ 已記錄：您會在場

【問題 8/10】事前聯絡

維修人員是否需要事前聯絡您？

1️⃣ 📞 是，請務必先打電話（維修人員會提前 15-30 分鐘致電）
2️⃣ 📱 傳訊息即可（維修人員會用簡訊或 LINE 通知）
3️⃣ ❌ 不用，可以直接過來（在您指定的時段內直接到達）

💡 提示：
   • 建議選擇「先打電話」，確保您做好準備
   • 維修人員會告知預計到達時間

請回覆數字（1-3）：

💭 系統狀態：表單收集中（field: contact_requirement）
```

---

### 📍 第十輪對話：租戶選擇聯絡方式

```
👤 租戶（14:39:10）: 1

💭 系統內部處理：
   [14:39:10] 收到訊息："1"
   [14:39:10] 解析選項："1" → "是，請務必先打電話"
   [14:39:11] 儲存到 collected_data:
              collected_data = {
                ...
                "contact_requirement": "call_first",
                "contact_requirement_display": "是，請務必先打電話"
              }
   [14:39:11] current_field_index: 7 → 8
   [14:39:11] 下一個欄位：additional_notes（其他說明，選填）
   [14:39:12] 返回下一個問題

🤖 系統（14:39:12）:
✓ 已記錄：維修人員會先打電話

我們會通知維修人員務必提前致電。

【問題 9/10】其他說明（選填）

還有其他需要我們知道的事項嗎？

例如：
• 特殊要求（例如：請帶鞋套、家中有寵物）
• 時間限制（例如：16:00 前必須完成）
• 環境說明（例如：冷氣安裝位置較高，可能需要梯子）

💡 這是選填欄位，如果沒有特別需要說明的，可以直接回覆「沒有」

請說明（或回覆「沒有」）：

💭 系統狀態：表單收集中（field: additional_notes）
```

---

### 📍 第十一輪對話：租戶補充說明

```
👤 租戶（14:39:40）: 請盡快處理，因為天氣很熱，晚上沒冷氣很難入睡。還有，家裡有小孩，麻煩維修人員注意安全。

💭 系統內部處理：
   [14:39:40] 收到訊息："請盡快處理，因為天氣很熱..."
   [14:39:40] 關鍵詞檢測：
              包含「盡快」→ 標記為緊急
              包含「小孩」→ 標記為有兒童
              包含「安全」→ 特別注意事項
   [14:39:41] 儲存到 collected_data:
              collected_data = {
                ...
                "additional_notes": "請盡快處理，因為天氣很熱，晚上沒冷氣很難入睡。還有，家裡有小孩，麻煩維修人員注意安全。",
                "flags": {
                  "urgent": true,
                  "children_present": true
                }
              }
   [14:39:41] current_field_index: 8 → 9
   [14:39:41] 下一個欄位：confirmation（最終確認）
   [14:39:42] 返回最終確認

🤖 系統（14:39:42）:
✓ 已記錄：您的特殊需求

我們會特別標注您的需求：
• 優先快速處理
• 維修現場有兒童，注意安全

【問題 10/10】最終確認

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📋 請確認以下資訊
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

【問題資訊】
問題類型：冷氣維修 - 冷氣無法啟動
問題位置：主臥室
發生時間：今天發生
緊急程度：緊急

【排查記錄】
已嘗試排查：是
排查內容：檢查了電源插座（插檯燈可用）、更換遙控器電池、嘗試面板按鈕、確認電箱未跳電
問題描述：完全沒反應，面板無燈號，無任何聲音，無異味

【派工資訊】
偏好時間：越快越好（預計 4 小時內）
進入方式：我會在場
事前聯絡：是，請務必先打電話
其他說明：請盡快處理（有小孩，注意安全）

【聯絡資訊】
租戶姓名：王小明
房號：3F-A
聯絡電話：0912-345-678

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

✅ 如以上資訊正確，請回覆「我確認提交」
🔄 如需修改，請告訴我要修改哪一項

請回覆：

💭 系統狀態：等待最終確認（field: confirmation）
```

---

### 📍 第十二輪對話：租戶確認提交

```
👤 租戶（14:40:10）: 我確認提交

💭 系統內部處理：
   [14:40:10] 收到訊息："我確認提交"
   [14:40:10] 確認關鍵詞匹配 ✓
   [14:40:11] 更新表單狀態：state: 'COLLECTING' → 'COMPLETED'
   [14:40:11] 創建 form_submission:
              {
                form_id: 'maintenance_troubleshooting',
                user_id: 'user_123',
                vendor_id: 1,
                session_id: 'session_abc',
                submitted_data: {
                  problem_category: 'ac_maintenance',
                  specific_problem: 'ac_not_starting',
                  urgency_level: 'urgent',
                  problem_location: '主臥室',
                  when_started: 'today',
                  tried_troubleshooting: 'yes_no_improvement',
                  troubleshooting_details: '...',
                  detailed_description: '...',
                  preferred_time: 'asap',
                  access_method: 'tenant_present',
                  contact_requirement: 'call_first',
                  additional_notes: '...',
                  flags: {urgent: true, children_present: true}
                },
                status: 'pending',
                submitted_at: '2026-01-22 14:40:11'
              }
   [14:40:12] 檢查 API callback → 找到 callback（type: 'api_call'）
   [14:40:12] 執行 API: maintenance_request
   [14:40:13] API 處理：
              - 計算優先級：P1（緊急）
                原因：問題類型=冷氣無法啟動 + 偏好時間=越快越好 + 夏季 + 有兒童
              - 生成工單編號：MT20260122001
              - 匹配維修人員：張師傅（冷氣專家，距離 2.5km，當前 1 個工單）
              - 更新 form_submission.status: 'pending' → 'assigned'
              - 創建工單記錄
   [14:40:14] 發送通知：
              - SMS to 張師傅：「新工單 MT20260122001，冷氣無法啟動（主臥室），預計 16:00 前完成，租戶電話 0912-345-678」
              - SMS to 租戶：「您的維修工單 MT20260122001 已建立，張師傅會在 30 分鐘內致電您」
              - Email to 租戶：包含完整工單資訊
              - 管理後台推送通知
   [14:40:15] 返回成功訊息

🤖 系統（14:40:15）:
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
✅ 維修請求已成功提交！
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

📋 工單資訊
━━━━━━━━━━━━━━━━
工單編號：MT20260122001
建立時間：2026-01-22 14:40
優先級：🟠 P1（緊急）
問題類型：冷氣維修 - 冷氣無法啟動
問題位置：主臥室

📍 派工資訊
━━━━━━━━━━━━━━━━
維修人員：張師傅
專長：冷氣維修、電器維修
聯絡電話：0922-111-222

⏰ 時間安排
━━━━━━━━━━━━━━━━
預計到達時間：4 小時內（最晚 18:30 前）
SLA 截止時間：2026-01-22 18:30

🔔 接下來的流程
━━━━━━━━━━━━━━━━
1️⃣ 張師傅會在 30 分鐘內致電您（0912-345-678）
2️⃣ 確認具體到達時間（通常會提前 15-30 分鐘通知）
3️⃣ 到達現場進行維修
4️⃣ 維修完成後請您確認測試
5️⃣ 系統會發送滿意度調查

💡 溫馨提醒
━━━━━━━━━━━━━━━━
• 請保持手機暢通 0912-345-678
• 我們已特別標注：優先處理、現場有兒童
• 如需查詢工單進度，請提供工單編號 MT20260122001
• 如有任何問題，可隨時聯絡客服：0800-123-456

感謝您使用我們的維修服務！

💭 系統狀態：工單已創建，等待維修人員處理
```

---

### 📊 業務數據記錄

```
完整流程統計：
━━━━━━━━━━━━━━━━━━━━━━
開始時間：14:30:15
結束時間：14:40:15
總耗時：10 分鐘

階段耗時：
- 排查階段：5 分鐘（14:30:15 - 14:35:20）
- 表單收集：4 分 50 秒（14:35:22 - 14:40:12）
- API 處理：3 秒（14:40:12 - 14:40:15）

用戶體驗：
- 問題數量：10 個
- 平均每題耗時：29 秒
- 輸入文字欄位：3 個（排查詳情、問題描述、其他說明）
- 選擇欄位：6 個
- 最終確認：1 個

工單品質：
- 排查記錄完整度：100%（所有步驟都已檢查）
- 問題描述清晰度：高（包含無反應、無燈號、無聲音、時間軸）
- 特殊需求標記：2 個（優先處理、有兒童）

系統效能：
- 意圖識別準確率：95%
- SOP 匹配速度：1 秒
- 關鍵詞觸發成功：是
- API 調用成功率：100%
- 通知發送成功率：100%（4/4）
```

---

## 業務重點分析

### ✅ 這個案例做得好的地方：

1. **排查階段有效**：系統提供了詳細的排查步驟，租戶認真執行並記錄
2. **資訊收集完整**：10 個問題收集了維修所需的所有關鍵資訊
3. **AI 分析準確**：系統根據描述準確判斷為電源供應或主機板問題
4. **優先級正確**：P1（4小時內）符合冷氣無法啟動的緊急程度
5. **派工合理**：匹配冷氣專家，距離近，工作量合理
6. **溝通清晰**：每一步都有清楚的提示和說明

### ⚠️ 可能的改進點：

1. **表單可以更快**：10 個問題可能稍多，可考慮合併部分問題
2. **預填更多資訊**：租戶的基本資訊（姓名、電話、房號）可以從系統自動帶入
3. **視覺化進度**：顯示「問題 X/10」讓租戶知道還剩多少
4. **中途保存**：如果租戶中斷填寫，24 小時內可以繼續

### 📈 預期結果：

- **租戶滿意度**：高（流程清晰、快速、專業）
- **維修效率**：高（資訊完整，維修人員準備充分）
- **SLA 達成率**：預期 100%（P1 工單，4 小時內處理）
- **一次修復率**：預期 90%+（問題診斷準確，攜帶正確工具零件）

---

## 🎬 場景 2：緊急型 SOP - 天花板漏水（自動派工）⚠️ 暫不實作

> **⚠️ 重要通知**：此場景展示的**緊急型模式現階段不會實作**，以下內容僅供未來參考。

**情境描述**（未來規劃）：租戶李小華（房號 5F-B）發現客廳天花板開始漏水，下午 15:45 緊急聯絡對話機器人。這是 P0 緊急情況，系統會自動創建工單，無需填寫表單。

---

### 📍 第一輪對話：租戶報告緊急情況

```
👤 租戶（15:45:30）: 天花板漏水了！

💭 系統內部處理：
   [15:45:30] 收到訊息："天花板漏水了！"
   [15:45:30] 緊急關鍵詞檢測：包含「天花板」+「漏水」→ 觸發緊急警報 🚨
   [15:45:30] 意圖分類 → intent_id: 42（漏水緊急）, confidence: 0.98
   [15:45:31] SOP 檢索 → 找到 SOP: "天花板漏水"（ID: 201）
   [15:45:31] SOP 配置：
              - trigger_mode: 'immediate'（行動型）✨ 關鍵！
              - next_action: 'api_call'
              - next_api_config: {
                  endpoint: "maintenance_request",
                  params: {
                    problem_category: "water_leak",
                    specific_problem: "ceiling_leak",
                    urgency_level: "critical",
                    auto_dispatch: true
                  }
                }
   [15:45:31] ⚠️ 檢測到緊急情況，啟動緊急處理流程
   [15:45:32] 立即執行 API（在返回 SOP 內容的同時）
   [15:45:32] API 處理（並行）：
              - 計算優先級：P0（非常緊急）
              - 生成工單編號：MT20260122010
              - 自動匹配維修人員：
                * 篩選條件：專長=水電維修、距離<5km、當前 P0 工單=0
                * 匹配結果：陳師傅（水電專家，距離 1.8km，立即可派）
              - 創建工單記錄
              - 設定 SLA：60 分鐘內到達
   [15:45:33] 發送緊急通知：
              - SMS to 陳師傅（立即）："🚨 緊急工單 MT20260122010，天花板漏水（5F-B客廳），請立即出發！租戶：0933-555-888"
              - 電話語音通知 to 陳師傅："您有一個 P0 緊急工單..."
              - SMS to 租戶："緊急維修已安排，陳師傅會在 1 小時內到達"
              - SMS to 值班主管："P0 工單創建：天花板漏水..."
              - App 推送 to 所有線上維修人員（備援）
   [15:45:34] 返回 SOP 內容 + 工單確認訊息

🤖 系統（15:45:34）:
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
🚨 這是緊急狀況！請立即採取以下措施
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

【緊急處理步驟】

1️⃣ 收集漏水（立即執行）
   • 在漏水處下方放置水桶或臉盆
   • 使用毛巾或抹布吸收積水
   • 移開漏水處下方的所有物品（電器、傢俱、貴重物品）

2️⃣ 關閉電源（重要！避免觸電）
   • 如果漏水接近電燈或插座，立即關閉該區域電源
   • 如果漏水範圍大，建議關閉整個區域的總開關
   • ⚠️ 不要用濕手觸碰電器開關

3️⃣ 通知樓上住戶
   • 如果是公寓，請立即聯絡樓上住戶（6F-B）
   • 可能是樓上的水管或浴室漏水
   • 請樓上住戶關閉水源

4️⃣ 拍照記錄
   • 拍下漏水位置和範圍（天花板狀況）
   • 拍下受損物品（用於保險理賠）
   • 拍下積水情況
   • 如果安全，拍下漏水天花板的細節（裂縫、水漬範圍）

5️⃣ 確保人員安全
   • 如果漏水量大，請暫時離開該區域
   • 特別注意老人和兒童安全
   • 如有天花板掉落危險，請遠離

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

⚡ 我已自動為您提交緊急維修請求

📋 緊急工單資訊
━━━━━━━━━━━━━━━━
工單編號：MT20260122010
建立時間：2026-01-22 15:45
優先級：🔴 P0（非常緊急）
問題類型：天花板漏水
問題位置：5F-B 客廳

📍 維修人員資訊
━━━━━━━━━━━━━━━━
維修人員：陳師傅
專長：水電維修、漏水處理
聯絡電話：0988-777-666
當前位置：距離 1.8 公里

⏰ 時間安排
━━━━━━━━━━━━━━━━
預計到達時間：1 小時內（最晚 16:45 前）
SLA 截止時間：2026-01-22 16:45

🔔 重要通知
━━━━━━━━━━━━━━━━
• 陳師傅已收到通知，正在趕往現場
• 陳師傅會在 5 分鐘內致電您確認情況（0933-555-888）
• 請保持手機暢通
• 如果情況持續惡化，請立即撥打緊急電話：0800-911-911

🆘 緊急聯絡資訊
━━━━━━━━━━━━━━━━
24 小時緊急專線：0800-911-911
值班主管：0922-123-456
陳師傅直線：0988-777-666

💡 在維修人員到達前
━━━━━━━━━━━━━━━━
✓ 持續收集漏水，避免擴大損失
✓ 保持電源關閉狀態
✓ 如果找到樓上住戶，請其關閉水源
✓ 拍照記錄損失
✓ 保持手機暢通，等待陳師傅來電

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

我們非常重視您的緊急情況。如有任何問題，請隨時聯絡我們。

💭 系統狀態：P0 緊急工單已自動創建並派工
```

---

### 📍 第二輪對話：維修人員致電確認（5 分鐘後）

```
💭 系統外部事件：
   [15:50:15] 陳師傅致電租戶 0933-555-888
   [15:50:15] 對話內容（電話錄音摘要）：
              陳師傅："李小姐您好，我是陳師傅，我現在在路上，大約 20 分鐘後到達。請問漏水情況嚴重嗎？"
              租戶："蠻嚴重的，一直在滴水，我用水桶接著。"
              陳師傅："好的，您做得很好。請問您有聯絡到樓上住戶嗎？"
              租戶："還沒有，樓上好像沒人在家。"
              陳師傅："沒關係，我到了會處理。您先保持電源關閉，我快到了。"
   [15:52:30] 陳師傅在維修 App 更新工單狀態：
              status: 'assigned' → 'on_the_way'
              estimated_arrival: '16:10'
              notes: '租戶已關閉電源，用水桶收集漏水。樓上無人。預計 20 分鐘到達。'
   [15:52:31] 系統自動發送更新通知給租戶

🤖 系統（15:52:31）（自動訊息）:
📱 工單更新通知

陳師傅已聯絡您並確認情況。

當前狀態：維修人員趕往現場中
預計到達：16:10（約 18 分鐘後）

陳師傅的備註：
「租戶已關閉電源，用水桶收集漏水。樓上無人。預計 20 分鐘到達。」

您可以隨時詢問工單進度。

💭 系統狀態：維修人員在途中
```

---

### 📍 第三輪對話：租戶主動查詢進度（期間）

```
👤 租戶（16:05:20）: 維修人員到哪裡了？

💭 系統內部處理：
   [16:05:20] 收到訊息："維修人員到哪裡了？"
   [16:05:20] 意圖識別 → 查詢工單進度
   [16:05:20] 檢索活躍工單 → 找到 MT20260122010（status: 'on_the_way'）
   [16:05:21] 獲取維修人員即時位置（從維修 App GPS）:
              當前位置：距離 5F-B 約 0.5 公里
              預計到達：5 分鐘內
   [16:05:21] 返回即時進度

🤖 系統（16:05:21）:
📍 工單即時進度

工單編號：MT20260122010
當前狀態：維修人員趕往現場中

陳師傅位置：
🚗 距離您約 0.5 公里
⏱️ 預計 5 分鐘內到達（16:10 左右）

最新更新（15:52）：
「租戶已關閉電源，用水桶收集漏水。樓上無人。預計 20 分鐘到達。」

💡 陳師傅很快就到了，請準備好：
   • 協助開門
   • 說明漏水位置
   • 提供樓上住戶聯絡方式（如果有）

如需聯絡陳師傅：0988-777-666

💭 系統狀態：維修人員即將到達
```

---

### 📍 第四輪對話：維修人員到達現場

```
💭 系統外部事件：
   [16:08:45] 陳師傅到達 5F-B
   [16:08:45] 陳師傅在維修 App 更新：
              status: 'on_the_way' → 'in_progress'
              actual_arrival: '16:08'
              notes: '已到達現場，開始檢查漏水源頭。'
   [16:08:46] 系統自動發送通知

🤖 系統（16:08:46）（自動訊息）:
✅ 維修人員已到達

陳師傅已到達 5F-B，正在處理您的漏水問題。

當前狀態：維修處理中
到達時間：16:08（比預計提前 2 分鐘）

陳師傅會：
1. 檢查漏水源頭
2. 判斷是否需要進入樓上（6F-B）
3. 進行緊急止漏處理
4. 評估後續修復方案

預計處理時間：30-60 分鐘

維修期間請勿關閉對話視窗，我們會即時更新進度。

💭 系統狀態：維修進行中
```

---

### 📍 第五輪對話：維修完成

```
💭 系統外部事件：
   [16:45:30] 陳師傅在維修 App 完成工單：
              status: 'in_progress' → 'completed'
              completion_time: '16:45'
              work_summary: '已進入樓上 6F-B（聯絡管理處開門），發現浴室排水管破裂。進行緊急止漏，更換破裂管段。5F-B 天花板損壞處已標記，建議後續進行天花板修復。'
              materials_used: '排水管 1.5m, 接頭 x2, 防水膠帶'
              cost: 1200
              photos: [photo1.jpg, photo2.jpg, photo3.jpg]
              next_steps: '建議 3 天後安排天花板修復，費用另估。'
   [16:45:31] 系統自動發送完成通知

🤖 系統（16:45:31）（自動訊息）:
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
✅ 維修已完成
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

工單編號：MT20260122010
完成時間：2026-01-22 16:45
總耗時：1 小時（15:45 - 16:45）

📋 維修摘要
━━━━━━━━━━━━━━━━
問題原因：樓上（6F-B）浴室排水管破裂

已完成工作：
✓ 進入樓上 6F-B（管理處協助開門）
✓ 找到漏水源頭：排水管破裂
✓ 更換破裂管段（1.5m 排水管）
✓ 進行緊急止漏處理
✓ 標記 5F-B 天花板損壞位置

使用材料：
• 排水管 1.5m
• 管接頭 x2
• 防水膠帶

💰 維修費用
━━━━━━━━━━━━━━━━
材料費：800 元
工資：400 元
合計：1,200 元

費用由樓上住戶（6F-B）負擔（原因：樓上管線問題）

📸 現場照片（3 張）
━━━━━━━━━━━━━━━━
• 樓上破裂排水管（維修前）
• 更換後的新管線（維修後）
• 5F-B 天花板損壞標記

⚠️ 後續建議
━━━━━━━━━━━━━━━━
建議 3 天後安排天花板修復：
• 天花板板材更換
• 重新粉刷
• 費用另行評估（預估 3,000-5,000 元）

目前漏水已完全停止，您可以安全使用該區域。

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

😊 請為本次服務評分

您對陳師傅的服務滿意嗎？

⭐⭐⭐⭐⭐ 非常滿意
⭐⭐⭐⭐ 滿意
⭐⭐⭐ 普通
⭐⭐ 不滿意
⭐ 非常不滿意

請回覆 1-5 顆星（例如：「5」）

💭 系統狀態：等待滿意度評分
```

---

### 📍 第六輪對話：租戶評分

```
👤 租戶（16:47:10）: 5

💭 系統內部處理：
   [16:47:10] 收到訊息："5"
   [16:47:10] 解析評分：5 顆星（非常滿意）
   [16:47:11] 儲存滿意度評分：
              ticket_id: MT20260122010
              rating: 5
              technician_id: 陳師傅
              rated_at: '2026-01-22 16:47:10'
   [16:47:11] 更新維修人員績效：
              陳師傅總評分：4.9 → 4.9（維持）
              陳師傅本月 5 星數：+1
   [16:47:12] 發送感謝訊息
   [16:47:12] 通知陳師傅收到好評
   [16:47:13] 關閉工單：status: 'completed' → 'closed'

🤖 系統（16:47:12）:
⭐⭐⭐⭐⭐ 感謝您的評分！

非常感謝您給予陳師傅 5 星好評！

您的回饋對我們非常重要，我們會將您的肯定轉達給陳師傅。

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

📋 工單完整記錄

工單編號：MT20260122010
問題類型：天花板漏水（P0 緊急）
報修時間：15:45
完成時間：16:45
總耗時：1 小時

維修人員：陳師傅 ⭐ 5.0
問題原因：樓上排水管破裂
維修費用：1,200 元（樓上負擔）

後續追蹤：
3 天後需安排天花板修復，我們會提前聯絡您預約時間。

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

如有任何問題，歡迎隨時聯絡我們：
• 客服專線：0800-123-456
• 工單編號：MT20260122010

祝您生活愉快！💙

💭 系統狀態：工單已關閉
```

---

### 📊 場景 2 業務數據記錄

```
緊急工單完整統計：
━━━━━━━━━━━━━━━━━━━━━━
報修時間：15:45:30
完成時間：16:45:30
總耗時：1 小時

關鍵時間點：
━━━━━━━━━━━━━━━━━━━━━━
15:45:30 - 租戶報修
15:45:34 - SOP 返回 + 工單自動創建（4 秒）✨
15:45:34 - 緊急通知發送（SMS + 電話 + App）
15:50:15 - 陳師傅致電租戶（4 分 45 秒）✅ SLA: 5 分鐘內聯絡
16:08:45 - 陳師傅到達現場（23 分鐘）✅ SLA: 60 分鐘內到達
16:45:30 - 維修完成（1 小時）✅ SLA: 2 小時內完成
16:47:10 - 租戶評分（5 星）

SLA 達成情況：
━━━━━━━━━━━━━━━━━━━━━━
⏱️ 5 分鐘內聯絡：✅ 達成（4 分 45 秒）
🚗 60 分鐘內到達：✅ 達成（23 分鐘）
🔧 2 小時內完成：✅ 達成（1 小時）

系統效能：
━━━━━━━━━━━━━━━━━━━━━━
- 緊急關鍵詞檢測：1 秒
- 自動創建工單：3 秒
- 多渠道通知發送：1 秒（並行）
- 維修人員匹配：即時（專長 + 距離 + 可用性）

租戶體驗：
━━━━━━━━━━━━━━━━━━━━━━
- 無需填寫表單：✅（緊急情況自動處理）
- 即時處理：✅（4 秒內完成所有系統流程）
- 維修人員響應速度：極快（4 分 45 秒致電）
- 問題解決：✅（1 小時內完成）
- 滿意度：5 星（非常滿意）

費用處理：
━━━━━━━━━━━━━━━━━━━━━━
- 總費用：1,200 元
- 負擔方：樓上住戶（6F-B）
- 原因：樓上管線問題導致
- 租戶無需支付：✅

後續追蹤：
━━━━━━━━━━━━━━━━━━━━━━
- 天花板修復：3 天後安排
- 預估費用：3,000-5,000 元
- 系統會自動提醒並聯絡租戶
```

---

## 場景 2 重點分析

### ✅ 緊急型 SOP 的特點 ⚠️ 暫不實作

> **⚠️ 注意**：以下內容為未來規劃，現階段不會實作。

1. **無需表單**：
   - 緊急情況不浪費時間填表單
   - 系統自動收集基本資訊（租戶、房號、電話）
   - 維修人員到場後再收集詳細資訊

2. **自動派工**：
   - 系統立即匹配最合適的維修人員
   - 考慮專長、距離、當前工作量
   - 多渠道通知（SMS + 電話 + App）

3. **P0 優先級**：
   - SLA 最緊：60 分鐘內到達，2 小時內完成
   - 所有維修人員收到備援通知
   - 值班主管同步收到通知

4. **即時溝通**：
   - 維修人員 5 分鐘內致電確認
   - 即時位置追蹤
   - 狀態自動更新

### 💡 與排查型 SOP 的對比 ⚠️ 暫不實作

> **⚠️ 注意**：緊急型現階段不會實作，此對比表僅供未來參考。

| 項目 | 排查型（場景 1）✅ 可用 | 緊急型（場景 2）⚠️ 暫不實作 |
|------|-----------------|-----------------|
| **觸發模式** | manual（等關鍵詞） | immediate（立即詢問） |
| **表單** | 需要（10 個問題） | 不需要 |
| **處理時間** | 10 分鐘（含表單） | 4 秒（純系統） |
| **優先級** | P1（4 小時內） | P0（1 小時內） |
| **通知方式** | SMS | SMS + 電話 + App |
| **租戶操作** | 需填寫表單 | 無需操作 |
| **適用情況** | 可以排查的問題 | 危險緊急情況 |

### 🎯 業務價值

1. **生命安全優先**：天花板漏水可能導致觸電、天花板坍塌等危險
2. **減少損失**：快速處理能大幅減少財產損失
3. **租戶安心**：知道系統立即處理，無需等待
4. **效率極高**：從報修到派工只需 4 秒

---

## 🎬 場景 3：行動型 SOP - 租金繳納登記（立即詢問）

**情境說明**: 租戶想要登記本月租金繳納記錄
**角色**: 租戶（李小姐）
**時間**: 2026年1月22日下午 13:20
**特點**: immediate 模式會在提供 SOP 後立即詢問是否執行動作

---

### 📍 第一輪對話：租戶詢問租金繳納

```
👤 租戶（13:20:30）: 我要登記租金繳納

💭 系統內部處理：
   [13:20:30] 收到訊息："我要登記租金繳納"
   [13:20:30] 意圖分類 → intent_id: 45（租金相關）, confidence: 0.98
   [13:20:31] 檢查是否有待處理的 SOP context → 無
   [13:20:31] SOP 檢索 → 找到 SOP: "租金繳納登記"（ID: 156）
   [13:20:31] SOP 配置：
              - trigger_mode: 'immediate'（行動型）✨
              - next_action: 'form_fill'
              - next_form_id: 'rent_payment_registration'
              - trigger_keywords: ['是', '要', '好', '可以', '需要']
              - immediate_prompt: '📋 是否要登記本月租金繳納記錄？'
   [13:20:32] 儲存 SOP context 到 Redis（TTL: 600秒）
   [13:20:32] 設置狀態：'IMMEDIATE_WAITING'（等待租戶確認）

🤖 系統（13:20:32）:

   【租金繳納登記說明】

   📅 每月租金繳納時間
   ━━━━━━━━━━━━━━━━━━━━━━
   • 繳納期限：每月 5 日前
   • 遲繳加收滯納金：每日 0.1%
   • 超過 10 日未繳：視為違約

   💳 可用繳納方式
   ━━━━━━━━━━━━━━━━━━━━━━
   1. 銀行轉帳（推薦）
      戶名：XX不動產股份有限公司
      銀行：中國信託銀行 822
      帳號：1234-5678-9012-3456

   2. ATM 轉帳
      銀行代碼：822
      帳號：同上

   3. 臨櫃繳款
      請攜帶繳款單至中國信託各分行

   4. 超商繳款（需提前申請繳款條碼）

   📝 繳納後請務必登記
   ━━━━━━━━━━━━━━━━━━━━━━
   • 系統會自動核對入帳記錄
   • 登記後可即時更新繳納狀態
   • 避免遲繳通知的困擾

   ━━━━━━━━━━━━━━━━━━━━━━

   📋 是否要登記本月租金繳納記錄？

   提示：如果您已經繳納，請回覆「是」開始登記。

💭 系統內部處理：
   [13:20:32] 返回 SOP 內容 + immediate_prompt
   [13:20:32] 開始監聽租戶回覆（等待觸發關鍵詞）
   [13:20:32] 關鍵詞列表：['是', '要', '好', '可以', '需要']
```

---

### 📍 第二輪對話：租戶確認要登記

```
👤 租戶（13:20:45）: 好，我剛剛已經轉帳了

💭 系統內部處理：
   [13:20:45] 收到訊息："好，我剛剛已經轉帳了"
   [13:20:45] 檢查 SOP context → 找到（狀態：'IMMEDIATE_WAITING'）
   [13:20:45] 關鍵詞匹配：
              - 匹配到：'好'（immediate 觸發關鍵詞）✅
   [13:20:46] 從 Redis 提取 SOP 配置
   [13:20:46] 觸發後續動作：
              - next_action: 'form_fill'
              - next_form_id: 'rent_payment_registration'
   [13:20:47] 創建表單 session
              - session_id: 'fs_20260122_789012'
              - form_id: 'rent_payment_registration'
              - user_id: 'tenant_456'
              - vendor_id: 1
   [13:20:47] 載入表單 schema（5 個欄位）
   [13:20:47] 檢查是否有預填欄位（從 SOP next_api_config.params）
              - 找到預填值：tenant_name: '李小姐', property_id: 'A-301'
   [13:20:48] 設置表單狀態：'COLLECTING'
   [13:20:48] 開始第一個欄位收集：payment_date

🤖 系統（13:20:48）:

   好的，我來協助您登記本月租金繳納記錄 📝

   ━━━━━━━━━━━━━━━━━━━━━━
   📋 租金繳納登記（第 1/5 題）
   ━━━━━━━━━━━━━━━━━━━━━━

   請問您的繳款日期是？

   💡 提示：請提供轉帳或繳款的日期（例如：1月22日、今天、昨天）

💭 系統內部處理：
   [13:20:48] 返回第一個問題（payment_date）
   [13:20:48] 等待租戶輸入...
```

---

### 📍 第三輪對話：收集繳款日期

```
👤 租戶（13:21:05）: 今天早上 10 點

💭 系統內部處理：
   [13:21:05] 收到訊息："今天早上 10 點"
   [13:21:05] 檢查表單 session → fs_20260122_789012（狀態：'COLLECTING'）
   [13:21:05] 當前欄位：payment_date
   [13:21:06] AI 語意解析：
              - 原始輸入："今天早上 10 點"
              - 解析結果："2026-01-22 10:00"
              - 標準化格式："2026-01-22T10:00:00+08:00"
   [13:21:06] 驗證：
              - 日期不可為未來 ✅
              - 日期不可早於上個月 5 日 ✅
   [13:21:07] 儲存欄位值：
              UPDATE form_submissions
              SET field_values = jsonb_set(field_values, '{payment_date}', '"2026-01-22T10:00:00+08:00"')
              WHERE session_id = 'fs_20260122_789012'
   [13:21:07] 進度：1/5 已完成
   [13:21:07] 下一個欄位：payment_amount

🤖 系統（13:21:07）:

   ✅ 已記錄繳款日期：2026年1月22日 10:00

   ━━━━━━━━━━━━━━━━━━━━━━
   📋 租金繳納登記（第 2/5 題）
   ━━━━━━━━━━━━━━━━━━━━━━

   請問繳款金額是多少？

   💡 提示：請輸入實際轉帳或繳納的金額（例如：25000）

💭 系統內部處理：
   [13:21:07] 返回第二個問題（payment_amount）
   [13:21:07] 等待租戶輸入...
```

---

### 📍 第四輪對話：收集繳款金額

```
👤 租戶（13:21:25）: 25000

💭 系統內部處理：
   [13:21:25] 收到訊息："25000"
   [13:21:25] 檢查表單 session → fs_20260122_789012（狀態：'COLLECTING'）
   [13:21:25] 當前欄位：payment_amount
   [13:21:26] 驗證：
              - 數字格式檢查 ✅
              - 金額必須 > 0 ✅
              - 金額範圍合理性（5000-100000）✅
   [13:21:26] 查詢租戶應繳金額：
              SELECT monthly_rent FROM leases
              WHERE tenant_id = 'tenant_456' AND status = 'active'
              → 結果：25000
   [13:21:27] 比對：輸入金額 = 應繳金額 ✅（完全相符）
   [13:21:27] 儲存欄位值：
              UPDATE form_submissions
              SET field_values = jsonb_set(field_values, '{payment_amount}', '25000')
              WHERE session_id = 'fs_20260122_789012'
   [13:21:27] 進度：2/5 已完成
   [13:21:27] 下一個欄位：payment_method

🤖 系統（13:21:27）:

   ✅ 已記錄繳款金額：NT$ 25,000

   ━━━━━━━━━━━━━━━━━━━━━━
   📋 租金繳納登記（第 3/5 題）
   ━━━━━━━━━━━━━━━━━━━━━━

   請問您使用哪種繳款方式？

   請選擇：
   1️⃣ 銀行轉帳
   2️⃣ ATM 轉帳
   3️⃣ 臨櫃繳款
   4️⃣ 超商繳款
   5️⃣ 其他

💭 系統內部處理：
   [13:21:27] 返回第三個問題（payment_method - 單選）
   [13:21:27] 等待租戶選擇...
```

---

### 📍 第五輪對話：選擇繳款方式

```
👤 租戶（13:21:40）: 1

💭 系統內部處理：
   [13:21:40] 收到訊息："1"
   [13:21:40] 檢查表單 session → fs_20260122_789012（狀態：'COLLECTING'）
   [13:21:40] 當前欄位：payment_method（單選）
   [13:21:41] 驗證：
              - 選項編號有效性檢查（1-5）✅
              - 映射選項值："1" → "銀行轉帳"
   [13:21:41] 儲存欄位值：
              UPDATE form_submissions
              SET field_values = jsonb_set(field_values, '{payment_method}', '"銀行轉帳"')
              WHERE session_id = 'fs_20260122_789012'
   [13:21:41] 進度：3/5 已完成
   [13:21:41] 下一個欄位：transfer_account_last4

🤖 系統（13:21:41）:

   ✅ 已記錄繳款方式：銀行轉帳

   ━━━━━━━━━━━━━━━━━━━━━━
   📋 租金繳納登記（第 4/5 題）
   ━━━━━━━━━━━━━━━━━━━━━━

   請問轉出帳號末 4 碼是？

   💡 提示：方便系統核對入帳記錄（例如：1234）

💭 系統內部處理：
   [13:21:41] 返回第四個問題（transfer_account_last4）
   [13:21:41] 等待租戶輸入...
```

---

### 📍 第六輪對話：收集帳號末 4 碼

```
👤 租戶（13:21:55）: 5678

💭 系統內部處理：
   [13:21:55] 收到訊息："5678"
   [13:21:55] 檢查表單 session → fs_20260122_789012（狀態：'COLLECTING'）
   [13:21:55] 當前欄位：transfer_account_last4
   [13:21:56] 驗證：
              - 格式檢查：必須是 4 位數字 ✅
              - 範圍檢查：0000-9999 ✅
   [13:21:56] 儲存欄位值：
              UPDATE form_submissions
              SET field_values = jsonb_set(field_values, '{transfer_account_last4}', '"5678"')
              WHERE session_id = 'fs_20260122_789012'
   [13:21:56] 進度：4/5 已完成
   [13:21:56] 下一個欄位：notes（可選欄位）

🤖 系統（13:21:56）:

   ✅ 已記錄轉出帳號末 4 碼：****5678

   ━━━━━━━━━━━━━━━━━━━━━━
   📋 租金繳納登記（第 5/5 題）
   ━━━━━━━━━━━━━━━━━━━━━━

   是否有其他備註？

   💡 提示：可選填（例如：包含本月水電費、提前繳納下月租金等）
   如果沒有，請直接回覆「無」或「沒有」

💭 系統內部處理：
   [13:21:56] 返回第五個問題（notes - 可選）
   [13:21:56] 等待租戶輸入...
```

---

### 📍 第七輪對話：完成登記

```
👤 租戶（13:22:10）: 包含本月水電費 800 元

💭 系統內部處理：
   [13:22:10] 收到訊息："包含本月水電費 800 元"
   [13:22:10] 檢查表單 session → fs_20260122_789012（狀態：'COLLECTING'）
   [13:22:10] 當前欄位：notes（可選）
   [13:22:11] 儲存欄位值：
              UPDATE form_submissions
              SET field_values = jsonb_set(field_values, '{notes}', '"包含本月水電費 800 元"')
              WHERE session_id = 'fs_20260122_789012'
   [13:22:11] 進度：5/5 已完成
   [13:22:11] 所有欄位收集完畢，準備最終確認頁面
   [13:22:12] 生成確認頁面內容（包含所有已收集資料）

🤖 系統（13:22:12）:

   ━━━━━━━━━━━━━━━━━━━━━━
   📋 租金繳納登記 - 確認資料
   ━━━━━━━━━━━━━━━━━━━━━━

   租戶姓名：李小姐
   房號：A-301
   繳款日期：2026年1月22日 10:00
   繳款金額：NT$ 25,000
   繳款方式：銀行轉帳
   轉出帳號：****5678
   備註：包含本月水電費 800 元

   ━━━━━━━━━━━━━━━━━━━━━━

   請確認以上資料是否正確？

   ✅ 確認提交
   ❌ 取消

💭 系統內部處理：
   [13:22:12] 設置表單狀態：'CONFIRMING'
   [13:22:12] 等待租戶確認...

👤 租戶（13:22:20）: 確認

💭 系統內部處理：
   [13:22:20] 收到確認訊息
   [13:22:20] 關鍵詞匹配：'確認' ✅
   [13:22:21] 開始提交流程
   [13:22:21] 更新表單 session：
              UPDATE form_submissions
              SET status = 'COMPLETED',
                  completed_at = '2026-01-22T13:22:21+08:00'
              WHERE session_id = 'fs_20260122_789012'
   [13:22:22] 創建租金繳納記錄：
              INSERT INTO rent_payments (
                tenant_id, property_id, payment_date, amount,
                payment_method, account_last4, notes, status, created_at
              ) VALUES (
                'tenant_456', 'A-301', '2026-01-22T10:00:00+08:00', 25000,
                '銀行轉帳', '5678', '包含本月水電費 800 元', 'pending_verification', NOW()
              )
              RETURNING payment_id
              → payment_id: 'RP20260122001'
   [13:22:23] 觸發後台核對任務：
              - 自動比對銀行入帳記錄（每 15 分鐘執行一次）
              - 匹配條件：金額 25000 + 帳號末4碼 5678 + 日期 2026-01-22
   [13:22:23] 發送通知：
              - SMS to 李小姐：「您的租金繳納登記已收到（RP20260122001），系統將於 2 小時內完成核對。」
              - Email to 財務部門：「租戶李小姐（A-301）已登記繳納 1 月租金 NT$ 25,000，請核對入帳。」
   [13:22:24] 更新租戶繳租狀態：
              UPDATE leases
              SET last_payment_date = '2026-01-22',
                  payment_status = 'pending_verification'
              WHERE tenant_id = 'tenant_456'
   [13:22:24] 清理 Redis SOP context（任務完成）

🤖 系統（13:22:24）:

   ✅ 租金繳納登記成功！

   ━━━━━━━━━━━━━━━━━━━━━━
   📋 登記編號：RP20260122001
   ━━━━━━━━━━━━━━━━━━━━━━

   您的租金繳納登記已成功提交！

   📱 後續處理：
   • 系統將自動核對銀行入帳記錄
   • 預計 2 小時內完成核對
   • 核對完成後將發送簡訊通知您

   💡 查詢進度：
   您可以隨時詢問「查詢租金繳納狀態」

   🔔 系統已同時通知財務部門進行核對

   ━━━━━━━━━━━━━━━━━━━━━━

   感謝您的配合！

💭 系統內部處理：
   [13:22:24] 整個流程結束
   [13:22:24] 表單 session 關閉
   [13:22:24] 記錄業務數據統計...
```

---

### 📊 場景 3 業務數據記錄

**時間統計**:
- 開始時間：13:20:30
- 結束時間：13:22:24
- **總耗時：1 分 54 秒**

**對話輪次**:
- 總輪次：7 輪
- SOP 說明 + 立即詢問：1 輪（32 秒）
- 確認觸發：1 輪（13 秒）
- 表單收集：5 輪（1 分 9 秒）

**表單收集效率**:
- 欄位總數：5 個（必填 4 個 + 可選 1 個）
- 平均每題耗時：13.8 秒
- 預填欄位：2 個（tenant_name, property_id）
- 租戶手動輸入：5 個

**觸發方式**:
- trigger_mode: 'immediate'
- 關鍵詞命中：'好'（第 2 輪）
- 從 SOP 到觸發：15 秒

**系統處理**:
- 資料驗證次數：5 次（全部通過 ✅）
- 數據庫操作：3 次寫入（form_submission + rent_payment + lease update）
- AI 語意解析：1 次（日期解析）
- 後台任務觸發：1 個（銀行入帳核對）

**通知發送**:
- SMS：1 則（發給租戶）
- Email：1 則（發給財務部門）

**租戶體驗**:
- 操作步驟：7 步
- 需要輸入文字：3 次
- 需要選擇選項：1 次
- 最終狀態：成功登記 ✅

---

## 場景 3 重點分析

### 🎯 immediate 模式特點

1. **立即詢問，快速決策**
   - SOP 內容返回後**立即附上詢問**
   - 不需要等待額外關鍵詞
   - 租戶可以直接說「是」就觸發

2. **適用於主動型業務**
   - 租戶已有明確意圖（我要登記租金）
   - 不需要排查步驟（與 manual 不同）
   - 也不需要緊急處理（與 auto 不同）

3. **與 manual 模式的差異**
   - manual：需要等租戶嘗試排查後說「還是不行」才觸發
   - immediate：提供資訊後**立即問**是否要執行
   - 關鍵詞更通用：['是', '要', '好', '可以', '需要']

4. **流程更順暢**
   - 減少對話輪次
   - 租戶意圖明確時更高效
   - 總耗時僅 1 分 54 秒（比 manual 快 5 倍以上）

### 📊 與場景 1、2 的對比

> **⚠️ 注意**：緊急型（場景 2）現階段不會實作，此對比表中僅供參考。

| 項目 | 排查型（場景 1）✅ | 緊急型（場景 2）⚠️ 暫不實作 | 行動型（場景 3）✅ |
|------|-----------------|-----------------|-----------------|
| **觸發模式** | manual（等關鍵詞） | immediate（立即詢問） | immediate（立即詢問） |
| **返回 SOP** | 是（排查步驟） | 是（緊急指引） | 是（業務說明） |
| **是否詢問** | 不主動詢問 | 不詢問（直接執行） | **立即詢問** ✨ |
| **觸發時機** | 租戶說「還是不行」 | 返回 SOP 同時 | 租戶回覆「是/要/好」 |
| **表單** | 需要（10 個問題） | 不需要 | 需要（5 個問題） |
| **處理時間** | 10 分鐘（含排查） | 4 秒（純系統） | 1 分 54 秒 |
| **後續動作** | form_then_api | api_call | **form_fill** |
| **優先級** | P1（4 小時內） | P0（1 小時內） | 無（非維修） |
| **租戶操作** | 需排查 + 填表單 | 無需操作 | 僅填表單 |
| **適用情況** | 可排查的問題 | 危險緊急情況 | **主動型業務** ✨ |

### 🎯 業務價值

1. **提升用戶體驗**：租戶有明確意圖時，一句話就能觸發，無需額外等待
2. **減少對話輪次**：從提出需求到完成登記僅 7 輪（場景 1 需 12 輪）
3. **適用主動型業務**：
   - 租金繳納登記
   - 訪客登記
   - 設施預約
   - 包裹領取登記
4. **靈活性高**：租戶可以先看完 SOP 說明（繳款方式、期限等）再決定是否執行

### 💡 immediate 模式的關鍵設計

```sql
-- SOP 配置範例
UPDATE vendor_sop_items SET
  trigger_mode = 'immediate',
  next_action = 'form_fill',
  next_form_id = 'rent_payment_registration',
  trigger_keywords = ARRAY['是', '要', '好', '可以', '需要'],
  immediate_prompt = '📋 是否要登記本月租金繳納記錄？',
  followup_prompt = '好的,我來協助您登記本月租金繳納記錄 📝'
WHERE sop_id = 156;
```

---

## 🎬 場景 4：資訊型 SOP - 垃圾收取時間（純資訊）

**情境說明**: 租戶詢問垃圾收取時間
**角色**: 租戶（張先生）
**時間**: 2026年1月22日晚上 20:15
**特點**: none 模式僅提供資訊，無任何後續動作

---

### 📍 第一輪對話：租戶詢問垃圾收取時間

```
👤 租戶（20:15:20）: 垃圾什麼時候收？

💭 系統內部處理：
   [20:15:20] 收到訊息："垃圾什麼時候收？"
   [20:15:20] 意圖分類 → intent_id: 88（垃圾相關查詢）, confidence: 0.97
   [20:15:21] 檢查是否有待處理的 SOP context → 無
   [20:15:21] SOP 檢索 → 找到 SOP: "垃圾收取時間"（ID: 201）
   [20:15:21] SOP 配置：
              - trigger_mode: null（不需觸發模式）✨
              - next_action: 'none'（無後續動作）
              - next_form_id: NULL
              - next_api_config: NULL
   [20:15:22] 不需要儲存 SOP context（資訊型不需追蹤）
   [20:15:22] 直接返回 SOP 內容

🤖 系統（20:15:22）:

   【垃圾收取時間規範】

   🗑️ 一般垃圾
   ━━━━━━━━━━━━━━━━━━━━━━
   • 收取時間：每週 一、三、五
   • 時段：晚上 8:00 - 9:00
   • 地點：1樓大門口垃圾收集區
   • 請使用社區專用垃圾袋（藍色）

   ♻️ 資源回收
   ━━━━━━━━━━━━━━━━━━━━━━
   • 收取時間：每週 二、四、六
   • 時段：晚上 8:00 - 9:00
   • 地點：1樓大門口回收區
   • 分類：紙類、塑膠、玻璃、金屬

   🍴 廚餘回收
   ━━━━━━━━━━━━━━━━━━━━━━
   • 收取時間：每週 一、三、五
   • 時段：晚上 8:00 - 9:00
   • 地點：1樓大門口廚餘桶
   • 請將廚餘瀝乾水分

   📦 大型垃圾
   ━━━━━━━━━━━━━━━━━━━━━━
   • 需提前預約：至少 3 天前
   • 聯絡管理室：(02)1234-5678
   • 收費標準：
     - 單人沙發：NT$ 300
     - 雙人/三人沙發：NT$ 500
     - 床墊：NT$ 400
     - 其他大型傢俱：依尺寸報價

   ⚠️ 注意事項
   ━━━━━━━━━━━━━━━━━━━━━━
   1. 請勿提早放置垃圾，避免堆積異味
   2. 垃圾袋務必綁緊，防止散落
   3. 玻璃類請用報紙包好，避免割傷清潔人員
   4. 電池、燈泡等有害垃圾請分開回收
   5. 違規丟棄者將依社區管理辦法處理

   💡 今天是星期三，今晚 8-9 點可以丟一般垃圾和廚餘

💭 系統內部處理：
   [20:15:22] SOP 內容已返回
   [20:15:22] trigger_mode = null，無後續動作
   [20:15:22] 對話結束，不需等待關鍵詞
   [20:15:22] 不創建表單 session
   [20:15:22] 不調用 API
   [20:15:22] 記錄查詢日誌：
              INSERT INTO sop_query_logs (
                user_id, sop_id, query_text, response_time_ms, created_at
              ) VALUES (
                'tenant_789', 201, '垃圾什麼時候收？', 2000, NOW()
              )
```

---

### 📍 第二輪對話：租戶追加詢問（可選）

```
👤 租戶（20:16:05）: 大型傢俱要怎麼預約？

💭 系統內部處理：
   [20:16:05] 收到訊息："大型傢俱要怎麼預約？"
   [20:16:05] 意圖分類 → intent_id: 89（大型垃圾預約）, confidence: 0.94
   [20:16:06] 檢查上下文：用戶剛查詢過垃圾相關資訊
   [20:16:06] 智能補充回覆（不觸發新 SOP）

🤖 系統（20:16:06）:

   關於大型垃圾預約，您可以：

   📞 方式 1：電話預約
   ━━━━━━━━━━━━━━━━━━━━━━
   • 撥打管理室電話：(02)1234-5678
   • 服務時間：週一至週六 9:00-18:00
   • 告知：預約日期、垃圾類型、數量

   💬 方式 2：透過我預約
   ━━━━━━━━━━━━━━━━━━━━━━
   • 直接跟我說：「我要預約大型垃圾清運」
   • 我會協助您填寫預約表單
   • 管理室確認後會簡訊通知您

   您想要現在預約嗎？

💭 系統內部處理：
   [20:16:06] 提供進一步資訊
   [20:16:06] 如果用戶說「要」，則觸發「大型垃圾預約」SOP（immediate 模式）
   [20:16:06] 如果用戶不回覆，對話自然結束

👤 租戶（20:16:30）: 不用了，謝謝

💭 系統內部處理：
   [20:16:30] 收到訊息："不用了，謝謝"
   [20:16:30] 意圖分類 → intent_id: 999（結束對話）
   [20:16:30] 對話正常結束

🤖 系統（20:16:30）:

   好的，不客氣！如果之後需要預約，隨時告訴我 😊

💭 系統內部處理：
   [20:16:30] 對話完全結束
   [20:16:30] 清理對話上下文
   [20:16:30] 記錄完整對話流程到數據庫
```

---

### 📊 場景 4 業務數據記錄

**時間統計**:
- 開始時間：20:15:20
- 結束時間：20:16:30
- **總耗時：1 分 10 秒**（包含追問）
- 純資訊查詢時間：2 秒

**對話輪次**:
- 總輪次：3 輪
- 主查詢：1 輪（2 秒）
- 追加查詢：1 輪（24 秒）
- 結束對話：1 輪（0 秒）

**觸發方式**:
- trigger_mode: null
- 無需觸發模式（純資訊型）
- 無 SOP context 儲存
- 無表單或 API

**系統處理**:
- SOP 檢索：1 次（耗時 1 秒）
- 資料驗證：0 次（無需驗證）
- 數據庫操作：1 次寫入（僅查詢日誌）
- AI 上下文理解：1 次（追問時使用）

**租戶體驗**:
- 操作步驟：1 步（詢問即獲得答案）
- 需要輸入：1 次
- 獲得資訊：立即（2 秒）
- 最終狀態：資訊獲取成功 ✅

---

## 場景 4 重點分析

### 🎯 none 模式特點

1. **純資訊提供，無後續動作**
   - 僅返回 SOP 內容
   - 不需要儲存任何 context
   - 不觸發表單或 API
   - 對話可以立即結束

2. **適用於常見問題**
   - 社區規範（垃圾、噪音、寵物）
   - 設施使用說明（游泳池、健身房、會議室）
   - 服務時間（管理室、保全、清潔）
   - 聯絡資訊（緊急電話、客服信箱）

3. **系統處理最簡單**
   - 無需狀態管理
   - 無需關鍵詞監聽
   - 無需表單 session
   - 僅記錄查詢日誌（用於數據分析）

4. **可自然延伸對話**
   - 用戶可以追問相關問題
   - 系統利用對話上下文智能補充
   - 如果追問涉及行動（如預約），可引導至其他 SOP

### 📊 與場景 1、2、3 的對比

> **⚠️ 注意**：緊急型（場景 2）現階段不會實作，此對比表中僅供參考。

| 項目 | 排查型（場景 1）✅ | 緊急型（場景 2）⚠️ 暫不實作 | 行動型（場景 3）✅ | 資訊型（場景 4）✅ |
|------|-----------------|-----------------|-----------------|-----------------|
| **觸發模式** | manual | auto | immediate | **none** ✨ |
| **返回 SOP** | 是（排查步驟） | 是（緊急指引） | 是（業務說明） | **是（純資訊）** ✨ |
| **後續動作** | form_then_api | api_call | form_fill | **無** ✨ |
| **是否儲存 context** | 是（等關鍵詞） | 是（短暫） | 是（等確認） | **否** ✨ |
| **表單** | 需要（10 題） | 不需要 | 需要（5 題） | **不需要** |
| **API 調用** | 是（創建工單） | 是（緊急派工） | 否 | **否** |
| **處理時間** | 10 分鐘 | 4 秒（系統） | 1 分 54 秒 | **2 秒** ✨ |
| **資料庫寫入** | 多次 | 多次 | 3 次 | **1 次**（僅日誌） |
| **租戶操作** | 排查 + 表單 | 無 | 填表單 | **無** ✨ |
| **適用情況** | 可排查問題 | 緊急危險 | 主動業務 | **資訊查詢** ✨ |
| **對話結束** | 提交後結束 | 評分後結束 | 登記後結束 | **立即可結束** ✨ |

### 🎯 業務價值

1. **減少人工負擔**：常見問題自動回答，不需客服人員介入
2. **7x24 可用**：租戶隨時可以查詢資訊，不受上班時間限制
3. **統一資訊來源**：所有租戶獲得一致、準確的資訊
4. **數據洞察**：
   - 追蹤哪些問題最常被問（優化 SOP 內容）
   - 分析查詢時段（調整服務時間）
   - 發現潛在需求（如大型垃圾預約常被問，可改為 immediate 模式）

### 💡 none 模式的關鍵設計

```sql
-- SOP 配置範例
UPDATE vendor_sop_items SET
  trigger_mode = NULL,             -- 不需觸發模式
  next_action = 'none',            -- 無後續動作
  next_form_id = NULL,             -- 不需要表單
  next_api_config = NULL,          -- 不調用 API
  trigger_keywords = NULL,         -- 不需要關鍵詞
  immediate_prompt = NULL,         -- 不需要詢問
  followup_prompt = NULL           -- 無後續引導
WHERE sop_id = 201;
```

### 📈 查詢日誌的應用

系統會記錄每次資訊查詢，用於：

```sql
-- 查詢統計範例
SELECT
  sop_id,
  COUNT(*) as query_count,
  AVG(response_time_ms) as avg_response_time
FROM sop_query_logs
WHERE created_at >= NOW() - INTERVAL '30 days'
  AND trigger_mode IS NULL
GROUP BY sop_id
ORDER BY query_count DESC
LIMIT 10;

-- 結果範例：
-- sop_id | query_count | avg_response_time
-- -------+-------------+------------------
--    201 |         458 |              1850  (垃圾收取時間)
--    202 |         312 |              1620  (設施使用時間)
--    203 |         287 |              1910  (停車規範)
--    204 |         156 |              1780  (寵物飼養規範)
```

**業務決策應用**：
- 如果某個 SOP 查詢量特別高 → 考慮在新租戶入住時主動提供
- 如果某個資訊型 SOP 經常伴隨預約需求 → 考慮改為 immediate 模式
- 如果回應時間過長 → 優化 SOP 內容或增加快取

---

## 🎬 場景 5：異常處理 - 表單填寫中途離題

**情境說明**: 租戶在填寫維修表單過程中突然詢問其他問題
**角色**: 租戶（王太太）
**時間**: 2026年1月23日上午 10:30
**特點**: 系統能暫存表單進度，處理離題問題後引導回歸

---

### 📍 第一輪對話：開始報修（前情）

```
👤 租戶（10:30:00）: 浴室水龍頭漏水

💭 系統內部處理：
   [10:30:00] 意圖分類 → intent_id: 18（水龍頭維修）
   [10:30:01] 觸發 SOP: "水龍頭漏水排查"（manual 模式）
   [10:30:01] 租戶回覆觸發關鍵詞，開始表單收集
   [10:30:02] 創建表單 session: 'fs_20260123_456789'

🤖 系統（10:30:02）:

   好的，我來協助您提交維修請求 🔧

   ━━━━━━━━━━━━━━━━━━━━━━
   📋 維修請求表單（第 1/10 題）
   ━━━━━━━━━━━━━━━━━━━━━━

   請問漏水的位置是？

   請選擇：
   1️⃣ 浴室
   2️⃣ 廚房
   3️⃣ 陽台
   4️⃣ 其他

👤 租戶（10:30:15）: 1

🤖 系統（10:30:15）:

   ✅ 已記錄位置：浴室

   ━━━━━━━━━━━━━━━━━━━━━━
   📋 維修請求表單（第 2/10 題）
   ━━━━━━━━━━━━━━━━━━━━━━

   請問水龍頭是哪種類型？

   請選擇：
   1️⃣ 臉盆水龍頭
   2️⃣ 浴缸水龍頭
   3️⃣ 蓮蓬頭
   4️⃣ 不確定

💭 系統內部處理：
   [10:30:15] 表單狀態：'COLLECTING'
   [10:30:15] 進度：1/10（已收集 location）
   [10:30:15] 等待第 2 題回答...
```

---

### 📍 第二輪對話：租戶突然離題

```
👤 租戶（10:30:45）: 對了，垃圾今天有收嗎？

💭 系統內部處理：
   [10:30:45] 收到訊息："對了，垃圾今天有收嗎？"
   [10:30:45] 檢查表單 session → 存在：fs_20260123_456789（狀態：'COLLECTING'）
   [10:30:46] 意圖分類：
              - 新意圖：intent_id: 88（垃圾相關查詢）
              - 與當前表單無關 ⚠️
   [10:30:46] 異常檢測：
              - 類型：'OFF_TOPIC'（離題）
              - 嚴重程度：'LOW'（低，不影響表單）
   [10:30:47] 策略決策：
              - 選擇：暫存表單 + 回答問題 + 引導回歸
              - 原因：問題簡單（資訊查詢），可快速回答後回歸
   [10:30:47] 暫存表單狀態：
              UPDATE form_submissions
              SET status = 'PAUSED',
                  paused_at = '2026-01-23T10:30:47+08:00',
                  pause_reason = 'off_topic_query'
              WHERE session_id = 'fs_20260123_456789'
   [10:30:48] 設置回歸提醒（TTL: 10 分鐘）
   [10:30:48] 檢索垃圾 SOP（trigger_mode: null）

🤖 系統（10:30:48）:

   今天是星期四，今晚 8-9 點會收資源回收 ♻️

   垃圾收取時間：
   • 一般垃圾：週一、三、五（晚上 8-9 點）
   • 資源回收：週二、四、六（晚上 8-9 點）

   ━━━━━━━━━━━━━━━━━━━━━━

   💡 我們剛才正在處理您的維修請求（浴室水龍頭漏水）

   是否要繼續填寫維修表單？

   ✅ 繼續填寫
   ❌ 稍後再填

💭 系統內部處理：
   [10:30:48] 回答離題問題（垃圾收取時間）
   [10:30:48] 同時提醒未完成的表單
   [10:30:48] 等待租戶決定是否繼續...
```

---

### 📍 第三輪對話：租戶決定繼續

```
👤 租戶（10:31:10）: 好，繼續

💭 系統內部處理：
   [10:31:10] 收到訊息："好，繼續"
   [10:31:10] 關鍵詞匹配：'繼續' ✅
   [10:31:11] 恢復表單 session
              UPDATE form_submissions
              SET status = 'COLLECTING',
                  resumed_at = '2026-01-23T10:31:11+08:00'
              WHERE session_id = 'fs_20260123_456789'
   [10:31:11] 載入暫存進度：
              - 已完成：1/10（location: '浴室'）
              - 當前問題：第 2 題（faucet_type）
   [10:31:11] 記錄離題事件：
              INSERT INTO form_interruption_logs (
                session_id, interruption_type, interruption_query,
                paused_at, resumed_at, duration_seconds
              ) VALUES (
                'fs_20260123_456789', 'off_topic', '垃圾今天有收嗎？',
                '10:30:47', '10:31:11', 24
              )

🤖 系統（10:31:11）:

   好的，我們繼續 💪

   ━━━━━━━━━━━━━━━━━━━━━━
   📋 維修請求表單（第 2/10 題）
   ━━━━━━━━━━━━━━━━━━━━━━

   請問水龍頭是哪種類型？

   請選擇：
   1️⃣ 臉盆水龍頭
   2️⃣ 浴缸水龍頭
   3️⃣ 蓮蓬頭
   4️⃣ 不確定

💭 系統內部處理：
   [10:31:11] 成功恢復表單
   [10:31:11] 繼續從第 2 題收集...
```

---

### 📍 第四輪對話：租戶再次離題（更複雜）

```
👤 租戶（10:31:30）: 1

💭 系統內部處理：
   [10:31:30] 收集第 2 題答案：'臉盆水龍頭'
   [10:31:30] 進度：2/10

🤖 系統（10:31:30）:

   ✅ 已記錄類型：臉盆水龍頭

   ━━━━━━━━━━━━━━━━━━━━━━
   📋 維修請求表單（第 3/10 題）
   ━━━━━━━━━━━━━━━━━━━━━━

   請簡單描述問題（例如：水龍頭一直滴水）

👤 租戶（10:32:15）: 等等，我想先登記租金繳納

💭 系統內部處理：
   [10:32:15] 收到訊息："等等，我想先登記租金繳納"
   [10:32:15] 檢查表單 session → 存在：fs_20260123_456789（狀態：'COLLECTING'）
   [10:32:16] 意圖分類：
              - 新意圖：intent_id: 45（租金繳納登記）
              - 與當前表單無關 ⚠️
              - 需要新的表單流程（immediate 模式）
   [10:32:16] 異常檢測：
              - 類型：'OFF_TOPIC_WITH_FORM'（離題且需另一個表單）
              - 嚴重程度：'MEDIUM'（中，需暫停當前表單）
   [10:32:17] 策略決策：
              - 選擇：暫存當前表單 + 詢問優先順序
              - 原因：新需求也需要表單，讓用戶選擇先後順序
   [10:32:17] 暫存表單狀態：
              UPDATE form_submissions
              SET status = 'PAUSED',
                  paused_at = '2026-01-23T10:32:17+08:00',
                  pause_reason = 'user_requested_new_form'
              WHERE session_id = 'fs_20260123_456789'

🤖 系統（10:32:17）:

   了解！您想要登記租金繳納 💰

   ⚠️ 提醒：您目前有一個進行中的維修請求（浴室水龍頭漏水，已填 2/10 題）

   請問您想要：

   1️⃣ 先完成維修表單（還剩 8 題，約 3 分鐘）
   2️⃣ 先登記租金繳納（約 2 分鐘）
   3️⃣ 取消維修表單，只登記租金

   💡 建議：先完成維修表單（已填 20%），避免資料遺失

💭 系統內部處理：
   [10:32:17] 詢問用戶優先順序
   [10:32:17] 暫存兩個待處理項目：
              - fs_20260123_456789（維修表單，進度 2/10）
              - 租金繳納（尚未開始）
   [10:32:17] 等待用戶選擇...
```

---

### 📍 第五輪對話：租戶選擇優先順序

```
👤 租戶（10:32:45）: 2，先登記租金

💭 系統內部處理：
   [10:32:45] 收到選擇："2"
   [10:32:45] 用戶選擇：先處理租金繳納
   [10:32:46] 確認當前表單已暫存（fs_20260123_456789）
   [10:32:46] 設置回歸提醒（延長 TTL: 20 分鐘）
   [10:32:46] 觸發租金繳納 SOP（immediate 模式）
   [10:32:47] 創建新表單 session: 'fs_20260123_789012'

🤖 系統（10:32:47）:

   好的，我們先處理租金繳納登記 📋

   （維修表單已暫存，完成後會提醒您繼續填寫）

   ━━━━━━━━━━━━━━━━━━━━━━
   📋 租金繳納登記（第 1/5 題）
   ━━━━━━━━━━━━━━━━━━━━━━

   請問您的繳款日期是？

   💡 提示：請提供轉帳或繳款的日期（例如：1月23日、今天、昨天）

💭 系統內部處理：
   [10:32:47] 開始新的表單流程
   [10:32:47] 同時維護兩個表單 session：
              - fs_20260123_456789（PAUSED，維修，進度 2/10）
              - fs_20260123_789012（COLLECTING，租金，進度 0/5）
   [10:32:47] 當前活動表單：fs_20260123_789012

（假設租戶順利完成租金繳納登記，耗時 2 分鐘）

👤 租戶（10:34:50）: [完成租金繳納登記]

💭 系統內部處理：
   [10:34:50] 租金表單完成
   [10:34:50] 檢查是否有暫存表單 → 找到：fs_20260123_456789
   [10:34:51] 暫存時間：2 分 33 秒（未超時）
   [10:34:51] 準備回歸提醒

🤖 系統（10:34:50）:

   ✅ 租金繳納登記成功！（登記編號：RP20260123002）

   ━━━━━━━━━━━━━━━━━━━━━━

   💡 提醒：您還有一個未完成的維修請求（浴室水龍頭漏水）

   已填進度：2/10 題
   預估剩餘時間：3 分鐘

   是否要繼續完成維修表單？

   ✅ 現在繼續
   ⏰ 稍後再填（將保留 20 分鐘）
   ❌ 取消表單

💭 系統內部處理：
   [10:34:50] 自動提醒未完成表單
   [10:34:50] 等待用戶決定...

👤 租戶（10:35:10）: 現在繼續

💭 系統內部處理：
   [10:35:10] 用戶選擇：現在繼續
   [10:35:11] 恢復表單：fs_20260123_456789
              UPDATE form_submissions
              SET status = 'COLLECTING',
                  resumed_at = '2026-01-23T10:35:11+08:00'
              WHERE session_id = 'fs_20260123_456789'
   [10:35:11] 記錄第二次離題事件：
              - 離題類型：user_requested_new_form
              - 暫停時長：2 分 54 秒
              - 完成其他任務：rent_payment_registration

🤖 系統（10:35:11）:

   好的，我們繼續完成維修表單 🔧

   ━━━━━━━━━━━━━━━━━━━━━━
   📋 維修請求表單（第 3/10 題）
   ━━━━━━━━━━━━━━━━━━━━━━

   請簡單描述問題（例如：水龍頭一直滴水）

💭 系統內部處理：
   [10:35:11] 成功恢復至第 3 題
   [10:35:11] 繼續收集...

（假設租戶順利完成剩餘 8 題）

🤖 系統（10:38:20）:

   ✅ 維修工單 MT20260123005 已建立！

   預計今日下午安排師傅到府維修。

💭 系統內部處理：
   [10:38:20] 維修表單完成
   [10:38:20] 總耗時：8 分 20 秒（包含兩次離題）
   [10:38:20] 淨表單時間：5 分 26 秒
   [10:38:20] 離題總時間：2 分 54 秒
```

---

### 📊 場景 5 業務數據記錄

**時間統計**:
- 開始時間：10:30:00
- 結束時間：10:38:20
- **總耗時：8 分 20 秒**
- 純表單時間：5 分 26 秒
- 離題時間：2 分 54 秒（35%）

**離題事件**:
- 離題次數：2 次
- 第 1 次：簡單資訊查詢（垃圾收取），24 秒
- 第 2 次：需要另一個表單（租金繳納），2 分 54 秒
- 恢復成功率：100%（2/2）

**表單會話管理**:
- 同時維護表單數：2 個（維修 + 租金）
- 暫存次數：2 次
- 恢復次數：2 次
- 取消次數：0 次
- 超時次數：0 次

**系統處理**:
- 離題檢測準確率：100%
- 自動暫存表單：2 次
- 回歸提醒：2 次
- 數據庫操作：多次（狀態更新、離題日誌）

**租戶體驗**:
- 可以自由離題詢問其他問題 ✅
- 系統自動暫存進度 ✅
- 完成後自動提醒回歸 ✅
- 可自主選擇優先順序 ✅
- 最終兩個任務都完成 ✅

---

## 場景 5 重點分析

### 🎯 離題處理機制

1. **智能檢測離題**
   - 意圖分類：識別新問題與當前表單無關
   - 嚴重程度評估：
     - LOW：簡單資訊查詢（垃圾時間、設施開放時間等）
     - MEDIUM：需要新表單或複雜操作
     - HIGH：緊急事件（天花板漏水、門鎖故障等）

2. **自動暫存機制**
   - 暫存表單狀態（PAUSED）
   - 記錄暫停時間和原因
   - 設置 TTL（Time To Live）：
     - 簡單離題：10 分鐘
     - 複雜離題：20 分鐘
     - 超時後表單自動取消

3. **優先順序管理**
   - 讓用戶選擇先後順序
   - 同時維護多個表單 session
   - 完成後自動提醒未完成項目

4. **回歸引導**
   - 主動提醒未完成表單
   - 顯示進度和預估時間
   - 提供多種選項（繼續/稍後/取消）

### 📊 離題類型與處理策略

| 離題類型 | 嚴重程度 | 處理策略 | TTL | 範例 |
|---------|---------|---------|-----|-----|
| **簡單資訊查詢** | LOW | 立即回答 + 引導回歸 | 10 分鐘 | 垃圾時間、設施開放時間 |
| **需要新表單** | MEDIUM | 暫存 + 讓用戶選優先順序 | 20 分鐘 | 租金登記、訪客登記 |
| **緊急事件** | HIGH | 立即處理 + 自動暫存原表單 | 30 分鐘 | 天花板漏水、瓦斯外洩 |
| **客服請求** | MEDIUM | 轉接人工 + 暫存表單 | 60 分鐘 | 「我要找客服」 |

### 🎯 業務價值

1. **提升用戶體驗**：
   - 不強迫用戶必須完成表單才能問其他問題
   - 尊重用戶的自然對話習慣
   - 避免「被卡住」的挫折感

2. **減少表單放棄率**：
   - 自動暫存進度，不會因離題而丟失
   - 主動提醒回歸，提高完成率
   - 數據顯示：有回歸提醒的表單完成率提升 40%

3. **智能多任務管理**：
   - 同時追蹤多個待處理項目
   - 自動判斷優先順序
   - 防止用戶遺忘未完成事項

4. **數據洞察**：
   - 分析哪些問題經常導致離題（優化表單流程）
   - 追蹤離題恢復率（評估提醒效果）
   - 識別用戶常見的多任務模式

### 💡 技術實現重點

```sql
-- 表單狀態管理
CREATE TYPE form_status AS ENUM (
  'COLLECTING',     -- 收集中
  'PAUSED',         -- 已暫停
  'CONFIRMING',     -- 確認中
  'COMPLETED',      -- 已完成
  'CANCELLED',      -- 已取消
  'EXPIRED'         -- 已過期
);

-- 離題事件日誌
CREATE TABLE form_interruption_logs (
  id SERIAL PRIMARY KEY,
  session_id VARCHAR(50),
  interruption_type VARCHAR(50),  -- off_topic, new_form_request, emergency, etc.
  interruption_query TEXT,
  paused_at TIMESTAMP,
  resumed_at TIMESTAMP,
  duration_seconds INTEGER,
  resolved BOOLEAN DEFAULT false,
  created_at TIMESTAMP DEFAULT NOW()
);

-- 自動過期檢查（定時任務，每分鐘執行）
UPDATE form_submissions
SET status = 'EXPIRED'
WHERE status = 'PAUSED'
  AND paused_at < NOW() - INTERVAL '20 minutes';
```

### 📈 離題處理數據統計

```sql
-- 離題事件統計
SELECT
  interruption_type,
  COUNT(*) as total_interruptions,
  AVG(duration_seconds) as avg_duration,
  SUM(CASE WHEN resolved THEN 1 ELSE 0 END)::FLOAT / COUNT(*) * 100 as resolution_rate
FROM form_interruption_logs
WHERE created_at >= NOW() - INTERVAL '30 days'
GROUP BY interruption_type
ORDER BY total_interruptions DESC;

-- 結果範例：
-- interruption_type       | total | avg_duration | resolution_rate
-- -----------------------+-------+--------------+----------------
-- off_topic              |   458 |           28 |          92.4%
-- new_form_request       |   156 |          180 |          78.2%
-- emergency              |    23 |          420 |          65.2%
-- customer_service       |    89 |          320 |          71.9%
```

**業務洞察**：
- 簡單離題（off_topic）恢復率最高（92.4%）
- 緊急事件導致的離題，原表單完成率較低（65.2%）→ 合理，用戶優先處理緊急情況
- 新表單請求的恢復率（78.2%）→ 可通過優化回歸提醒來提升

---

## 🎬 場景 6-10：其他異常處理與滿意度調查（精簡版）

> 為保持文檔可讀性，以下場景以精簡格式呈現核心流程。完整系統內部處理邏輯請參考場景 1-5。

### 場景 6：異常處理 - 用戶想修改已填資訊

**情境**: 租戶填完表單後發現填錯，想要修改

```
👤 租戶（14:25:30）: [已完成表單確認頁面]

🤖 系統: ━━━━━━━━━━━━━━━━
   📋 維修請求 - 確認資料
   ━━━━━━━━━━━━━━━━
   位置：浴室
   問題類型：水龍頭漏水
   聯絡電話：0912-345-678
   ...

   ✅ 確認提交
   ❌ 取消

👤 租戶（14:25:45）: 等等，電話號碼錯了

💭 系統檢測：用戶想修改資訊
   [14:25:45] 狀態：'CONFIRMING' → 'EDITING'
   [14:25:45] 啟動編輯模式

🤖 系統: 了解，您想修改哪個資訊？

   1️⃣ 聯絡電話
   2️⃣ 其他欄位
   3️⃣ 查看所有已填資訊

👤 租戶: 1

🤖 系統: 請提供正確的聯絡電話

👤 租戶: 0987-654-321

💭 系統處理：
   [14:26:10] 更新欄位：contact_phone = '0987-654-321'
   [14:26:10] 狀態：'EDITING' → 'CONFIRMING'

🤖 系統: ✅ 已更新聯絡電話：0987-654-321

   ━━━━━━━━━━━━━━━━
   📋 維修請求 - 確認資料（已更新）
   ━━━━━━━━━━━━━━━━
   位置：浴室
   問題類型：水龍頭漏水
   聯絡電話：0987-654-321 ⬅️ 已更新
   ...

   ✅ 確認提交
   ✏️ 繼續修改
   ❌ 取消
```

**業務數據**:
- 修改請求發生率：約 12% 的表單會被修改
- 最常修改欄位：聯絡電話（45%）、預約時間（32%）、問題描述（18%）
- 平均修改次數：1.3 次
- 修改後提交率：96%（幾乎都會繼續提交）

**技術重點**:
```sql
-- 記錄修改歷史
CREATE TABLE form_edit_logs (
  id SERIAL PRIMARY KEY,
  session_id VARCHAR(50),
  field_name VARCHAR(100),
  old_value TEXT,
  new_value TEXT,
  edited_at TIMESTAMP DEFAULT NOW()
);
```

---

### 場景 7：異常處理 - 用戶中途放棄表單

**情境**: 租戶填到一半決定不繼續

```
👤 租戶（11:15:00）: [正在填寫表單，第 5/10 題]

🤖 系統: 📋 維修請求表單（第 5/10 題）
   ...

👤 租戶（11:15:30）: 算了，不修了

💭 系統檢測：用戶想取消表單
   [11:15:30] 關鍵詞匹配：'算了', '不修了'
   [11:15:30] 意圖分類：cancel_form（信心度 0.92）
   [11:15:31] 詢問確認（防誤判）

🤖 系統: 了解，請問您是想：

   1️⃣ 暫停填寫，稍後繼續（保留 20 分鐘）
   2️⃣ 取消這次維修請求
   3️⃣ 繼續填寫（我協助您加快）

👤 租戶: 2，取消

💭 系統處理：
   [11:15:45] 用戶確認取消
   [11:15:45] 更新狀態：
              UPDATE form_submissions
              SET status = 'CANCELLED',
                  cancelled_at = NOW(),
                  cancel_reason = 'user_requested'
              WHERE session_id = 'fs_20260123_123456'
   [11:15:45] 記錄放棄事件：
              - 填寫進度：5/10（50%）
              - 放棄原因：user_requested
              - 耗時：15 分鐘

🤖 系統: ✅ 已取消維修請求

   如果之後需要維修，隨時告訴我 😊

   💡 小提示：如果只是暫時沒空填寫，可以選擇「暫停」，
   我會幫您保留進度 20 分鐘。
```

**業務數據**:
- 表單放棄率：8.5%
- 放棄時機分布：
  - 第 1-3 題放棄：45%（可能覺得太麻煩）
  - 第 4-7 題放棄：35%（表單疲勞）
  - 第 8-10 題放棄：20%（問題自行解決或其他原因）
- 誤判率：3.2%（用戶說「算了」但其實想繼續）→ 因此需要二次確認

**優化策略**:
- 簡化前 3 題（降低初期放棄率）
- 在第 4 題時顯示進度條（「已完成 40%」）激勵用戶
- 提供「快速模式」（僅問必填欄位，可選欄位稍後補）

---

### 場景 8：異常處理 - 重複報修檢測

**情境**: 租戶重複提交相同問題

```
👤 租戶（15:30:00）: 冷氣還是不會冷

💭 系統檢測：可能是重複報修
   [15:30:00] 查詢最近工單：
              SELECT * FROM maintenance_tickets
              WHERE tenant_id = 'tenant_123'
                AND created_at > NOW() - INTERVAL '7 days'
                AND status IN ('pending', 'assigned', 'in_progress')
              → 找到工單：MT20260122008

   [15:30:01] 工單詳情：
              - 工單號：MT20260122008
              - 問題：冷氣無法啟動
              - 狀態：assigned（已派工）
              - 預計到達：今日 16:00-18:00
              - 相似度：85%（高）

   [15:30:02] 判定：可能重複報修

🤖 系統: 我查詢到您有一個進行中的冷氣維修工單：

   📋 工單編號：MT20260122008
   ━━━━━━━━━━━━━━━━━━━━━━
   問題：冷氣無法啟動
   狀態：已派工 ✅
   維修師傅：陳師傅
   預計到達：今日 16:00-18:00（再 30 分鐘）
   聯絡電話：0912-345-678

   ━━━━━━━━━━━━━━━━━━━━━━

   請問您是想：

   1️⃣ 查詢這個工單的最新進度
   2️⃣ 催促師傅盡快到達
   3️⃣ 這是不同的問題，要新增工單

👤 租戶: 1

💭 系統處理：
   [15:30:20] 用戶選擇：查詢進度
   [15:30:20] 調用即時追蹤 API
   [15:30:21] 獲取師傅位置：距離 2.3km

🤖 系統: 📍 工單進度更新

   陳師傅目前距離您 2.3 公里
   預計 15 分鐘後到達

   🚗 即時位置追蹤：[查看地圖]

   如需聯絡師傅，可直接撥打：0912-345-678
```

**情境 B：確實是新問題**

```
👤 租戶: 3，這是不同的問題

💭 系統處理：
   [15:30:35] 用戶確認：不同問題
   [15:30:35] 繼續新工單流程
   [15:30:36] 但標記關聯：related_ticket_id = 'MT20260122008'

🤖 系統: 了解，我來協助您新增工單。

   💡 提示：您的上一個冷氣工單（MT20260122008）正在處理中，
   如果兩個問題相關，師傅到達時可以一併檢查。

   請描述這次的問題...
```

**業務數據**:
- 重複報修檢測率：5.2%
- 檢測準確率：87%（大部分確實是重複）
- 處理結果分布：
  - 查詢進度：62%
  - 催促師傅：25%
  - 確實是新問題：13%
- 用戶滿意度：避免重複工單讓用戶感到「被照顧」，滿意度提升 18%

**技術實現**:
```sql
-- 重複檢測邏輯
SELECT
  ticket_id,
  problem_description,
  status,
  similarity(problem_description, '冷氣還是不會冷') as similarity_score
FROM maintenance_tickets
WHERE tenant_id = 'tenant_123'
  AND created_at > NOW() - INTERVAL '7 days'
  AND status IN ('pending', 'assigned', 'in_progress')
  AND similarity(problem_description, '冷氣還是不會冷') > 0.7
ORDER BY similarity_score DESC
LIMIT 1;
```

---

### 場景 9：異常處理 - 客服介入接管

**情境**: 租戶要求人工客服或系統無法處理

```
👤 租戶（16:45:00）: 我要找客服

💭 系統檢測：客服請求
   [16:45:00] 意圖分類：request_human_agent（信心度 0.99）
   [16:45:00] 檢查當前狀態：
              - 有進行中的表單：是（維修表單，進度 3/10）
              - 營業時間：是（週一至週六 9:00-18:00）
              - 客服在線人數：3 人
              - 等待隊列：5 人
   [16:45:01] 預估等待時間：3-5 分鐘

🤖 系統: 了解，我幫您轉接人工客服 👩‍💼

   ⏰ 目前等待人數：5 人
   預估等待時間：3-5 分鐘

   ━━━━━━━━━━━━━━━━━━━━━━

   💡 轉接前提醒：
   您目前有一個進行中的維修表單（已填 3/10 題）
   我會為您保留 60 分鐘。

   ✅ 確認轉接人工客服
   ⏸ 我先處理其他事，稍後再找客服

👤 租戶: 確認

💭 系統處理：
   [16:45:15] 暫存當前表單（TTL: 60 分鐘）
              UPDATE form_submissions
              SET status = 'PAUSED',
                  pause_reason = 'human_agent_requested'
   [16:45:15] 創建客服工單：
              INSERT INTO customer_service_queue (
                tenant_id, request_type, context, priority, created_at
              ) VALUES (
                'tenant_123', 'human_agent',
                '{"current_form": "fs_xxx", "progress": "3/10", "topic": "maintenance"}',
                'normal', NOW()
              )
   [16:45:16] 發送通知給客服端：
              - 租戶資訊：王先生（A-505）
              - 當前問題：填寫維修表單中
              - 上下文：冷氣維修（已填 3 題）
   [16:45:16] 等待配對...

   [16:47:30] 客服 Linda 接起
   [16:47:30] 建立 WebSocket 連接
   [16:47:30] 切換至人工模式

🤖 系統: ✅ 已為您接通客服 Linda

   ━━━━━━━━━━━━━━━━━━━━━━

👩‍💼 客服 Linda（16:47:35）: 您好，我是客服 Linda，請問有什麼可以幫您？

   我看到您正在填寫冷氣維修表單，是在填寫過程中遇到問題嗎？

👤 租戶: 是的，我不確定該怎麼描述問題...

👩‍💼 客服 Linda: 沒問題，我來協助您...

   [對話進行中...]

   [10 分鐘後，問題解決]

👩‍💼 客服 Linda: 好的，您的維修工單已經建立完成（MT20260123010）

   如果還有其他問題，隨時再找我。祝您有美好的一天！

   ━━━━━━━━━━━━━━━━━━━━━━

💭 系統處理：
   [16:57:45] 人工會話結束
   [16:57:45] 記錄客服日誌：
              - 處理時長：10 分 10 秒
              - 問題類型：form_assistance
              - 解決狀態：resolved
              - 客服評分：（待租戶評分）
   [16:57:45] 恢復機器人模式
   [16:57:45] 清理暫存表單（已由客服完成）

🤖 系統: 感謝您的耐心等待 😊

   您的維修工單已建立成功！

   📋 工單編號：MT20260123010
   預計處理時間：今日 19:00 前

   💬 如需協助，隨時告訴我！
```

**業務數據**:
- 人工客服請求率：3.8%
- 請求原因分布：
  - 表單填寫困難：42%
  - 複雜問題需諮詢：28%
  - 情緒激動/抱怨：18%
  - 系統無法處理：12%
- 平均處理時長：8.5 分鐘
- 問題解決率：94%
- 客服滿意度：4.6/5.0

**人機協作重點**:
- 機器人暫存上下文，客服可直接接續
- 客服可查看完整對話歷史
- 客服可手動操作表單系統（權限更高）
- 結束後機器人恢復，確保一致體驗

---

### 場景 10：維修完成後滿意度調查

**情境**: 維修完成，系統自動觸發滿意度調查

```
💭 系統自動觸發：
   [18:30:00] 工單狀態更新：
              UPDATE maintenance_tickets
              SET status = 'completed',
                  completed_at = '2026-01-23T18:30:00'
              WHERE ticket_id = 'MT20260123010'
   [18:30:01] 觸發滿意度調查流程（延遲 30 分鐘）
   [19:00:00] 發送調查請求

🤖 系統（19:00:00）:

   您好！您的維修工單已完成 ✅

   📋 工單編號：MT20260123010
   問題類型：冷氣無法啟動
   維修師傅：陳師傅
   完成時間：今日 18:30

   ━━━━━━━━━━━━━━━━━━━━━━

   💬 請問您對這次的維修服務滿意嗎？

   請評分（1-5 星）：
   ⭐ 非常不滿意
   ⭐⭐ 不滿意
   ⭐⭐⭐ 普通
   ⭐⭐⭐⭐ 滿意
   ⭐⭐⭐⭐⭐ 非常滿意

👤 租戶（19:02:15）: 5

💭 系統處理：
   [19:02:15] 收到評分：5 星
   [19:02:15] 儲存評分：
              INSERT INTO service_ratings (
                ticket_id, rating, rated_at
              ) VALUES (
                'MT20260123010', 5, NOW()
              )
   [19:02:15] 判斷：高分（≥4），簡單追問
   （如果是低分 ≤2，會深入詢問問題）

🤖 系統（19:02:15）:

   感謝您的 5 星好評！⭐⭐⭐⭐⭐

   能否簡單分享您滿意的地方？（可選）

   例如：
   • 師傅服務態度好
   • 維修很快速
   • 問題解決得很徹底

   或直接回覆「無」跳過

👤 租戶（19:03:00）: 師傅很專業，很快就修好了

💭 系統處理：
   [19:03:00] 收到評論："師傅很專業，很快就修好了"
   [19:03:01] AI 情感分析：
              - 情感：正面（positive, 0.96）
              - 關鍵詞：專業、快
              - 提及：technician_skill, response_time
   [19:03:02] 儲存評論：
              UPDATE service_ratings
              SET comment = '師傅很專業，很快就修好了',
                  comment_sentiment = 'positive',
                  comment_keywords = ARRAY['專業', '快速']
              WHERE ticket_id = 'MT20260123010'
   [19:03:02] 更新師傅評分：
              UPDATE technicians
              SET total_ratings = total_ratings + 1,
                  total_score = total_score + 5,
                  avg_rating = (total_score + 5) / (total_ratings + 1)
              WHERE technician_id = 'tech_001'

🤖 系統（19:03:02）:

   感謝您的寶貴意見！您的回饋對我們非常重要 🙏

   我們會將您的好評轉達給陳師傅。

   ━━━━━━━━━━━━━━━━━━━━━━

   如果之後有任何維修需求，隨時告訴我！

   祝您生活愉快 😊
```

**情境 B：低分評價（需深入了解）**

```
👤 租戶: 2

💭 系統檢測：低分評價（≤2）
   [19:02:15] 觸發低分處理流程
   [19:02:15] 標記工單為「需關注」
   [19:02:15] 通知主管

🤖 系統: 抱歉讓您不滿意 😔

   能否告訴我們哪裡需要改進？

   請選擇：
   1️⃣ 師傅態度不佳
   2️⃣ 維修時間太久
   3️⃣ 問題沒有解決
   4️⃣ 費用不合理
   5️⃣ 其他原因

👤 租戶: 3

🤖 系統: 了解，問題沒有完全解決。

   請問目前還有什麼問題？
   我會立即安排師傅回訪。

👤 租戶: 冷氣還是有點不冷

💭 系統處理：
   [19:03:30] 記錄低分評價 + 問題未解決
   [19:03:30] 自動創建回訪工單：
              INSERT INTO maintenance_tickets (
                related_ticket_id, priority, problem_description, status
              ) VALUES (
                'MT20260123010', 'P1', '冷氣還是有點不冷（回訪）', 'pending'
              )
              RETURNING ticket_id
              → MT20260123011
   [19:03:31] 發送緊急通知：
              - SMS to 維修主管
              - SMS to 陳師傅
              - Email to 客服主管
   [19:03:32] 標記原工單：需回訪

🤖 系統: 非常抱歉造成您的困擾 🙏

   我已立即為您安排回訪：

   📋 回訪工單：MT20260123011
   優先級：P1（緊急）
   預計回訪時間：明日上午

   陳師傅或其他資深師傅會再次檢查，
   確保問題徹底解決。

   維修主管也會親自追蹤此案。

   如有任何問題，請立即撥打客服專線：
   ☎️ (02)1234-5678
```

**業務數據**:
- 調查回覆率：76%（高於行業平均 45%）
- 平均評分：4.2/5.0
- 評分分布：
  - 5 星：58%
  - 4 星：24%
  - 3 星：12%
  - 2 星：4%
  - 1 星：2%
- 低分處理：
  - 自動創建回訪工單：100%
  - 48 小時內回訪率：95%
  - 回訪後滿意度提升至：4.5/5.0

**關鍵設計**:
- 延遲 30 分鐘發送（給租戶喘息時間）
- 高分簡單追問，低分深入了解
- 低分自動觸發補救流程
- AI 情感分析識別關鍵問題
- 評分直接影響師傅績效
- 數據用於持續改善服務質量

---

### 類型 2：冷氣漏水（排查型）

```
👤 租戶: 冷氣滴水

🤖 系統: 【冷氣漏水 - 排查步驟】

        請先嘗試以下步驟：

        1️⃣ 檢查排水管
           • 確認排水管沒有脫落
           • 確認排水管沒有堵塞（可用細鐵絲疏通）

        2️⃣ 檢查室內機傾斜度
           • 確認室內機是否水平安裝
           • 如果向後傾斜，水才能順利排出

        3️⃣ 暫停使用
           • 先關閉冷氣，避免持續漏水
           • 用容器收集漏水

        若排查後仍漏水，請提交維修請求。

👤 租戶: 排水管看起來沒堵，但還是一直滴水

🤖 系統: 好的，我來協助您提交維修請求...

（後續表單流程與類型 1 類似，此處省略）

🤖 系統: ✅ 工單 MT20260122002 已建立！（P1，4小時內處理）
```

**業務重點**：
- 排水管堵塞是最常見原因，約 40% 可自行解決
- 如果持續漏水會損壞傢俱，需快速處理

---

### 類型 3：天花板漏水（緊急型 - 自動派工）⚠️ 暫不實作

> **⚠️ 重要通知**：此類型為**緊急型模式**，現階段不會實作。以下內容僅供未來參考。

```
👤 租戶: 天花板漏水了！

🤖 系統: 🚨 這是緊急狀況！請立即採取以下措施：

        【緊急處理步驟】

        1️⃣ 收集漏水
           • 立即在漏水處放置水桶或臉盆
           • 移開漏水處下方的物品（電器、傢俱、貴重物品）

        2️⃣ 關閉電源
           • 如果漏水接近電燈或插座，請立即關閉該區域電源
           • 避免觸電風險

        3️⃣ 通知樓上住戶
           • 如果是公寓，請立即聯絡樓上住戶檢查
           • 可能是樓上的水管或浴室漏水

        4️⃣ 拍照記錄
           • 拍下漏水位置和範圍
           • 拍下受損物品
           • 用於後續賠償和修繕

        ━━━━━━━━━━━━━━━━━━━━━━

        ⚡ 我已自動為您提交緊急維修請求

        📋 緊急工單資訊
        ━━━━━━━━━━━━━━━━
        工單編號：MT20260122003
        優先級：P0（非常緊急）
        問題類型：天花板漏水
        預計到達時間：1小時內

        維修人員會立即聯絡您，請保持手機暢通。

        🆘 緊急聯絡電話：0912-345-678
           （如果情況惡化，請立即撥打）
```

**業務重點**：
- **無需表單**：系統自動創建 P0 工單
- 值班人員會立即收到 SMS、Email、App 推送
- 維修人員會在 5 分鐘內致電租戶確認

---

### 類型 4：門鎖故障（排查型）

```
👤 租戶: 門鎖打不開

🤖 系統: 【門鎖故障 - 排查步驟】

        請先嘗試以下步驟：

        1️⃣ 檢查鑰匙
           • 確認使用的是正確的鑰匙
           • 檢查鑰匙是否彎曲或損壞

        2️⃣ 檢查鎖孔
           • 確認鎖孔沒有異物堵塞
           • 可以嘗試噴一點 WD-40 潤滑劑

        3️⃣ 檢查門框
           • 確認門框沒有變形
           • 嘗試調整門的角度

        4️⃣ 使用備用鑰匙
           • 如果有備用鑰匙，嘗試使用

        若無法解決，請提交維修請求。

👤 租戶: 試過了，鑰匙可以插進去但轉不動

🤖 系統: 好的，我來協助您提交維修請求...

（後續表單流程，收集位置、時間、描述等）

🤖 系統: ✅ 工單 MT20260122004 已建立！（P1，4小時內處理）
```

**業務重點**：
- 門鎖問題影響安全，列為 P1 緊急
- 如果租戶被鎖在外面，可啟動 P0 緊急流程

---

### 類型 5：電燈不亮（排查型）

```
👤 租戶: 客廳電燈不亮

🤖 系統: 【電燈不亮 - 排查步驟】

        請先嘗試以下步驟：

        1️⃣ 檢查燈泡
           • 嘗試旋轉燈泡，確認是否鬆脫
           • 更換新燈泡測試

        2️⃣ 檢查開關
           • 確認開關撥動順暢
           • 檢查其他房間的電燈是否正常

        3️⃣ 檢查電箱
           • 確認該區域的斷路器沒有跳掉
           • 如果跳掉，嘗試重新推上

        若排查後仍不亮，請提交維修請求。

👤 租戶: 換了新燈泡還是不亮，電箱也正常

🤖 系統: 好的，我來協助您提交維修請求...

（後續表單流程）

🤖 系統: ✅ 工單 MT20260122005 已建立！（P2，24小時內處理）
```

**業務重點**：
- 約 50% 的電燈問題是燈泡故障，換燈泡即可解決
- 如果是電路問題，需派電工處理

---

### 類型 6：熱水器故障（排查型）

```
👤 租戶: 沒有熱水

🤖 系統: 【熱水器故障 - 排查步驟】

        請先嘗試以下步驟：

        1️⃣ 檢查電源/瓦斯
           • 電熱水器：確認電源插頭插好，電源開關開啟
           • 瓦斯熱水器：確認瓦斯閥門開啟，有瓦斯供應

        2️⃣ 檢查溫度設定
           • 確認溫度設定足夠（建議 40-45°C）
           • 調高溫度後等待 10 分鐘

        3️⃣ 檢查水壓
           • 確認其他地方的水壓正常
           • 水壓過低會影響熱水器啟動

        若排查後仍無熱水，請提交維修請求。

👤 租戶: 電源和瓦斯都正常，溫度也調到最高了，還是沒熱水

🤖 系統: 好的，我來協助您提交維修請求...

（後續表單流程）

🤖 系統: ✅ 工單 MT20260122006 已建立！（P1，4小時內處理）
```

**業務重點**：
- 冬天的熱水器故障列為 P1，夏天列為 P2
- 瓦斯熱水器故障需派有證照的瓦斯技師

---

### 類型 7：馬桶堵塞（排查型）

```
👤 租戶: 馬桶堵住了

🤖 系統: 【馬桶堵塞 - 排查步驟】

        請先嘗試以下步驟：

        1️⃣ 使用馬桶吸把
           • 使用皮吸把（馬桶疏通器）
           • 用力上下抽動 10-15 次

        2️⃣ 使用熱水
           • 倒入一桶熱水（約 60-70°C）
           • 等待 5-10 分鐘
           • 再嘗試沖水

        3️⃣ 停止使用
           • 如果仍堵塞，請停止使用
           • 避免溢出造成更大問題

        若無法疏通，請提交維修請求。

👤 租戶: 用吸把試了很多次都不行

🤖 系統: 好的，我來協助您提交維修請求...

（後續表單流程）

🤖 系統: ✅ 工單 MT20260122007 已建立！（P1，4小時內處理）
```

**業務重點**：
- 約 60% 的馬桶堵塞可用吸把解決
- 如果多個馬桶同時堵塞，可能是主管道問題（P0）

---

### 類型 8：網路不通（排查型）

```
👤 租戶: 網路連不上

🤖 系統: 【網路不通 - 排查步驟】

        請先嘗試以下步驟：

        1️⃣ 檢查路由器
           • 確認路由器電源正常（指示燈有亮）
           • 確認網路線沒有鬆脫

        2️⃣ 重啟路由器
           • 拔掉路由器電源插頭
           • 等待 30 秒
           • 重新插上電源，等待 2 分鐘

        3️⃣ 測試其他設備
           • 用其他設備（手機、電腦）測試
           • 確認是設備問題還是網路問題

        4️⃣ 檢查 WiFi 設定
           • 確認輸入的 WiFi 密碼正確
           • 嘗試忘記網路後重新連接

        若仍無法連接，請提交報修。

👤 租戶: 重啟過了，其他設備也連不上

🤖 系統: 好的，我來協助您提交維修請求...

（後續表單流程）

🤖 系統: ✅ 工單 MT20260122008 已建立！（P2，24小時內處理）
```

**業務重點**：
- 約 70% 的網路問題可透過重啟路由器解決
- 如果是 ISP 問題，需聯絡電信商

---

### 類型 9：窗戶無法關閉（排查型）

```
👤 租戶: 窗戶關不起來

🤖 系統: 【窗戶無法關閉 - 排查步驟】

        請先嘗試以下步驟：

        1️⃣ 檢查軌道
           • 確認窗戶軌道沒有異物
           • 清潔軌道內的灰塵和雜物

        2️⃣ 檢查窗戶角度
           • 嘗試調整窗戶的角度
           • 確認窗框沒有變形

        3️⃣ 檢查鎖扣
           • 確認鎖扣沒有卡住
           • 嘗試潤滑鎖扣

        若無法關閉，請提交維修請求。

👤 租戶: 軌道清過了，但還是關不緊，會有縫隙

🤖 系統: 好的，我來協助您提交維修請求...

（後續表單流程）

🤖 系統: ✅ 工單 MT20260122009 已建立！（P2，24小時內處理）
```

**業務重點**：
- 如果影響安全（一樓窗戶）或下雨漏水，升級為 P1
- 通常需要調整窗框或更換配件

---

### 類型 10：租金繳納登記（行動型）

```
👤 租戶: 我要登記繳租

🤖 系統: 【租金繳納流程】

        📅 繳納時間
           每月 5 日前繳納當月租金

        💰 繳納方式
           銀行轉帳（推薦）
           銀行：玉山銀行
           帳號：1234-5678-9012-3456
           戶名：XX物業管理股份有限公司

        📝 繳納後請務必：
           1. 保留轉帳明細
           2. 登記繳納記錄（系統會自動更新）
           3. 如有問題請聯絡管理員

        📋 是否要登記本月租金繳納記錄？
           （回覆「是」、「要」或「好」即可開始登記）

👤 租戶: 要

🤖 系統: 好的，我來協助您登記繳租記錄。

        請提供繳納日期？（例如：01/22 或 今天）

👤 租戶: 今天

🤖 系統: 請提供轉帳金額（元）

👤 租戶: 15000

🤖 系統: 請提供轉帳帳號後五碼（用於核對）

👤 租戶: 12345

🤖 系統: 是否有備註或說明？（選填，可直接回覆「沒有」）

👤 租戶: 沒有

🤖 系統: ✅ 繳租記錄已成功登記！

        📋 登記資訊
        ━━━━━━━━━━━━
        租戶：王小明（3F-A）
        繳納日期：2026/01/22
        金額：15,000 元
        帳號後五碼：12345
        登記編號：RP20260122001

        我們會在 1 個工作日內核對，核對完成後會通知您。
        如需查詢記錄，請提供登記編號。
```

**業務重點**：
- 行動型 SOP：立即詢問是否要登記，無需等關鍵詞
- 登記後需人工核對轉帳明細
- 核對完成後系統會自動更新租金狀態

---

## 🏢 工單管理流程

### 工單生命週期

```
提交 → 待處理 → 已派工 → 處理中 → 已完成 → 已關閉
  ↓      ↓        ↓        ↓        ↓        ↓
創建   指派人員  維修開始  維修結束  租戶確認  歸檔
```

### 管理後台查看工單

**工單列表**：
```
┌─────────────────────────────────────────────────────────┐
│ 工單編號      │ 租戶    │ 問題類型     │ 優先級 │ 狀態    │
├─────────────────────────────────────────────────────────┤
│ MT20260122001 │ 王小明  │ 冷氣無法啟動 │ P1 🟠  │ 待處理  │
│ MT20260122002 │ 李小華  │ 冷氣漏水     │ P1 🟠  │ 已派工  │
│ MT20260122003 │ 張小美  │ 天花板漏水   │ P0 🔴  │ 處理中  │
│ MT20260122004 │ 陳小強  │ 門鎖故障     │ P1 🟠  │ 已完成  │
└─────────────────────────────────────────────────────────┘
```

**工單詳情**：
```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
 工單編號：MT20260122001
 狀態：待處理 → 已派工
 優先級：P1（緊急）- SLA 剩餘 3小時45分
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

【租戶資訊】
姓名：王小明
房號：3F-A
電話：0912-345-678
Email：wang@example.com

【問題詳情】
問題類型：冷氣維修 > 冷氣無法啟動
位置：主臥室
發生時間：今天發生（2026-01-22）
緊急程度：緊急

【排查記錄】
已嘗試排查：是
排查內容：檢查了電源插座和遙控器電池，也確認電箱沒有跳電
問題描述：完全沒反應，面板不亮，也沒有任何聲音

【派工資訊】
偏好時間：越快越好
進入方式：租戶在場
事前聯絡：是，請務必先打電話
其他說明：請盡快處理，因為天氣很熱

【時間記錄】
提交時間：2026-01-22 14:30
SLA 截止：2026-01-22 18:30（P1 = 4小時）
指派時間：2026-01-22 14:35
預計到達：2026-01-22 16:00

【指派維修人員】
姓名：張師傅
電話：0922-111-222
專長：冷氣維修、電器維修
當前位置：距離 2.5 公里

【操作記錄】
2026-01-22 14:30 - 系統自動創建工單
2026-01-22 14:35 - 管理員指派給張師傅
2026-01-22 14:36 - 張師傅已接單
2026-01-22 14:40 - 張師傅致電租戶，確認到達時間 16:00
```

### 管理人員操作

1. **指派維修人員**
   ```
   選擇合適的維修師傅（根據專長、位置、當前工作量）
   系統會自動發送通知給維修師傅
   ```

2. **更新工單狀態**
   ```
   待處理 → 已派工：選擇維修人員後
   已派工 → 處理中：維修人員到達現場後
   處理中 → 已完成：維修完成後
   已完成 → 已關閉：租戶確認滿意後
   ```

3. **聯絡租戶**
   ```
   直接撥打電話：0912-345-678
   發送訊息：系統內建訊息功能
   Email 通知：系統自動發送
   ```

4. **記錄處理結果**
   ```
   維修內容：更換冷氣主機板
   使用材料：主機板 x 1
   維修費用：2,500 元
   照片：上傳維修前後照片
   備註：建議租戶定期清潔濾網
   ```

---

## 👥 客服介入指南

### 何時需要客服介入

1. **租戶主動要求人工客服**
   ```
   👤 租戶: 我要跟人工客服說話

   🤖 系統: 好的，我正在為您轉接人工客服，請稍候...
           （系統會將對話記錄傳給客服人員）
   ```

2. **系統無法理解租戶意圖**
   ```
   連續 3 次無法識別意圖，系統會自動建議轉人工：

   🤖 系統: 抱歉，我不太理解您的問題。是否需要轉接人工客服？
           （回覆「是」轉接人工）
   ```

3. **租戶在表單中填寫不當內容**
   ```
   例如：連續輸入無意義文字、情緒激動、髒話等
   系統會標記並通知客服人員
   ```

4. **緊急情況需要立即處理**
   ```
   P0 工單創建時，系統會同時通知值班客服
   客服需立即致電租戶確認情況
   ```

### 客服介入流程

**步驟 1：查看對話記錄**
```
客服人員接手後，可以看到完整對話記錄：
- 租戶提問
- 系統回應
- 表單填寫進度（如果有）
- 工單資訊（如果已創建）
```

**步驟 2：繼續對話或接管表單**
```
選項 A：直接對話
客服：您好，我是客服小美，我來協助您處理問題。

選項 B：接管表單
客服可以在後台手動填寫剩餘欄位，加快處理速度
```

**步驟 3：處理問題**
```
- 詢問詳細情況
- 查詢歷史記錄
- 協調維修人員
- 記錄特殊需求
```

**步驟 4：創建或更新工單**
```
客服可以：
- 手動創建工單（如果系統未自動創建）
- 修改工單優先級（升級或降級）
- 添加備註
- 指定特定維修人員
```

### 客服工具

1. **快速查詢**
   ```
   - 租戶資訊：房號、電話、租期、繳租記錄
   - 歷史工單：過去的報修記錄
   - 當前狀態：是否有進行中的工單
   ```

2. **快捷回覆**
   ```
   - 常見問題回覆模板
   - 安撫租戶的標準話術
   - 維修進度更新模板
   ```

3. **權限操作**
   ```
   - 修改工單優先級
   - 指派特定維修人員
   - 延長 SLA 時間
   - 取消或關閉工單
   ```

---

## 🚨 特殊情況處理

### 情況 1：租戶填表單填到一半放棄

**系統行為**：
- 表單會話保留 24 小時
- 租戶可以隨時繼續填寫
- 24 小時後自動過期，資料清除

**客服處理**：
```
如果客服發現租戶填到一半就不填了：

1. 主動聯絡租戶：
   「王先生您好，我看到您剛才在填寫冷氣維修表單，是否遇到什麼問題需要協助？」

2. 詢問原因：
   - 太複雜不想填？→ 客服幫忙填寫
   - 問題解決了？→ 確認是否仍需維修
   - 臨時有事？→ 告知可以稍後繼續填寫

3. 根據情況處理：
   - 客服代填：加快處理速度
   - 取消表單：如果租戶不需要了
   - 提醒續填：發送訊息提醒
```

---

### 情況 2：租戶填錯資訊想修改

**提交前**：
```
👤 租戶: 我剛才填錯了，是次臥不是主臥

🤖 系統: 好的，我幫您修改。請重新說明問題位置？

👤 租戶: 次臥

🤖 系統: 已更新為「次臥」。我們繼續下一個問題...
```

**提交後**：
```
👤 租戶: 我剛才填的位置填錯了

🤖 系統: 工單已提交，如需修改請聯絡客服：0800-123-456
          或回覆「人工客服」轉接

客服處理：
1. 確認要修改的內容
2. 在後台更新工單資訊
3. 通知維修人員（如果已派工）
```

---

### 情況 3：重複提交相同問題

**系統檢測**：
```
如果租戶在 24 小時內提交相同問題（例如：都是「冷氣不冷」），系統會提示：

🤖 系統: 我們發現您在今天 14:30 已提交過「冷氣不冷」的維修請求（工單編號：MT20260122001）

        目前狀態：已派工
        維修人員：張師傅
        預計到達：16:00

        是否要查詢此工單進度？還是要提交新的問題？

        1. 查詢工單進度
        2. 提交新問題
        3. 取消
```

**客服處理**：
```
如果租戶堅持要重複提交：

1. 確認原因：
   - 之前的工單沒處理？→ 催促維修人員
   - 是不同的問題？→ 創建新工單
   - 問題加重了？→ 升級原工單優先級

2. 合併或分開處理：
   - 如果是同一個問題加重：升級原工單為 P0
   - 如果是不同位置的問題：創建新工單
```

---

### 情況 4：租戶情緒激動或抱怨

**系統識別**：
```
如果租戶使用負面情緒詞語（例如：「爛」、「垃圾」、「差勁」、「投訴」），系統會標記並通知客服：

🔔 提醒：工單 MT20260122001 的租戶可能情緒不佳，建議客服主動聯絡
```

**客服處理**：
```
標準安撫流程：

1. 主動致電租戶（不要等租戶來電）：
   「王先生您好，我是客服主管小美，我了解您對維修進度感到不滿意，我來幫您處理。」

2. 傾聽並記錄問題：
   - 讓租戶說完，不要打斷
   - 記錄關鍵問題點
   - 同理心回應：「我理解您的感受...」

3. 提出解決方案：
   - 加速處理：升級優先級，派最快的維修人員
   - 補償方案：例如減免維修費用、租金折扣
   - 後續追蹤：承諾會持續追蹤到問題解決

4. 記錄並上報：
   - 在工單中添加詳細備註
   - 如果是嚴重投訴，上報主管
```

---

### 情況 5：維修人員無法在 SLA 時間內到達

**系統告警**：
```
如果工單接近 SLA 截止時間（例如 P1 工單提交後 3.5 小時仍未處理），系統會發送告警：

⚠️ 警告：工單 MT20260122001 即將超過 SLA（剩餘 30 分鐘）
   優先級：P1
   提交時間：14:30
   SLA 截止：18:30
   當前狀態：已派工（但維修人員尚未到達）
```

**客服處理**：
```
1. 確認維修人員狀態：
   致電張師傅：「您預計多久能到達？」

2. 根據情況處理：

   情況 A：維修人員堵車、車輛故障等
   → 主動致電租戶說明情況
   → 提供預計到達時間
   → 提出補償方案（例如：優先處理、免費服務）

   情況 B：維修人員工作量過大，無法如期到達
   → 重新指派其他維修人員
   → 致電租戶道歉並說明

   情況 C：工單資訊有誤，實際不緊急
   → 與租戶確認實際情況
   → 調整優先級

3. 記錄並改進：
   - 記錄超時原因
   - 月底分析超時工單，改進流程
```

---

## 📊 報表與數據分析

### 報表類型

1. **工單統計報表**
   ```
   時間範圍：2026-01-01 ~ 2026-01-31

   ┌─────────────────────────────────────┐
   │ 總工單數：156                        │
   │ 已完成：142（91%）                   │
   │ 處理中：10（6%）                     │
   │ 已逾期：4（3%）                      │
   └─────────────────────────────────────┘

   按優先級分布：
   P0：8（5%）  - 平均處理時間 45 分鐘
   P1：62（40%）- 平均處理時間 3.2 小時
   P2：78（50%）- 平均處理時間 18 小時
   P3：8（5%）  - 平均處理時間 62 小時
   ```

2. **問題類型分析**
   ```
   ┌──────────────────────────────────────┐
   │ 問題類型        │ 數量 │ 佔比 │ 趨勢 │
   ├──────────────────────────────────────┤
   │ 冷氣相關        │ 48   │ 31%  │ ↑ +12%│
   │ 漏水相關        │ 28   │ 18%  │ ↓ -5% │
   │ 門鎖相關        │ 22   │ 14%  │ → 持平│
   │ 電力相關        │ 20   │ 13%  │ ↑ +8% │
   │ 熱水器相關      │ 18   │ 12%  │ ↓ -3% │
   │ 其他            │ 20   │ 13%  │ → 持平│
   └──────────────────────────────────────┘

   洞察：
   - 夏季（6-8月）冷氣維修需求大增
   - 雨季（5-6月）漏水問題增多
   - 建議提前安排冷氣保養
   ```

3. **租戶滿意度**
   ```
   ┌─────────────────────────────────────┐
   │ 維修完成後系統會自動發送滿意度調查   │
   ├─────────────────────────────────────┤
   │ 非常滿意：108（76%）                 │
   │ 滿意：28（20%）                      │
   │ 不滿意：6（4%）                      │
   └─────────────────────────────────────┘

   平均評分：4.7 / 5.0

   不滿意原因分析：
   1. 維修時間過長（3 件）
   2. 維修人員態度不佳（2 件）
   3. 問題未完全解決（1 件）
   ```

4. **維修人員績效**
   ```
   ┌──────────────────────────────────────────────┐
   │ 維修人員  │ 完成數 │ 平均時間 │ 滿意度 │ 排名 │
   ├──────────────────────────────────────────────┤
   │ 張師傅    │ 42     │ 2.8 小時 │ 4.9    │ ⭐   │
   │ 李師傅    │ 38     │ 3.1 小時 │ 4.7    │ ⭐   │
   │ 王師傅    │ 32     │ 3.5 小時 │ 4.6    │      │
   │ 陳師傅    │ 30     │ 4.2 小時 │ 4.3    │      │
   └──────────────────────────────────────────────┘

   績效獎金計算：
   - 完成數 x 50 元
   - 滿意度 >= 4.8 加發 1000 元
   - 平均時間 < 3 小時加發 500 元
   ```

5. **SLA 達成率**
   ```
   ┌─────────────────────────────────────┐
   │ 2026-01 SLA 達成率：96.2%            │
   ├─────────────────────────────────────┤
   │ P0：100%（8/8）   - 目標 >= 95%    │
   │ P1：95.2%（59/62）- 目標 >= 90%    │
   │ P2：96.2%（75/78）- 目標 >= 85%    │
   │ P3：100%（8/8）   - 目標 >= 80%    │
   └─────────────────────────────────────┘

   未達標工單分析：
   - P1 工單 MT20260115003：維修人員車輛故障
   - P1 工單 MT20260118007：零件缺貨需調貨
   - P1 工單 MT20260122005：租戶臨時外出改約
   ```

### 報表使用場景

1. **每日晨會**
   ```
   查看昨日工單統計：
   - 新增工單數
   - 已完成工單數
   - 待處理工單數
   - 逾期工單（需立即處理）
   ```

2. **每週檢討**
   ```
   查看本週問題類型分析：
   - 哪類問題最多？
   - 是否有共同原因？
   - 是否需要預防性維護？
   ```

3. **每月績效**
   ```
   查看維修人員績效報表：
   - 發放績效獎金
   - 表揚優秀維修人員
   - 輔導表現不佳的維修人員
   ```

4. **季度規劃**
   ```
   查看趨勢分析：
   - 預測下季度維修需求
   - 調整維修人員配置
   - 安排預防性維護計畫
   ```

---

## ❓ 常見問題解答（FAQ）

### Q1：租戶填表單到一半可以中斷嗎？

**A**：可以。系統會保留表單進度 24 小時。

**範例**：
```
👤 租戶: 冷氣不冷
🤖 系統: 【排查步驟】...
👤 租戶: 試過了
🤖 系統: 好的。請說明問題位置？
👤 租戶: 等等，我想先問房租什麼時候繳？  ← 離題
🤖 系統: 租金每月 5 日前繳納...            ← 回答問題
🤖 系統: 我們繼續填寫維修表單。請說明問題位置？ ← 恢復表單
👤 租戶: 主臥室
```

**業務人員須知**：
- 如果租戶長時間未回覆（超過 1 小時），可以主動聯絡
- 24 小時後表單會自動過期，需重新填寫

---

### Q2：租戶填錯了可以修改嗎？

**A**：提交前可以修改，提交後需要聯絡客服。

**提交前修改**：
```
👤 租戶: 我剛才填錯了，是次臥不是主臥

🤖 系統: 好的，我幫您修改。請重新說明問題位置？

👤 租戶: 次臥
```

**提交後修改**：
```
👤 租戶: 我剛才填的時間填錯了

🤖 系統: 工單已提交，如需修改請聯絡客服：0800-123-456
```

**客服處理**：
- 在後台手動修改工單資訊
- 如果已派工，需通知維修人員

---

### Q3：為什麼有些問題不需要填表單就自動創建工單？

**A**：緊急危險情況（P0）會自動創建工單，無需填表單。

**自動創建工單的情況**：
- 天花板漏水
- 水管破裂
- 瓦斯外洩
- 停電（整棟）
- 電梯困人

**原因**：
- 這些情況非常緊急，每一秒都很重要
- 等租戶填完表單可能已造成更大損失
- 系統會自動填入基本資訊（租戶、房號、電話）
- 維修人員會致電租戶確認詳細情況

---

### Q4：租戶可以查詢工單進度嗎？

**A**：可以。租戶只需提供工單編號即可查詢。

**範例**：
```
👤 租戶: 我想查詢工單進度

🤖 系統: 請提供您的工單編號（例如：MT20260122001）

👤 租戶: MT20260122001

🤖 系統: 📋 工單 MT20260122001

        問題類型：冷氣無法啟動
        當前狀態：處理中
        維修人員：張師傅（0922-111-222）

        ⏰ 時間記錄
        提交時間：2026-01-22 14:30
        派工時間：2026-01-22 14:35
        到達時間：2026-01-22 16:00
        預計完成：2026-01-22 17:00

        備註：正在更換冷氣主機板，預計 1 小時內完成。
```

---

### Q5：租戶說問題解決了，工單可以取消嗎？

**A**：可以。但建議確認原因並記錄。

**處理流程**：
```
1. 租戶說問題解決了
   👤 租戶: 冷氣現在可以用了，不用維修了

2. 系統詢問原因
   🤖 系統: 好的，請問是自行解決的嗎？還是問題自動好轉？

   可能的原因：
   - 按照排查步驟解決了（例如：換燈泡、重啟路由器）
   - 問題自動好轉（例如：電壓穩定後冷氣恢復）
   - 其他人已經幫忙處理了

3. 記錄原因並取消工單
   系統會將工單狀態更新為「已取消（租戶自行解決）」

4. 客服複查（可選）
   對於重要問題（P0/P1），客服可致電確認：
   「王先生您好，我看到您取消了冷氣維修工單，請問問題真的解決了嗎？」
```

**業務價值**：
- 記錄自行解決的案例，優化 SOP 排查步驟
- 如果同一問題重複出現，可能需要根本性維修

---

### Q6：如何處理惡意報修或濫用系統？

**A**：系統有多重防護機制。

**防護機制**：
```
1. 頻率限制
   同一租戶 24 小時內最多提交 5 個工單
   如果超過，系統會提示：「您今天已提交 5 個工單，如有緊急情況請致電客服」

2. 重複檢測
   如果租戶在短時間內重複提交相同問題，系統會提示：
   「您在 14:30 已提交過相同問題的工單（MT20260122001），是否要查詢進度？」

3. 異常行為檢測
   系統會檢測以下異常行為：
   - 填寫無意義內容（例如：「asdfasdf」）
   - 連續取消工單（3 次以上）
   - 頻繁中斷表單填寫

4. 客服介入
   如果檢測到異常，系統會通知客服：
   ⚠️ 警告：租戶王小明（3F-A）可能存在異常行為，建議人工審核
```

**客服處理**：
```
1. 查看歷史記錄
   - 過去 30 天的工單數量
   - 是否有重複問題
   - 是否有投訴記錄

2. 聯絡租戶確認
   「王先生您好，我們發現您今天提交了多個維修請求，是否遇到什麼問題需要協助？」

3. 根據情況處理
   情況 A：租戶確實有多個問題
   → 正常處理，無需限制

   情況 B：租戶不了解系統使用方式
   → 教育租戶正確使用方式

   情況 C：租戶惡意濫用
   → 記錄並警告，嚴重者可暫停使用權限
```

---

### Q7：租戶可以指定維修人員嗎？

**A**：系統會自動匹配最合適的維修人員，但租戶可以提出偏好。

**自動匹配邏輯**：
```
系統會根據以下因素自動匹配：
1. 專長匹配（冷氣問題派冷氣專家）
2. 地理位置（派最近的維修人員）
3. 工作量（避免單個維修人員過載）
4. 歷史評價（優先派評價高的維修人員）
```

**租戶指定偏好**：
```
如果租戶在「其他說明」欄位提到：
「希望張師傅來維修」或「上次的李師傅很好，希望還是他」

客服會看到這個需求，並盡量安排指定的維修人員（如果該維修人員有空）
```

---

### Q8：維修費用由誰負擔？

**A**：根據租約條款和損壞原因判定。

**費用負擔原則**：
```
1. 自然損耗（房東負擔）
   - 設備老化故障（例如：冷氣用 8 年壞了）
   - 建築結構問題（例如：牆壁滲水）
   - 公共設施維修（例如：電梯、停車場）

2. 人為損壞（租戶負擔）
   - 不當使用導致損壞（例如：冷氣濾網從未清洗導致故障）
   - 租戶造成的損壞（例如：門鎖被暴力破壞）
   - 租戶物品導致的問題（例如：租戶的家具堵住排水孔）

3. 預防性維護（房東負擔）
   - 定期保養（例如：冷氣年度保養）
   - 預防性更換（例如：更換老舊線路）
```

**系統處理**：
```
工單完成後，系統會要求維修人員填寫：
- 損壞原因
- 費用明細
- 建議費用負擔方（房東/租戶）

管理員會根據維修報告和租約條款，決定費用負擔：
- 房東負擔：直接核銷
- 租戶負擔：從押金扣除或另行收費
- 雙方分擔：協商比例
```

---

### Q9：系統支援多語言嗎？

**A**：目前支援繁體中文，未來會擴展多語言。

**當前支援**：
```
- 繁體中文（主要）
- 簡體中文（部分支援）
```

**外籍租戶處理**：
```
如果租戶使用英文或其他語言：

1. 系統會嘗試翻譯並理解意圖
   "Air conditioner not working" → 識別為「冷氣維修」

2. 如果無法理解，會提示轉人工：
   🤖 系統: Sorry, I cannot understand your question. Please contact customer service:
          0800-123-456

3. 客服人員會使用翻譯工具協助處理
```

**未來規劃**：
```
- 2026 Q2：新增英文完整支援
- 2026 Q3：新增越南語、印尼語、泰語（常見外籍租戶語言）
```

---

### Q10：系統會發送通知給租戶嗎？

**A**：會。系統會在關鍵節點自動發送通知。

**通知時機**：
```
1. 工單創建成功
   📱 簡訊：「您的維修工單 MT20260122001 已成功建立，我們會盡快安排維修人員。」

2. 維修人員已派工
   📱 簡訊：「您的工單已派給張師傅（0922-111-222），他會在 30 分鐘內聯絡您。」

3. 維修人員即將到達
   📱 簡訊：「張師傅預計 10 分鐘後到達，請準備開門。」

4. 維修已完成
   📱 簡訊：「您的冷氣維修已完成，請確認是否正常。如有問題請聯絡客服。」
   📧 Email：包含詳細的維修報告（維修內容、使用材料、費用、照片）

5. 滿意度調查
   📱 簡訊：「您對本次維修服務滿意嗎？請點擊連結評分：https://...」
```

**通知渠道**：
```
- 簡訊（SMS）：即時通知（P0/P1 工單）
- Email：詳細報告
- App 推送：如果租戶安裝了 App
- 系統訊息：租戶登入後台可查看
```

**租戶可以設定通知偏好**：
```
租戶可以在後台設定：
□ 簡訊通知（緊急通知一定會發送）
□ Email 通知
□ App 推送
□ 電話通知（僅緊急情況）
```

---

## 📋 業務流程檢查清單

### 系統上線前檢查

- [ ] 所有 SOP 內容已審核並錄入系統
- [ ] 所有表單欄位已設定並測試
- [ ] 維修人員名單已建立（姓名、電話、專長、位置）
- [ ] 優先級規則已設定（P0/P1/P2/P3）
- [ ] SLA 時間已設定（P0: 1h, P1: 4h, P2: 24h, P3: 72h）
- [ ] 客服人員已完成系統培訓
- [ ] 維修人員已下載 App 並完成註冊
- [ ] 告警機制已設定（Email、SMS、App 推送）
- [ ] 報表已設定（工單統計、問題分析、績效報表）
- [ ] 測試帳號已建立並完成端到端測試

### 日常維運檢查

**每日早上 9:00**：
- [ ] 查看昨日新增工單數
- [ ] 查看待處理工單列表
- [ ] 查看逾期工單（需立即處理）
- [ ] 查看維修人員今日排程

**每日下午 17:00**：
- [ ] 查看今日工單完成率
- [ ] 查看接近 SLA 的工單（提醒維修人員加速）
- [ ] 查看租戶滿意度（處理不滿意的案例）

**每週一早上**：
- [ ] 查看上週工單統計報表
- [ ] 查看問題類型分析（是否有共同原因）
- [ ] 查看維修人員績效排名

**每月 1 號**：
- [ ] 生成上月完整報表
- [ ] 計算維修人員績效獎金
- [ ] 分析 SLA 達成率（未達標原因分析）
- [ ] 審核系統使用情況（是否需要優化）

---

## 📞 緊急聯絡資訊

```
系統技術支援：0800-888-999（24小時）
客服主管：0922-123-456（週一至週五 9:00-18:00）
值班電話：0912-345-678（緊急情況，24小時）

系統後台網址：https://admin.aichatbot.com
客服工作台網址：https://cs.aichatbot.com
維修人員 App：在 App Store 搜尋「維修派工」
```

---

**文檔版本**: 2.0
**最後更新**: 2026-01-23
**適用系統**: AIChatbot 維護請求模組
**文檔維護**: 請定期更新此文檔，確保與系統功能同步
