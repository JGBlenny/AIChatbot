# ðŸ§ª æ¸¬è©¦ SOP é©—è­‰å ±å‘Š

**å»ºç«‹æ™‚é–“**: 2026-01-26
**ç‹€æ…‹**: âœ… å·²å»ºç«‹ä¸¦é©—è­‰
**Vendor ID**: 2

---

## ðŸ“Š æ¸¬è©¦æ•¸æ“šæ¦‚è¦½

æˆåŠŸå»ºç«‹ **6 å€‹æ¸¬è©¦ SOP**ï¼Œæ¶µè“‹ 3 ç¨®è§¸ç™¼æ¨¡å¼çš„ä¸åŒçµ„åˆï¼š

| ID | SOP åç¨± | è§¸ç™¼æ¨¡å¼ | å¾ŒçºŒå‹•ä½œ | è¡¨å–® ID | æç¤ºè©ž | Embedding |
|----|----------|----------|----------|---------|--------|-----------|
| **1672** | ã€æ¸¬è©¦ã€‘ç§Ÿé‡‘ç¹³ç´èªªæ˜Ž | none | none | - | - | âœ… |
| **1673** | ã€æ¸¬è©¦ã€‘ç¶²è·¯ä¸é€šæŽ’æŸ¥ | manual | form_fill | maintenance_request | - | âœ… |
| **1674** | ã€æ¸¬è©¦ã€‘é–€éŽ–æ•…éšœç·Šæ€¥ | immediate | form_fill | repair_request | ã€Œéœ€è¦å—Žï¼Ÿã€ | âœ… |
| **1675** | ã€æ¸¬è©¦ã€‘ç†±æ°´å™¨æ²’ç†±æ°´ | manual | none | - | - | âœ… |
| **1676** | ã€æ¸¬è©¦ã€‘æŸ¥è©¢ç¹³è²»è¨˜éŒ„ | immediate | none | - | ã€Œéœ€è¦æŸ¥è©¢å—Žï¼Ÿã€ | âœ… |
| **1677** | ã€æ¸¬è©¦ã€‘å…¬è¨­ä½¿ç”¨è¦å®š | none | none | - | - | âœ… |

---

## âœ… è³‡æ–™å®Œæ•´æ€§é©—è­‰

### 1. æµç¨‹é…ç½®æ¬„ä½ âœ…

æ‰€æœ‰ SOP çš„æµç¨‹é…ç½®æ¬„ä½éƒ½å·²æ­£ç¢ºä¿å­˜ï¼š

```sql
-- é©—è­‰æŸ¥è©¢
SELECT
    id,
    item_name,
    trigger_mode,
    next_action,
    next_form_id,
    immediate_prompt
FROM vendor_sop_items
WHERE id >= 1672 AND id <= 1677;
```

**çµæžœ**: 6/6 é€šéŽ âœ…

### 2. è§¸ç™¼é—œéµè©ž âœ…

manual æ¨¡å¼çš„ SOP åŒ…å«æ­£ç¢ºçš„è§¸ç™¼é—œéµè©žé™£åˆ—ï¼š

- **SOP 1673** (ç¶²è·¯æŽ’æŸ¥): 6 å€‹é—œéµè©ž
  - ã€Œé‚„æ˜¯ä¸è¡Œã€ã€Œè©¦éŽäº†ã€ã€Œæ²’ç”¨ã€ã€Œä¸èƒ½ç”¨ã€ã€Œé‚„æ˜¯é€£ä¸ä¸Šã€ã€Œéƒ½è©¦éŽäº†ã€

- **SOP 1675** (ç†±æ°´å™¨): 5 å€‹é—œéµè©ž
  - ã€Œé‚„æ˜¯æ²’ç†±æ°´ã€ã€Œé‚„æ˜¯ä¸ç†±ã€ã€Œè©¦éŽäº†ã€ã€Œæ²’ç”¨ã€ã€Œéƒ½æª¢æŸ¥éŽäº†ã€

```sql
-- é©—è­‰æŸ¥è©¢
SELECT id, item_name, trigger_keywords
FROM vendor_sop_items
WHERE trigger_mode = 'manual'
  AND id >= 1672 AND id <= 1677;
```

**çµæžœ**: 2/2 é€šéŽ âœ…

### 3. Embeddings ç”Ÿæˆ âœ…

æ‰€æœ‰ SOP çš„ Primary å’Œ Fallback Embeddings éƒ½å·²ç”Ÿæˆï¼š

```sql
-- é©—è­‰æŸ¥è©¢
SELECT
    id,
    item_name,
    primary_embedding IS NOT NULL as has_primary,
    fallback_embedding IS NOT NULL as has_fallback
FROM vendor_sop_items
WHERE id >= 1672 AND id <= 1677;
```

**çµæžœ**: 6/6 Primary âœ…, 6/6 Fallback âœ…

---

## ðŸ”„ æ¨¡å¼åˆ†ä½ˆ

| æ¨¡å¼çµ„åˆ | æ•¸é‡ | SOP ID |
|---------|------|--------|
| none + none | 2 | 1672, 1677 |
| manual + form_fill | 1 | 1673 |
| manual + none | 1 | 1675 |
| immediate + form_fill | 1 | 1674 |
| immediate + none | 1 | 1676 |

**è¦†è“‹çŽ‡**: 5/6 ç¨®å¸¸ç”¨çµ„åˆ âœ…

---

## ðŸ§ª æ‰‹å‹•æ¸¬è©¦æŒ‡å¼•

### æ–¹å¼ 1: ä½¿ç”¨ curl æ¸¬è©¦ï¼ˆæŽ¨è–¦ï¼‰

```bash
# æ¸¬è©¦ 1: è³‡è¨Šåž‹ - ç§Ÿé‡‘ç¹³ç´
curl -X POST http://localhost:8100/api/v1/chat/stream \
  -H "Content-Type: application/json" \
  -d '{
    "question": "ç§Ÿé‡‘æ€Žéº¼ç¹³ï¼Ÿ",
    "vendor_id": 2,
    "user_role": "customer",
    "user_id": "test_user_1"
  }'

# é æœŸ: è¿”å›žç§Ÿé‡‘ç¹³ç´èªªæ˜Žçš„ SOP å…§å®¹ï¼Œç„¡å¾ŒçºŒè§¸ç™¼

# æ¸¬è©¦ 2: æŽ’æŸ¥åž‹ - ç¶²è·¯ä¸é€š
curl -X POST http://localhost:8100/api/v1/chat/stream \
  -H "Content-Type: application/json" \
  -d '{
    "question": "ç¶²è·¯é€£ä¸ä¸Š",
    "vendor_id": 2,
    "user_role": "customer",
    "user_id": "test_user_2"
  }'

# é æœŸ: è¿”å›žç¶²è·¯æŽ’æŸ¥æ­¥é©Ÿï¼Œç³»çµ±ä¸æœƒä¸»å‹•å•ã€Œè¦å¡«è¡¨å–®å—Žï¼Ÿã€
# éœ€è¦ç”¨æˆ¶èªªã€Œé‚„æ˜¯ä¸è¡Œã€æ‰æœƒè§¸ç™¼è¡¨å–®

# æ¸¬è©¦ 3: è¡Œå‹•åž‹ - é–€éŽ–æ•…éšœ
curl -X POST http://localhost:8100/api/v1/chat/stream \
  -H "Content-Type: application/json" \
  -d '{
    "question": "é–€éŽ–å£žäº†",
    "vendor_id": 2,
    "user_role": "customer",
    "user_id": "test_user_3"
  }'

# é æœŸ: è¿”å›žé–€éŽ–è™•ç†æ–¹å¼ + ç«‹å³è©¢å•ã€Œéœ€è¦å—Žï¼Ÿã€
```

### æ–¹å¼ 2: ä½¿ç”¨å‰ç«¯ä»‹é¢æ¸¬è©¦

1. è¨ªå• http://localhost:8087/vendor-sop
2. åˆ‡æ›åˆ° Vendor ID 2
3. æŸ¥çœ‹ã€Œæˆ‘çš„ SOPã€åˆ—è¡¨ï¼Œæ‡‰è©²çœ‹åˆ° 6 å€‹ã€æ¸¬è©¦ã€‘SOP
4. æª¢æŸ¥æ¯å€‹ SOP çš„æµç¨‹é…ç½®æ˜¯å¦æ­£ç¢ºé¡¯ç¤º

### æ–¹å¼ 3: ç›´æŽ¥å°è©±æ¸¬è©¦

ä½¿ç”¨ WebSocket æˆ– HTTP å®¢æˆ¶ç«¯ï¼Œæ¨¡æ“¬ç”¨æˆ¶å°è©±ï¼š

**æ¸¬è©¦æƒ…å¢ƒ 1: è³‡è¨Šåž‹ï¼ˆç„¡è§¸ç™¼ï¼‰**
```
ðŸ‘¤: ç§Ÿé‡‘æ€Žéº¼ç¹³ï¼Ÿ
ðŸ¤–: [é¡¯ç¤ºç§Ÿé‡‘ç¹³ç´èªªæ˜Ž]
   âœ… ä¸æœƒå•ã€Œéœ€è¦å—Žï¼Ÿã€
   âœ… å°è©±è‡ªç„¶çµæŸ
```

**æ¸¬è©¦æƒ…å¢ƒ 2: æŽ’æŸ¥åž‹ï¼ˆè¢«å‹•è§¸ç™¼ï¼‰**
```
ðŸ‘¤: ç¶²è·¯é€£ä¸ä¸Š
ðŸ¤–: [é¡¯ç¤ºç¶²è·¯æŽ’æŸ¥æ­¥é©Ÿ]
   âœ… ä¸æœƒç«‹å³å•ã€Œè¦å¡«è¡¨å–®å—Žï¼Ÿã€

ðŸ‘¤: éƒ½è©¦éŽäº†é‚„æ˜¯ä¸è¡Œ
ðŸ¤–: å¥½çš„ï¼Œæˆ‘ä¾†å”åŠ©æ‚¨å¡«å¯«ç¶²è·¯ç¶­ä¿®è¡¨å–®ã€‚
   âœ… è§¸ç™¼è¡¨å–®å¡«å¯«æµç¨‹
```

**æ¸¬è©¦æƒ…å¢ƒ 3: è¡Œå‹•åž‹ï¼ˆä¸»å‹•è§¸ç™¼ï¼‰**
```
ðŸ‘¤: é–€éŽ–å£žäº†
ðŸ¤–: [é¡¯ç¤ºé–€éŽ–è™•ç†æ–¹å¼]
    é€™æ˜¯ç·Šæ€¥ç¶­ä¿®ç‹€æ³ï¼Œæˆ‘å¯ä»¥ç«‹å³ç‚ºæ‚¨å®‰æŽ’ç¶­ä¿®äººå“¡ã€‚éœ€è¦å—Žï¼Ÿ
   âœ… ç«‹å³ä¸»å‹•è©¢å•

ðŸ‘¤: è¦
ðŸ¤–: å¥½çš„ï¼Œè«‹æä¾›ä»¥ä¸‹è³‡è¨Š...
   âœ… è§¸ç™¼è¡¨å–®å¡«å¯«æµç¨‹
```

---

## ðŸ“– è©³ç´°æ¸¬è©¦å°è©±è…³æœ¬

å®Œæ•´çš„æ¸¬è©¦å°è©±ç¯„ä¾‹è«‹åƒè€ƒï¼š**`test_sop_scenarios_dialogue.md`**

è©²æ–‡æª”åŒ…å«ï¼š
- 6 å€‹å®Œæ•´æƒ…å¢ƒçš„å°è©±ç¯„ä¾‹
- æ­£å‘æµç¨‹ï¼ˆè§¸ç™¼ï¼‰å’Œè² å‘æµç¨‹ï¼ˆä¸è§¸ç™¼ï¼‰
- æ¯å€‹æ¨¡å¼çš„é©—è­‰é‡é»ž
- æ¸¬è©¦æª¢æŸ¥æ¸…å–®

---

## ðŸ—‘ï¸ æ¸…ç†æ¸¬è©¦æ•¸æ“š

æ¸¬è©¦å®Œæˆå¾Œï¼ŒåŸ·è¡Œä»¥ä¸‹å‘½ä»¤æ¸…ç†ï¼š

```bash
python3 cleanup_test_sop.py
```

é€™æœƒåˆªé™¤æ‰€æœ‰æ¸¬è©¦ SOPï¼ˆID 1672-1677ï¼‰ã€‚

---

## ðŸ“‹ é©—è­‰æª¢æŸ¥æ¸…å–®

æ¸¬è©¦æ™‚è«‹ç¢ºèªï¼š

### è³‡è¨Šåž‹ï¼ˆSOP 1672, 1677ï¼‰
- [ ] è¿”å›žå®Œæ•´ SOP å…§å®¹
- [ ] ä¸æœƒä¸»å‹•è©¢å•ä»»ä½•å•é¡Œ
- [ ] å°è©±å¯è‡ªç„¶çµæŸ

### æŽ’æŸ¥åž‹ï¼ˆSOP 1673, 1675ï¼‰
- [ ] è¿”å›žæŽ’æŸ¥æ­¥é©Ÿ
- [ ] **ä¸æœƒ**ç«‹å³è©¢å•ã€Œè¦ä¸è¦ï¼Ÿã€
- [ ] åªæœ‰èªªå‡ºé—œéµè©žæ™‚æ‰è§¸ç™¼
- [ ] æ¸¬è©¦è‡³å°‘ 3 å€‹ä¸åŒé—œéµè©ž
- [ ] form_fill é¡žåž‹æœƒå¼•å°Žå¡«è¡¨å–®
- [ ] none é¡žåž‹åªé¡¯ç¤ºå®¢æœè³‡è¨Š

### è¡Œå‹•åž‹ï¼ˆSOP 1674, 1676ï¼‰
- [ ] è¿”å›ž SOP å…§å®¹
- [ ] **ç«‹å³ä¸»å‹•è©¢å•**ï¼ˆä½¿ç”¨ immediate_promptï¼‰
- [ ] ç”¨æˆ¶èªªã€Œè¦ã€â†’ è§¸ç™¼å¾ŒçºŒå‹•ä½œ
- [ ] ç”¨æˆ¶èªªã€Œä¸è¦ã€â†’ ä¸è§¸ç™¼
- [ ] form_fill é¡žåž‹æœƒå¼•å°Žå¡«è¡¨å–®
- [ ] none é¡žåž‹åªé¡¯ç¤ºå¾ŒçºŒæç¤º

---

## ðŸŽ¯ é—œéµå·®ç•°é©—è­‰

**æœ€é‡è¦çš„é©—è­‰é»ž**ï¼š

1. **æŽ’æŸ¥åž‹ vs è¡Œå‹•åž‹**
   - æŽ’æŸ¥åž‹ï¼šç³»çµ±**ä¸ä¸»å‹•å•**ï¼Œç­‰é—œéµè©ž
   - è¡Œå‹•åž‹ï¼šç³»çµ±**ä¸»å‹•å•**ã€Œè¦ä¸è¦ï¼Ÿã€

2. **form_fill vs none**
   - form_fillï¼šè§¸ç™¼å¾Œå¼•å°Žå¡«å¯«è¡¨å–®
   - noneï¼šè§¸ç™¼å¾Œåªé¡¯ç¤ºæ–‡å­—æç¤º

3. **è§¸ç™¼é—œéµè©žæ¸¬è©¦**
   - æŽ’æŸ¥åž‹ SOP å¿…é ˆæ¸¬è©¦å¤šå€‹é—œéµè©ž
   - ç¢ºèªæ¯å€‹é—œéµè©žéƒ½èƒ½æ­£ç¢ºè§¸ç™¼

---

## âœ… é©—è­‰ç‹€æ…‹

**è³‡æ–™åº«å±¤ç´š**: âœ… 100% é€šéŽ
- æµç¨‹é…ç½®æ¬„ä½å®Œæ•´
- è§¸ç™¼é—œéµè©žæ­£ç¢º
- Embeddings å·²ç”Ÿæˆ

**æ‡‰ç”¨å±¤ç´š**: â¸ï¸ å¾…æ‰‹å‹•æ¸¬è©¦
- éœ€è¦å¯¦éš›å°è©±æ¸¬è©¦ç¢ºèªæµç¨‹é‚è¼¯
- å»ºè­°ä½¿ç”¨ä¸Šè¿° curl å‘½ä»¤æˆ–å‰ç«¯ä»‹é¢æ¸¬è©¦

---

**å»ºç«‹è…³æœ¬**: `create_test_sop_scenarios.py`
**æ¸¬è©¦å°è©±**: `test_sop_scenarios_dialogue.md`
**æ¸…ç†è…³æœ¬**: `cleanup_test_sop.py`
