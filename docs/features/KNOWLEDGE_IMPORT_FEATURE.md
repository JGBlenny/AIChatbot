# ğŸ“¥ çŸ¥è­˜åŒ¯å…¥åŠŸèƒ½æ–‡æª”

## æ¦‚è¿°

çŸ¥è­˜åŒ¯å…¥åŠŸèƒ½æä¾›äº†ä¸€å€‹å®Œæ•´çš„æµç¨‹ï¼Œè®“ä½¿ç”¨è€…å¯ä»¥æ‰¹é‡åŒ¯å…¥çŸ¥è­˜åˆ°ç³»çµ±ä¸­ã€‚æ‰€æœ‰åŒ¯å…¥çš„çŸ¥è­˜éƒ½æœƒå…ˆé€²å…¥å¯©æ ¸ä½‡åˆ—ï¼Œç¶“éäººå·¥å¯©æ ¸å¾Œæ‰æœƒåŠ å…¥æ­£å¼çŸ¥è­˜åº«ã€‚

### æ ¸å¿ƒç‰¹è‰²

- âœ… **å¤šæ ¼å¼æ”¯æ´**ï¼šExcel (.xlsx), CSV (.csv), JSON, TXT
- ğŸ” **é›™å±¤å»é‡æ©Ÿåˆ¶**ï¼šæ–‡å­—å»é‡ + èªæ„å»é‡
- ğŸ¤– **AI è‡ªå‹•è™•ç†**ï¼šå•é¡Œç”Ÿæˆã€å‘é‡åµŒå…¥ã€æ„åœ–æ¨è–¦
- ğŸ§ª **è‡ªå‹•æ¸¬è©¦æƒ…å¢ƒ**ï¼šB2C çŸ¥è­˜è‡ªå‹•å‰µå»ºæ¸¬è©¦æƒ…å¢ƒ
- ğŸ“‹ **å¯©æ ¸ä½‡åˆ—**ï¼šæ‰€æœ‰çŸ¥è­˜éœ€ç¶“äººå·¥å¯©æ ¸
- ğŸ’° **æˆæœ¬å„ªåŒ–**ï¼šæ–‡å­—å»é‡åœ¨ LLM å‰åŸ·è¡Œï¼Œç¯€çœ API æˆæœ¬
- ğŸŒ **å¤šèªè¨€æ”¯æ´**ï¼šCSV æ ¼å¼æ”¯æ´ JSON æ¬„ä½ï¼Œè‡ªå‹•æå–ç¹é«”ä¸­æ–‡

---

## ğŸ“Š åŒ¯å…¥æµç¨‹

```mermaid
graph TD
    A[ä¸Šå‚³æª”æ¡ˆ] --> B[è§£ææª”æ¡ˆ]
    B --> C[æ–‡å­—å»é‡<br/>ç²¾ç¢ºåŒ¹é…]
    C --> D{æœ‰é‡è¤‡?}
    D -->|æ˜¯| E[è·³é]
    D -->|å¦| F[ç”Ÿæˆå•é¡Œæ‘˜è¦<br/>LLM]
    F --> G[ç”Ÿæˆå‘é‡åµŒå…¥<br/>OpenAI]
    G --> H[èªæ„å»é‡<br/>å‘é‡ç›¸ä¼¼åº¦]
    H --> I{ç›¸ä¼¼åº¦ â‰¥ 0.85?}
    I -->|æ˜¯| J[è·³é]
    I -->|å¦| K[æ¨è–¦æ„åœ–<br/>LLM]
    K --> L[å»ºç«‹æ¸¬è©¦æƒ…å¢ƒ<br/>B2C only]
    L --> M[åŒ¯å…¥å¯©æ ¸ä½‡åˆ—]
    M --> N[äººå·¥å¯©æ ¸]
    N --> O{å¯©æ ¸çµæœ}
    O -->|é€šé| P[knowledge_base]
    O -->|æ‹’çµ•| Q[ä¸åŒ¯å…¥]
```

---

## ğŸ” å»é‡æ©Ÿåˆ¶

### éšæ®µ 1ï¼šæ–‡å­—å»é‡ï¼ˆç²¾ç¢ºåŒ¹é…ï¼‰

**åŸ·è¡Œæ™‚æ©Ÿ**ï¼šåœ¨ LLM å‰åŸ·è¡Œï¼Œç¯€çœ OpenAI API æˆæœ¬

**æª¢æŸ¥ç¯„åœ**ï¼š3 å¼µè¡¨
1. `knowledge_base` - æ­£å¼çŸ¥è­˜åº«ï¼ˆå•é¡Œ + ç­”æ¡ˆï¼‰
2. `ai_generated_knowledge_candidates` - å¯©æ ¸ä½‡åˆ—ï¼ˆå•é¡Œ + ç­”æ¡ˆï¼‰
3. `test_scenarios` - æ¸¬è©¦æƒ…å¢ƒï¼ˆå•é¡Œï¼‰

**åˆ¤æ–·é‚è¼¯**ï¼š
```sql
SELECT COUNT(*) FROM (
    SELECT 1 FROM knowledge_base
    WHERE question_summary = ? AND answer = ?
    UNION ALL
    SELECT 1 FROM ai_generated_knowledge_candidates
    WHERE question = ? AND generated_answer = ?
    UNION ALL
    SELECT 1 FROM test_scenarios
    WHERE test_question = ?
) AS combined
```

**çµæœ**ï¼šå®Œå…¨ç›¸åŒ â†’ è·³é

### éšæ®µ 2ï¼šèªæ„å»é‡ï¼ˆå‘é‡ç›¸ä¼¼åº¦ï¼‰

**åŸ·è¡Œæ™‚æ©Ÿ**ï¼šç”Ÿæˆ embedding å¾Œ

**æª¢æŸ¥ç¯„åœ**ï¼š3 å¼µè¡¨
1. `knowledge_base` (embedding ç›¸ä¼¼åº¦)
2. `ai_generated_knowledge_candidates` (embedding ç›¸ä¼¼åº¦)
3. `test_scenarios` (embedding ç›¸ä¼¼åº¦)

**åˆ¤æ–·é‚è¼¯**ï¼š
- ç›¸ä¼¼åº¦é–¾å€¼ï¼š**0.85**
- ä½¿ç”¨ pgvector çš„ cosine distance (`<=>` operator)
- å‡½æ•¸ï¼š`check_knowledge_exists_by_similarity(embedding, threshold)`

**çµæœ**ï¼šç›¸ä¼¼åº¦ â‰¥ 0.85 â†’ è·³é

---

## ğŸ“‚ æ”¯æ´çš„æª”æ¡ˆæ ¼å¼

### 1. CSV (.csv)

**ç‰¹è‰²**ï¼š
- âœ… æ”¯æ´æ¨™æº– CSV æ ¼å¼
- âœ… æ”¯æ´ JSON æ¬„ä½æ ¼å¼ï¼ˆè‡ªå‹•è§£æï¼‰
- âœ… æ”¯æ´å¤šèªè¨€ï¼ˆè‡ªå‹•æå– zh-TWï¼‰
- âœ… è‡ªå‹•æ¸…ç† HTML æ¨™ç±¤

**æ”¯æ´çš„æ¬„ä½åç¨±**ï¼ˆä¸å€åˆ†å¤§å°å¯«ï¼‰ï¼š

| æ¬„ä½ | åˆ¥å | å¿…å¡« | èªªæ˜ |
|------|------|------|------|
| å•é¡Œ | question, å•é¡Œæ‘˜è¦, question_summary, title, æ¨™é¡Œ | å¦* | è‹¥ç„¡æä¾›ï¼ŒLLM è‡ªå‹•ç”Ÿæˆ |
| ç­”æ¡ˆ | answer, å›è¦†, response, content, å…§å®¹ | âœ… æ˜¯ | è‡³å°‘ 10 å­— |
| åˆ†é¡ | category, é¡åˆ¥, type | å¦ | é è¨­ã€Œä¸€èˆ¬å•é¡Œã€ |
| å°è±¡ | audience, å—çœ¾, target_user | å¦ | é è¨­ã€Œç§Ÿå®¢ã€ |
| é—œéµå­— | keywords, æ¨™ç±¤, tags | å¦ | é€—è™Ÿåˆ†éš” |

#### æ ¼å¼ 1ï¼šæ¨™æº– CSV

**ç¯„ä¾‹æª”æ¡ˆ**ï¼š

```csv
åˆ†é¡,å•é¡Œ,ç­”æ¡ˆ,å°è±¡,é—œéµå­—
å¸³å‹™æŸ¥è©¢,å¦‚ä½•ç¹³ç´ç§Ÿé‡‘ï¼Ÿ,è«‹æ–¼æ¯æœˆ 1 è™Ÿå‰é€é ATM è½‰å¸³...,ç§Ÿå®¢,"ç¹³è²»,ç§Ÿé‡‘,ATM"
å¯µç‰©è¦å®š,å¯ä»¥é¤Šå¯µç‰©å—ï¼Ÿ,éƒ¨åˆ†ç‰©ä»¶å…è¨±é£¼é¤Šå°å‹å¯µç‰©...,ç§Ÿå®¢,"å¯µç‰©,é£¼é¤Š"
```

#### æ ¼å¼ 2ï¼šJSON æ¬„ä½æ ¼å¼ï¼ˆhelp_datas.csvï¼‰

**èªªæ˜**ï¼šæ¬„ä½å€¼ç‚º JSON å­—ä¸²ï¼Œè‡ªå‹•æå–ç¹é«”ä¸­æ–‡ï¼ˆzh-TWï¼‰

**ç¯„ä¾‹æª”æ¡ˆ**ï¼š

```csv
title,title.1,content
"{""zh-TW"":""ç‰©ä»¶"",""en-US"":""Property""}","{""zh-TW"":""å¦‚ä½•æ–°å¢ç‰©ä»¶ï¼Ÿ"",""en-US"":""How to add property?""}","{""zh-TW"":""<p>æˆ¿æ±å¯åˆ°ã€Œç‰©ä»¶ç®¡ç†ã€...</p>""}"
```

**è™•ç†é‚è¼¯**ï¼š
1. è‡ªå‹•åµæ¸¬ JSON æ ¼å¼ï¼ˆ`{` é–‹é ­ `}` çµå°¾ï¼‰
2. è§£æ JSON ä¸¦æå– `zh-TW` æ¬„ä½
3. è‡ªå‹•æ¸…ç† HTML æ¨™ç±¤ï¼š
   - ç§»é™¤ `style` å±¬æ€§
   - ç§»é™¤ `<span>` æ¨™ç±¤
   - å°‡ `<p>` è½‰æ›ç‚ºæ›è¡Œ
4. ç”Ÿæˆå‘é‡åµŒå…¥

**è™•ç†å‰**ï¼š
```json
{
  "zh-TW": "<p><span style=\"font-size:18px\">æˆ¿æ±å¯åˆ°ã€Œç‰©ä»¶ç®¡ç†ã€ä¸­çš„ã€Œç‰©ä»¶ç¸½è¡¨ã€...</span></p>",
  "en-US": "<p>The lessor can go to...</p>"
}
```

**è™•ç†å¾Œ**ï¼š
```
æˆ¿æ±å¯åˆ°ã€Œç‰©ä»¶ç®¡ç†ã€ä¸­çš„ã€Œç‰©ä»¶ç¸½è¡¨ã€...
```

#### æ¬„ä½æ˜ å°„é‚è¼¯

**æ™ºèƒ½åµæ¸¬**ï¼š
- å¦‚æœæ‰¾ä¸åˆ°æ¨™æº–æ¬„ä½åç¨±ï¼Œè‡ªå‹•åµæ¸¬ `help_datas.csv` æ ¼å¼
- ç¬¬ä¸€æ¬„ â†’ åˆ†é¡ï¼ˆtitleï¼‰
- ç¬¬äºŒæ¬„ â†’ å•é¡Œï¼ˆtitle.1ï¼‰
- ç¬¬ä¸‰æ¬„ â†’ ç­”æ¡ˆï¼ˆcontentï¼‰

**æ—¥èªŒç¯„ä¾‹**ï¼š
```
ğŸ“– è§£æ CSV æª”æ¡ˆ: help_datas.csv
   è®€å– 72 è¡Œè³‡æ–™
   æ¬„ä½: ['title', 'title.1', 'content']
   åµæ¸¬åˆ°ç‰¹æ®Šæ ¼å¼ CSVï¼Œä½¿ç”¨æ¬„ä½: title, title.1, content
   âœ… è§£æå‡º 72 å€‹æœ‰æ•ˆçŸ¥è­˜é …ç›®
```

---

### 2. Excel (.xlsx, .xls)

**æ”¯æ´çš„æ¬„ä½åç¨±**ï¼ˆä¸å€åˆ†å¤§å°å¯«ï¼‰ï¼š

| æ¬„ä½ | åˆ¥å | å¿…å¡« | èªªæ˜ |
|------|------|------|------|
| å•é¡Œ | question, å•é¡Œæ‘˜è¦, question_summary, title, æ¨™é¡Œ | å¦* | è‹¥ç„¡æä¾›ï¼ŒLLM è‡ªå‹•ç”Ÿæˆ |
| ç­”æ¡ˆ | answer, å›è¦†, response, content, å…§å®¹ | âœ… æ˜¯ | è‡³å°‘ 10 å­— |
| åˆ†é¡ | category, é¡åˆ¥, type | å¦ | é è¨­ã€Œä¸€èˆ¬å•é¡Œã€ |
| å°è±¡ | audience, å—çœ¾ | å¦ | é è¨­ã€Œç§Ÿå®¢ã€ |
| é—œéµå­— | keywords, æ¨™ç±¤, tags | å¦ | é€—è™Ÿåˆ†éš” |

**ç¯„ä¾‹æª”æ¡ˆ**ï¼š

| å•é¡Œ | ç­”æ¡ˆ | åˆ†é¡ | å°è±¡ | é—œéµå­— |
|------|------|------|------|--------|
| å¦‚ä½•ç¹³ç´ç§Ÿé‡‘ï¼Ÿ | è«‹æ–¼æ¯æœˆ 1 è™Ÿå‰é€é ATM è½‰å¸³... | å¸³å‹™æŸ¥è©¢ | ç§Ÿå®¢ | ç¹³è²», ç§Ÿé‡‘, ATM |
| å¯ä»¥é¤Šå¯µç‰©å—ï¼Ÿ | éƒ¨åˆ†ç‰©ä»¶å…è¨±é£¼é¤Šå°å‹å¯µç‰©... | å¯µç‰©è¦å®š | ç§Ÿå®¢ | å¯µç‰©, é£¼é¤Š |

### 2. JSON

**æ ¼å¼ 1**ï¼š
```json
{
  "knowledge": [
    {
      "question": "å¦‚ä½•ç¹³ç´ç§Ÿé‡‘ï¼Ÿ",
      "answer": "è«‹æ–¼æ¯æœˆ 1 è™Ÿå‰é€é ATM è½‰å¸³...",
      "category": "å¸³å‹™æŸ¥è©¢",
      "audience": "ç§Ÿå®¢",
      "keywords": ["ç¹³è²»", "ç§Ÿé‡‘"]
    }
  ]
}
```

**æ ¼å¼ 2**ï¼š
```json
[
  {
    "question_summary": "å¦‚ä½•ç¹³ç´ç§Ÿé‡‘ï¼Ÿ",
    "answer": "è«‹æ–¼æ¯æœˆ 1 è™Ÿå‰é€é ATM è½‰å¸³...",
    "category": "å¸³å‹™æŸ¥è©¢"
  }
]
```

### 3. TXTï¼ˆç´”æ–‡å­—ï¼‰

**è™•ç†æ–¹å¼**ï¼šä½¿ç”¨ LLM è‡ªå‹•æå–çŸ¥è­˜

**ç¯„ä¾‹**ï¼š
```
ç§Ÿé‡‘ç¹³è²»èªªæ˜

ç§Ÿé‡‘æ‡‰æ–¼æ¯æœˆ 1 è™Ÿå‰ç¹³æ¸…ã€‚å¯é€éä»¥ä¸‹æ–¹å¼ç¹³è²»ï¼š
1. ATM è½‰å¸³
2. ç·šä¸Šåˆ·å¡
3. è¶…å•†ç¹³è²»

é€¾æœŸå°‡åŠ æ”¶æ‰‹çºŒè²»ã€‚
```

LLM æœƒè‡ªå‹•åˆ†æä¸¦æå–ï¼š
- å•é¡Œæ‘˜è¦ï¼šã€Œå¦‚ä½•ç¹³ç´ç§Ÿé‡‘ï¼Ÿã€
- ç­”æ¡ˆï¼šå®Œæ•´çš„ç¹³è²»èªªæ˜
- åˆ†é¡ï¼šã€Œå¸³å‹™æŸ¥è©¢ã€
- é—œéµå­—ï¼š["ç¹³è²»", "ç§Ÿé‡‘", "ATM"]

---

## ğŸ¤– AI è‡ªå‹•è™•ç†

### 1. å•é¡Œæ‘˜è¦ç”Ÿæˆ

**è§¸ç™¼æ¢ä»¶**ï¼šExcel/JSON æœªæä¾›å•é¡Œæ¬„ä½

**ä½¿ç”¨æ¨¡å‹**ï¼š`gpt-4o-mini`

**Prompt ç¯„ä¾‹**ï¼š
```
è«‹æ ¹æ“šä»¥ä¸‹ç­”æ¡ˆï¼Œç”Ÿæˆä¸€å€‹ç°¡æ½”çš„å•é¡Œæ‘˜è¦ï¼ˆ15å­—ä»¥å…§ï¼‰ã€‚

åˆ†é¡ï¼šå¸³å‹™æŸ¥è©¢
ç­”æ¡ˆï¼šç§Ÿé‡‘æ‡‰æ–¼æ¯æœˆ 1 è™Ÿå‰ç¹³æ¸…ã€‚å¯é€é ATM è½‰å¸³ã€ç·šä¸Šåˆ·å¡æˆ–è¶…å•†ç¹³è²»...

åªè¼¸å‡ºå•é¡Œæ‘˜è¦ï¼Œä¸è¦åŠ å…¶ä»–èªªæ˜ã€‚
```

**è¼¸å‡º**ï¼šã€Œå¦‚ä½•ç¹³ç´ç§Ÿé‡‘ï¼Ÿã€

### 2. å‘é‡åµŒå…¥ç”Ÿæˆ

**ä½¿ç”¨æ¨¡å‹**ï¼š`text-embedding-3-small` (1536 ç¶­åº¦)

**è¼¸å…¥æ–‡å­—**ï¼š`å•é¡Œæ‘˜è¦ + ç­”æ¡ˆå‰ 200 å­—`

**ç¯„ä¾‹**ï¼š
```
å¦‚ä½•ç¹³ç´ç§Ÿé‡‘ï¼Ÿ ç§Ÿé‡‘æ‡‰æ–¼æ¯æœˆ 1 è™Ÿå‰ç¹³æ¸…ã€‚å¯é€é ATM è½‰å¸³ã€ç·šä¸Šåˆ·å¡æˆ–è¶…å•†ç¹³è²»ã€‚é€¾æœŸ 5 å¤©å¾Œå°‡åŠ æ”¶ 200 å…ƒæ‰‹çºŒè²»...
```

**è¼¸å‡º**ï¼š`[0.023, -0.045, 0.012, ..., 0.089]` (1536 å€‹æµ®é»æ•¸)

**å„²å­˜ä½ç½®**ï¼š
- `knowledge_base.embedding` (å¯©æ ¸é€šéå¾Œ)
- `ai_generated_knowledge_candidates.question_embedding` (å¯©æ ¸ä½‡åˆ—)
- `test_scenarios.question_embedding` (æ¸¬è©¦æƒ…å¢ƒ)

### 3. æ„åœ–æ¨è–¦

**ä½¿ç”¨æ¨¡å‹**ï¼š`gpt-4o-mini`

**Prompt ç¯„ä¾‹**ï¼š
```
è«‹æ ¹æ“šä»¥ä¸‹å•ç­”å…§å®¹ï¼Œå¾æ„åœ–æ¸…å–®ä¸­é¸æ“‡æœ€åˆé©çš„æ„åœ–ã€‚

å•é¡Œï¼šå¦‚ä½•ç¹³ç´ç§Ÿé‡‘ï¼Ÿ
ç­”æ¡ˆï¼šç§Ÿé‡‘æ‡‰æ–¼æ¯æœˆ 1 è™Ÿå‰ç¹³æ¸…...
åˆ†é¡ï¼šå¸³å‹™æŸ¥è©¢

å¯ç”¨çš„æ„åœ–æ¸…å–®ï¼š
- 1: é ç´„çœ‹æˆ¿ (ç§Ÿå®¢é ç´„çœ‹æˆ¿ç›¸é—œå•é¡Œ)
- 2: å…¥ä½æµç¨‹ (æ–°ç§Ÿå®¢å…¥ä½æµç¨‹èªªæ˜)
- 6: å¸³å‹™æŸ¥è©¢ (ç§Ÿé‡‘ç¹³è²»ã€å¸³å–®æŸ¥è©¢)
- ...

è«‹ä»¥ JSON æ ¼å¼å›æ‡‰ï¼š
{
  "intent_id": æ¨è–¦çš„æ„åœ– IDï¼ˆæ•¸å­—ï¼‰,
  "intent_name": æ„åœ–åç¨±,
  "confidence": ä¿¡å¿ƒåº¦ï¼ˆ0.0-1.0ï¼‰,
  "reasoning": æ¨è–¦ç†ç”±ï¼ˆç°¡çŸ­èªªæ˜ï¼‰
}
```

**è¼¸å‡ºç¯„ä¾‹**ï¼š
```json
{
  "intent_id": 6,
  "intent_name": "å¸³å‹™æŸ¥è©¢",
  "confidence": 0.95,
  "reasoning": "å•é¡Œæ¶‰åŠç¹³ç´ç§Ÿé‡‘çš„æ–¹å¼å’ŒæœŸé™ï¼Œå±¬æ–¼å¸³å‹™æŸ¥è©¢çš„ç¯„ç–‡ã€‚"
}
```

---

## ğŸ§ª æ¸¬è©¦æƒ…å¢ƒè‡ªå‹•å‰µå»º

### è§¸ç™¼æ¢ä»¶

1. **å°è±¡ç‚º B2C**ï¼šç§Ÿå®¢ã€æˆ¿æ± (audience in ['ç§Ÿå®¢', 'æˆ¿æ±', 'tenant', 'landlord'])
2. **æ¸¬è©¦æƒ…å¢ƒè¡¨ä¸­ä¸å­˜åœ¨ç›¸åŒå•é¡Œ**

### å‰µå»ºå…§å®¹

```sql
INSERT INTO test_scenarios (
    test_question,           -- å•é¡Œ
    expected_category,       -- åˆ†é¡
    difficulty,             -- é›£åº¦ï¼ˆé è¨­ 'medium'ï¼‰
    status,                 -- ç‹€æ…‹ï¼ˆ'pending_review'ï¼‰
    source,                 -- ä¾†æºï¼ˆ'imported'ï¼‰
    created_at
) VALUES (?, ?, ?, ?, ?, CURRENT_TIMESTAMP)
```

### ç¯„ä¾‹

**åŒ¯å…¥çŸ¥è­˜**ï¼š
- å•é¡Œï¼šã€Œå¦‚ä½•ç¹³ç´ç§Ÿé‡‘ï¼Ÿã€
- å°è±¡ï¼šç§Ÿå®¢
- åˆ†é¡ï¼šå¸³å‹™æŸ¥è©¢

**è‡ªå‹•å‰µå»ºæ¸¬è©¦æƒ…å¢ƒ**ï¼š
- test_question: ã€Œå¦‚ä½•ç¹³ç´ç§Ÿé‡‘ï¼Ÿã€
- expected_category: ã€Œå¸³å‹™æŸ¥è©¢ã€
- difficulty: 'medium'
- status: 'pending_review'
- source: 'imported'

---

## ğŸ“‹ å¯©æ ¸ä½‡åˆ—

### è³‡æ–™è¡¨çµæ§‹

**æ¸¬è©¦æƒ…å¢ƒ** (`test_scenarios`):
```
id: æ¸¬è©¦æƒ…å¢ƒ ID
test_question: å•é¡Œ
expected_category: é æœŸåˆ†é¡
difficulty: é›£åº¦ (easy/medium/hard)
status: ç‹€æ…‹ (pending_review/approved/rejected)
source: ä¾†æº (imported/manual/user_question)
question_embedding: å•é¡Œå‘é‡ (1536 ç¶­åº¦)
```

**çŸ¥è­˜å€™é¸** (`ai_generated_knowledge_candidates`):
```
id: å€™é¸ ID
test_scenario_id: é—œè¯çš„æ¸¬è©¦æƒ…å¢ƒ (å¤–éµ)
question: å•é¡Œ
generated_answer: ç­”æ¡ˆ
question_embedding: å•é¡Œå‘é‡ (1536 ç¶­åº¦)
confidence_score: ä¿¡å¿ƒåˆ†æ•¸
ai_model: AI æ¨¡å‹ ('knowledge_import' è¡¨ç¤ºä¾†è‡ªåŒ¯å…¥)
generation_reasoning: ç”Ÿæˆç†ç”±ï¼ˆå«æ„åœ–æ¨è–¦è³‡è¨Šï¼‰
status: ç‹€æ…‹ (pending_review/approved/rejected)
```

### å¯©æ ¸æµç¨‹

```
1. çŸ¥è­˜åŒ¯å…¥ â†’ ai_generated_knowledge_candidates (status='pending_review')
                â†“
2. äººå·¥å¯©æ ¸ â†’ å¯©æ ¸ä¸­å¿ƒä»‹é¢
                â†“
3. å¯©æ ¸æ±ºå®š â†’ approved / rejected
                â†“
4. å¯©æ ¸é€šé â†’ knowledge_base (æ­£å¼çŸ¥è­˜åº«)
```

---

## ğŸ”§ API ä½¿ç”¨

### 1. ä¸Šå‚³æª”æ¡ˆåŒ¯å…¥çŸ¥è­˜

**ç«¯é»**ï¼š`POST /api/v1/knowledge-import/upload`

**Request**ï¼š
```bash
curl -X POST http://localhost:8100/api/v1/knowledge-import/upload \
  -F "file=@test_knowledge_data.xlsx" \
  -F "vendor_id=1" \
  -F "import_mode=append" \
  -F "enable_deduplication=true"
```

**åƒæ•¸èªªæ˜**ï¼š
- `file`: ä¸Šå‚³çš„æª”æ¡ˆ (CSV/Excel/JSON/TXT)
- `vendor_id`: æ¥­è€… IDï¼ˆå¯é¸ï¼Œé€šç”¨çŸ¥è­˜å¯ä¸å¡«ï¼‰
- `import_mode`: åŒ¯å…¥æ¨¡å¼
  - `append`: è¿½åŠ ï¼ˆé è¨­ï¼‰
  - `replace`: å–ä»£æ¥­è€…ç¾æœ‰çŸ¥è­˜
  - `merge`: åˆä½µï¼ˆå»é‡å¾Œè¿½åŠ ï¼‰
- `enable_deduplication`: æ˜¯å¦å•Ÿç”¨å»é‡ï¼ˆé è¨­ trueï¼‰

**Response**ï¼š
```json
{
  "job_id": "f87958b1-a660-477f-8725-17b074da76f0",
  "status": "processing",
  "message": "æª”æ¡ˆä¸Šå‚³æˆåŠŸï¼Œé–‹å§‹è™•ç†ä¸­ã€‚æ‰€æœ‰çŸ¥è­˜å°‡é€²å…¥å¯©æ ¸ä½‡åˆ—ï¼Œéœ€ç¶“äººå·¥å¯©æ ¸å¾Œæ‰æœƒæ­£å¼åŠ å…¥çŸ¥è­˜åº«ã€‚"
}
```

### 2. æŸ¥è©¢åŒ¯å…¥ä½œæ¥­ç‹€æ…‹

**ç«¯é»**ï¼š`GET /api/v1/knowledge-import/jobs/{job_id}`

**Request**ï¼š
```bash
curl http://localhost:8100/api/v1/knowledge-import/jobs/f87958b1-a660-477f-8725-17b074da76f0
```

**Responseï¼ˆè™•ç†ä¸­ï¼‰**ï¼š
```json
{
  "job_id": "f87958b1-a660-477f-8725-17b074da76f0",
  "status": "processing",
  "progress": {
    "current": 55,
    "total": 100,
    "stage": "ç”Ÿæˆå‘é‡åµŒå…¥"
  },
  "created_at": "2025-10-12T10:48:20Z",
  "updated_at": "2025-10-12T10:48:25Z"
}
```

**Responseï¼ˆå®Œæˆï¼‰**ï¼š
```json
{
  "job_id": "f87958b1-a660-477f-8725-17b074da76f0",
  "status": "completed",
  "progress": {
    "current": 100,
    "total": 100
  },
  "result": {
    "imported": 10,
    "skipped": 0,
    "errors": 0,
    "total": 10,
    "test_scenarios_created": 8,
    "mode": "review_queue"
  },
  "completed_at": "2025-10-12T10:48:30Z"
}
```

### 3. æŸ¥è©¢å¯©æ ¸ä½‡åˆ—

**ç«¯é»**ï¼š`GET /api/v1/knowledge/candidates`

**Request**ï¼š
```bash
curl "http://localhost:8100/api/v1/knowledge/candidates?status=pending_review&ai_model=knowledge_import"
```

**Response**ï¼š
```json
{
  "candidates": [
    {
      "id": 45,
      "test_scenario_id": 20,
      "question": "å¦‚ä½•ç¹³ç´ç§Ÿé‡‘ï¼Ÿ",
      "generated_answer": "ç§Ÿé‡‘æ‡‰æ–¼æ¯æœˆ 1 è™Ÿå‰ç¹³æ¸…...",
      "confidence_score": 0.95,
      "ai_model": "knowledge_import",
      "generation_reasoning": "åˆ†é¡: å¸³å‹™æŸ¥è©¢, å°è±¡: ç§Ÿå®¢\n\nã€æ¨è–¦æ„åœ–ã€‘\næ„åœ– ID: 6\næ„åœ–åç¨±: å¸³å‹™æŸ¥è©¢\nä¿¡å¿ƒåº¦: 0.95",
      "status": "pending_review",
      "created_at": "2025-10-12T10:48:30Z"
    }
  ],
  "total": 10
}
```

---

## ğŸ“Š é©—è­‰æ¸¬è©¦çµæœ

### æ¸¬è©¦å ´æ™¯

**æ¸¬è©¦æª”æ¡ˆ**ï¼š10 æ¢çŸ¥è­˜
- 1 æ¢å®Œå…¨é‡è¤‡ï¼ˆé …ç›® 1 & 8ï¼‰
- 2 çµ„èªæ„ç›¸ä¼¼ï¼ˆ1&2 ç§Ÿé‡‘ï¼Œ3&4 å¯µç‰©ï¼‰
- 9 æ¢ B2Cï¼ˆç§Ÿå®¢/æˆ¿æ±ï¼‰
- 1 æ¢ B2Bï¼ˆç®¡ç†å¸«ï¼‰

### Round 1ï¼šç¬¬ä¸€æ¬¡åŒ¯å…¥ï¼ˆè³‡æ–™åº«ç‚ºç©ºï¼‰

**çµæœ**ï¼š
```
âœ… åŒ¯å…¥çŸ¥è­˜: 10 æ¢
âœ… æ¸¬è©¦æƒ…å¢ƒ: 8 å€‹ï¼ˆ9 æ¢ B2C - 1 æ¢é‡è¤‡ï¼‰
âœ… å¯©æ ¸ä½‡åˆ—: 13 æ¢ï¼ˆ10 æ¢åŒ¯å…¥ + 3 æ¢èˆŠè³‡æ–™ï¼‰
âœ… è™•ç†æ™‚é–“: ~15 ç§’
âœ… æ„åœ–æ¨è–¦: å…¨éƒ¨æˆåŠŸï¼ˆä¿¡å¿ƒåº¦ 0.95-1.0ï¼‰
```

### Round 2ï¼šç¬¬äºŒæ¬¡åŒ¯å…¥ï¼ˆé©—è­‰å»é‡ï¼‰

**çµæœ**ï¼š
```
âœ… åŒ¯å…¥çŸ¥è­˜: 0 æ¢ï¼ˆå…¨éƒ¨æ””æˆªï¼‰
âœ… æ¸¬è©¦æƒ…å¢ƒ: 0 å€‹
âœ… å¯©æ ¸ä½‡åˆ—: 13 æ¢ï¼ˆç¶­æŒä¸è®Šï¼‰
âœ… è™•ç†æ™‚é–“: < 1 ç§’
âœ… å»é‡éšæ®µ: æ–‡å­—å»é‡ï¼ˆç¯€çœ 10 æ¬¡ embedding å‘¼å«ï¼‰
```

**å»é‡æ—¥èªŒ**ï¼š
```
ğŸ” åŸ·è¡Œæ–‡å­—å»é‡ï¼ˆç²¾ç¢ºåŒ¹é…ï¼‰...
   è·³éé‡è¤‡: å¦‚ä½•ç¹³ç´ç§Ÿé‡‘ï¼Ÿ...
   è·³éé‡è¤‡: ç§Ÿé‡‘è¦æ€éº¼ç¹³ï¼Ÿ...
   è·³éé‡è¤‡: å¯ä»¥é¤Šå¯µç‰©å—ï¼Ÿ...
   ... (å…± 10 æ¢)
ğŸ” æ–‡å­—å»é‡: è·³é 10 æ¢å®Œå…¨ç›¸åŒçš„é …ç›®ï¼Œå‰©é¤˜ 0 æ¢
ğŸ“Š ç¸½è¨ˆè·³é: 10 æ¢ï¼ˆæ–‡å­—: 10, èªæ„: 0ï¼‰
```

---

## ğŸ¯ æ•ˆèƒ½å„ªåŒ–

### 1. æ–‡å­—å»é‡åœ¨ LLM å‰åŸ·è¡Œ

**åŸå› **ï¼šç¯€çœ OpenAI API æˆæœ¬

**æµç¨‹**ï¼š
```
è§£ææª”æ¡ˆ (10 æ¢)
  â†“
æ–‡å­—å»é‡ â†’ è·³é 10 æ¢ â†’ å‰©é¤˜ 0 æ¢
  â†“
âŒ ä¸åŸ·è¡Œï¼šå•é¡Œç”Ÿæˆ (gpt-4o-mini)
âŒ ä¸åŸ·è¡Œï¼šå‘é‡åµŒå…¥ (text-embedding-3-small)
âŒ ä¸åŸ·è¡Œï¼šèªæ„å»é‡
âŒ ä¸åŸ·è¡Œï¼šæ„åœ–æ¨è–¦ (gpt-4o-mini)
```

**ç¯€çœæˆæœ¬**ï¼š
- 0 æ¬¡å•é¡Œç”Ÿæˆå‘¼å«
- 0 æ¬¡ embedding å‘¼å«ï¼ˆ**çœæœ€å¤š**ï¼‰
- 0 æ¬¡æ„åœ–æ¨è–¦å‘¼å«

### 2. æ‰¹æ¬¡è™•ç†

**embedding ç”Ÿæˆ**ï¼š
- æ¯è™•ç† 10 æ¢é¡¯ç¤ºé€²åº¦
- Sleep 0.05 ç§’é¿å… rate limit

**æ„åœ–æ¨è–¦**ï¼š
- æ¯è™•ç† 1 æ¢ sleep 0.1 ç§’
- é¿å… OpenAI rate limit

---

## ğŸ—„ï¸ è³‡æ–™åº«è¨­è¨ˆ

### Migration 31: å¯©æ ¸ä½‡åˆ—èªæ„å»é‡æ”¯æ´

**æª”æ¡ˆ**ï¼š`database/migrations/31-add-embedding-to-review-queue.sql`

**è®Šæ›´**ï¼š
1. ç‚º `ai_generated_knowledge_candidates` å¢åŠ  `question_embedding` æ¬„ä½
2. ç‚º `test_scenarios` å¢åŠ  `question_embedding` æ¬„ä½
3. å‰µå»º `find_similar_knowledge_candidate()` å‡½æ•¸
4. å»ºç«‹ ivfflat ç´¢å¼•æå‡æŸ¥è©¢æ•ˆèƒ½

### Migration 32: æ¸¬è©¦æƒ…å¢ƒèªæ„æª¢æŸ¥

**æª”æ¡ˆ**ï¼š`database/migrations/32-add-test-scenario-similarity-check.sql`

**è®Šæ›´**ï¼š
1. å‰µå»º `find_similar_test_scenario()` å‡½æ•¸
2. æ›´æ–° `check_knowledge_exists_by_similarity()` å‡½æ•¸æ”¯æ´ 3 å¼µè¡¨æª¢æŸ¥
3. è¿”å› `exists_in_test_scenarios` æ¬„ä½

**å‡½æ•¸å®šç¾©**ï¼š
```sql
CREATE OR REPLACE FUNCTION check_knowledge_exists_by_similarity(
    p_question_embedding vector(1536),
    p_similarity_threshold DECIMAL DEFAULT 0.85
)
RETURNS TABLE (
    exists_in_knowledge_base BOOLEAN,
    exists_in_review_queue BOOLEAN,
    exists_in_test_scenarios BOOLEAN,    -- æ–°å¢
    knowledge_id INTEGER,
    candidate_id INTEGER,
    scenario_id INTEGER,                 -- æ–°å¢
    matched_question TEXT,
    similarity_score DECIMAL,
    source_table VARCHAR
)
```

---

## ğŸš¨ å¸¸è¦‹å•é¡Œ

### Q1: ç‚ºä»€éº¼ç¬¬ä¸€æ¬¡åŒ¯å…¥æ²’æœ‰å»é‡ï¼Ÿ

**A**: ç¬¬ä¸€æ¬¡åŒ¯å…¥æ™‚è³‡æ–™åº«ç‚ºç©ºï¼Œæ²’æœ‰å¯æ¯”å°çš„è³‡æ–™ã€‚å»é‡åŠŸèƒ½æœƒåœ¨ï¼š
- ç¬¬äºŒæ¬¡åŒ¯å…¥ç›¸åŒæª”æ¡ˆæ™‚ç”Ÿæ•ˆ
- å·²æœ‰æ¸¬è©¦æƒ…å¢ƒ/å¯©æ ¸ä½‡åˆ—/çŸ¥è­˜åº«è³‡æ–™æ™‚ç”Ÿæ•ˆ

### Q2: ç‚ºä»€éº¼è¦æª¢æŸ¥ test_scenariosï¼Ÿ

**A**: å› ç‚ºåŒ¯å…¥æµç¨‹æœƒå…ˆå‰µå»ºæ¸¬è©¦æƒ…å¢ƒï¼ˆstatus='pending_review'ï¼‰ï¼Œå¦‚æœä¸æª¢æŸ¥æ¸¬è©¦æƒ…å¢ƒï¼š
- ç¬¬äºŒæ¬¡åŒ¯å…¥æœƒå‰µå»ºé‡è¤‡çš„æ¸¬è©¦æƒ…å¢ƒ
- å³ä½¿çŸ¥è­˜å€™é¸è¢«æ””æˆªï¼Œæ¸¬è©¦æƒ…å¢ƒé‚„æ˜¯æœƒé‡è¤‡

### Q3: èªæ„å»é‡çš„é–¾å€¼å¯ä»¥èª¿æ•´å—ï¼Ÿ

**A**: å¯ä»¥ã€‚é–¾å€¼é è¨­ç‚º 0.85ï¼Œå¯åœ¨ `_deduplicate_by_similarity()` å‡½æ•¸ä¸­èª¿æ•´ï¼š
```python
knowledge_list = await self._deduplicate_by_similarity(
    knowledge_list,
    threshold=0.85  # èª¿æ•´æ­¤å€¼
)
```

**å»ºè­°å€¼**ï¼š
- 0.90-0.95ï¼šåš´æ ¼ï¼ˆåªéæ¿¾éå¸¸ç›¸ä¼¼çš„ï¼‰
- 0.85ï¼šå¹³è¡¡ï¼ˆé è¨­ï¼‰
- 0.75-0.80ï¼šå¯¬é¬†ï¼ˆéæ¿¾è¼ƒå¤šç›¸ä¼¼å•é¡Œï¼‰

### Q4: å¦‚ä½•æŸ¥çœ‹åŒ¯å…¥çš„è©³ç´°æ—¥èªŒï¼Ÿ

**A**: ä½¿ç”¨ Docker logsï¼š
```bash
docker logs aichatbot-rag-orchestrator 2>&1 | grep -A 50 "job_id"
```

### Q5: åŒ¯å…¥å¤±æ•—å¦‚ä½•æ’æŸ¥ï¼Ÿ

**A**: æª¢æŸ¥ä»¥ä¸‹é …ç›®ï¼š
1. **æª”æ¡ˆæ ¼å¼**ï¼šç¢ºèªæ˜¯ .csv / .xlsx / .json / .txt
2. **å¿…å¡«æ¬„ä½**ï¼šç­”æ¡ˆæ¬„ä½è‡³å°‘ 10 å­—
3. **OpenAI API Key**ï¼šç¢ºèªç’°å¢ƒè®Šæ•¸å·²è¨­å®š
4. **å®¹å™¨ç‹€æ…‹**ï¼š`docker-compose ps`
5. **è³‡æ–™åº«é€£ç·š**ï¼š`docker logs aichatbot-postgres`

---

## ğŸ“š ç›¸é—œæ–‡ä»¶

- [API åƒè€ƒæ–‡ä»¶](../api/KNOWLEDGE_IMPORT_API.md)
- [æ¸¬è©¦æƒ…å¢ƒç®¡ç†](./TEST_SCENARIO_STATUS_MANAGEMENT.md)
- [AI çŸ¥è­˜ç”Ÿæˆ](./AI_KNOWLEDGE_GENERATION_FEATURE.md)
- [å¯©æ ¸ä¸­å¿ƒä½¿ç”¨æŒ‡å—](../guides/REVIEW_CENTER_GUIDE.md)

---

**å»ºç«‹æ—¥æœŸ**: 2025-10-12
**æœ€å¾Œæ›´æ–°**: 2025-11-13
**ç‰ˆæœ¬**: 1.1 (æ–°å¢ CSV æ”¯æ´)
**ç¶­è­·è€…**: Claude Code
