# 📂 多檔案匯入功能使用指南

## 🎯 功能概述

檔案管理器允許您一次添加多個檔案到佇列，然後批次或逐個處理，大幅提升匯入效率。

## 🖼️ 介面預覽

```
┌─────────────────────────────────────────────────────┐
│  📤 知識庫匯入                                        │
├─────────────────────────────────────────────────────┤
│  📋 檔案佇列 (3)                     [➕ 添加檔案]    │
│                                                     │
│  ┌─────────────────────────────────────────────┐   │
│  │ 📄 knowledge_1.csv  125KB  CSV              │   │
│  │    ⏳ 待處理                                  │   │
│  │    [處理] [✕]                                │   │
│  └─────────────────────────────────────────────┘   │
│                                                     │
│  ┌─────────────────────────────────────────────┐   │
│  │ 📄 knowledge_2.xlsx  230KB  XLSX            │   │
│  │    🔄 處理中... ████████░░ 80%               │   │
│  │    [處理中...]                                │   │
│  └─────────────────────────────────────────────┘   │
│                                                     │
│  ┌─────────────────────────────────────────────┐   │
│  │ 📄 knowledge_3.csv  89KB  CSV               │   │
│  │    ✅ 已完成  新增: 50  跳過: 5              │   │
│  │    [詳情] [✕]                                │   │
│  └─────────────────────────────────────────────┘   │
│                                                     │
│  [🚀 處理全部待處理檔案 (1)]                         │
│  [🗑️ 清除已完成 (1)]  [清空佇列]                    │
└─────────────────────────────────────────────────────┘
```

## 📖 使用步驟

### 步驟 1: 添加檔案到佇列

1. 訪問 http://localhost:8087/knowledge-import
2. 點擊右上角「➕ 添加檔案」按鈕
3. 在檔案選擇器中：
   - 按住 `Ctrl` (Windows) 或 `Cmd` (Mac) 可多選檔案
   - 支援格式：`.csv`, `.xlsx`, `.xls`, `.txt`, `.json`
4. 點擊「開啟」，檔案會出現在佇列中

**檔案狀態**：
- ⏳ **待處理** - 檔案已添加，等待處理
- 🔄 **處理中** - 正在上傳和處理
- ✅ **已完成** - 處理成功
- ❌ **失敗** - 處理失敗，可查看錯誤訊息

### 步驟 2: 處理檔案

**方式 A - 逐個處理**：
1. 點擊某個檔案的「處理」按鈕
2. 等待該檔案處理完成（可看到進度條）
3. 完成後點擊「詳情」查看結果

**方式 B - 批次處理**（推薦）：
1. 點擊底部「🚀 處理全部待處理檔案」按鈕
2. 系統會自動逐個處理所有待處理的檔案
3. 處理期間可以看到每個檔案的進度
4. 全部完成後會彈出總結通知

### 步驟 3: 管理佇列

**查看詳情**：
- 點擊「詳情」查看處理結果統計（新增、跳過、失敗筆數）

**重試失敗檔案**：
- 點擊「重試」重新處理失敗的檔案

**移除檔案**：
- 點擊「✕」移除單個檔案
- 點擊「🗑️ 清除已完成」移除所有已完成的檔案
- 點擊「清空佇列」移除所有檔案（處理中的檔案不會被移除）

## ⚙️ 匯入選項

在添加檔案後，可以設定以下選項：

### 跳過審核
- **位置**: 在佇列下方的選項區
- **說明**: 勾選後，知識會直接加入正式知識庫（跳過審核流程）
- **注意**: 影響線上回答，請謹慎使用

### 統一啟用優先級
- **條件**: 僅在勾選「跳過審核」時顯示
- **說明**: 所有匯入的知識將獲得 +0.15 相似度加成
- **效果**: 提升重要知識的檢索排名

## 💡 使用技巧

### 1. 檔案命名建議

```
✅ 好的命名:
- FAQ_客服_202511.csv
- 產品知識_更新_v2.xlsx
- 新手指南_2025Q4.csv

❌ 避免:
- 未命名.csv
- 新增檔案 (1).csv
- test.csv
```

### 2. 批次處理最佳實踐

**小批量（2-5 個檔案）**：
- 可以全部添加後點「處理全部」
- 總時間 < 5 分鐘

**中批量（6-10 個檔案）**：
- 建議先處理重要的檔案
- 可分批添加處理

**大批量（10+ 個檔案）**：
- 先測試處理 1-2 個檔案確認格式正確
- 再批次處理剩餘檔案
- 建議在非高峰時段處理

### 3. 錯誤處理策略

**某個檔案失敗時**：
1. 其他檔案繼續處理（互不影響）
2. 點擊失敗檔案的錯誤訊息查看原因
3. 修正檔案後點「重試」
4. 或移除該檔案，稍後手動處理

### 4. 進度監控

處理中可以：
- 查看每個檔案的進度百分比
- 查看當前處理第幾個檔案
- 估算剩餘時間（每個檔案約 1-3 分鐘）

## 🔧 技術細節

### 檔案大小限制
- **單檔上限**: 50MB
- **建議大小**: < 10MB（處理更快）
- **超大檔案**: 建議拆分為多個小檔案

### 處理超時
- **自動超時**: 單檔處理超過 10 分鐘會標記為失敗
- **建議**: 如檔案過大或內容複雜，考慮分批匯入

### 並發限制
- **當前設計**: 序列處理（一次處理一個檔案）
- **原因**: 避免同時多個 OpenAI API 請求導致 rate limit
- **未來**: 可升級為平行處理（需調整後端）

### 資料去重
- 每個檔案獨立去重
- 基於 `question_summary` 和相似度檢查
- 重複知識會自動跳過

## 📊 常見問題

### Q1: 可以一次上傳幾個檔案？
A: 理論上無限制，但建議一次不超過 20 個檔案，以便管理和監控。

### Q2: 處理中可以添加新檔案嗎？
A: 可以！新添加的檔案會進入佇列，等待當前檔案處理完成後再處理。

### Q3: 處理中可以關閉瀏覽器嗎？
A: 不建議。處理依賴前端輪詢狀態，關閉瀏覽器會中斷輪詢。建議等待處理完成。

### Q4: 失敗的檔案會影響其他檔案嗎？
A: 不會。每個檔案獨立處理，某個失敗不影響其他檔案。

### Q5: 如何查看歷史匯入記錄？
A: 在同一頁面下方有「匯入歷史」表格，顯示所有匯入任務記錄。

### Q6: 可以暫停批次處理嗎？
A: 當前版本不支援暫停。建議處理前確認所有檔案正確無誤。

## 🆚 與單檔案模式比較

| 特性 | 單檔案模式 (舊) | 檔案管理器 (新) |
|------|---------------|----------------|
| 一次選擇 | 1 個 | 多個 |
| 重複操作 | 需要 | 不需要 |
| 進度可見 | 單一進度條 | 每個檔案獨立進度 |
| 錯誤處理 | 中斷全部 | 獨立處理 |
| 批次處理 | 手動重複 | 自動批次 |
| 適合場景 | 單個大檔案 | 多個小檔案 |

## 📝 最佳實踐範例

### 範例 1: 月度知識更新

```
場景：每月更新 5 個不同類別的 FAQ

步驟：
1. 準備 5 個 CSV 檔案：
   - FAQ_客服_202511.csv
   - FAQ_產品_202511.csv
   - FAQ_技術_202511.csv
   - FAQ_帳務_202511.csv
   - FAQ_其他_202511.csv

2. 一次添加所有檔案到佇列

3. 勾選「跳過審核」+「統一啟用優先級」

4. 點擊「處理全部」

5. 泡杯咖啡，等待 10-15 分鐘

6. 查看結果，處理失敗的檔案（如有）
```

### 範例 2: 大量歷史資料遷移

```
場景：匯入 20 個歷史知識檔案

步驟：
1. 先添加 2 個檔案測試
   - 確認格式正確
   - 確認欄位對應無誤

2. 測試通過後，添加剩餘 18 個檔案

3. 不勾選「跳過審核」（先進審核佇列）

4. 點擊「處理全部」

5. 處理完成後，到審核中心批次審核
```

## 🚀 未來計劃

- [ ] 支援拖曳上傳
- [ ] 支援檔案優先順序調整
- [ ] 支援暫停/繼續處理
- [ ] 支援平行處理（加快速度）
- [ ] 支援處理歷史記錄查詢
- [ ] 支援失敗重試次數設定

---

**最後更新**: 2025-11-18
**功能版本**: v1.0
**實現工時**: 3 小時
**後端改動**: 無（完全前端實現）
