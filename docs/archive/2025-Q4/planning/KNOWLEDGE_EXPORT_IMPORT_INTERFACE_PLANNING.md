# 知識庫匯出匯入介面規劃

**日期**: 2025-11-22
**規劃人員**: Claude Code
**狀態**: 📝 規劃中

---

## 📊 現狀盤查

### 後端 API 完成度

#### ✅ 知識庫匯出 API（已完整實現）

**端點**: `/api/v1/knowledge-export`

| 端點 | 方法 | 功能 | 狀態 |
|------|------|------|------|
| `/export` | POST | 創建匯出任務 | ✅ 完成 |
| `/jobs/{job_id}` | GET | 查詢任務狀態 | ✅ 完成 |
| `/jobs/{job_id}/download` | GET | 下載匯出檔案 | ✅ 完成 |
| `/jobs` | GET | 匯出歷史列表 | ✅ 完成 |
| `/jobs/{job_id}` | DELETE | 刪除任務 | ✅ 完成 |
| `/statistics` | GET | 匯出統計資訊 | ✅ 完成 |
| `/preview` | GET | 預覽匯出資料 | ✅ 完成 |

**功能特點**:
- ✅ 三種匯出模式：basic, formatted, optimized
- ✅ 支援按業者篩選（vendor_id）
- ✅ Excel 格式匯出（多工作表）
- ✅ 背景任務處理（避免超時）
- ✅ 進度追蹤
- ✅ 統一 Job 系統整合

**測試狀態**:
- ✅ 成功匯出 136 筆知識記錄
- ✅ 檔案大小 29.66 KB
- ✅ 無字元錯誤
- ✅ 多工作表格式正確

#### ✅ 知識庫匯入 API（已完整實現）

**端點**: `/api/v1/knowledge-import`

| 端點 | 方法 | 功能 | 狀態 |
|------|------|------|------|
| `/upload` | POST | 上傳檔案開始匯入 | ✅ 完成 |
| `/jobs/{job_id}` | GET | 查詢任務狀態 | ✅ 完成 |
| `/jobs` | GET | 匯入歷史列表 | ✅ 完成 |
| `/preview` | POST | 預覽檔案內容 | ✅ 完成 |
| `/jobs/{job_id}` | DELETE | 刪除任務 | ✅ 完成 |
| `/statistics` | GET | 匯入統計資訊 | ✅ 完成 |

**功能特點**:
- ✅ 多格式支援：Excel, TXT, JSON, CSV
- ✅ 智能去重
- ✅ LLM 增強（自動提取關鍵字、推薦意圖）
- ✅ 背景任務處理
- ✅ 進度追蹤
- ✅ 審核機制（可選跳過審核）
- ✅ 統一 Job 系統整合

---

### 前端介面完成度

#### ✅ 知識庫匯入介面（已完整實現）

**路由**: `/knowledge-import`
**檔案**: `KnowledgeImportView.vue`

**功能特點**:
- ✅ 多檔案佇列管理
- ✅ 拖拽上傳
- ✅ 即時進度顯示
- ✅ 預覽功能
- ✅ 批次處理
- ✅ 結果統計
- ✅ 歷史記錄

**使用者體驗**:
- ✅ 4 步驟流程清晰
- ✅ 視覺反饋完善
- ✅ 錯誤處理友善

#### ❌ 知識庫匯出介面（未實現）

**狀態**: 🔴 完全缺失
**影響**: 使用者無法透過前端執行匯出操作

---

## 🎯 介面需求分析

### 使用場景

#### 場景 1：定期備份
**使用者**: 系統管理員
**需求**: 定期將知識庫匯出為 Excel 備份
**頻率**: 每月或每週

#### 場景 2：跨業者遷移
**使用者**: 業務人員
**需求**: 將通用知識匯出後，匯入到特定業者

#### 場景 3：資料分析
**使用者**: 數據分析師
**需求**: 匯出知識庫進行 Excel 分析

#### 場景 4：內容審查
**使用者**: 內容管理員
**需求**: 匯出特定業者的知識進行檢查

---

## 📐 介面設計方案

### 方案 A：獨立匯出頁面（推薦）⭐

#### 優點
- ✅ 功能完整獨立
- ✅ 與匯入頁面呼應
- ✅ 易於擴展進階功能
- ✅ 符合使用者心智模型

#### 缺點
- ⚠️ 需要新增路由和導航
- ⚠️ 開發工作量較大

#### 設計細節

**路由配置**:
```javascript
{
  path: '/knowledge-export',
  name: 'KnowledgeExport',
  component: KnowledgeExportView
}
```

**導航位置**:
```
📤 工具
  └─ 📥 知識匯入 (現有)
  └─ 📤 知識匯出 (新增) ⭐
  └─ 📄 規格書轉換 (現有)
```

**頁面結構**:
```
知識庫匯出
├─ 匯出設定區
│  ├─ 業者選擇（下拉選單）
│  ├─ 匯出模式（basic/formatted/optimized）
│  ├─ 進階選項（摺疊面板）
│  │  ├─ 包含意圖對照表
│  │  └─ 包含匯出資訊
│  └─ 按鈕：預覽 | 開始匯出
│
├─ 匯出歷史區
│  ├─ 篩選條件（業者、日期）
│  └─ 歷史列表（表格）
│     ├─ 狀態標籤
│     ├─ 進度條（處理中）
│     └─ 操作按鈕（下載、刪除）
│
└─ 統計資訊區（卡片）
   ├─ 總匯出次數
   ├─ 本月匯出次數
   └─ 總匯出資料量
```

---

### 方案 B：整合到知識庫頁面

#### 優點
- ✅ 開發工作量小
- ✅ 使用者無需切換頁面

#### 缺點
- ⚠️ 功能受限（難以展示進階設定）
- ⚠️ 與匯入介面不一致
- ⚠️ 知識庫頁面過於複雜

#### 設計細節

**位置**: 知識庫頁面右上角
**形式**: 匯出按鈕 → 彈出視窗

**彈出視窗內容**:
- 業者選擇
- 匯出模式
- 確認按鈕

---

### 方案 C：合併匯入匯出頁面

#### 優點
- ✅ 集中管理
- ✅ 節省導航空間

#### 缺點
- ⚠️ 頁面複雜度高
- ⚠️ 使用者容易混淆
- ⚠️ 不利於專注操作

#### 設計細節

**頁面結構**:
```
知識庫管理
├─ Tab 1: 匯入
└─ Tab 2: 匯出
```

---

## 💡 推薦方案：方案 A（獨立匯出頁面）

### 理由
1. **功能對等**: 匯入有獨立頁面，匯出也應該有
2. **使用者體驗**: 清晰的功能劃分
3. **可擴展性**: 未來可新增更多匯出選項
4. **符合直覺**: 使用者期望對稱的操作流程

---

## 🎨 詳細介面設計（方案 A）

### 頁面佈局

```
┌─────────────────────────────────────────────────────────┐
│ 📤 知識庫匯出                                            │
├─────────────────────────────────────────────────────────┤
│                                                          │
│ 將知識庫匯出為 Excel 格式，支援備份、遷移、分析等用途    │
│                                                          │
├─────────────────────────────────────────────────────────┤
│ ┌─ 匯出設定 ─────────────────────────────────────────┐ │
│ │                                                      │ │
│ │ 業者選擇:  [v] 通用知識 ▼                            │ │
│ │                                                      │ │
│ │ 匯出模式:  ◉ 進階格式化（推薦）                       │ │
│ │            ○ 基礎匯出                                │ │
│ │            ○ 效能優化（10萬+筆）                      │ │
│ │                                                      │ │
│ │ ▼ 進階選項                                           │ │
│ │ [x] 包含意圖對照表                                    │ │
│ │ [x] 包含匯出資訊工作表                                │ │
│ │                                                      │ │
│ │ [預覽資料]  [開始匯出]                                │ │
│ └──────────────────────────────────────────────────┘ │
│                                                          │
├─────────────────────────────────────────────────────────┤
│ ┌─ 匯出歷史 ─────────────────────────────────────────┐ │
│ │                                                      │ │
│ │ 篩選: [業者 ▼] [日期範圍]  搜尋: [_______] 🔍        │ │
│ │                                                      │ │
│ │ ╔════╦════════╦════════╦══════╦══════╦════════╗   │ │
│ │ ║ ID ║ 業者   ║ 模式   ║ 狀態 ║ 筆數 ║ 操作   ║   │ │
│ │ ╠════╬════════╬════════╬══════╬══════╬════════╣   │ │
│ │ ║ 1  ║ 通用   ║ 格式化 ║ ✅   ║ 136  ║ 📥 🗑️  ║   │ │
│ │ ║ 2  ║ 業者1  ║ 基礎   ║ 🔄   ║ -    ║ 📊     ║   │ │
│ │ ║    ║        ║        ║      ║      ║        ║   │ │
│ │ ║    ║        ║        ║ 50%  ║      ║        ║   │ │
│ │ ║    ║        ║        ║ ▓▓▓▓░░░░ ║        ║   │ │
│ │ ╚════╩════════╩════════╩══════╩══════╩════════╝   │ │
│ │                                                      │ │
│ │ [清除已完成]  [全部刪除]            顯示 10/頁 ▼ 1/5 │ │
│ └──────────────────────────────────────────────────┘ │
│                                                          │
├─────────────────────────────────────────────────────────┤
│ ┌─ 統計資訊 ────────────────────────────────────────┐ │
│ │                                                      │ │
│ │ 📊 總匯出次數  📅 本月匯出  💾 總資料量             │ │
│ │    245 次         12 次       3.2 MB               │ │
│ └──────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────┘
```

### 互動流程

#### 流程 1：快速匯出
```
1. 使用者進入頁面
2. 保持預設設定（通用知識、進階格式化）
3. 點擊「開始匯出」
4. 顯示處理中提示
5. 完成後出現在歷史列表
6. 點擊「📥」下載檔案
```

#### 流程 2：特定業者匯出
```
1. 使用者進入頁面
2. 選擇業者（下拉選單）
3. 選擇匯出模式
4. 點擊「預覽資料」（可選）
   └─ 彈出視窗顯示前 20 筆
5. 點擊「開始匯出」
6. 查看進度（歷史列表）
7. 下載檔案
```

#### 流程 3：查看歷史
```
1. 滾動到「匯出歷史」區塊
2. 使用篩選條件（業者、日期）
3. 點擊「📊」查看詳情
   └─ 彈出視窗顯示詳細資訊
4. 點擊「📥」下載檔案
5. 點擊「🗑️」刪除記錄
```

---

## 🛠️ 技術實現要點

### Vue 組件結構

```
KnowledgeExportView.vue (主頁面)
├─ ExportConfigPanel.vue (匯出設定)
│  ├─ VendorSelector (業者選擇)
│  ├─ ExportModeSelector (模式選擇)
│  └─ AdvancedOptions (進階選項)
├─ ExportHistoryTable.vue (歷史列表)
│  ├─ StatusBadge (狀態標籤)
│  ├─ ProgressBar (進度條)
│  └─ ActionButtons (操作按鈕)
├─ ExportStatistics.vue (統計資訊)
└─ ExportPreviewModal.vue (預覽彈窗)
```

### API 呼叫流程

```javascript
// 1. 創建匯出任務
const response = await axios.post('/api/v1/knowledge-export/export', {
  vendor_id: selectedVendor,
  export_mode: exportMode,
  include_intents: includeIntents,
  include_metadata: includeMetadata
});
const jobId = response.data.job_id;

// 2. 輪詢任務狀態（每 2 秒）
const pollStatus = async () => {
  const status = await axios.get(`/api/v1/knowledge-export/jobs/${jobId}`);

  if (status.data.status === 'processing') {
    updateProgress(status.data.progress);
    setTimeout(pollStatus, 2000);
  } else if (status.data.status === 'completed') {
    showDownloadButton(jobId);
  } else if (status.data.status === 'failed') {
    showError(status.data.error);
  }
};

// 3. 下載檔案
const downloadFile = (jobId) => {
  window.location.href = `/api/v1/knowledge-export/jobs/${jobId}/download`;
};
```

### 狀態管理

```javascript
data() {
  return {
    // 匯出設定
    exportConfig: {
      vendor_id: null,
      export_mode: 'formatted',
      include_intents: true,
      include_metadata: true
    },

    // 匯出歷史
    exportJobs: [],

    // 統計資訊
    statistics: {
      total_exports: 0,
      month_exports: 0,
      total_size_mb: 0
    },

    // UI 狀態
    isExporting: false,
    showPreview: false,
    previewData: []
  }
}
```

---

## 📋 實作檢查清單

### 第一階段：基礎功能（1-2 天）

#### 後端（已完成）
- [x] 匯出 API 端點
- [x] 任務狀態查詢
- [x] 檔案下載
- [x] 歷史列表

#### 前端（待實作）
- [ ] 創建 `KnowledgeExportView.vue`
- [ ] 實現匯出設定面板
- [ ] 實現業者選擇器
- [ ] 實現模式選擇器
- [ ] 實現「開始匯出」功能
- [ ] 實現匯出歷史表格
- [ ] 實現狀態輪詢
- [ ] 實現下載功能
- [ ] 新增路由配置
- [ ] 新增導航連結

### 第二階段：進階功能（1 天）

- [ ] 實現預覽功能
- [ ] 實現進階選項摺疊
- [ ] 實現篩選功能
- [ ] 實現刪除功能
- [ ] 實現統計資訊卡片
- [ ] 錯誤處理完善
- [ ] Loading 狀態優化

### 第三階段：優化與測試（0.5 天）

- [ ] 響應式設計調整
- [ ] 視覺效果優化
- [ ] 互動動畫
- [ ] 完整測試（不同業者、模式）
- [ ] 錯誤場景測試
- [ ] 效能測試（大量資料）

---

## 🎯 開發優先級建議

### 高優先級（Must Have）⭐⭐⭐
1. 基礎匯出功能（設定 + 執行）
2. 匯出歷史列表
3. 狀態追蹤與進度顯示
4. 檔案下載
5. 導航整合

### 中優先級（Should Have）⭐⭐
6. 業者選擇
7. 模式選擇
8. 統計資訊
9. 篩選功能
10. 刪除功能

### 低優先級（Nice to Have）⭐
11. 預覽功能
12. 進階選項
13. 批次操作
14. 匯出範本

---

## 💡 介面位置建議

### 推薦位置：工具區塊（Tools Section）

**導航結構**:
```
App.vue Navigation
├─ 📚 知識管理
│  ├─ 通用知識
│  ├─ 產業知識
│  ├─ JGB 知識
│  ├─ 意圖管理
│  └─ ...
│
├─ 👥 業者管理
│  ├─ 業者列表
│  └─ ...
│
├─ 💬 測試與驗證
│  ├─ 聊天測試
│  └─ ...
│
├─ 📤 資料工具  ⭐ 新增或重命名現有的「工具」區塊
│  ├─ 📥 知識匯入 (現有)
│  ├─ 📤 知識匯出 (新增) ⭐
│  ├─ 📄 規格書轉換 (現有)
│  └─ ...
│
└─ 🔧 系統管理
   └─ ...
```

**理由**:
1. ✅ 與匯入功能並列，符合使用者預期
2. ✅ 屬於資料處理工具，分類合理
3. ✅ 易於發現和使用

---

## 📊 預期效益

### 使用者體驗
- ✅ **操作便利**: 一鍵匯出，無需手動操作資料庫
- ✅ **視覺化管理**: 清楚看到匯出歷史和狀態
- ✅ **進度透明**: 即時顯示處理進度

### 系統效益
- ✅ **資料備份**: 定期匯出作為備份
- ✅ **資料遷移**: 方便跨業者/環境遷移
- ✅ **資料分析**: Excel 格式便於分析

### 開發效益
- ✅ **功能完整**: 匯入匯出功能對等
- ✅ **易於維護**: 結構清晰
- ✅ **可擴展**: 未來可新增更多格式

---

## 🚀 快速實作指南

### Step 1: 創建頁面組件（30 分鐘）
```bash
# 創建主頁面
touch knowledge-admin/frontend/src/views/KnowledgeExportView.vue

# 創建子組件
mkdir -p knowledge-admin/frontend/src/components/export
touch knowledge-admin/frontend/src/components/export/ExportConfigPanel.vue
touch knowledge-admin/frontend/src/components/export/ExportHistoryTable.vue
touch knowledge-admin/frontend/src/components/export/ExportStatistics.vue
```

### Step 2: 配置路由（5 分鐘）
```javascript
// src/router.js
import KnowledgeExportView from './views/KnowledgeExportView.vue';

routes: [
  // ...
  {
    path: '/knowledge-export',
    name: 'KnowledgeExport',
    component: KnowledgeExportView
  }
]
```

### Step 3: 新增導航（10 分鐘）
```vue
<!-- src/App.vue -->
<router-link to="/knowledge-export" class="nav-item">
  📤 知識匯出
</router-link>
```

### Step 4: 實現核心功能（3-4 小時）
1. 匯出設定面板 → 1 小時
2. 歷史列表 → 1.5 小時
3. API 整合 → 1 小時
4. 狀態追蹤 → 0.5 小時

### Step 5: 測試與優化（1 小時）
1. 功能測試
2. 視覺調整
3. 錯誤處理

**總預估時間**: 5-6 小時（1 個工作天）

---

## 📝 總結

### 現況
- ✅ **後端**: 完整實現，功能齊全
- ❌ **前端**: 完全缺失，無法使用

### 建議
- ⭐ **採用方案 A**: 獨立匯出頁面
- ⭐ **位置**: 資料工具區塊
- ⭐ **優先級**: 高（使用者強需求）

### 下一步
1. 創建 `KnowledgeExportView.vue`
2. 實現基礎匯出功能
3. 實現歷史列表
4. 新增導航連結
5. 完整測試

---

**文檔版本**: 1.0
**最後更新**: 2025-11-22
**維護者**: 開發團隊
**預估工作量**: 1-2 個工作天
