# 📚 部署文檔索引（2026-01-10）

> 本次更新的完整部署資源

---

## 📄 文檔清單

### 1. 完整部署文檔 ⭐
**檔案**：`PRODUCTION_DEPLOY_2026-01-10.md`

**適用對象**：首次部署或需要詳細說明的部署人員

**內容**：
- 詳細的更新內容摘要
- 完整的部署步驟說明
- 資料庫遷移詳解
- 功能驗證指南
- 常見問題排查
- 回滾步驟

**何時使用**：
- 第一次執行此版本部署
- 遇到問題需要詳細排查
- 需要了解每個步驟的具體原因

---

### 2. 快速部署指南 ⚡
**檔案**：`QUICK_DEPLOY_2026-01-10.md`

**適用對象**：熟悉部署流程的運維人員

**內容**：
- 5 步驟快速部署流程
- 精簡的檢查清單
- 快速故障排除
- 預估時間

**何時使用**：
- 已經熟悉部署流程
- 需要快速參考命令
- 緊急情況下的快速部署

---

### 3. 自動化部署腳本 🤖
**檔案**：`deploy_2026-01-10.sh`

**適用對象**：偏好自動化的運維人員

**內容**：
- 一鍵執行所有部署步驟
- 自動檢查和驗證
- 彩色輸出和進度提示
- 自動生成部署記錄

**使用方法**：
```bash
cd /path/to/AIChatbot
./deploy_2026-01-10.sh
```

**特色功能**：
- ✅ 自動前置檢查
- ✅ 可選資料庫備份
- ✅ 智能跳過已執行的遷移
- ✅ 自動驗證服務狀態
- ✅ 生成部署記錄

**何時使用**：
- 標準的生產環境部署
- 想要減少手動操作錯誤
- 需要自動化部署流程

---

### 4. 資料庫遷移文件
**位置**：`database/migrations/`

**檔案清單**：
- `create_form_tables.sql` - 建立表單資料表
- `verify_form_tables.sql` - 驗證表單資料表
- `create_digression_config.sql` - 建立離題檢測配置
- `add_form_submission_status.sql` - 新增表單狀態管理欄位（新增）

**何時使用**：
- 需要手動執行資料庫遷移
- 在測試環境驗證遷移腳本
- 排查資料庫相關問題

---

## 🚀 推薦部署流程

### 情境 1：生產環境首次部署此版本

**推薦方案**：使用自動化腳本 + 詳細文檔

1. 閱讀 `PRODUCTION_DEPLOY_2026-01-10.md` 了解更新內容
2. 執行 `./deploy_2026-01-10.sh` 進行自動化部署
3. 參考文檔進行功能驗證
4. 如遇問題，查閱文檔的故障排查章節

**優點**：
- 節省時間
- 減少錯誤
- 完整記錄

---

### 情境 2：測試環境驗證

**推薦方案**：手動執行 + 快速指南

1. 參考 `QUICK_DEPLOY_2026-01-10.md`
2. 手動執行每個步驟
3. 觀察每個步驟的輸出
4. 驗證所有功能

**優點**：
- 完全掌控
- 便於學習
- 易於調試

---

### 情境 3：緊急修復部署

**推薦方案**：快速指南

1. 直接參考 `QUICK_DEPLOY_2026-01-10.md`
2. 執行最少必要步驟
3. 快速驗證關鍵功能
4. 持續監控日誌

**優點**：
- 最快速度
- 精簡流程
- 聚焦關鍵

---

## 📊 部署流程對比

| 特性 | 自動化腳本 | 快速指南 | 完整文檔 |
|-----|----------|---------|---------|
| 執行時間 | 15-20 分鐘 | 20-30 分鐘 | 30-40 分鐘 |
| 適合對象 | 所有人 | 熟悉者 | 新手 |
| 錯誤風險 | 低 | 中 | 低 |
| 學習價值 | 中 | 高 | 最高 |
| 問題排查 | 中 | 中 | 高 |
| 自動記錄 | ✅ | ❌ | ❌ |
| 互動確認 | ✅ | ❌ | ❌ |

---

## 🎯 快速開始

### 如果你是...

#### 👉 第一次部署此版本
```bash
# 1. 先閱讀完整文檔了解變更
cat PRODUCTION_DEPLOY_2026-01-10.md

# 2. 使用自動化腳本部署
./deploy_2026-01-10.sh

# 3. 參考文檔進行驗證
```

#### 👉 熟悉部署流程的運維人員
```bash
# 直接使用快速指南
cat QUICK_DEPLOY_2026-01-10.md

# 或使用自動化腳本
./deploy_2026-01-10.sh
```

#### 👉 需要詳細了解每個步驟
```bash
# 閱讀完整文檔並手動執行
cat PRODUCTION_DEPLOY_2026-01-10.md
# 然後手動執行每個命令
```

---

## ⚠️ 重要提醒

### 部署前必讀
1. **備份資料庫**（強烈建議）
2. **確認在正確的服務器**
3. **檢查當前分支是 main**
4. **確認工作目錄乾淨**

### 資料庫遷移注意事項
- 遷移腳本具有冪等性（可重複執行）
- 如果表已存在，會自動跳過
- 如果遇到錯誤，可以安全重試

### 回滾準備
- 記錄當前版本：`git log --oneline -1`
- 如需回滾：`git checkout b03d649`
- 資料庫回滾：使用備份文件恢復

---

## 🔍 驗證檢查清單

部署完成後，請確認：

### 服務狀態
- [ ] 所有 Docker 容器運行正常
- [ ] 沒有服務在不斷重啟
- [ ] 日誌中沒有錯誤訊息

### 資料庫
- [ ] 表單相關資料表存在
- [ ] form_submissions 包含狀態欄位
- [ ] 索引正確建立

### 後端功能
- [ ] `/api/v1/forms` 端點可訪問
- [ ] `/api/v1/form-submissions` 端點可訪問
- [ ] API 文檔顯示新路由

### 前端功能
- [ ] 表單管理頁面可訪問
- [ ] 業者管理顯示「📋 表單」按鈕
- [ ] 業者表單頁面正常（無側邊欄）
- [ ] 狀態管理功能正常
- [ ] 搜尋和篩選功能正常

---

## 📞 獲取幫助

### 遇到問題時
1. **查看服務日誌**
   ```bash
   docker-compose -f docker-compose.prod.yml logs --tail=100 [service_name]
   ```

2. **參考故障排查章節**
   - 完整文檔：第 "🐛 常見問題排查" 章節
   - 快速指南：第 "🐛 快速故障排除" 章節

3. **檢查部署記錄**
   ```bash
   cat /tmp/deploy_record_*.txt | tail -30
   ```

4. **如無法解決，立即回滾**
   ```bash
   git checkout b03d649
   docker-compose -f docker-compose.prod.yml down
   docker-compose -f docker-compose.prod.yml build --no-cache
   docker-compose -f docker-compose.prod.yml up -d
   ```

---

## 📝 相關文檔

### 功能文檔
- `docs/features/FORM_MANAGEMENT_SYSTEM.md` - 表單管理系統說明
- `docs/testing/FORM_REVIEW_EDIT_TEST_REPORT.md` - 審核編輯功能測試報告
- `docs/testing/FORM_STATUS_NOTES_TEST_REPORT.md` - 狀態管理測試報告

### 設計文檔
- `docs/design/FORM_FILLING_*.md` - 表單填寫設計文檔系列

### 標準部署文檔
- `DEPLOY_CHECKLIST.md` - 標準部署檢查清單
- `PRODUCTION_DEPLOY.md` - 通用生產環境部署指南

---

## 🏷️ 版本資訊

**文檔版本**：2026-01-12（更新）
**適用 commit 範圍**：b03d649 ~ HEAD
**主要功能**：
- 動態表單收集系統
- 表單審核與編輯
- 表單狀態管理與備註
- 搜尋和篩選功能

**測試狀態**：✅ 已通過完整測試
**生產就緒**：✅ 可用於生產環境

### 最新更新（2026-01-12）
- ✅ 新增知識庫缺失欄位遷移（form_id, video_url, trigger_form_condition 等）
- ✅ 修復前端 sidebarCollapsed 錯誤
- ✅ 更新故障排除指南
- ✅ 歸檔舊版部署文件

---

**最後更新**：2026-01-12
**維護者**：Claude Code
