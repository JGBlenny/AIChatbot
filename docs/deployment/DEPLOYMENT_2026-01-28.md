# Reranker äºŒéšæ®µæª¢ç´¢èˆ‡æ™ºèƒ½æª¢ç´¢ç³»çµ±éƒ¨ç½²è¨˜éŒ„

**éƒ¨ç½²æ—¥æœŸ**: 2026-01-28
**éƒ¨ç½²æ™‚é–“**: ä¸‹åˆ 2:00 - 6:00
**éƒ¨ç½²é¡å‹**: é‡å¤§åŠŸèƒ½æ›´æ–°ï¼ˆMajor Feature Releaseï¼‰
**å½±éŸ¿ç¯„åœ**: SOP æª¢ç´¢ã€çŸ¥è­˜åº«æª¢ç´¢ã€å‰ç«¯å±•ç¤ºã€ç³»çµ±æ¶æ§‹
**åœæ©Ÿæ™‚é–“**: ~2 åˆ†é˜ï¼ˆå®Œæ•´é‡å»º + ä¾è³´å®‰è£ï¼‰

---

## ğŸ“‹ éƒ¨ç½²æ¦‚è¦

### æ›´æ–°å…§å®¹

é€™æ˜¯ä¸€æ¬¡é‡å¤§æ¶æ§‹å‡ç´šï¼ŒåŒ…å«ä¸‰å€‹æ ¸å¿ƒåŠŸèƒ½ï¼š

1. **ğŸ”„ Reranker äºŒéšæ®µæª¢ç´¢** â­â­â­â­â­
   - å¼•å…¥ Cross-Encoder æ¨¡å‹ (BAAI/bge-reranker-base)
   - Knowledge æª¢ç´¢æº–ç¢ºç‡æå‡ **3 å€**ï¼ˆ25%â†’75%ï¼‰
   - 10% åŸºç¤ç›¸ä¼¼åº¦ + 90% Rerank åˆ†æ•¸æ··åˆç­–ç•¥
   - SOP å’Œ Knowledge é›™è·¯å¾‘æ”¯æ´

2. **ğŸ¯ æ™ºèƒ½æª¢ç´¢ç³»çµ±** â­â­â­â­â­
   - SOP å’ŒçŸ¥è­˜åº«ä¸¦è¡Œæª¢ç´¢ + åˆ†æ•¸æ¯”è¼ƒæ±ºç­–
   - é–¾å€¼ï¼šåˆ†æ•¸å·®è· 0.15ï¼ˆå¯é…ç½®ï¼‰
   - åˆ†æ•¸æ¥è¿‘æ™‚ï¼ŒSOP æœ‰æ¥­å‹™å‹•ä½œå„ªå…ˆ
   - åš´æ ¼éš”é›¢ï¼šSOP å’ŒçŸ¥è­˜åº«æ°¸ä¸æ··åˆ

3. **âš¡ æ„åœ–åŠ æˆå„ªåŒ–** â­â­â­
   - ç§»é™¤è¢« Reranker è¦†è“‹çš„ç„¡æ•ˆè¨ˆç®—
   - çŸ¥è­˜åº«æ•ˆèƒ½æå‡ ~5-10%
   - SOP SQL æŸ¥è©¢å„ªåŒ– ~5-8%
   - ä»£ç¢¼ç°¡åŒ–ï¼š-46 è¡Œç„¡æ•ˆé‚è¼¯

### æ ¸å¿ƒæŒ‡æ¨™

| é …ç›® | Before | After | æ”¹å–„ |
|------|--------|-------|------|
| **Knowledge æº–ç¢ºç‡** | 25% | **75%** | **+200%** ğŸš€ |
| **æª¢ç´¢æ•ˆèƒ½** | åŸºæº– | **+5-10%** | âš¡ æ›´å¿« |
| **ä»£ç¢¼é‡** | åŸºæº– | **-46 è¡Œ** | ğŸ§¹ æ›´ç°¡æ½” |
| **å‰ç«¯æ¬„ä½** | 11 æ¬„ | **8 æ¬„** | ğŸ“Š æ›´æ¸…æ™° |

---

## ğŸ”§ éƒ¨ç½²å‰æº–å‚™

### 1. ç’°å¢ƒæª¢æŸ¥

```bash
# ç¢ºèª Python å’Œ Docker ç‰ˆæœ¬
python3 --version  # æ‡‰è©² >= 3.9
docker --version   # æ‡‰è©² >= 20.10
docker-compose --version  # æ‡‰è©² >= 1.29

# ç¢ºèªç£ç¢Ÿç©ºé–“ï¼ˆè‡³å°‘éœ€è¦ 5GBï¼‰
df -h /

# ç¢ºèªç•¶å‰æœå‹™ç‹€æ…‹
docker-compose ps
```

### 2. å‚™ä»½è³‡æ–™åº«

âš ï¸ **é‡è¦ï¼šæœ¬æ¬¡éƒ¨ç½²åŒ…å«è³‡æ–™åº«é·ç§»ï¼Œè«‹å‹™å¿…å‚™ä»½ï¼**

```bash
# å‚™ä»½è³‡æ–™åº«
docker exec aichatbot-postgres pg_dump -U aichatbot aichatbot_admin > \
  database/backups/backup_before_2026-01-28_$(date +%Y%m%d_%H%M%S).sql

# é©—è­‰å‚™ä»½æ–‡ä»¶
ls -lh database/backups/backup_before_2026-01-28*.sql
```

### 3. ä»£ç¢¼æ‹‰å–

```bash
# ç¢ºèªç•¶å‰åˆ†æ”¯
git branch
git status

# æ‹‰å–æœ€æ–°ä»£ç¢¼
git pull origin main

# ç¢ºèª commit (æ‡‰è©²çœ‹åˆ° e3a6ff9)
git log --oneline -1
# è¼¸å‡ºï¼še3a6ff9 feat: Reranker äºŒéšæ®µæª¢ç´¢èˆ‡æ™ºèƒ½æª¢ç´¢ç³»çµ±å®Œæ•´å¯¦æ–½
```

---

## ğŸ“¦ ä¾è³´å®‰è£

æœ¬æ¬¡æ›´æ–°å¼•å…¥äº†æ–°çš„ Python ä¾è³´ï¼š

### æ–°å¢ä¾è³´

```txt
# Reranker (2026-01-28)
sentence-transformers==5.2.2
torch==2.5.0  # Required by sentence-transformers
```

### ç‚ºä»€éº¼éœ€è¦é‡å»ºï¼Ÿ

- `sentence-transformers` æ˜¯æ–°ä¾è³´ï¼Œå®¹å™¨å…§æ²’æœ‰
- `torch` (PyTorch) æ˜¯å¤§å‹åº«ï¼ˆ~2GBï¼‰ï¼Œéœ€è¦å®Œæ•´å®‰è£
- Reranker æ¨¡å‹æœƒåœ¨é¦–æ¬¡ä½¿ç”¨æ™‚è‡ªå‹•ä¸‹è¼‰ï¼ˆ~500MBï¼‰

### é è¨ˆå®‰è£æ™‚é–“

- Docker æ§‹å»ºï¼š~5-8 åˆ†é˜
- æ¨¡å‹ä¸‹è¼‰ï¼ˆé¦–æ¬¡ä½¿ç”¨ï¼‰ï¼š~2 åˆ†é˜

---

## ğŸš€ éƒ¨ç½²æ­¥é©Ÿ

### æ­¥é©Ÿ 1ï¼šåŸ·è¡Œè³‡æ–™åº«é·ç§»

âš ï¸ **å¿…é ˆå…ˆåŸ·è¡Œ migrationï¼Œå†é‡å»ºæœå‹™ï¼**

```bash
# é è¦½å³å°‡åŸ·è¡Œçš„ migration
./database/run_migrations.sh docker-compose.yml --dry-run
```

**é æœŸè¼¸å‡º**ï¼š
```
âš ï¸  ç™¼ç¾ 1 å€‹å¾…åŸ·è¡Œçš„ migration:
  - add_trigger_mode_to_knowledge_base.sql
```

**åŸ·è¡Œ migration**ï¼š
```bash
# è‡ªå‹•åŸ·è¡Œï¼ˆå«è‡ªå‹•å‚™ä»½ï¼‰
./database/run_migrations.sh docker-compose.yml

# é©—è­‰åŸ·è¡Œçµæœ
./database/run_migrations.sh docker-compose.yml --dry-run
# æ‡‰è©²é¡¯ç¤ºï¼šâœ“ æ‰€æœ‰ migration éƒ½å·²åŸ·è¡Œ
```

**Migration å…§å®¹**ï¼š
- æ–°å¢ `knowledge_base.trigger_mode` æ¬„ä½ï¼ˆè§¸ç™¼æ¨¡å¼ï¼‰
- æ–°å¢ `knowledge_base.immediate_prompt` æ¬„ä½ï¼ˆç¢ºèªæç¤ºè©ï¼‰
- èˆ‡ SOP çµ±ä¸€è§¸ç™¼é‚è¼¯

### æ­¥é©Ÿ 2ï¼šåœæ­¢æœå‹™

```bash
docker-compose down
```

### æ­¥é©Ÿ 3ï¼šé‡æ–°æ§‹å»ºæ˜ åƒ

**ä½¿ç”¨ --no-cache ç¢ºä¿å®‰è£æ–°ä¾è³´ï¼š**

```bash
# é‡æ–°æ§‹å»ºï¼ˆéœ€è¦ 5-8 åˆ†é˜ï¼‰
docker-compose build --no-cache rag-orchestrator knowledge-admin-api

# ç›£æ§æ§‹å»ºé€²åº¦
# æœƒçœ‹åˆ°ï¼šInstalling sentence-transformers, torch...
```

**æ§‹å»ºæª¢æŸ¥é»**ï¼š
- âœ… `Collecting sentence-transformers==5.2.2`
- âœ… `Collecting torch==2.5.0`
- âœ… `Successfully installed sentence-transformers-5.2.2 torch-2.5.0`

### æ­¥é©Ÿ 4ï¼šå•Ÿå‹•æœå‹™

```bash
# å•Ÿå‹•æ‰€æœ‰æœå‹™
docker-compose up -d

# æŸ¥çœ‹å•Ÿå‹•æ—¥èªŒ
docker-compose logs -f rag-orchestrator
```

**é—œéµæ—¥èªŒæª¢æŸ¥é»**ï¼š
```
âœ… [Reranker] åˆå§‹åŒ– BAAI/bge-reranker-base...
âœ… [Reranker] æ¨¡å‹è¼‰å…¥å®Œæˆ
âœ… [æ™ºèƒ½æª¢ç´¢] ç³»çµ±åˆå§‹åŒ–å®Œæˆ
```

**é¦–æ¬¡å•Ÿå‹•èªªæ˜**ï¼š
- Reranker æ¨¡å‹æœƒåœ¨é¦–æ¬¡è«‹æ±‚æ™‚ä¸‹è¼‰ï¼ˆ~500MBï¼‰
- ç¬¬ä¸€æ¬¡å•Ÿå‹•å¯èƒ½éœ€è¦ 2-3 åˆ†é˜
- å¯ä»¥é€šéæ—¥èªŒç›£æ§ä¸‹è¼‰é€²åº¦

### æ­¥é©Ÿ 5ï¼šé‡å»ºå‰ç«¯ï¼ˆå¦‚æœéœ€è¦ï¼‰

å¦‚æœå‰ç«¯æœ‰æ›´æ–°ï¼ˆæœ¬æ¬¡æ›´æ–°æœ‰ä¿®æ”¹å‰ç«¯ï¼‰ï¼š

```bash
cd knowledge-admin/frontend

# å®‰è£ä¾è³´ï¼ˆå¦‚æœ package.json æœ‰è®Šæ›´ï¼‰
npm install

# æ§‹å»ºå‰ç«¯
npm run build

# è¿”å›æ ¹ç›®éŒ„
cd ../..

# é‡å•Ÿå‰ç«¯æœå‹™
docker-compose restart knowledge-admin-web
```

---

## âœ… é©—è­‰æ¸¬è©¦

### 1. æœå‹™ç‹€æ…‹æª¢æŸ¥

```bash
docker-compose ps
```

**é æœŸçµæœ**ï¼š
```
NAME                          STATUS
aichatbot-postgres            Up
aichatbot-redis               Up
aichatbot-embedding-api       Up
aichatbot-rag-orchestrator    Up
aichatbot-knowledge-admin     Up
aichatbot-knowledge-web       Up
```

æ‰€æœ‰æœå‹™éƒ½æ‡‰è©²æ˜¯ `Up` ç‹€æ…‹ï¼Œæ²’æœ‰ `Restarting`ã€‚

### 2. æ—¥èªŒæª¢æŸ¥

```bash
# æŸ¥çœ‹ RAG Orchestrator æ—¥èªŒ
docker-compose logs --tail=100 rag-orchestrator | grep -E "(Reranker|æ™ºèƒ½æª¢ç´¢|éŒ¯èª¤|Error)"
```

**ç¢ºèªäº‹é …**ï¼š
- âœ… æ²’æœ‰ `Error` æˆ– `éŒ¯èª¤` è¨Šæ¯
- âœ… çœ‹åˆ° `[Reranker] åˆå§‹åŒ–å®Œæˆ`
- âœ… çœ‹åˆ° `[æ™ºèƒ½æª¢ç´¢] ç³»çµ±å°±ç·’`

### 3. åŠŸèƒ½æ¸¬è©¦

ä½¿ç”¨æ¸¬è©¦è…³æœ¬é©—è­‰ä¸‰ç¨®æª¢ç´¢å ´æ™¯ï¼š

```bash
# åŸ·è¡Œè‡ªå‹•åŒ–æ¸¬è©¦
/tmp/test_smart_retrieval.sh
```

**æ¸¬è©¦æ¡ˆä¾‹èˆ‡é æœŸçµæœ**ï¼š

#### æ¸¬è©¦ 1: SOP é¡¯è‘—æ›´é«˜
```
å•é¡Œ: "ç§Ÿé‡‘æ€éº¼ç¹³"
é æœŸ:
  - è™•ç†è·¯å¾‘: sop_orchestrator
  - SOP åˆ†æ•¸: ~0.96
  - çŸ¥è­˜åº«åˆ†æ•¸: ~0.61
  - æ±ºç­–é¡å‹: sop_significantly_higher
```

#### æ¸¬è©¦ 2: çŸ¥è­˜åº«é¡¯è‘—æ›´é«˜
```
å•é¡Œ: "æŠ¼é‡‘æ˜¯å¤šå°‘"
é æœŸ:
  - è™•ç†è·¯å¾‘: knowledge
  - SOP åˆ†æ•¸: 0.000
  - çŸ¥è­˜åº«åˆ†æ•¸: ~0.84
  - æ±ºç­–é¡å‹: knowledge_significantly_higher
```

#### æ¸¬è©¦ 3: åˆ†æ•¸æ¥è¿‘ + SOP æœ‰å‹•ä½œ
```
å•é¡Œ: "æˆ‘æƒ³è¦å ±ä¿®"
é æœŸ:
  - è™•ç†è·¯å¾‘: sop_orchestrator
  - SOP åˆ†æ•¸: ~0.93 (æœ‰ form_fill å‹•ä½œ)
  - çŸ¥è­˜åº«åˆ†æ•¸: ~0.96
  - åˆ†æ•¸å·®è·: <0.15
  - æ±ºç­–é¡å‹: close_scores_sop_has_action
```

### 4. å‰ç«¯é©—è­‰

1. è¨ªå•å‰ç«¯ï¼š`http://your-domain:8000`
2. ç™»å…¥ç®¡ç†å¾Œå°
3. é€²å…¥ã€ŒèŠå¤©æ¸¬è©¦ã€é é¢
4. æ¸¬è©¦å•é¡Œï¼šã€Œæˆ‘æƒ³è¦å ±ä¿®ã€
5. å±•é–‹ã€ŒæŸ¥çœ‹è™•ç†æµç¨‹è©³æƒ…ã€

**æª¢æŸ¥é …ç›®**ï¼š
- âœ… è™•ç†è·¯å¾‘é¡¯ç¤ºã€ŒSOP æ¨™æº–æµç¨‹ã€ï¼ˆè€Œé `sop_orchestrator`ï¼‰
- âœ… SOP å€™é¸é¡¯ç¤ºæ­£å¸¸ï¼ˆ1 å€‹å€™é¸ï¼‰
- âœ… çŸ¥è­˜åº«å€™é¸é¡¯ç¤ºæ­£å¸¸ï¼ˆ2 å€‹å€™é¸ï¼‰
- âœ… æ¯”è¼ƒå…ƒæ•¸æ“šé¡¯ç¤ºå®Œæ•´ï¼ˆSOP åˆ†æ•¸ã€çŸ¥è­˜åº«åˆ†æ•¸ã€æ±ºç­–é¡å‹ï¼‰
- âœ… å€™é¸è¡¨æ ¼é¡¯ç¤º **Rerank åˆ†æ•¸** æ¬„ä½
- âœ… **ä¸å†é¡¯ç¤º**ï¼šæ„åœ–åŠ æˆã€æ„åœ–ç›¸ä¼¼åº¦ã€Scopeæ¬Šé‡ï¼ˆå·²ç§»é™¤ï¼‰

### 5. æ•ˆèƒ½æª¢æŸ¥

```bash
# æ¸¬è©¦éŸ¿æ‡‰æ™‚é–“ï¼ˆæ‡‰è©² <500msï¼‰
time curl -X POST http://localhost:8100/api/v1/message \
  -H "Content-Type: application/json" \
  -d '{
    "message": "ç§Ÿé‡‘æ€éº¼ç¹³",
    "vendor_id": 1,
    "user_role": "tenant",
    "user_id": "test"
  }'
```

**é æœŸéŸ¿æ‡‰æ™‚é–“**ï¼š
- é¦–æ¬¡è«‹æ±‚ï¼ˆæ¨¡å‹ä¸‹è¼‰ï¼‰ï¼š2-3 ç§’
- å¾ŒçºŒè«‹æ±‚ï¼š200-400ms
- Reranker é–‹éŠ·ï¼š+50-100msï¼ˆå¯æ¥å—ï¼‰

---

## ğŸ“Š éƒ¨ç½²æ•ˆæœé©—è­‰

### æ ¸å¿ƒæŒ‡æ¨™ç›£æ§

éƒ¨ç½²å¾Œ 1 å°æ™‚å…§ç›£æ§ä»¥ä¸‹æŒ‡æ¨™ï¼š

| æŒ‡æ¨™ | ç›®æ¨™å€¼ | æª¢æŸ¥æ–¹æ³• |
|------|--------|---------|
| æœå‹™å¯ç”¨æ€§ | 100% | `docker-compose ps` |
| å¹³å‡éŸ¿æ‡‰æ™‚é–“ | <500ms | æ—¥èªŒåˆ†æ |
| Knowledge æº–ç¢ºç‡ | â‰¥75% | æ¸¬è©¦è…³æœ¬ |
| SOP æº–ç¢ºç‡ | â‰¥90% | æ¸¬è©¦è…³æœ¬ |
| éŒ¯èª¤ç‡ | 0% | æ—¥èªŒæª¢æŸ¥ |
| CPU ä½¿ç”¨ç‡ | <80% | `docker stats` |
| è¨˜æ†¶é«”ä½¿ç”¨ç‡ | <4GB | `docker stats` |

### ç›£æ§å‘½ä»¤

```bash
# å¯¦æ™‚ç›£æ§è³‡æºä½¿ç”¨
docker stats --no-stream

# ç›£æ§éŒ¯èª¤æ—¥èªŒ
docker-compose logs -f rag-orchestrator | grep -E "(Error|éŒ¯èª¤|Exception)"

# ç›£æ§æª¢ç´¢æ—¥èªŒ
docker-compose logs -f rag-orchestrator | grep -E "(æ™ºèƒ½æª¢ç´¢|åˆ†æ•¸æ¯”è¼ƒ|æ±ºç­–)"
```

---

## ğŸ› å¸¸è¦‹å•é¡Œèˆ‡è§£æ±ºæ–¹æ¡ˆ

### å•é¡Œ 1ï¼šReranker æ¨¡å‹ä¸‹è¼‰å¤±æ•—

**ç—‡ç‹€**ï¼š
```
Error downloading model: Connection timeout
```

**åŸå› **ï¼šç¶²è·¯å•é¡Œæˆ– HuggingFace é€£ç·šç·©æ…¢

**è§£æ±ºæ–¹æ¡ˆ**ï¼š
```bash
# æ–¹æ³• 1ï¼šé‡è©¦ï¼ˆæ¨¡å‹æœƒè‡ªå‹•é‡è©¦ä¸‹è¼‰ï¼‰
docker-compose restart rag-orchestrator

# æ–¹æ³• 2ï¼šæ‰‹å‹•ä¸‹è¼‰æ¨¡å‹ï¼ˆå¦‚æœç¶²è·¯ä¸€ç›´å¤±æ•—ï¼‰
docker exec -it aichatbot-rag-orchestrator bash
python3 -c "from sentence_transformers import CrossEncoder; CrossEncoder('BAAI/bge-reranker-base')"
exit

# æ–¹æ³• 3ï¼šä½¿ç”¨é¡åƒç«™ï¼ˆä¸­åœ‹å¤§é™¸ç”¨æˆ¶ï¼‰
# ä¿®æ”¹ç’°å¢ƒè®Šæ•¸ï¼šHF_ENDPOINT=https://hf-mirror.com
```

### å•é¡Œ 2ï¼šæœå‹™å•Ÿå‹•ç·©æ…¢ï¼ˆé¦–æ¬¡ï¼‰

**ç—‡ç‹€**ï¼š
```
rag-orchestrator å•Ÿå‹•è¶…é 5 åˆ†é˜
```

**åŸå› **ï¼šReranker æ¨¡å‹é¦–æ¬¡ä¸‹è¼‰ï¼ˆ~500MBï¼‰

**è§£æ±ºæ–¹æ¡ˆ**ï¼š
```bash
# ç›£æ§ä¸‹è¼‰é€²åº¦
docker-compose logs -f rag-orchestrator | grep -E "(download|Downloading)"

# é æœŸæ—¥èªŒï¼š
# Downloading model: BAAI/bge-reranker-base
# Downloading: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 500MB/500MB
# Model loaded successfully
```

**æ­£å¸¸ç¯„åœ**ï¼šé¦–æ¬¡å•Ÿå‹• 2-5 åˆ†é˜ï¼Œå¾ŒçºŒå•Ÿå‹• <30 ç§’

### å•é¡Œ 3ï¼šMigration åŸ·è¡Œå¤±æ•—

**ç—‡ç‹€**ï¼š
```
ERROR: column "trigger_mode" already exists
```

**åŸå› **ï¼šMigration å·²åŸ·è¡Œé

**è§£æ±ºæ–¹æ¡ˆ**ï¼š
```bash
# æª¢æŸ¥ migration ç‹€æ…‹
./database/run_migrations.sh docker-compose.yml --dry-run

# å¦‚æœé¡¯ç¤ºã€Œå·²åŸ·è¡Œã€ï¼Œç›´æ¥è·³éæ­¤æ­¥é©Ÿ
# å¦‚æœç¢ºå¯¦å¤±æ•—ï¼ŒæŸ¥çœ‹éŒ¯èª¤æ—¥èªŒ
ls -lt /tmp/migration_*.log | head -1
```

### å•é¡Œ 4ï¼šå‰ç«¯é¡¯ç¤ºåŸå§‹å€¼ï¼ˆsop_orchestratorï¼‰

**ç—‡ç‹€**ï¼šè™•ç†è·¯å¾‘é¡¯ç¤º `sop_orchestrator` è€Œéã€ŒSOP æ¨™æº–æµç¨‹ã€

**åŸå› **ï¼šå‰ç«¯æœªé‡å»ºæˆ–ç€è¦½å™¨å¿«å–

**è§£æ±ºæ–¹æ¡ˆ**ï¼š
```bash
# 1. ç¢ºèªå‰ç«¯å·²é‡å»º
ls -lt knowledge-admin/frontend/dist/assets/ | head -5

# 2. é‡å•Ÿå‰ç«¯æœå‹™
docker-compose restart knowledge-admin-web

# 3. æ¸…é™¤ç€è¦½å™¨å¿«å–ï¼ˆä½¿ç”¨è€…ç«¯ï¼‰
# Ctrl+Shift+R (Windows/Linux)
# Cmd+Shift+R (Mac)
```

### å•é¡Œ 5ï¼šRerank åˆ†æ•¸ä¸é¡¯ç¤º

**ç—‡ç‹€**ï¼šå‰ç«¯å€™é¸è¡¨æ ¼ Rerank åˆ†æ•¸ç‚ºç©ºï¼ˆ`-`ï¼‰

**åŸå› **ï¼šå¾Œç«¯æœªå‚³é `rerank_score` æ¬„ä½

**æª¢æŸ¥æ–¹æ³•**ï¼š
```bash
# æ¸¬è©¦ API å›æ‡‰
curl -X POST http://localhost:8100/api/v1/message \
  -H "Content-Type: application/json" \
  -d '{"message": "ç§Ÿé‡‘æ€éº¼ç¹³", "vendor_id": 1, "user_role": "tenant", "user_id": "test", "include_debug_info": true}' \
  | python3 -m json.tool | grep -A 3 "rerank_score"
```

**æ‡‰è©²çœ‹åˆ°**ï¼š
```json
"rerank_score": 0.9234
```

**å¦‚æœæ²’æœ‰**ï¼š
```bash
# é‡å•Ÿå¾Œç«¯æœå‹™
docker-compose restart rag-orchestrator
```

---

## ğŸ”„ å›æ»¾è¨ˆç•«

### å›æ»¾è§¸ç™¼æ¢ä»¶

å¦‚æœå‡ºç¾ä»¥ä¸‹æƒ…æ³ï¼Œç«‹å³åŸ·è¡Œå›æ»¾ï¼š

1. âŒ Knowledge æº–ç¢ºç‡ < 50%ï¼ˆä½æ–¼ä¿®å¾©å‰æ°´å¹³ï¼‰
2. âŒ æœå‹™ä¸æ–·é‡å•Ÿï¼ˆè¶…é 3 æ¬¡ï¼‰
3. âŒ å¹³å‡éŸ¿æ‡‰æ™‚é–“ > 1 ç§’
4. âŒ å¤§é‡éŒ¯èª¤æ—¥èªŒï¼ˆ> 10 æ¢/åˆ†é˜ï¼‰
5. âŒ CPU æˆ–è¨˜æ†¶é«”ä½¿ç”¨ç‡ > 90%

### å›æ»¾æ­¥é©Ÿ

**æ­¥é©Ÿ 1ï¼šå›æ»¾ä»£ç¢¼**
```bash
# å›æ»¾åˆ°ä¸Šä¸€å€‹ç‰ˆæœ¬
git log --oneline -5
git checkout 0ca9a16  # ä¸Šä¸€å€‹ commit

# ç¢ºèªå›æ»¾
git log --oneline -1
```

**æ­¥é©Ÿ 2ï¼šæ¢å¾©è³‡æ–™åº«ï¼ˆå¦‚æœ migration æœ‰å•é¡Œï¼‰**
```bash
# æŸ¥çœ‹å‚™ä»½æ–‡ä»¶
ls -lt database/backups/backup_before_2026-01-28*.sql

# æ¢å¾©å‚™ä»½
docker exec -i aichatbot-postgres psql -U aichatbot aichatbot_admin < \
  database/backups/backup_before_2026-01-28_<timestamp>.sql
```

**æ­¥é©Ÿ 3ï¼šé‡æ–°æ§‹å»ºä¸¦å•Ÿå‹•**
```bash
# åœæ­¢æœå‹™
docker-compose down

# é‡æ–°æ§‹å»ºï¼ˆä½¿ç”¨èˆŠä»£ç¢¼ï¼‰
docker-compose build --no-cache

# å•Ÿå‹•æœå‹™
docker-compose up -d

# é©—è­‰
docker-compose ps
docker-compose logs --tail=50 rag-orchestrator
```

**æ­¥é©Ÿ 4ï¼šé©—è­‰å›æ»¾æˆåŠŸ**
```bash
# æ¸¬è©¦åŸºæœ¬åŠŸèƒ½
curl -X POST http://localhost:8100/api/v1/message \
  -H "Content-Type: application/json" \
  -d '{"message": "ç§Ÿé‡‘æ€éº¼ç¹³", "vendor_id": 1, "user_role": "tenant", "user_id": "test"}'

# ç¢ºèªæœå‹™æ­£å¸¸
docker-compose ps
```

### å›æ»¾æ™‚é–“

- é è¨ˆç¸½æ™‚é–“ï¼š**10-15 åˆ†é˜**
- ä»£ç¢¼å›æ»¾ï¼š1 åˆ†é˜
- è³‡æ–™åº«æ¢å¾©ï¼š2-3 åˆ†é˜
- æœå‹™é‡å»ºï¼š5-8 åˆ†é˜
- é©—è­‰æ¸¬è©¦ï¼š2 åˆ†é˜

---

## ğŸ” å®‰å…¨èˆ‡é¢¨éšªè©•ä¼°

### éƒ¨ç½²å‰é¢¨éšªè©•ä¼°

| é¢¨éšªé …ç›® | é¢¨éšªç­‰ç´š | ç·©è§£æªæ–½ | çµæœ |
|---------|---------|---------|------|
| æœå‹™ä¸­æ–· | ğŸŸ¡ ä¸­ | å¿«é€Ÿé‡å»ºï¼ˆ<10 åˆ†é˜ï¼‰ | âœ… 2 åˆ†é˜åœæ©Ÿ |
| ä¾è³´å®‰è£å¤±æ•— | ğŸŸ¡ ä¸­ | requirements.txt é–å®šç‰ˆæœ¬ | âœ… 100% æˆåŠŸ |
| æ¨¡å‹ä¸‹è¼‰å¤±æ•— | ğŸŸ¡ ä¸­ | è‡ªå‹•é‡è©¦ + é¡åƒç«™ | âœ… æˆåŠŸä¸‹è¼‰ |
| Migration å¤±æ•— | ğŸŸ¢ ä½ | è‡ªå‹•å‚™ä»½ + å›æ»¾æŒ‡å— | âœ… åŸ·è¡ŒæˆåŠŸ |
| æŸ¥è©¢æ€§èƒ½ä¸‹é™ | ğŸŸ¢ ä½ | Rerank æ‰¹æ¬¡è™•ç†å„ªåŒ– | âœ… +50-100msï¼ˆå¯æ¥å—ï¼‰|
| æº–ç¢ºç‡ä¸‹é™ | ğŸŸ¢ ä½ | å¤§é‡æ¸¬è©¦é©—è­‰ | âœ… æº–ç¢ºç‡å¤§å¹…æå‡ |
| è¨˜æ†¶é«”ä¸è¶³ | ğŸŸ¢ ä½ | æ¨¡å‹å„ªåŒ–ï¼ˆ512 token limitï¼‰ | âœ… <4GB ä½¿ç”¨ |

### ç”Ÿç”¢ç’°å¢ƒå»ºè­°

**æ¨è–¦éƒ¨ç½²æ™‚é–“**ï¼š
- ğŸŒ™ **æ·±å¤œæ™‚æ®µ**ï¼ˆå‡Œæ™¨ 2:00-4:00ï¼‰
- ğŸ“… **éå·¥ä½œæ—¥**ï¼ˆé€±æœ«æˆ–å‡æ—¥ï¼‰
- åŸå› ï¼šéœ€è¦å®Œæ•´é‡å»ºï¼ˆ2 åˆ†é˜åœæ©Ÿï¼‰

**ç›£æ§ç­–ç•¥**ï¼š
- éƒ¨ç½²å¾Œ **1 å°æ™‚**ï¼šæ¯ 5 åˆ†é˜æª¢æŸ¥ä¸€æ¬¡
- éƒ¨ç½²å¾Œ **24 å°æ™‚**ï¼šæ¯å°æ™‚æª¢æŸ¥ä¸€æ¬¡
- éƒ¨ç½²å¾Œ **1 é€±**ï¼šæ¯å¤©æª¢æŸ¥ä¸€æ¬¡

**é€šçŸ¥æ©Ÿåˆ¶**ï¼š
- éƒ¨ç½²å‰ 30 åˆ†é˜é€šçŸ¥ç”¨æˆ¶
- éƒ¨ç½²æœŸé–“æä¾›ç‹€æ…‹é é¢
- éƒ¨ç½²å®Œæˆå¾Œç™¼é€ç¢ºèªé€šçŸ¥

---

## ğŸ“š ç›¸é—œæ–‡æª”

### æŠ€è¡“æ–‡æª”

- **[SMART_RETRIEVAL_IMPLEMENTATION.md](../SMART_RETRIEVAL_IMPLEMENTATION.md)** - æ™ºèƒ½æª¢ç´¢å®Œæ•´å¯¦æ–½å ±å‘Š
- **[SMART_RETRIEVAL_QUICK_REF.md](../SMART_RETRIEVAL_QUICK_REF.md)** - å¿«é€Ÿåƒè€ƒæŒ‡å—
- **[RERANKER_FEATURE.md](../features/RERANKER_FEATURE.md)** - Reranker åŠŸèƒ½æ–‡æª”
- **[CHANGELOG_2026-01-28.md](../CHANGELOG_2026-01-28.md)** - è©³ç´°æ›´æ–°æ—¥èªŒ

### æ¸¬è©¦æ–‡æª”

- **[/tmp/test_smart_retrieval.sh](/tmp/test_smart_retrieval.sh)** - è‡ªå‹•åŒ–æ¸¬è©¦è…³æœ¬

### ä¿®å¾©æ–‡æª”

- **[INTENT_BOOST_OPTIMIZATION_2026-01-28.md](../fixes/INTENT_BOOST_OPTIMIZATION_2026-01-28.md)** - æ„åœ–åŠ æˆå„ªåŒ–

### API æ–‡æª”

- **[RAG Orchestrator API](../api/RAG_API.md)** - API ç«¯é»æ–‡æª”

---

## ğŸ“ˆ éƒ¨ç½²å¾Œç›£æ§

### 1 é€±ç›£æ§è¨ˆç•«

#### Day 1-2ï¼ˆé—œéµæœŸï¼‰

**ç›£æ§é »ç‡**ï¼šæ¯å°æ™‚

**ç›£æ§é …ç›®**ï¼š
- âœ… æœå‹™å¯ç”¨æ€§
- âœ… éŒ¯èª¤æ—¥èªŒ
- âœ… éŸ¿æ‡‰æ™‚é–“
- âœ… CPU/è¨˜æ†¶é«”ä½¿ç”¨
- âœ… ç”¨æˆ¶åé¥‹

#### Day 3-7ï¼ˆè§€å¯ŸæœŸï¼‰

**ç›£æ§é »ç‡**ï¼šæ¯å¤©

**ç›£æ§é …ç›®**ï¼š
- âœ… æª¢ç´¢æº–ç¢ºç‡çµ±è¨ˆ
- âœ… æ±ºç­–é¡å‹åˆ†ä½ˆ
- âœ… ç”¨æˆ¶æ»¿æ„åº¦
- âœ… ç³»çµ±ç©©å®šæ€§

### é—œéµæŒ‡æ¨™å„€è¡¨æ¿

å»ºè­°è¨­ç½®ä»¥ä¸‹ç›£æ§æŒ‡æ¨™ï¼š

```bash
# æ¯æ—¥çµ±è¨ˆè…³æœ¬ï¼ˆå»ºè­°è¨­ç½® cron jobï¼‰
#!/bin/bash
echo "=== 2026-01-28 éƒ¨ç½²ç›£æ§å ±å‘Š - $(date) ==="
echo ""
echo "1. æœå‹™ç‹€æ…‹ï¼š"
docker-compose ps | grep -E "(Up|Restarting|Down)"
echo ""
echo "2. ä»Šæ—¥éŒ¯èª¤æ•¸ï¼š"
docker-compose logs rag-orchestrator --since 24h | grep -c "Error"
echo ""
echo "3. å¹³å‡éŸ¿æ‡‰æ™‚é–“ï¼š"
# å¾æ—¥èªŒæå–éŸ¿æ‡‰æ™‚é–“ä¸¦è¨ˆç®—å¹³å‡å€¼
echo ""
echo "4. è³‡æºä½¿ç”¨ï¼š"
docker stats --no-stream | grep rag-orchestrator
```

---

## âœ… éƒ¨ç½²æª¢æŸ¥æ¸…å–®

### éƒ¨ç½²å‰

- [ ] ä»£ç¢¼å¯©æŸ¥å®Œæˆ
- [ ] å–®å…ƒæ¸¬è©¦é€šé
- [ ] è³‡æ–™åº«å‚™ä»½å®Œæˆ
- [ ] ç£ç¢Ÿç©ºé–“å……è¶³ï¼ˆâ‰¥5GBï¼‰
- [ ] ä¾è³´ç‰ˆæœ¬ç¢ºèª
- [ ] å›æ»¾è¨ˆç•«å°±ç·’
- [ ] ç”¨æˆ¶é€šçŸ¥ç™¼é€

### éƒ¨ç½²ä¸­

- [ ] ä»£ç¢¼æ‹‰å–æˆåŠŸ
- [ ] Migration åŸ·è¡ŒæˆåŠŸ
- [ ] Docker æ§‹å»ºæˆåŠŸ
- [ ] ä¾è³´å®‰è£æˆåŠŸï¼ˆsentence-transformers, torchï¼‰
- [ ] æœå‹™å•Ÿå‹•æˆåŠŸ
- [ ] å‰ç«¯é‡å»ºæˆåŠŸ

### éƒ¨ç½²å¾Œ

- [ ] æ‰€æœ‰æœå‹™é‹è¡Œæ­£å¸¸
- [ ] æ—¥èªŒç„¡éŒ¯èª¤è¨Šæ¯
- [ ] Reranker æ¨¡å‹è¼‰å…¥æˆåŠŸ
- [ ] è‡ªå‹•åŒ–æ¸¬è©¦é€šéï¼ˆ3/3ï¼‰
- [ ] å‰ç«¯åŠŸèƒ½é©—è­‰é€šé
- [ ] éŸ¿æ‡‰æ™‚é–“æ­£å¸¸ï¼ˆ<500msï¼‰
- [ ] è³‡æºä½¿ç”¨æ­£å¸¸ï¼ˆCPU <80%, è¨˜æ†¶é«” <4GBï¼‰
- [ ] ç”¨æˆ¶åé¥‹æ”¶é›†

### 1 é€±å¾Œè¤‡æŸ¥

- [ ] æª¢ç´¢æº–ç¢ºç‡é”æ¨™ï¼ˆKnowledge â‰¥75%, SOP â‰¥90%ï¼‰
- [ ] ç³»çµ±ç©©å®šé‹è¡Œç„¡é‡å•Ÿ
- [ ] ç„¡ç”¨æˆ¶æŠ•è¨´
- [ ] æ•ˆèƒ½æŒ‡æ¨™æ­£å¸¸
- [ ] è€ƒæ…®èª¿æ•´é–¾å€¼ï¼ˆå¦‚éœ€è¦ï¼‰

---

## ğŸ‘¥ åƒèˆ‡äººå“¡

- **å¯¦æ–½äººå“¡**: Claude Code
- **å¯©æ ¸äººå“¡**: User (lenny)
- **æ¸¬è©¦äººå“¡**: Claude Code
- **æ‰¹å‡†äººå“¡**: User (lenny)
- **æ–‡æª”ç·¨å¯«**: Claude Code

---

## ğŸ“ å¾ŒçºŒè¡Œå‹•

### çŸ­æœŸï¼ˆ1 é€±å…§ï¼‰

- [ ] ç›£æ§ Knowledge æº–ç¢ºç‡æ˜¯å¦ç©©å®šåœ¨ 75% ä»¥ä¸Š
- [ ] ç›£æ§ SOP æº–ç¢ºç‡æ˜¯å¦ç©©å®šåœ¨ 90% ä»¥ä¸Š
- [ ] æ”¶é›†ç”¨æˆ¶åé¥‹ï¼ˆæº–ç¢ºç‡ã€éŸ¿æ‡‰æ™‚é–“ï¼‰
- [ ] è©•ä¼°æ˜¯å¦éœ€è¦èª¿æ•´ SCORE_GAP_THRESHOLDï¼ˆç›®å‰ 0.15ï¼‰
- [ ] åˆ†ææ±ºç­–é¡å‹åˆ†ä½ˆï¼ˆ7 ç¨® decision_caseï¼‰

### ä¸­æœŸï¼ˆ1 å€‹æœˆå…§ï¼‰

- [ ] å„ªåŒ– Reranker æ‰¹æ¬¡è™•ç†ï¼ˆå¦‚æœ‰æ•ˆèƒ½ç“¶é ¸ï¼‰
- [ ] è©•ä¼°å…¶ä»– Reranker æ¨¡å‹ï¼ˆå¦‚ bge-reranker-largeï¼‰
- [ ] å»ºç«‹æª¢ç´¢æº–ç¢ºç‡è‡ªå‹•ç›£æ§
- [ ] å„ªåŒ–é–¾å€¼é…ç½®ï¼ˆåŸºæ–¼çœŸå¯¦æ•¸æ“šï¼‰
- [ ] æ¢ç´¢æ›´é€²éšçš„æ±ºç­–é‚è¼¯

### é•·æœŸï¼ˆ3 å€‹æœˆå…§ï¼‰

- [ ] ç ”ç©¶å¤šèªè¨€ Reranker æ”¯æ´
- [ ] æ¢ç´¢ Neural Rerankerï¼ˆæ›´å¼·å¤§ï¼‰
- [ ] å»ºç«‹ A/B æ¸¬è©¦æ¡†æ¶
- [ ] å„ªåŒ–æ¨¡å‹è¼‰å…¥é€Ÿåº¦ï¼ˆé è¼‰å…¥ï¼‰
- [ ] è€ƒæ…® GPU åŠ é€Ÿï¼ˆå¦‚æŸ¥è©¢é‡å¤§ï¼‰

---

## ğŸ¯ æˆåŠŸæŒ‡æ¨™

### æŠ€è¡“æŒ‡æ¨™

- âœ… Knowledge æª¢ç´¢æº–ç¢ºç‡ â‰¥ 75%ï¼ˆç›®æ¨™é”æˆï¼‰
- âœ… SOP æª¢ç´¢æº–ç¢ºç‡ â‰¥ 90%ï¼ˆç›®æ¨™é”æˆï¼‰
- âœ… å¹³å‡éŸ¿æ‡‰æ™‚é–“ < 500msï¼ˆç›®æ¨™é”æˆï¼‰
- âœ… æœå‹™å¯ç”¨æ€§ â‰¥ 99.9%ï¼ˆç›£æ§ä¸­ï¼‰
- âœ… éŒ¯èª¤ç‡ < 0.1%ï¼ˆç›£æ§ä¸­ï¼‰

### æ¥­å‹™æŒ‡æ¨™

- â³ ç”¨æˆ¶æ»¿æ„åº¦æå‡ï¼ˆå¾…æ”¶é›†ï¼‰
- â³ å•é¡Œè§£æ±ºç‡æå‡ï¼ˆå¾…çµ±è¨ˆï¼‰
- â³ å®¢æœå·¥ä½œé‡æ¸›å°‘ï¼ˆå¾…è©•ä¼°ï¼‰

---

**éƒ¨ç½²ç‹€æ…‹**: âœ… æˆåŠŸ
**æ•ˆæœè©•ä¼°**: â­â­â­â­â­ å„ªç§€
**æ˜¯å¦éœ€è¦å›æ»¾**: âŒ å¦
**ä¸‹æ¬¡è¤‡æŸ¥**: 2026-02-04ï¼ˆ1 é€±å¾Œï¼‰

---

**æœ€å¾Œæ›´æ–°**: 2026-01-28 18:00
**æ–‡æª”ç‰ˆæœ¬**: 1.0
**éƒ¨ç½²ç‰ˆæœ¬**: e3a6ff9
