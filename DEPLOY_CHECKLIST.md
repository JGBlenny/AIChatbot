# ğŸš€ æ¨™æº–éƒ¨ç½²æª¢æŸ¥æ¸…å–®

> **é‡è¦**ï¼šæ¯æ¬¡éƒ¨ç½²éƒ½å¿…é ˆæŒ‰ç…§æ­¤æ¸…å–®åŸ·è¡Œï¼Œä¸è¦è·³éä»»ä½•æ­¥é©Ÿ

## âœ… éƒ¨ç½²å‰æª¢æŸ¥

### 1. ä»£ç¢¼æª¢æŸ¥
```bash
# åœ¨æœå‹™å™¨ä¸ŠåŸ·è¡Œ
cd /path/to/AIChatbot
git status
git log --oneline -5
```

**æª¢æŸ¥é …ç›®ï¼š**
- [ ] ç•¶å‰åˆ†æ”¯æ˜¯ `main`
- [ ] å·¥ä½œç›®éŒ„ä¹¾æ·¨ï¼ˆæ²’æœ‰æœªæäº¤çš„ä¿®æ”¹ï¼‰
- [ ] æŸ¥çœ‹æœ€è¿‘ 5 å€‹æäº¤ï¼Œç¢ºèªè¦éƒ¨ç½²çš„æ›´æ–°

---

## ğŸ“¦ éƒ¨ç½²æ­¥é©Ÿ

### æ­¥é©Ÿ 1ï¼šæ‹‰å–æœ€æ–°ä»£ç¢¼
```bash
git pull origin main
```

**é æœŸçµæœï¼š**
- çœ‹åˆ° "Already up to date" æˆ–é¡¯ç¤ºæ‹‰å–çš„æ–‡ä»¶åˆ—è¡¨
- æ²’æœ‰åˆä½µè¡çª

---

### æ­¥é©Ÿ 2ï¼šæª¢æŸ¥æ˜¯å¦éœ€è¦é‡æ–°æ§‹å»ºå‰ç«¯

**åˆ¤æ–·æ¨™æº–ï¼š**
- å¦‚æœ `knowledge-admin/frontend/src/` ä¸‹çš„æ–‡ä»¶æœ‰è®Šæ›´ â†’ éœ€è¦
- å¦‚æœåªæœ‰å¾Œç«¯æˆ–é…ç½®è®Šæ›´ â†’ ä¸éœ€è¦

**éœ€è¦é‡æ–°æ§‹å»ºæ™‚åŸ·è¡Œï¼ˆæœ¬åœ°ï¼‰ï¼š**
```bash
cd knowledge-admin/frontend
npm install
npm run build
```

**ä¸Šå‚³ dist åˆ°æœå‹™å™¨ï¼š**
```bash
rsync -avz --progress --delete \
  knowledge-admin/frontend/dist/ \
  user@server:/path/to/AIChatbot/knowledge-admin/frontend/dist/
```

**æª¢æŸ¥é …ç›®ï¼š**
- [ ] dist ç›®éŒ„å·²ä¸Šå‚³
- [ ] æ²’æœ‰ä¸Šå‚³éŒ¯èª¤

---

### æ­¥é©Ÿ 3ï¼šæª¢æŸ¥ Dockerfile æ˜¯å¦è®Šæ›´

```bash
git diff HEAD~1 knowledge-admin/backend/Dockerfile
```

**å¦‚æœ Dockerfile æœ‰è®Šæ›´ â†’ éœ€è¦é‡æ–°æ§‹å»º**

---

### æ­¥é©Ÿ 4ï¼šæ±ºå®šéƒ¨ç½²ç­–ç•¥

| è®Šæ›´é¡å‹ | éœ€è¦é‡æ–°æ§‹å»º | åªéœ€é‡å•Ÿ |
|---------|------------|---------|
| å‰ç«¯æ–‡ä»¶ï¼ˆ.vue, .jsï¼‰ | âœ… æ˜¯ | âŒ å¦ |
| Dockerfile | âœ… æ˜¯ | âŒ å¦ |
| requirements.txt | âœ… æ˜¯ | âŒ å¦ |
| å¾Œç«¯ Python æ–‡ä»¶ï¼ˆé–‹ç™¼ç’°å¢ƒæ›è¼‰ï¼‰ | âŒ å¦ | âœ… æ˜¯ |
| é…ç½®æ–‡ä»¶ï¼ˆdocker-compose.ymlï¼‰ | âŒ å¦ | âœ… æ˜¯ |

**é¸æ“‡åŸ·è¡Œï¼š**

#### æ–¹æ¡ˆ Aï¼šå®Œæ•´é‡æ–°æ§‹å»ºï¼ˆæœ‰ Dockerfile æˆ–ä¾è³´è®Šæ›´ï¼‰
```bash
cd /path/to/AIChatbot
docker-compose -f docker-compose.prod.yml down
docker-compose -f docker-compose.prod.yml build --no-cache
docker-compose -f docker-compose.prod.yml up -d
```

#### æ–¹æ¡ˆ Bï¼šé‡å•Ÿæœå‹™ï¼ˆåªæœ‰ä»£ç¢¼è®Šæ›´ï¼Œé–‹ç™¼ç’°å¢ƒï¼‰
```bash
docker-compose -f docker-compose.prod.yml restart knowledge-admin-api
docker-compose -f docker-compose.prod.yml restart knowledge-admin-web
```

**æª¢æŸ¥é …ç›®ï¼š**
- [ ] åŸ·è¡Œäº†æ­£ç¢ºçš„æ–¹æ¡ˆ
- [ ] å‘½ä»¤æ²’æœ‰éŒ¯èª¤

---

### æ­¥é©Ÿ 5ï¼šé©—è­‰éƒ¨ç½²

#### 5.1 æª¢æŸ¥æœå‹™ç‹€æ…‹
```bash
docker-compose -f docker-compose.prod.yml ps
```

**é æœŸçµæœï¼š**
- æ‰€æœ‰æœå‹™ç‹€æ…‹éƒ½æ˜¯ `Up`
- æ²’æœ‰æœå‹™åœ¨ `Restarting`

**å¦‚æœæœ‰æœå‹™åœ¨é‡å•Ÿï¼ŒåŸ·è¡Œï¼š**
```bash
docker-compose -f docker-compose.prod.yml logs --tail=50 [service_name]
```

#### 5.2 æª¢æŸ¥ API å¥åº·
```bash
curl -s http://localhost:8000/docs | grep "FastAPI" || echo "API æœªæ­£å¸¸é‹è¡Œ"
```

**é æœŸçµæœï¼š**
- çœ‹åˆ° "FastAPI" å­—æ¨£

#### 5.3 æª¢æŸ¥å‰ç«¯
```bash
curl -s http://localhost:80 | grep "<!DOCTYPE html>" || echo "å‰ç«¯æœªæ­£å¸¸é‹è¡Œ"
```

**é æœŸçµæœï¼š**
- çœ‹åˆ° HTML å…§å®¹

#### 5.4 æ¸¬è©¦ç™»å…¥
- è¨ªå•ï¼š`http://your-domain` æˆ– `http://your-server-ip`
- ä½¿ç”¨ç®¡ç†å“¡å¸³è™Ÿç™»å…¥
- æª¢æŸ¥æ›´æ–°çš„åŠŸèƒ½æ˜¯å¦æ­£å¸¸

**æª¢æŸ¥é …ç›®ï¼š**
- [ ] æ‰€æœ‰æœå‹™æ­£å¸¸é‹è¡Œ
- [ ] API å¯è¨ªå•
- [ ] å‰ç«¯å¯è¨ªå•
- [ ] å¯ä»¥ç™»å…¥
- [ ] æ–°åŠŸèƒ½æ­£å¸¸

---

## ğŸš¨ å¸¸è¦‹å•é¡Œè™•ç†

### å•é¡Œ 1ï¼šæœå‹™ä¸æ–·é‡å•Ÿ
```bash
# æŸ¥çœ‹æ—¥èªŒ
docker-compose -f docker-compose.prod.yml logs --tail=100 [service_name]
```

**å¸¸è¦‹åŸå› ï¼š**
- ç¼ºå°‘ Python æ¨¡çµ„ â†’ éœ€è¦é‡æ–°æ§‹å»º
- é…ç½®éŒ¯èª¤ â†’ æª¢æŸ¥ç’°å¢ƒè®Šæ•¸
- æ•¸æ“šåº«é€£æ¥å¤±æ•— â†’ æª¢æŸ¥æ•¸æ“šåº«æœå‹™

### å•é¡Œ 2ï¼šå‰ç«¯é¡¯ç¤ºèˆŠç‰ˆæœ¬
```bash
# å¼·åˆ¶é‡å•Ÿä¸¦æ¸…é™¤ç€è¦½å™¨ç·©å­˜
docker-compose -f docker-compose.prod.yml restart knowledge-admin-web
# åœ¨ç€è¦½å™¨æŒ‰ Ctrl+Shift+R å¼·åˆ¶åˆ·æ–°
```

### å•é¡Œ 3ï¼šAPI å›æ‡‰ 404
```bash
# æª¢æŸ¥è·¯ç”±æ–‡ä»¶æ˜¯å¦å­˜åœ¨
docker-compose -f docker-compose.prod.yml exec knowledge-admin-api ls -la /app/routes_*.py
```

**å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ â†’ Dockerfile æ²’æœ‰æ­£ç¢ºè¤‡è£½**

---

## ğŸ“‹ éƒ¨ç½²å¾Œæª¢æŸ¥

### å¿…åšæª¢æŸ¥
- [ ] æ‰€æœ‰æœå‹™ç‹€æ…‹æ­£å¸¸
- [ ] å¯ä»¥ç™»å…¥ç³»çµ±
- [ ] æ¸¬è©¦æœ¬æ¬¡æ›´æ–°çš„åŠŸèƒ½
- [ ] æŸ¥çœ‹éŒ¯èª¤æ—¥èªŒï¼ˆå¦‚æœ‰ï¼‰

### è¨˜éŒ„
```bash
# è¨˜éŒ„éƒ¨ç½²ç‰ˆæœ¬
git log --oneline -1 > /tmp/deploy_version.txt
echo "éƒ¨ç½²æ™‚é–“: $(date)" >> /tmp/deploy_version.txt
cat /tmp/deploy_version.txt
```

---

## ğŸ”„ å›æ»¾æ­¥é©Ÿï¼ˆå¦‚æœéƒ¨ç½²å¤±æ•—ï¼‰

```bash
# 1. æŸ¥çœ‹ä¸Šä¸€å€‹ç‰ˆæœ¬
git log --oneline -5

# 2. å›æ»¾ä»£ç¢¼
git checkout [previous_commit_hash]

# 3. é‡æ–°æ§‹å»º
docker-compose -f docker-compose.prod.yml down
docker-compose -f docker-compose.prod.yml build --no-cache
docker-compose -f docker-compose.prod.yml up -d

# 4. é©—è­‰æœå‹™
docker-compose -f docker-compose.prod.yml ps
```

---

## ğŸ“ æ¨™æº–è¼¸å‡ºç¯„ä¾‹

### æˆåŠŸçš„éƒ¨ç½²æ‡‰è©²çœ‹åˆ°ï¼š
```
âœ… ä»£ç¢¼å·²æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬
âœ… å‰ç«¯å·²é‡æ–°æ§‹å»ºä¸¦ä¸Šå‚³ï¼ˆå¦‚éœ€è¦ï¼‰
âœ… æœå‹™å·²é‡æ–°æ§‹å»ºï¼ˆå¦‚éœ€è¦ï¼‰
âœ… æ‰€æœ‰æœå‹™ç‹€æ…‹ï¼šUp
âœ… API å¥åº·æª¢æŸ¥é€šé
âœ… å‰ç«¯å¯è¨ªå•
âœ… ç™»å…¥æ¸¬è©¦é€šé
âœ… åŠŸèƒ½æ¸¬è©¦é€šé
```

---

## âš ï¸ é‡è¦æé†’

1. **ä¸è¦è·³éä»»ä½•æª¢æŸ¥æ­¥é©Ÿ**
2. **ä¸è¦åœ¨ç”Ÿç”¢ç’°å¢ƒåšå¯¦é©—æ€§ä¿®æ”¹**
3. **æ¯æ¬¡éƒ¨ç½²éƒ½è¨˜éŒ„ç‰ˆæœ¬å’Œæ™‚é–“**
4. **æœ‰å•é¡Œç«‹å³å›æ»¾ï¼Œä¸è¦å˜—è©¦åœ¨ç·šä¿®å¾©**
5. **éƒ¨ç½²å‰åœ¨æœ¬åœ°æˆ–æ¸¬è©¦ç’°å¢ƒé©—è­‰**

---

## ğŸ†˜ ç·Šæ€¥è¯çµ¡

å¦‚æœéƒ¨ç½²éç¨‹ä¸­é‡åˆ°ç„¡æ³•è§£æ±ºçš„å•é¡Œï¼š
1. ç«‹å³å›æ»¾åˆ°ä¸Šä¸€å€‹ç©©å®šç‰ˆæœ¬
2. è¨˜éŒ„å®Œæ•´çš„éŒ¯èª¤æ—¥èªŒ
3. ä¸è¦é‡è¤‡å˜—è©¦å¤±æ•—çš„æ“ä½œ
