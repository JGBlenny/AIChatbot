# ğŸš€ èªç¾©æ¨¡å‹å¿«é€Ÿé–‹å§‹æŒ‡å—

## ğŸ“‹ å›ç­”æ‚¨çš„å•é¡Œ

### 1. æ–‡ä»¶çµæ§‹å·²å»ºç«‹ âœ…
```
semantic_model/
â”œâ”€â”€ README.md           # ä¸»æ–‡æª”
â”œâ”€â”€ QUICK_START.md     # æœ¬æ–‡ä»¶
â”œâ”€â”€ quick_start.sh     # ä¸€éµåŸ·è¡Œè…³æœ¬
â”œâ”€â”€ scripts/           # æ ¸å¿ƒè…³æœ¬
â”œâ”€â”€ models/            # è¨“ç·´å¥½çš„æ¨¡å‹
â”œâ”€â”€ data/              # è¨“ç·´æ•¸æ“š
â”œâ”€â”€ config/            # é…ç½®æ–‡ä»¶
â”œâ”€â”€ tests/             # æ¸¬è©¦è…³æœ¬
â””â”€â”€ docs/              # è©³ç´°æ–‡æª”
```

### 2. å¦‚ä½•å¯¦ä½œåœ¨å°è©±ç³»çµ±ä¸Šï¼Ÿ

**ç°¡å–®èªªï¼šèªç¾©æ¨¡å¼ + Reranker = æ›´æº–ç¢ºçš„çµæœ**

```python
# æ‚¨ç¾æœ‰çš„æµç¨‹
query â†’ å‘é‡æª¢ç´¢ â†’ Reranker â†’ çµæœ

# æ–°çš„æµç¨‹ï¼ˆåŠ å…¥èªç¾©ç†è§£ï¼‰
query â†’ èªç¾©æ¨¡å¼è­˜åˆ¥ â†’ å‘é‡æª¢ç´¢ â†’ æ¨¡å¼åŠ æ¬Š â†’ Reranker â†’ çµæœ
```

**å…·é«”å¯¦ä½œï¼š**
```python
# backend/services/chat_service.py ä¿®æ”¹

def enhanced_retrieve(query):
    # 1. è­˜åˆ¥èªç¾©æ¨¡å¼ï¼ˆæ–°å¢ï¼‰
    if "å¹¾è™Ÿ" in query or "ä½•æ™‚" in query:
        pattern = "time_query"
        boost_weight = 1.5

    # 2. å‘é‡æª¢ç´¢ï¼ˆåŸæœ‰ï¼‰
    candidates = vector_search(query)

    # 3. æ¨¡å¼åŠ æ¬Šï¼ˆæ–°å¢ï¼‰
    for c in candidates:
        if pattern == "time_query" and c.action_type == "form_fill":
            c.score *= boost_weight

    # 4. Rerankerï¼ˆåŸæœ‰ï¼‰
    reranked = reranker.predict(candidates)

    # 5. ç¶œåˆè©•åˆ†
    final_score = vector_score * 0.3 + pattern_score * 0.2 + reranker_score * 0.5
```

### 3. Reranker çš„è§’è‰²

| çµ„ä»¶ | ä½œç”¨ | ä½•æ™‚ä½¿ç”¨ |
|-----|------|----------|
| **å‘é‡æª¢ç´¢** | å¿«é€Ÿæ‰¾å‡ºç›¸é—œæ–‡æª” | ç¬¬ä¸€æ­¥ç¯©é¸ |
| **èªç¾©æ¨¡å¼** | ç†è§£æŸ¥è©¢æ„åœ–é¡å‹ | åˆ¤æ–·æ˜¯æ™‚é–“/è²»ç”¨/ç”³è«‹ç­‰ |
| **Reranker** | ç²¾ç¢ºåˆ¤æ–·ç›¸é—œæ€§ | æœ€çµ‚æ’åº |

**Reranker ä»ç„¶æœƒç”¨ï¼** åªæ˜¯åœ¨å®ƒä¹‹å‰åŠ äº†èªç¾©ç†è§£å±¤ã€‚

### 4. ä»€éº¼æ˜¯ã€ŒçœŸå¯¦è³‡æ–™è¨“ç·´ã€ï¼Ÿ

**çœŸå¯¦è³‡æ–™ = æ‚¨è³‡æ–™åº«ä¸­çš„å¯¦éš›å…§å®¹**

ä¸æ˜¯éš¨ä¾¿å¯«æ¸¬è©¦å¥å­ï¼Œè€Œæ˜¯ï¼š
1. **æ‚¨çš„çŸ¥è­˜åº«** - knowledge_base è¡¨çš„å…§å®¹
2. **æ­·å²æŸ¥è©¢** - ç”¨æˆ¶å¯¦éš›å•éçš„å•é¡Œï¼ˆå¦‚æœæœ‰è¨˜éŒ„ï¼‰
3. **æ­£ç¢ºé…å°** - å“ªå€‹æŸ¥è©¢æ‡‰è©²å°æ‡‰å“ªå€‹çŸ¥è­˜é»

**å…·é«”æ€éº¼åšï¼š**
```bash
# Step 1: æå–æ‚¨çš„çŸ¥è­˜åº«
python scripts/extract_knowledge.py
# é€™æœƒé€£æ¥æ‚¨çš„è³‡æ–™åº«ï¼Œæå–æ‰€æœ‰çŸ¥è­˜é»

# Step 2: ç”Ÿæˆè¨“ç·´æ•¸æ“š
python scripts/generate_training_data.py
# è‡ªå‹•ç‚ºæ¯å€‹çŸ¥è­˜é»ç”Ÿæˆå¯èƒ½çš„æŸ¥è©¢

# Step 3: è¨“ç·´æ¨¡å‹
python scripts/train.py
# ä½¿ç”¨ç”Ÿæˆçš„æ•¸æ“šè¨“ç·´èªç¾©ç†è§£æ¨¡å‹
```

## ğŸ¯ ç«‹å³é–‹å§‹ï¼ˆ5åˆ†é˜ï¼‰

### æœ€ç°¡å–®çš„æ–¹å¼ï¼šä¸€éµåŸ·è¡Œ

```bash
cd semantic_model
chmod +x quick_start.sh
./quick_start.sh
```

é€™å€‹è…³æœ¬æœƒè‡ªå‹•ï¼š
1. âœ… æª¢æŸ¥ç’°å¢ƒ
2. âœ… æå–çŸ¥è­˜åº«
3. âœ… ç”Ÿæˆè¨“ç·´æ•¸æ“š
4. âœ… é–‹å§‹è¨“ç·´ï¼ˆå¯é¸ï¼‰

### æ‰‹å‹•åŸ·è¡Œï¼ˆå¦‚æœæƒ³äº†è§£ç´°ç¯€ï¼‰

```bash
# 1. å®‰è£ä¾è³´
pip install sentence-transformers psycopg2-binary

# 2. æå–çŸ¥è­˜åº«ï¼ˆå¾æ‚¨çš„è³‡æ–™åº«ï¼‰
python scripts/extract_knowledge.py

# 3. ç”Ÿæˆè¨“ç·´æ•¸æ“š
python scripts/generate_training_data.py

# 4. è¨“ç·´æ¨¡å‹ï¼ˆéœ€è¦æ™‚é–“ï¼‰
python scripts/train.py
```

## ğŸ“Š è¨“ç·´æ™‚é–“é ä¼°

| ç’°å¢ƒ | è¨“ç·´æ™‚é–“ | å»ºè­° |
|-----|---------|------|
| CPU | 2-3 å°æ™‚ | å¯åœ¨èƒŒæ™¯åŸ·è¡Œ |
| GPU (CUDA) | 30-60 åˆ†é˜ | æ¨è–¦ |
| Apple M1/M2 | 1-2 å°æ™‚ | ä½¿ç”¨ MPS åŠ é€Ÿ |

## ğŸ”§ å¿«é€Ÿæ¸¬è©¦ï¼ˆä¸éœ€è¦è¨“ç·´ï¼‰

å¦‚æœæ‚¨æƒ³å…ˆæ¸¬è©¦æ•ˆæœï¼Œä¸è¨“ç·´ï¼š

```python
# semantic_model/test_quick.py

def quick_test_without_training():
    """ä¸è¨“ç·´ï¼Œç›´æ¥ç”¨è¦å‰‡æ¸¬è©¦"""

    queries = [
        "é›»è²»å¹¾è™Ÿå¯„",      # æ‡‰è©²è§¸ç™¼æ™‚é–“æŸ¥è©¢æ¨¡å¼
        "ç§Ÿé‡‘å¤šå°‘éŒ¢",      # æ‡‰è©²è§¸ç™¼è²»ç”¨æŸ¥è©¢æ¨¡å¼
        "ç”³è«‹é€€ç§Ÿ"         # æ‡‰è©²è§¸ç™¼ç”³è«‹è¾¦ç†æ¨¡å¼
    ]

    for query in queries:
        # ç°¡å–®çš„è¦å‰‡åˆ¤æ–·
        if "å¹¾è™Ÿ" in query or "ä½•æ™‚" in query:
            print(f"âœ… {query} â†’ æ™‚é–“æŸ¥è©¢æ¨¡å¼ â†’ è§¸ç™¼è¡¨å–®")
        elif "å¤šå°‘éŒ¢" in query or "è²»ç”¨" in query:
            print(f"âœ… {query} â†’ è²»ç”¨æŸ¥è©¢æ¨¡å¼ â†’ ç›´æ¥å›ç­”")
        elif "ç”³è«‹" in query or "è¾¦ç†" in query:
            print(f"âœ… {query} â†’ ç”³è«‹è¾¦ç†æ¨¡å¼ â†’ è§¸ç™¼è¡¨å–®")

# åŸ·è¡Œæ¸¬è©¦
quick_test_without_training()
```

## â“ å¸¸è¦‹å•é¡Œ

### Q: ä¸€å®šè¦è¨“ç·´å—ï¼Ÿ
**A:** ä¸ä¸€å®šã€‚æ‚¨å¯ä»¥å…ˆç”¨è¦å‰‡ç‰ˆæœ¬ï¼ˆè¦‹ implementation.md çš„å¿«é€Ÿå¯¦ä½œï¼‰ï¼Œçœ‹åˆ°æ•ˆæœå¾Œå†è¨“ç·´ã€‚

### Q: è¨“ç·´éœ€è¦ GPU å—ï¼Ÿ
**A:** ä¸éœ€è¦ã€‚CPU ä¹Ÿå¯ä»¥ï¼Œåªæ˜¯æ…¢ä¸€é»ï¼ˆ2-3å°æ™‚ vs 30åˆ†é˜ï¼‰ã€‚

### Q: æœƒå½±éŸ¿ç¾æœ‰ç³»çµ±å—ï¼Ÿ
**A:** ä¸æœƒã€‚é€™æ˜¯é™„åŠ å±¤ï¼Œä¸æ”¹è®ŠåŸæœ‰é‚è¼¯ã€‚

### Q: è¨“ç·´æ•¸æ“šå¾å“ªä¾†ï¼Ÿ
**A:** å¾æ‚¨çš„è³‡æ–™åº«è‡ªå‹•ç”Ÿæˆï¼ä¸éœ€è¦æ‰‹å‹•æº–å‚™ã€‚

## ğŸ“ éœ€è¦å¹«åŠ©ï¼Ÿ

1. æŸ¥çœ‹è©³ç´°æ–‡æª”ï¼š
   - `docs/implementation.md` - å¯¦ä½œç´°ç¯€
   - `docs/training_guide.md` - è¨“ç·´æŒ‡å—

2. æª¢æŸ¥è…³æœ¬ï¼š
   - `scripts/` è³‡æ–™å¤¾ä¸­çš„æ‰€æœ‰ .py æ–‡ä»¶

3. æ¸¬è©¦ç¯„ä¾‹ï¼š
   - `/tmp/test_semantic_billing.py` - æ¸¬è©¦æ•ˆæœ

## âœ… æª¢æŸ¥æ¸…å–®

- [ ] Docker PostgreSQL æ­£åœ¨é‹è¡Œ
- [ ] Python 3.7+ å·²å®‰è£
- [ ] pip install sentence-transformers
- [ ] åŸ·è¡Œ quick_start.sh
- [ ] æŸ¥çœ‹ç”Ÿæˆçš„è¨“ç·´æ•¸æ“š
- [ ] æ±ºå®šæ˜¯å¦è¦è¨“ç·´ï¼ˆ2-3å°æ™‚ï¼‰

æº–å‚™å¥½äº†å—ï¼ŸåŸ·è¡Œï¼š
```bash
./quick_start.sh
```

å°±é€™éº¼ç°¡å–®ï¼ğŸ‰